2023-12-06 01:12:20,857 - INFO - >>>>>=========================Start Train!===========================<<<<<
2023-12-06 01:12:20,858 - INFO - descriptor: SuperPoint+Boost-B-attlay3
2023-12-06 01:12:20,858 - INFO - num_epochs: 40
2023-12-06 01:12:20,858 - INFO - train_ratio: 1.0
2023-12-06 01:12:20,858 - INFO - batch_size: 64
2023-12-06 01:12:20,858 - INFO - num_workers: 4
2023-12-06 01:12:20,858 - INFO - print_interval: 20
2023-12-06 01:12:20,859 - INFO - eval_interval: 1
2023-12-06 01:12:20,859 - INFO - save_interval: 10
2023-12-06 01:12:20,859 - INFO - lr: 0.001
2023-12-06 01:12:20,859 - INFO - warmup_step: 20
2023-12-06 01:12:20,859 - INFO - random_seed: 0
2023-12-06 01:12:20,859 - INFO - expand_piexl: 5
2023-12-06 01:12:20,859 - INFO - test_threshold: 0.5
2023-12-06 01:12:20,859 - INFO - test_image: 
2023-12-06 01:12:20,859 - INFO - test_images: []
2023-12-06 01:12:20,859 - INFO - eval: False
2023-12-06 01:12:20,859 - INFO - save_path: work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth
2023-12-06 01:12:20,859 - INFO - log_file: work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_dataset_repeat_1_positive_keypoint_repeat_1_scratch.log
2023-12-06 01:12:20,859 - INFO - checkpoint: 
2023-12-06 01:12:20,859 - INFO - multiprocessing_context: spawn
2023-12-06 01:12:20,859 - INFO - data_root: data/hrsid
2023-12-06 01:12:20,860 - INFO - img_suffix: .png
2023-12-06 01:12:20,860 - INFO - train_ann_file: ['train/', 'val/']
2023-12-06 01:12:20,860 - INFO - test_ann_file: ['test/all', 'test/offshore', 'test/inshore']
2023-12-06 01:12:20,860 - INFO - dataset_class: {'ship': 1}
2023-12-06 01:12:20,860 - INFO - dataset_repeat: 1
2023-12-06 01:12:20,860 - INFO - positive_keypoint_repeat: 1
2023-12-06 01:12:20,860 - INFO - image_aug: False
2023-12-06 01:12:20,860 - INFO - print: True
2023-12-06 01:12:20,860 - INFO - feature_booster_pretrained: 
2023-12-06 01:12:20,860 - INFO - device: cuda
2023-12-06 01:12:20,860 - INFO - color: ['#00FF00', '#FF00FF', '#FF4500', '#009900', '#009999', '#ff0000', '#ffff00', '#00ff00', '#00ffff', '#0000ff']
# -*- coding: UTF-8 -*-
import pycolmap # pycolmap 占用的TLS最大,放在最前面 
# 原理参考: https://github.com/pytorch/pytorch/issues/2575#issue-254038499
from extract_features import normalize_keypoints, extractor_build, extract_img_feature
from torch.utils.data import DataLoader, Dataset
from os import path as osp
from pathlib import Path
from torch import nn
import numpy as np
import matplotlib
matplotlib.use('Agg')  # 设置Agg为后端
import matplotlib.pyplot as plt
import importlib
import warnings
import logging
import random
import torch
import copy
import time
import glob
import yaml
import cv2
import os
warnings.filterwarnings('ignore')

def parse_arguments():
    parser = importlib.import_module('argparse').ArgumentParser(description="Extract feature and refine descriptor using neural network to find ship keypoint.")

    parser.add_argument(
        '--descriptor', type=str, default='SuperPoint+Boost-B-attlay3',
        help='descriptor to extract' )

    parser.add_argument(
        '--num_epochs', type=int, default=40,)

    parser.add_argument(
        '--train_ratio', type=float, default=1.0,
        help='The ratio of data used for training out of the training set' )

    parser.add_argument(
        '--batch_size', type=int, default=64,)

    parser.add_argument(
        '--num_workers', type=int, default=4,)

    parser.add_argument(
        '--print_interval', type=int, default=20,)

    parser.add_argument(
        '--eval_interval', type=int, default=1,)

    parser.add_argument(
        '--save_interval', type=int, default=10,)

    parser.add_argument(
        '--lr', type=float, default=1e-3,)

    parser.add_argument(
        '--warmup_step', type=int, default=20,)

    parser.add_argument(
        '--random_seed', type=int, default=0,)

    parser.add_argument(
        '--expand_piexl', type=int, default=5,)

    parser.add_argument(
        '--test_threshold', type=float, default=0.5,)

    parser.add_argument(
        '--test_image', type=str, default='',)
    
    parser.add_argument(
        '--test_images', nargs='*', default=[],)
    
    parser.add_argument(
        '--eval', action='store_true',)

    parser.add_argument(
        '--save_path', type=str, default='',)

    parser.add_argument(
        '--log_file', type=str, default='',)

    parser.add_argument(
        '--checkpoint', type=str, default='',)

    parser.add_argument(
        '--multiprocessing_context', type=str, default=None,)

    parser.add_argument(
        '--data_root', type=str, default='data/hrsid',)

    parser.add_argument(
        '--img_suffix', type=str, default='.png',)

    parser.add_argument(
        '--train_ann_file', nargs='*', default=['train/','val/'],)

    parser.add_argument(
        '--test_ann_file', nargs='*', default=['test/all','test/offshore','test/inshore'],)

    parser.add_argument(
        '--dataset_class',
        nargs='*',
        # default=['ore-oil','Cell-Container','Fishing','LawEnforce','Dredger','Container'], # [166, 89 , 288 , 25 , 263 , 2053]
        default=["ship"],
        help='Dataset classes list. Default is ["ship"].'
    )

    parser.add_argument(
        '--dataset_repeat', type=int, default=1,)
    
    parser.add_argument(
        '--positive_keypoint_repeat', type=int, default=1,)

    parser.add_argument(
        '--image_aug', action='store_true',)
    
    parser.add_argument(
        '--print', action='store_true')

    args = parser.parse_args()
    args.dataset_class = {item: index + 1 for index, item in enumerate(args.dataset_class)}    
    return args

def calculate_md5(file_path):

    hash_md5 = importlib.import_module('hashlib').md5()
    with open(file_path, "rb") as f:
        # 以块的方式读取文件，以防文件太大
        for chunk in iter(lambda: f.read(4096), b""):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()

# 定义舰船目标关键点检测模型（示例）
class ShipKeyPointsModel(nn.Module):
    def __init__(self, args,):
        super().__init__()
        FeatureBooster = importlib.import_module('FeatureBooster.featurebooster').FeatureBooster
        MLP = importlib.import_module('FeatureBooster.featurebooster').MLP

        self.device = args.device

        with open(str(Path(__file__).parent / "config.yaml"), 'r') as f:
            config = yaml.load(f, Loader=yaml.FullLoader)
        self.config = config[args.descriptor]
        # Model
        self.feature_booster = FeatureBooster(self.config)
        # load the model
        if os.path.isfile(args.feature_booster_pretrained):
            self.feature_booster.load_state_dict(torch.load(args.feature_booster_pretrained), strict =False)
            args.logger.info(f"feature_booster weights loaded from {args.feature_booster_pretrained}!")
        self.fc_out = MLP([self.config['output_dim'], self.config['output_dim']//2, len(args.dataset_class) + 1]) 
        self.to(args.device)
        self.args = args

    def forward(self, x):
        feat = self.feature_booster(x[...,self.config['keypoint_dim']:], x[...,:self.config['keypoint_dim']])
        x = self.fc_out(feat)
        return feat, nn.functional.softmax(x, dim=-1)

def rotate_box_90_degrees(coords):
    x1, y1, x2, y2, x3, y3, x4, y4 = coords

    # 计算中心点
    cx = (x1 + x3) / 2
    cy = (y1 + y3) / 2

    # 将矩形平移到原点，旋转90度，然后平移回去
    rotated_coords = []
    for x, y in [(x1, y1), (x2, y2), (x3, y3), (x4, y4)]:
        x_prime = -y + cy + cx
        y_prime = x - cx + cy
        rotated_coords.extend([x_prime, y_prime])

    return rotated_coords

def load_txt_info_srsdd(txt_file, args):
    data_info = {}
    img_id = osp.split(txt_file)[1][:-4]
    data_info['img_id'] = img_id
    img_name = img_id + f'.{args.img_suffix.lstrip(".")}'
    data_info['file_name'] = img_name

    img_path = txt_file.replace('.txt',f'.{args.img_suffix.lstrip(".")}').replace('labels','images')
    data_info['img_path'] = img_path

    instances = []
    with open(txt_file) as f:
        s = f.readlines()
        for si in s[2:]:
            instance = {}
            bbox_info = si.split()
            instance['bbox_label'] = args.dataset_class[bbox_info[8]] if len(args.dataset_class) > 1 else 1
            instance['ignore_flag'] = 0
            instance['bbox'] = [float(i) for i in bbox_info[:8]]
            instances.append(instance)
    data_info['instances'] = instances
    return data_info

def load_txt_info_rsdd(txt_file, args):
    data_info = {}
    img_id = osp.split(txt_file)[1][:-4]
    data_info['img_id'] = img_id
    img_name = img_id + f'.{args.img_suffix.lstrip(".")}'
    data_info['file_name'] = img_name

    img_path = txt_file.replace('.txt',f'.{args.img_suffix.lstrip(".")}').replace('labels','images')
    data_info['img_path'] = img_path

    instances = []
    with open(txt_file) as f:
        s = f.readlines()
        for si in s:
            instance = {}
            bbox_info = si.split()
            instance['bbox_label'] = args.dataset_class[bbox_info[8]] if len(args.dataset_class) > 1 else 1
            instance['ignore_flag'] = 0
            instance['bbox'] = rotate_box_90_degrees([float(i) for i in bbox_info[2:]]) # 这里标注出的矩形框和真实中间差90度。可能是标注换换的问题。
            #人为旋转90度
            instances.append(instance)
    data_info['instances'] = instances
    return data_info

def load_txt_info_hrsid(txt_file, args):
    data_info = {}
    img_id = osp.split(txt_file)[1][:-4]
    data_info['img_id'] = img_id
    img_name = img_id + f'.{args.img_suffix.lstrip(".")}'
    data_info['file_name'] = img_name

    img_path = txt_file.replace('.txt',f'.{args.img_suffix.lstrip(".")}').replace('labelTxt','images')
    data_info['img_path'] = img_path

    instances = []
    with open(txt_file) as f:
        s = f.readlines()
        for si in s:
            instance = {}
            bbox_info = si.split()
            instance['bbox_label'] = args.dataset_class[bbox_info[8]]
            instance['ignore_flag'] = 0
            instance['bbox'] = [float(i) for i in bbox_info[:8]]
            instances.append(instance)
    data_info['instances'] = instances
    return data_info

def get_keypoint_label(keypoints, data_info, args):
    bboxes = []
    bbox_label = []
    for instances in data_info['instances']:
        bboxes.append(np.array([(instances['bbox'][i], instances['bbox'][i + 1]) for i in range(0, len(instances['bbox']), 2)], dtype=np.int32))
        bbox_label.append(instances['bbox_label'])

    tmp = np.zeros(data_info['image_shape'], dtype=np.uint8)
    for box, label in zip(bboxes, bbox_label):
        cv2.fillPoly(tmp, np.array([box]), label)
    target = []
    mode = importlib.import_module('scipy.stats').mode
    for kp in keypoints:
        region = tmp[max(0, int(kp[1] - args.expand_piexl)):min(int(kp[1] + args.expand_piexl), data_info['image_shape'][0]),
                    max(0, int(kp[0] - args.expand_piexl)):min(int(kp[0] +args.expand_piexl), data_info['image_shape'][1])].reshape(-1)
        region = region[region.astype(np.bool_)]
        if region.size > 0:
            # 计算区域的众数
            mode_val = mode(region, axis=None)[0][0]
            target.append(mode_val)
        else:
            target.append(0)
    return np.array(target), bboxes

# 定义数据集（示例）
class ShipKeyPointsDataset(Dataset):
    def __init__(self, args, dataset_repeat = 1, pipeline = [], debug = False, **kwargs):
        super(ShipKeyPointsDataset, self).__init__()
        if len(pipeline):
            importlib.import_module('mmdet.utils').register_all_modules(init_default_scope=False)
            importlib.import_module('mmdet.utils').register_all_modules(init_default_scope=False)
        self.transform = importlib.import_module('mmengine.dataset').Compose(pipeline)
        self.debug = debug
        self.args = args
        with open(str(Path(__file__).parent / "config.yaml"), 'r') as f:
            config = yaml.load(f, Loader=yaml.FullLoader)
        self.config = config[args.descriptor]
        self.extractor = extractor_build(self.args.descriptor, device = args.device)
        if 'ann_file' in kwargs and kwargs['ann_file'] !='':
            # train case
            ann_dir = kwargs['ann_file']
            if isinstance(ann_dir, str):
                ann_dir = [ann_dir]
        else:
            ann_dir = []
        self.txt_files = []
        for path in ann_dir:
            self.txt_files.extend(glob.glob(osp.join(args.data_root, path, "**/*.txt"), recursive=True)) 
        if (not args.eval) and (args.train_ratio<1):
            self.txt_files = random.sample(self.txt_files, int(np.ceil(len(self.txt_files)*args.train_ratio)))
        if (not args.eval) and (dataset_repeat > 1):
            self.txt_files = self.txt_files*dataset_repeat
            args.logger.info(f"The dataset located in {ann_dir} was duplicated {dataset_repeat} times!")

    def __len__(self):
        return len(self.txt_files)

    def load_data_info(self, idx):
        txt_file = self.txt_files[idx]
        load_txt_info_func = globals()['load_txt_info_' + self.args.data_root.rstrip('/').split('/')[-1]]
        return load_txt_info_func(txt_file, self.args)

    def __getitem__(self, idx):
        data_info = self.load_data_info(idx)
        bboxes = []
        if (not self.args.eval) and (len(self.transform.transforms)):
            data = self.transform(data_info)
            data_instance = data['data_samples'].gt_instances
            if (len(data_info['instances'])>0) and (len(data_instance.labels)<1):
                image = cv2.cvtColor(cv2.imread(data_info['img_path']), cv2.COLOR_BGR2RGB)
                data_info['image_shape'] = image.shape[:2]
            else:            
                image = data['inputs'].cpu().numpy().transpose(1, 2, 0)
                data_info['image_shape'] = image.shape[:2]
                data_info['instances'] = [] 
                for box_id in range(len(data_instance.labels)):
                    instance = {}
                    instance['bbox_label'] = int(data_instance.labels[box_id])
                    instance['bbox'] = list(data_instance.bboxes.vertices[box_id].reshape(-1).cpu().numpy())
                    data_info['instances'].append(instance)
            del data
        else:
            image = cv2.cvtColor(cv2.imread(data_info['img_path']), cv2.COLOR_BGR2RGB)
            data_info['image_shape'] = image.shape[:2]

        keypoints, descriptors, image = extract_img_feature(self.args.descriptor, image, self.extractor)
        if keypoints.size == 0:
            message = f"{data_info['img_path']} has no keypoint founded with {self.args.descriptor}"
            print(message)
            with open(self.args.log_file, "a") as file:   
                file.write(message+'\n')
            return torch.zeros([2, self.config['keypoint_dim'] + self.config['descriptor_dim'] + 2], dtype = torch.float32, requires_grad = False).float(), data_info['img_path']
        else:
            target, bboxes = get_keypoint_label(keypoints, data_info, self.args)
            
            if (not self.args.eval) and (self.args.positive_keypoint_repeat>1) and (np.random.rand() > 0.5): # 将正样本的关键点特征进行重复，增加正样本数目
                keypoints = np.concatenate([keypoints, np.tile(keypoints[target.astype(np.bool_)], (self.args.positive_keypoint_repeat,1))], axis=0)
                descriptors = np.concatenate([descriptors, np.tile(descriptors[target.astype(np.bool_)], (self.args.positive_keypoint_repeat,1))], axis=0)
                target = np.concatenate([target, np.tile(target[target.astype(np.bool_)], self.args.positive_keypoint_repeat)], axis=0)

            # visualization
            if self.debug:
                print(f"VISUALIZATION: {data_info['img_path']}")
                kps = np.array([cv2.KeyPoint(*kp) for kp in keypoints])
                image = cv2.drawKeypoints(image, kps[target.astype(np.bool_)], None, color=(255,0,0,))
                image = cv2.drawKeypoints(image, kps[~(target.astype(np.bool_))], None, color=(0,0,255))
                image = cv2.polylines(image, bboxes, isClosed=True, color=(0, 255, 0), thickness=2)
                cv2.imwrite(f"vis_dir/{data_info['img_id']}.png", cv2.cvtColor(image, cv2.COLOR_RGB2BGR))
                
            # boosted the descriptor using trained model
            keypoints = normalize_keypoints(keypoints, image.shape).astype(np.float32)
            if 'orb' in self.args.descriptor.lower():
                descriptors = np.unpackbits(descriptors, axis=1, bitorder='little').astype(np.float32)
                descriptors = descriptors * 2.0 - 1.0
            # 最后的全一是为了区分对齐batch的padding数据
            result = torch.from_numpy(np.concatenate([keypoints, descriptors, target.reshape(-1, 1), np.ones([len(target),1])], axis=-1))
            if (not self.args.eval) and (np.random.rand() > 0.5):
                result = result[torch.randperm(len(result))]
            result.requires_grad = False
            result = result.float()
            return result, data_info['img_path']

def hex_to_rgb(hex_color):
    hex_color = hex_color.lstrip('#')
    return tuple(int(hex_color[i:i+2], 16) for i in (0, 2, 4))

def get_metric(all_labels, all_output, args):
    accuracy_score = importlib.import_module('sklearn.metrics').accuracy_score
    recall_score = importlib.import_module('sklearn.metrics').recall_score
    precision_score = importlib.import_module('sklearn.metrics').precision_score
    precision_recall_curve = importlib.import_module('sklearn.metrics').precision_recall_curve
    average_precision_score = importlib.import_module('sklearn.metrics').average_precision_score
    f1_score = importlib.import_module('sklearn.metrics').f1_score
    if isinstance(all_output, torch.Tensor):
        if all_output.requires_grad:
            all_output = all_output.detach()
        all_output = all_output.cpu().numpy()
    if isinstance(all_labels, torch.Tensor):
        all_labels = all_labels.cpu().numpy()

    metrics_per_class = {}
    Average_Precision_Curve = {}
    avg_metrics = {}
  
    dataset_class = args.dataset_class.copy()
    if len(args.dataset_class) > 1:
        dataset_class['foreground'] = 0

    all_predict = np.zeros_like(all_output, dtype=bool)
    np.put_along_axis(all_predict, np.argmax(all_output, axis=-1).reshape(-1, 1), True, axis=-1)
     
    for class_name, idx in dataset_class.items():
        # 为当前类别准备标签和预测
        if class_name in 'foreground':
            class_labels = (all_labels != idx).astype(int)
            class_output = ~all_predict[:, 0]
            ap = average_precision_score(class_labels, 1-all_output[:, idx])
            precisions, recalls, _ = precision_recall_curve(class_labels, 1-all_output[:, idx])
        else:
            class_labels = (all_labels == idx).astype(int)
            class_output = all_predict[:, idx]
            ap = average_precision_score(class_labels, all_output[:, idx])
            precisions, recalls, _ = precision_recall_curve(class_labels, all_output[:, idx])
        # 计算指标
        accuracy = accuracy_score(class_labels, class_output)
        precision = precision_score(class_labels, class_output)
        recall = recall_score(class_labels, class_output)
        f1 = f1_score(class_labels, class_output)

        metrics_per_class[class_name] = {
            'Accuracy': accuracy,
            'Precision': precision,
            'Recall': recall,
            'F1_score': f1,
            'Average_Precision': ap,
        }
        Average_Precision_Curve[class_name] = {'Precision': precisions,'Recall': recalls}
        metrics_str = ', '.join(f"{metric}: {value:.4f}" for metric, value in metrics_per_class[class_name].items())
        args.logger.info(f"Metrics for {class_name}: {metrics_str}")

    if len(args.dataset_class)>1:    
        # 计算平均值
        for metric in metrics_per_class[list(args.dataset_class.keys())[0]].keys():
            avg_metrics[metric] = np.mean([class_metrics[metric] for class_metrics in metrics_per_class.values()])
        metrics_str = ', '.join(f"{metric}: {value:.4f}" for metric, value in avg_metrics.items())
        args.logger.info(f"Average metrics: {metrics_str}")
        
        if (not ( os.path.isfile(args.test_image) or (len(args.test_images)>0) )):
            for class_name, idx in dataset_class.items():
                plt.plot(Average_Precision_Curve[class_name]['Recall'], 
                        Average_Precision_Curve[class_name]['Precision'], label=class_name, color=args.color[idx % len(args.color)])
            # 设置图例和标签
            plt.xlabel('Recall')
            plt.ylabel('Precision')
            plt.title('Precision-Recall Curve')
            plt.legend()
            if (args.eval): 
                PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_eval.png'
            else:
                PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_train.png'
            plt.savefig(PR_curve_path, bbox_inches='tight', dpi=300)
            plt.close('all') 
            args.logger.info(f"PR_curve has been saved to {PR_curve_path}:")        
        return avg_metrics, Average_Precision_Curve['foreground']
    return metrics_per_class[list(args.dataset_class.keys())[0]], Average_Precision_Curve[list(args.dataset_class.keys())[0]] 

def evaluate(model, eva_loader, args):
    model.eval()

    all_output = torch.tensor([], device=args.device)
    all_labels = torch.tensor([], device=args.device)

    with torch.no_grad():
        for i, (data, img_paths) in enumerate(eva_loader):
            data = data.to(args.device)
            _, outputs = model(data[:,:,:-2])
            valid = data[:,:,-1].reshape(-1).bool()
            all_output = torch.cat([all_output, outputs.view(-1,len(args.dataset_class)+1)[valid,:]], dim=0)
            all_labels = torch.cat([all_labels, data[:,:,-2].long().reshape(-1)[valid]], dim=0)

            if (i + 1) % args.print_interval == 0:
                args.logger.info(f"Epoch(test) : [{i + 1}/{len(eva_loader)}]")

    return get_metric(all_labels, all_output, args)

def test(model, test_image, args):
    model.eval()
    extractor = extractor_build(args.descriptor)
    keypoints, descriptors, image = extract_img_feature(args.descriptor, cv2.cvtColor(cv2.imread(test_image), cv2.COLOR_BGR2RGB), extractor)

    load_txt_info_func = globals()['load_txt_info_' + args.data_root.rstrip('/').split('/')[-1]]
    txt_file = test_image.replace(f'.{args.img_suffix.lstrip(".")}','.txt').replace('images','**')
    txt_file = glob.glob(txt_file, recursive=True)[0]
    data_info = load_txt_info_func(txt_file, args)
    data_info['image_shape'] = image.shape[:2]
    labels, bboxes = get_keypoint_label(keypoints, data_info, args)
    
    kps = np.array([cv2.KeyPoint(*kp) for kp in keypoints])
    # boosted the descriptor using trained model
    keypoints = normalize_keypoints(keypoints, image.shape).astype(np.float32)
    if 'orb' in args.descriptor.lower():
        descriptors = np.unpackbits(descriptors, axis=1, bitorder='little').astype(np.float32)
        descriptors = descriptors * 2.0 - 1.0
    with torch.no_grad():
        _, output = model(torch.from_numpy(np.concatenate([keypoints, descriptors,], axis=-1)).to(args.device).float()).cpu().numpy()

    metric_dict, PR_dict = get_metric(labels, output, args)
    # predict = (1-output[...,0]) > args.test_threshold
    predict = np.argmax(output, axis=-1)
    dataset_class = dict()
    for class_name, idx in args.dataset_class.items():
        dataset_class[str(idx)] = class_name
        index = (predict==idx) # & (output[:,idx]>args.test_threshold)
        image = cv2.drawKeypoints(image, kps[index&labels.astype(np.bool_)], None, color=hex_to_rgb("#00FF00"),)
        image = cv2.drawKeypoints(image, kps[index&(~labels.astype(np.bool_))], None, color=hex_to_rgb("#FF00FF"),)
        # image = cv2.drawKeypoints(image, kps[(~predict)&(labels)], None, color=(0,0,255)) # Aqua蓝色 漏检
        # image = cv2.drawKeypoints(image, kps[predict&labels], None, color=(0,0,255,),) # 黄色 正确预测(正样本)
        # image = cv2.drawKeypoints(image, kps[(~predict)&(~labels)], None, color= (0, 255, 0) ) # 绿色 正确预测(负样本)
        # image = cv2.drawKeypoints(image, kps[(label)], None, color=(255,0,0,))
        # image = cv2.drawKeypoints(image, kps[~predict], None, color=(0,255,0))
    for instance in data_info['instances']:
        color=hex_to_rgb("#FFFF00")
        box = np.array([(instance['bbox'][i], instance['bbox'][i + 1]) for i in range(0, len(instance['bbox']), 2)], dtype=np.int32)
        image = cv2.polylines(image, [box], isClosed=True, color=color, thickness=1)
        # cls_name = dataset_class[str(instance['bbox_label'])]
        # assert args.dataset_class[cls_name] == instance['bbox_label']
        # cv2.putText(image, cls_name, (int(instance['bbox'][0]), int(instance['bbox'][1])), cv2.FONT_HERSHEY_SIMPLEX, 0.5, color, 1)
    save_path = f"{args.data_root.rstrip('/').split('/')[-1]}_keypoint_results/{args.descriptor}/vis/" + test_image.split('/')[-1]
    if not os.path.exists(os.path.dirname(save_path)):
        os.makedirs(os.path.dirname(save_path))
    cv2.imwrite(save_path, cv2.cvtColor(image, cv2.COLOR_RGB2BGR))
    return metric_dict, PR_dict

def keypoint_match(model, args, test_image1, test_image2):
    model.eval()
    extractor = extractor_build(args.descriptor)
    load_txt_info_func = globals()['load_txt_info_' + args.data_root.rstrip('/').split('/')[-1]]

    imgs = []
    kps = []
    descriptors = []
    labels = []
    for img_path in [test_image1, test_image2]:
        kp, des, img = extract_img_feature(args.descriptor, cv2.cvtColor(cv2.imread(img_path), cv2.COLOR_BGR2RGB), extractor)
        txt_file = img_path.replace(f'.{args.img_suffix.lstrip(".")}','.txt').replace('images','**')
        txt_file = glob.glob(txt_file, recursive=True)[0]
        data_info = load_txt_info_func(txt_file, args)
        data_info['image_shape'] = img.shape[:2]
        label, bboxes = get_keypoint_label(kp, data_info, args)

        if 'orb' in args.descriptor.lower():
            des = np.unpackbits(des, axis=1, bitorder='little').astype(np.float32)
            des = des * 2.0 - 1.0
        kp_norm = normalize_keypoints(kp, img.shape).astype(np.float32)
        des, _ = model(torch.from_numpy(np.concatenate([kp_norm, des], axis=-1)).to(args.device).float())
        des = des.detach().cpu().numpy()
        imgs.append(img)
        kps.append(kp)
        descriptors.append(des)
        labels.append(label)
        
    border = 10
    kps[1] = np.array([cv2.KeyPoint(kp_i[0] + border + imgs[0].shape[1], kp_i[1], kp_i[2]) for kp_i in kps[1]])
    kps[0] = np.array([cv2.KeyPoint(kp_i[0] , kp_i[1], kp_i[2]) for kp_i in kps[0]])
      
    imgs[1] = cv2.copyMakeBorder(imgs[1], 0, 0, border, 0, cv2.BORDER_CONSTANT, value=[255, 255, 255])
    dis = torch.cdist(torch.from_numpy(descriptors[0]),torch.from_numpy(descriptors[1]))
    matches_AB = torch.argmin(dis,dim=-1).cpu().numpy()
    matches_BA = torch.argmin(dis,dim=0).cpu().numpy()
    
    h1, w1 = imgs[0].shape[:2]
    h2, w2 = imgs[1].shape[:2]
    height = max(h1, h2)
    width = w1 + w2
    img_matches = np.zeros((height, width, 3), dtype="uint8")
    img_matches[:h1, :w1, :] = imgs[0]
    img_matches[:h2, w1:(w1 + w2), :] = imgs[1]

    for kp_i, label_i in zip(kps, labels):
        for kp_j, label_j in zip(kp_i, label_i):
            pt2 = tuple(np.round(kp_j.pt).astype(int))
            cv2.circle(img_matches, pt2, 5, color = hex_to_rgb("#40E0D0") if label_j>0 else hex_to_rgb("#FF0000"), thickness = 1) # if label_j>0 else hex_to_rgb("#FF0000")
    def draw_matches(img, kps, matches, color = hex_to_rgb("#FFFF00"), inverse = False):
        if inverse:
            color = hex_to_rgb("#00FF00")
        matches = matches[labels[int(inverse)].astype(np.bool_)] 
        for src,des,idx in zip(kps[int(inverse)][labels[int(inverse)].astype(np.bool_)], kps[1-int(inverse)][matches], matches):
            pt1 = tuple(np.round(src.pt).astype(int))
            pt2 = tuple(np.round(des.pt).astype(int))
            if labels[1-int(inverse)][idx]:
                cv2.arrowedLine(img, pt1, pt2, color , thickness = 1, tipLength=0.01)
            else:
                cv2.arrowedLine(img, pt1, pt2, hex_to_rgb("#FF0000"), thickness = 1, tipLength=0.01)
    draw_matches(img_matches, kps, matches_AB)
    draw_matches(img_matches, kps, matches_BA, inverse = True)

    # bf = cv2.BFMatcher(cv2.NORM_L2, crossCheck=True)
    # matches = bf.match(descriptors[0], descriptors[1])
    # matches = sorted(matches, key=lambda x: x.distance, reverse = True)
    # img_matches = cv2.drawMatches(imgs[0], kps[0], imgs[1], kps[1], matches, None, matchColor=(0, 255, 0), flags=cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS)

    save_path = f"{args.data_root.rstrip('/').split('/')[-1]}_keypoint_results/{args.descriptor}/kp_matched/{test_image1.split('/')[-1][:-4]}vs{test_image2.split('/')[-1]}"
    if not os.path.exists(os.path.dirname(save_path)):
        os.makedirs(os.path.dirname(save_path))        
    cv2.imwrite(save_path, cv2.cvtColor(img_matches, cv2.COLOR_RGB2BGR))
    args.logger.info(f"result saved to {save_path}")
    return img_matches

def worker_init_fn(worker_id, group, args):
    # torch.cuda.set_device(worker_id) 指定数加载设备
    torch.cuda.manual_seed_all(worker_id)

def custom_collate_fn(batch):
    rnn_utils = importlib.import_module('torch.nn.utils.rnn')
    results = [item[0] for item in batch]  # 提取每个样本的result
    img_paths = [item[1] for item in batch]  # 提取每个样本的img_path
    padded_results = rnn_utils.pad_sequence(results, batch_first=True, padding_value=0)
    return padded_results, img_paths

def train(model, args):
    CosineAnnealingWarmRestarts = importlib.import_module('torch.optim.lr_scheduler').CosineAnnealingWarmRestarts
    LinearLR = importlib.import_module('torch.optim.lr_scheduler').LinearLR
    MultiStepLR = importlib.import_module('torch.optim.lr_scheduler').MultiStepLR
    ChainedScheduler = importlib.import_module('torch.optim.lr_scheduler').ChainedScheduler
    clip_grad_norm_ = importlib.import_module('torch.nn.utils').clip_grad_norm_
    optimizer_class = importlib.import_module('torch.optim').AdamW
    partial = importlib.import_module('functools').partial
    train_pipeline = []
    if args.image_aug:
        train_pipeline = [
            dict(type='mmdet.LoadImageFromFile', backend_args=None),
            dict(type='mmdet.LoadAnnotations', with_bbox=True, box_type='qbox'),
            dict(
                type='mmrotate.ConvertBoxType',
                box_type_mapping=dict(gt_bboxes='rbox')),
            dict(
                type='mmrotate.RandomRotate',
                prob=0.5,
                angle_range=180,
                rotate_type='mmrotate.Rotate'),
            dict(
                type='mmdet.RandomFlip',
                prob=0.75,
                direction=['horizontal', 'vertical', 'diagonal']),
            dict(
                type='mmdet.RandomAffine',),
            dict(
                type='mmdet.PhotoMetricDistortion',),

            dict(
                type='mmrotate.ConvertBoxType',
                box_type_mapping=dict(gt_bboxes='qbox')),
            dict(type='mmdet.PackDetInputs', meta_keys=())]
    train_dataset = ShipKeyPointsDataset(args, ann_file = args.train_ann_file, dataset_repeat = args.dataset_repeat, pipeline = train_pipeline)
    train_loader = DataLoader(train_dataset, batch_size=args.batch_size, shuffle=True, 
                              num_workers=args.num_workers, collate_fn=custom_collate_fn, 
                              # worker_init_fn=partial(worker_init_fn, group='train', args = args),
                              # pin_memory=True, persistent_workers = True,
                              multiprocessing_context=args.multiprocessing_context)
    eva_loader = {}
    for ann_file in args.test_ann_file:
        eval_args = copy.deepcopy(args)
        eval_args.eval = True
        eva_dataset = ShipKeyPointsDataset(args = eval_args, ann_file = ann_file)
        eva_loader[ann_file] = DataLoader(eva_dataset, batch_size=args.batch_size, shuffle=False, 
                                num_workers=args.num_workers, collate_fn=custom_collate_fn, 
                                # worker_init_fn=partial(worker_init_fn, group='eval', args = args), 
                                # pin_memory=True, persistent_workers = True,
                                multiprocessing_context=args.multiprocessing_context)
    if args.print:
        outputs = importlib.import_module('mmengine.analysis').get_model_complexity_info(
            model,
            input_shape=None,
            inputs=train_dataset.__getitem__(0)[0][:,:-2].float().to(args.device),  # the input tensor of the model
            show_table=True,  # show the complexity table
            show_arch=False)  # show the complexity arch
        for k, v in outputs.items():
            args.logger.info(f"{k}: {v}")
    # 定义损失函数和优化器
    weight = torch.softmax(1/torch.tensor([100000.0,  166, 89 , 288 , 25 , 263 , 2053], device = args.device),dim=-1) # [100000.0,  166, 89 , 288 , 25 , 263 , 2053]

    CenterLoss = getattr(importlib.import_module("CenterLoss"), "CenterLoss")
    loss_weight = 20
    centerloss = CenterLoss(len(args.dataset_class) + 1, model.config['output_dim']).to(args.device)
    nllloss = nn.NLLLoss().to(args.device)
    param_groups = [
        {'params': model.parameters(), 'lr': args.lr, 'weight_decay': 1e-4},
        {'params': centerloss.parameters(), 'lr': args.lr, 'weight_decay': 1e-4}
    ]
    optimizer = optimizer_class(param_groups) # 
    # warmup_scheduler = LinearLR(optimizer, start_factor=1.0 / 20, end_factor=1.0, total_iters=args.warmup_step)
    scheduler = CosineAnnealingWarmRestarts(optimizer, T_0=20, T_mult=2, eta_min = 1e-5)
    # scheduler = MultiStepLR(optimizer, milestones=[40, 70, 90], gamma=0.5)
    # scheduler = ChainedScheduler([warmup_scheduler, step_scheduler])

    start_epoch = 0
    best_AP = 0.0
    if os.path.isfile(args.checkpoint):
        checkpoint = torch.load(args.checkpoint)
        model.load_state_dict(checkpoint['model_state_dict'])
        centerloss.load_state_dict(checkpoint['centerloss_state_dict'])
        optimizer.load_state_dict(checkpoint['optimizer_state_dict']),
        scheduler.load_state_dict(checkpoint['scheduler_state_dict'])
        start_epoch = checkpoint['epoch']+1
        best_AP = checkpoint['best_AP']
        args.logger.info(f'Continue training from epoch [{start_epoch}] !')

    # getGPUs = importlib.import_module('GPUtil').getGPUs
    # virtual_memory = importlib.import_module('psutil').virtual_memory
    # collect = importlib.import_module('gc').collect
    for epoch in range(start_epoch, args.num_epochs):
        start_time = time.time()
        model.train()
        for i, (data, img_paths)  in enumerate(train_loader):
            torch.cuda.empty_cache() # 在显存资源有限的情况下使用
            data = data.to(args.device)
            # collect() # 显式垃圾回收
            # memory = virtual_memory()
            # args.logger.info(f"总内存: {memory.total / (1024 ** 3):.2f} GB, 可用内存: {memory.available / (1024 ** 3):.2f} GB, 内存使用率: {memory.percent}%")
            # gpu = getGPUs()[0]
            # args.logger.info(f">>>before: GPU: {gpu.name}, 显存总量: {gpu.memoryTotal}MB, 显存使用: {gpu.memoryUsed}MB, 显存空闲: {gpu.memoryFree}MB")
            feat, outputs = model(data[:,:,:-2])
            # args.logger.info(f">>>after: GPU: {gpu.name}, 显存总量: {gpu.memoryTotal}MB, 显存使用: {gpu.memoryUsed}MB, 显存空闲: {gpu.memoryFree}MB")
            valid = data[:,:,-1].reshape(-1).bool()
            label_inc = data[:,:,-2].long().view(-1)[valid]
            feat = feat.view(-1,model.config['output_dim'])[valid,:]
            outputs = outputs.view(-1,len(args.dataset_class)+1)[valid,:]
            
            # label = nn.functional.one_hot(label_inc, num_classes= len(args.dataset_class) + 1).float()
            
            # if len(args.dataset_class) > 1: # soft_label
            #     softening_value = 0.1
            #     non_background_mask = (label_inc != 0).unsqueeze(dim=-1).repeat(1,len(args.dataset_class)+1)
            #     non_background_mask[...,0] = False
            #     label[non_background_mask] = label[non_background_mask]  * (1 - softening_value) + \
            #                                     (1 - label[non_background_mask]) * softening_value / (len(args.dataset_class)-1)  
                                                          
            # loss_cls = torch.mean(- 0.75*label * ((1-outputs)**2) *torch.log(outputs) - 0.25*((1-label) *(outputs**2)* torch.log(1-outputs)), dim = 0)
            # inter_cls_loss = torch.sum(loss_cls*weight)
            inter_cls_loss = nllloss(torch.log(outputs), label_inc)
            inner_cls_loss = centerloss(feat, label_inc)
            loss = loss_weight * inter_cls_loss + inner_cls_loss
            
            optimizer.zero_grad()
            loss.backward()
            clip_grad_norm_(model.parameters(), 35, 2)
            clip_grad_norm_(centerloss.parameters(), 35, 2)
            optimizer.step()
            del outputs, data, valid
            if (i + 1) % args.print_interval == 0:
                current_time = time.time()
                eta_seconds = (current_time - start_time) / (i+1) * ( (args.num_epochs - epoch ) * len(train_loader) - (i + 1))
                eta_str = str(int(eta_seconds // 3600)) + ':' + str(int((eta_seconds % 3600) // 60)) + ':' + str(int(eta_seconds % 60))
                # loss_str = ' '.join([f"{cls_name}:{loss_value:.4f}" for cls_name,loss_value in zip(['background'] + list(args.dataset_class.keys()), loss_cls)])
                args.logger.info(f"Epoch(train)"
                      f"[{epoch + 1}/{args.num_epochs}][{i + 1}/{len(train_loader)}]"
                      f"lr: {optimizer.param_groups[0]['lr']:.4e}  eta: {eta_str}  " 
                      f"time: {current_time - start_time:.4f}  inter_cls_loss: {inter_cls_loss:.4f} inner_cls_loss: {inner_cls_loss.item():.4f}")
        scheduler.step()
        if ((epoch+1) % args.eval_interval == 0) or (epoch == 0) or (epoch == args.num_epochs-1): #            
            for idx, ann_file in enumerate(args.test_ann_file): 
                args.logger.info(f"Epoch(test) {ann_file}:")
                metric_dict_all, PR_dict_all = evaluate(model, eva_loader[ann_file], args)
                if len(args.test_ann_file) >1:
                    plt.plot(PR_dict_all['Recall'], PR_dict_all['Precision'], label=ann_file, color=args.color[idx % len(args.color)])
            if len(args.test_ann_file) >1:
                plt.xlabel('Recall')
                plt.ylabel('Precision')
                plt.title('Precision-Recall Curve')
                plt.legend()
                PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_train.png'
                plt.savefig(PR_curve_path, bbox_inches='tight', dpi=300)
                plt.close('all') 
                args.logger.info(f"PR_curve has been saved to {PR_curve_path}:")      
                               
            # 检查是否有更好的模型，如果有，则保存权重
            if metric_dict_all['Average_Precision'] > best_AP:
                best_AP = metric_dict_all['Average_Precision']
                # 保存当前模型的权重
                torch.save(model.state_dict(), args.save_path)
                args.logger.info(f"Best model saved to  {args.save_path} with MD5 {calculate_md5(args.save_path)}, with {args.test_ann_file[-1]} image AP {best_AP:.4f}")
            if (epoch >= args.num_epochs-1):
                last_save_path = 'work_dirs/' + args.data_root.rstrip('/').split('/')[-1] + '_' + args.descriptor + f'_{args.train_ratio*100:.0f}' + '_last_model_weight.pth'
                torch.save(model.state_dict(), last_save_path)
                args.logger.info(f"Last model saved :{last_save_path}")

        if ((epoch+1) % args.save_interval == 0):
            for file_path in glob.glob(args.save_path[:-4] + '*_epoch.pth'):
                os.remove(file_path)
            torch.save({
                'model_state_dict': model.state_dict(),
                'centerloss_state_dict': centerloss.state_dict(),
                'optimizer_state_dict': optimizer.state_dict(),
                'scheduler_state_dict': scheduler.state_dict(),
                'epoch': epoch,
                'best_AP': best_AP,
                }, args.save_path[:-4] + f'_{epoch+1}_epoch.pth')

if __name__ == '__main__':
    args = parse_arguments()

    random.seed(args.random_seed)
    np.random.seed(args.random_seed)
    torch.manual_seed(args.random_seed)
    if torch.cuda.is_available():
        torch.cuda.manual_seed_all(args.random_seed)

    if ('alike' in args.descriptor.lower()) or ('superpoint' in args.descriptor.lower()) or ('hardnet' in args.descriptor.lower()) or ('sosnet' in args.descriptor.lower()):
        args.multiprocessing_context = 'spawn'

    args.feature_booster_pretrained = '' # Path(__file__).parent / str("FeatureBooster/models/" + args.descriptor + ".pth")
    pretrained_str = 'finetune' if os.path.isfile(args.feature_booster_pretrained) else 'scratch'
    args.save_path = args.save_path if len(args.save_path) else 'work_dirs/' + args.data_root.rstrip('/').split('/')[-1] + '_' + args.descriptor + f'_{args.train_ratio*100:.0f}' + f"_bs{args.batch_size}" + f'_best_model_weights_{pretrained_str}.pth'
    args.device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    # args.color = ['#ff0000', '#ffff00', '#00ff00', '#00ffff', '#0000ff', '#ff00ff', '#990000', '#999900', '#009900', '#009999'] 
    args.color = ['#00FF00', '#FF00FF', '#FF4500', '#009900', '#009999','#ff0000', '#ffff00', '#00ff00','#00ffff', '#0000ff', ] 
    model = ShipKeyPointsModel(args)
    
    # 创建日志器
    logger = logging.getLogger()
    logger.setLevel(logging.INFO)
    # 创建控制台处理程序
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.INFO)
    console_handler.setFormatter(logging.Formatter('%(asctime)s - %(levelname)s - %(message)s'))    
    logger.addHandler(console_handler)
    args.logger = logger
    if (not args.eval) and (not ( os.path.isfile(args.test_image) or (len(args.test_images)>0) )): # train
        args.log_file = args.log_file if len(args.log_file) else 'work_dirs/' + args.data_root.rstrip('/').split('/')[-1] + '_' + args.descriptor + f'_{args.train_ratio*100:.0f}' + f"_bs{args.batch_size}" + f'_dataset_repeat_{args.dataset_repeat}_positive_keypoint_repeat_{args.positive_keypoint_repeat}_{pretrained_str}.log'
        if not os.path.exists(os.path.dirname(args.log_file)):
            os.makedirs(os.path.dirname(args.log_file))
        # 创建文件处理程序
        file_handler = logging.FileHandler(args.log_file, mode='a')
        file_handler.setLevel(logging.INFO)
        file_handler.setFormatter(logging.Formatter('%(asctime)s - %(levelname)s - %(message)s'))
        # 添加处理程序到日志器
        logger.addHandler(file_handler)
        logger.info(">>>>>=========================Start Train!===========================<<<<<")
        for k, v in vars(args).items():
            if k not in 'logger':
                logger.info(f"{k}: {v}")

        if args.print: 
            with open(__file__, 'r') as file:
                lines = file.readlines()
            with open(args.log_file, "a") as file:   
                for line in lines:
                    file.write(line[:-1]+'\n')
                file.write('\n')
        train(model, args)
        args.logger.info(f"model weights saved to {args.save_path} with MD5 {calculate_md5(args.save_path)}!")
        args.checkpoint = args.save_path
        args.eval = True

    model_weights_md5 = "init_md5"
    if os.path.isfile(args.checkpoint):
        if 'cpu' in args.device.type:
            model.load_state_dict(torch.load(args.checkpoint, map_location=lambda storage, loc:storage), strict=False)
        else:
            model.load_state_dict(torch.load(args.checkpoint), strict=False)
        model_weights_md5 = calculate_md5(args.checkpoint)
        args.logger.info(f"model weights loaded from {args.checkpoint} with MD5 {model_weights_md5}!")
        model_weights_md5 = model_weights_md5[:5]

    # keypoint_match(model, args, args.test_images[0], args.test_images[1])
    # exit(0)
    
    for img in args.test_images:
        if os.path.isfile(img):
            args.logger.info(f"Epoch(test) - {img}:")
            metric_dict, PR_dict = test(model,img, args)
    if os.path.isfile(args.test_image):
        args.logger.info(f"Epoch(test) - {args.test_image}:")
        metric_dict, PR_dict = test(model, args.test_image, args)
    if args.eval:
        for idx, ann_file in enumerate(args.test_ann_file):
            args.logger.info(f"Epoch(test) {ann_file}:")
            eva_dataset = ShipKeyPointsDataset(args = args, ann_file = ann_file)
            eva_loader = DataLoader(eva_dataset, batch_size=args.batch_size, shuffle=False, 
                                    num_workers=args.num_workers, collate_fn=custom_collate_fn, 
                                    pin_memory=True, persistent_workers = True, multiprocessing_context=args.multiprocessing_context)
            metric_dict, PR_dict_all = evaluate(model, eva_loader, args)
            if len(args.test_ann_file) >1:
                plt.plot(PR_dict_all['Recall'], PR_dict_all['Precision'], label=ann_file, color=args.color[idx % len(args.color)])
        if len(args.test_ann_file) >1:
            plt.xlabel('Recall')
            plt.ylabel('Precision')
            plt.title('Precision-Recall Curve')
            plt.legend()
            PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_eval_{model_weights_md5}.png'
            plt.savefig(PR_curve_path, bbox_inches='tight', dpi=300)
            plt.close('all') 
            args.logger.info(f"PR_curve has been saved to {PR_curve_path}!"

2023-12-06 01:12:22,986 - INFO - flops: 43683904
2023-12-06 01:12:22,986 - INFO - flops_str: 43.684M
2023-12-06 01:12:22,986 - INFO - activations: 159852
2023-12-06 01:12:22,987 - INFO - activations_str: 0.16M
2023-12-06 01:12:22,987 - INFO - params: 1987522
2023-12-06 01:12:22,987 - INFO - params_str: 1.988M
2023-12-06 01:12:22,987 - INFO - out_table: 
+---------------------------+----------------------+------------+--------------+
| module                    | #parameters or shape | #flops     | #activations |
+---------------------------+----------------------+------------+--------------+
| model                     | 1.988M               | 43.684M    | 0.16M        |
|  feature_booster          |  1.954M              |  42.957M   |  0.157M      |
|   feature_booster.kenc.e… |   0.109M             |   2.39M    |   16.192K    |
|    feature_booster.kenc.… |    0.128K            |    2.112K  |    0.704K    |
|    feature_booster.kenc.… |    2.112K            |    45.056K |    1.408K    |
|    feature_booster.kenc.… |    8.32K             |    0.18M   |    2.816K    |
|    feature_booster.kenc.… |    33.024K           |    0.721M  |    5.632K    |
|    feature_booster.kenc.… |    65.792K           |    1.442M  |    5.632K    |
|   feature_booster.denc.e… |   0.197M             |   4.325M   |   16.896K    |
|    feature_booster.denc.… |    65.792K           |    1.442M  |    5.632K    |
|    feature_booster.denc.… |    65.792K           |    1.442M  |    5.632K    |
|    feature_booster.denc.… |    65.792K           |    1.442M  |    5.632K    |
|   feature_booster.attn_p… |   1.581M             |   34.772M  |   0.118M     |
|    feature_booster.attn_… |    0.527M            |    11.591M |    39.424K   |
|    feature_booster.attn_… |    0.527M            |    11.591M |    39.424K   |
|    feature_booster.attn_… |    0.527M            |    11.591M |    39.424K   |
|   feature_booster.final_… |   65.792K            |   1.442M   |   5.632K     |
|    feature_booster.final… |    (256, 256)        |            |              |
|    feature_booster.final… |    (256,)            |            |              |
|   feature_booster.layer_… |   0.512K             |   28.16K   |   0          |
|    feature_booster.layer… |    (256,)            |            |              |
|    feature_booster.layer… |    (256,)            |            |              |
|  fc_out                   |  33.154K             |  0.727M    |  2.86K       |
|   fc_out.0                |   32.896K            |   0.721M   |   2.816K     |
|    fc_out.0.weight        |    (128, 256)        |            |              |
|    fc_out.0.bias          |    (128,)            |            |              |
|   fc_out.2                |   0.258K             |   5.632K   |   44         |
|    fc_out.2.weight        |    (2, 128)          |            |              |
|    fc_out.2.bias          |    (2,)              |            |              |
+---------------------------+----------------------+------------+--------------+

2023-12-06 01:12:22,987 - INFO - out_arch: 
2023-12-06 01:13:15,468 - INFO - Epoch(train)[1/40][20/58]lr: 1.0000e-03  eta: 1:40:33  time: 52.4670  inter_cls_loss: 0.6252 inner_cls_loss: 57.5372
2023-12-06 01:13:51,196 - INFO - Epoch(train)[1/40][40/58]lr: 1.0000e-03  eta: 1:23:47  time: 88.1954  inter_cls_loss: 0.6505 inner_cls_loss: 59.3135
2023-12-06 01:14:23,736 - INFO - Epoch(test) test/all:
2023-12-06 01:15:11,174 - INFO - Epoch(test) : [20/31]
2023-12-06 01:15:31,210 - INFO - Metrics for ship: Accuracy: 0.8194, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.4667
2023-12-06 01:15:31,250 - INFO - Epoch(test) test/offshore:
2023-12-06 01:16:16,332 - INFO - Epoch(test) : [20/26]
2023-12-06 01:16:28,478 - INFO - Metrics for ship: Accuracy: 0.6329, Precision: 0.9013, Recall: 0.0180, F1_score: 0.0353, Average_Precision: 0.5914
2023-12-06 01:16:28,482 - INFO - Epoch(test) test/inshore:
2023-12-06 01:16:47,253 - INFO - Metrics for ship: Accuracy: 0.8795, Precision: 0.2510, Recall: 0.0040, F1_score: 0.0078, Average_Precision: 0.2488
2023-12-06 01:16:48,002 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:16:48,043 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 7bb450daf7596e0820af0d6cff6f93b1, with test/inshore image AP 0.2488
2023-12-06 01:17:39,380 - INFO - Epoch(train)[2/40][20/58]lr: 9.9391e-04  eta: 1:35:54  time: 51.3347  inter_cls_loss: 0.4488 inner_cls_loss: 39.1286
2023-12-06 01:18:13,586 - INFO - Epoch(train)[2/40][40/58]lr: 9.9391e-04  eta: 1:19:11  time: 85.5407  inter_cls_loss: 0.4318 inner_cls_loss: 39.3183
2023-12-06 01:18:43,797 - INFO - Epoch(test) test/all:
2023-12-06 01:19:28,475 - INFO - Epoch(test) : [20/31]
2023-12-06 01:19:46,687 - INFO - Metrics for ship: Accuracy: 0.6022, Precision: 0.3011, Recall: 0.9102, F1_score: 0.4525, Average_Precision: 0.4854
2023-12-06 01:19:46,714 - INFO - Epoch(test) test/offshore:
2023-12-06 01:20:30,474 - INFO - Epoch(test) : [20/26]
2023-12-06 01:20:41,296 - INFO - Metrics for ship: Accuracy: 0.8643, Precision: 0.7509, Recall: 0.9520, F1_score: 0.8395, Average_Precision: 0.8518
2023-12-06 01:20:41,299 - INFO - Epoch(test) test/inshore:
2023-12-06 01:20:57,688 - INFO - Metrics for ship: Accuracy: 0.4808, Precision: 0.1804, Recall: 0.9432, F1_score: 0.3028, Average_Precision: 0.2526
2023-12-06 01:20:59,349 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:20:59,404 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 901e0129b4accc973ea346c4f3e6d9a4, with test/inshore image AP 0.2526
2023-12-06 01:21:50,810 - INFO - Epoch(train)[3/40][20/58]lr: 9.7577e-04  eta: 1:33:33  time: 51.4050  inter_cls_loss: 0.2424 inner_cls_loss: 24.9224
2023-12-06 01:22:24,040 - INFO - Epoch(train)[3/40][40/58]lr: 9.7577e-04  eta: 1:16:18  time: 84.6347  inter_cls_loss: 0.2185 inner_cls_loss: 23.0298
2023-12-06 01:22:53,487 - INFO - Epoch(test) test/all:
2023-12-06 01:23:38,193 - INFO - Epoch(test) : [20/31]
2023-12-06 01:23:56,126 - INFO - Metrics for ship: Accuracy: 0.8943, Precision: 0.7225, Recall: 0.6738, F1_score: 0.6973, Average_Precision: 0.7553
2023-12-06 01:23:56,158 - INFO - Epoch(test) test/offshore:
2023-12-06 01:24:40,085 - INFO - Epoch(test) : [20/26]
2023-12-06 01:24:51,256 - INFO - Metrics for ship: Accuracy: 0.9270, Precision: 0.9141, Recall: 0.8877, F1_score: 0.9007, Average_Precision: 0.9051
2023-12-06 01:24:51,259 - INFO - Epoch(test) test/inshore:
2023-12-06 01:25:07,867 - INFO - Metrics for ship: Accuracy: 0.8157, Precision: 0.3606, Recall: 0.7005, F1_score: 0.4761, Average_Precision: 0.3833
2023-12-06 01:25:09,516 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:25:09,572 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 4dd53fcc432a9317d8f69b63a928a1af, with test/inshore image AP 0.3833
2023-12-06 01:26:00,226 - INFO - Epoch(train)[4/40][20/58]lr: 9.4605e-04  eta: 1:29:43  time: 50.6469  inter_cls_loss: 0.2049 inner_cls_loss: 21.4072
2023-12-06 01:26:33,874 - INFO - Epoch(train)[4/40][40/58]lr: 9.4605e-04  eta: 1:13:58  time: 84.3009  inter_cls_loss: 0.3234 inner_cls_loss: 25.5696
2023-12-06 01:27:03,863 - INFO - Epoch(test) test/all:
2023-12-06 01:27:49,214 - INFO - Epoch(test) : [20/31]
2023-12-06 01:28:07,435 - INFO - Metrics for ship: Accuracy: 0.8954, Precision: 0.6846, Recall: 0.7803, F1_score: 0.7293, Average_Precision: 0.7829
2023-12-06 01:28:07,464 - INFO - Epoch(test) test/offshore:
2023-12-06 01:28:51,247 - INFO - Epoch(test) : [20/26]
2023-12-06 01:29:02,073 - INFO - Metrics for ship: Accuracy: 0.9451, Precision: 0.9205, Recall: 0.9336, F1_score: 0.9270, Average_Precision: 0.9156
2023-12-06 01:29:02,077 - INFO - Epoch(test) test/inshore:
2023-12-06 01:29:18,708 - INFO - Metrics for ship: Accuracy: 0.8012, Precision: 0.3519, Recall: 0.7881, F1_score: 0.4865, Average_Precision: 0.4117
2023-12-06 01:29:20,240 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:29:20,296 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 722848991d0e6de69a1d873e067883aa, with test/inshore image AP 0.4117
2023-12-06 01:30:10,887 - INFO - Epoch(train)[5/40][20/58]lr: 9.0546e-04  eta: 1:27:10  time: 50.5876  inter_cls_loss: 0.1716 inner_cls_loss: 18.7427
2023-12-06 01:30:44,175 - INFO - Epoch(train)[5/40][40/58]lr: 9.0546e-04  eta: 1:11:34  time: 83.8784  inter_cls_loss: 0.2359 inner_cls_loss: 21.2609
2023-12-06 01:31:14,719 - INFO - Epoch(test) test/all:
2023-12-06 01:31:59,258 - INFO - Epoch(test) : [20/31]
2023-12-06 01:32:16,531 - INFO - Metrics for ship: Accuracy: 0.9032, Precision: 0.7014, Recall: 0.8080, F1_score: 0.7510, Average_Precision: 0.8390
2023-12-06 01:32:16,563 - INFO - Epoch(test) test/offshore:
2023-12-06 01:33:00,897 - INFO - Epoch(test) : [20/26]
2023-12-06 01:33:10,993 - INFO - Metrics for ship: Accuracy: 0.9494, Precision: 0.9209, Recall: 0.9456, F1_score: 0.9331, Average_Precision: 0.9667
2023-12-06 01:33:10,996 - INFO - Epoch(test) test/inshore:
2023-12-06 01:33:27,557 - INFO - Metrics for ship: Accuracy: 0.8301, Precision: 0.3946, Recall: 0.7893, F1_score: 0.5261, Average_Precision: 0.5359
2023-12-06 01:33:28,540 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:33:28,600 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 21d58db82d596288546f79b05e06b5cd, with test/inshore image AP 0.5359
2023-12-06 01:34:18,804 - INFO - Epoch(train)[6/40][20/58]lr: 8.5502e-04  eta: 1:24:5  time: 50.2023  inter_cls_loss: 0.2723 inner_cls_loss: 21.9377
2023-12-06 01:34:53,759 - INFO - Epoch(train)[6/40][40/58]lr: 8.5502e-04  eta: 1:10:36  time: 85.1571  inter_cls_loss: 0.1893 inner_cls_loss: 18.4249
2023-12-06 01:35:23,021 - INFO - Epoch(test) test/all:
2023-12-06 01:36:08,002 - INFO - Epoch(test) : [20/31]
2023-12-06 01:36:25,624 - INFO - Metrics for ship: Accuracy: 0.9189, Precision: 0.7814, Recall: 0.7651, F1_score: 0.7732, Average_Precision: 0.8629
2023-12-06 01:36:25,651 - INFO - Epoch(test) test/offshore:
2023-12-06 01:37:08,960 - INFO - Epoch(test) : [20/26]
2023-12-06 01:37:19,626 - INFO - Metrics for ship: Accuracy: 0.9555, Precision: 0.9510, Recall: 0.9285, F1_score: 0.9396, Average_Precision: 0.9757
2023-12-06 01:37:19,629 - INFO - Epoch(test) test/inshore:
2023-12-06 01:37:36,114 - INFO - Metrics for ship: Accuracy: 0.8916, Precision: 0.5355, Recall: 0.7046, F1_score: 0.6085, Average_Precision: 0.5788
2023-12-06 01:37:37,350 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:37:37,406 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 7be0db42ec0316672b30bd52c366a262, with test/inshore image AP 0.5788
2023-12-06 01:38:28,187 - INFO - Epoch(train)[7/40][20/58]lr: 7.9595e-04  eta: 1:22:36  time: 50.7804  inter_cls_loss: 0.1708 inner_cls_loss: 16.5944
2023-12-06 01:39:02,351 - INFO - Epoch(train)[7/40][40/58]lr: 7.9595e-04  eta: 1:8:22  time: 84.9428  inter_cls_loss: 0.2700 inner_cls_loss: 19.8958
2023-12-06 01:39:30,874 - INFO - Epoch(test) test/all:
2023-12-06 01:40:15,643 - INFO - Epoch(test) : [20/31]
2023-12-06 01:40:33,606 - INFO - Metrics for ship: Accuracy: 0.9087, Precision: 0.7004, Recall: 0.8646, F1_score: 0.7739, Average_Precision: 0.8676
2023-12-06 01:40:33,633 - INFO - Epoch(test) test/offshore:
2023-12-06 01:41:17,323 - INFO - Epoch(test) : [20/26]
2023-12-06 01:41:27,540 - INFO - Metrics for ship: Accuracy: 0.9536, Precision: 0.9130, Recall: 0.9677, F1_score: 0.9396, Average_Precision: 0.9757
2023-12-06 01:41:27,543 - INFO - Epoch(test) test/inshore:
2023-12-06 01:41:44,130 - INFO - Metrics for ship: Accuracy: 0.8366, Precision: 0.4121, Recall: 0.8599, F1_score: 0.5572, Average_Precision: 0.5925
2023-12-06 01:41:45,192 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:41:45,247 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 7ecef0b8c7971ccaa03469fe19bcd689, with test/inshore image AP 0.5925
2023-12-06 01:42:36,830 - INFO - Epoch(train)[8/40][20/58]lr: 7.2973e-04  eta: 1:21:24  time: 51.5827  inter_cls_loss: 0.1637 inner_cls_loss: 15.6729
2023-12-06 01:43:10,955 - INFO - Epoch(train)[8/40][40/58]lr: 7.2973e-04  eta: 1:6:55  time: 85.7079  inter_cls_loss: 0.2353 inner_cls_loss: 18.5323
2023-12-06 01:43:40,236 - INFO - Epoch(test) test/all:
2023-12-06 01:44:25,633 - INFO - Epoch(test) : [20/31]
2023-12-06 01:44:43,565 - INFO - Metrics for ship: Accuracy: 0.9217, Precision: 0.7556, Recall: 0.8375, F1_score: 0.7944, Average_Precision: 0.8757
2023-12-06 01:44:43,596 - INFO - Epoch(test) test/offshore:
2023-12-06 01:45:27,164 - INFO - Epoch(test) : [20/26]
2023-12-06 01:45:37,790 - INFO - Metrics for ship: Accuracy: 0.9602, Precision: 0.9464, Recall: 0.9468, F1_score: 0.9466, Average_Precision: 0.9752
2023-12-06 01:45:37,794 - INFO - Epoch(test) test/inshore:
2023-12-06 01:45:54,372 - INFO - Metrics for ship: Accuracy: 0.8772, Precision: 0.4918, Recall: 0.8206, F1_score: 0.6150, Average_Precision: 0.5861
2023-12-06 01:45:55,426 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:46:45,592 - INFO - Epoch(train)[9/40][20/58]lr: 6.5796e-04  eta: 1:16:44  time: 50.1624  inter_cls_loss: 0.1825 inner_cls_loss: 15.5625
2023-12-06 01:47:20,721 - INFO - Epoch(train)[9/40][40/58]lr: 6.5796e-04  eta: 1:4:32  time: 85.2924  inter_cls_loss: 0.1796 inner_cls_loss: 15.5486
2023-12-06 01:47:50,350 - INFO - Epoch(test) test/all:
2023-12-06 01:48:35,602 - INFO - Epoch(test) : [20/31]
2023-12-06 01:48:53,240 - INFO - Metrics for ship: Accuracy: 0.9271, Precision: 0.8197, Recall: 0.7649, F1_score: 0.7913, Average_Precision: 0.8840
2023-12-06 01:48:53,267 - INFO - Epoch(test) test/offshore:
2023-12-06 01:49:36,163 - INFO - Epoch(test) : [20/26]
2023-12-06 01:49:47,499 - INFO - Metrics for ship: Accuracy: 0.9515, Precision: 0.9679, Recall: 0.8999, F1_score: 0.9327, Average_Precision: 0.9842
2023-12-06 01:49:47,501 - INFO - Epoch(test) test/inshore:
2023-12-06 01:50:03,869 - INFO - Metrics for ship: Accuracy: 0.9003, Precision: 0.5630, Recall: 0.7421, F1_score: 0.6403, Average_Precision: 0.6255
2023-12-06 01:50:04,870 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:50:04,924 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 a44b67fdf6f76fc692b55407c7d1968a, with test/inshore image AP 0.6255
2023-12-06 01:50:55,771 - INFO - Epoch(train)[10/40][20/58]lr: 5.8244e-04  eta: 1:15:19  time: 50.8405  inter_cls_loss: 0.1484 inner_cls_loss: 13.9131
2023-12-06 01:51:29,389 - INFO - Epoch(train)[10/40][40/58]lr: 5.8244e-04  eta: 1:1:52  time: 84.4600  inter_cls_loss: 0.1837 inner_cls_loss: 14.8312
2023-12-06 01:51:59,151 - INFO - Epoch(test) test/all:
2023-12-06 01:52:43,603 - INFO - Epoch(test) : [20/31]
2023-12-06 01:53:01,732 - INFO - Metrics for ship: Accuracy: 0.9291, Precision: 0.7909, Recall: 0.8258, F1_score: 0.8080, Average_Precision: 0.8921
2023-12-06 01:53:01,760 - INFO - Epoch(test) test/offshore:
2023-12-06 01:53:45,589 - INFO - Epoch(test) : [20/26]
2023-12-06 01:53:56,055 - INFO - Metrics for ship: Accuracy: 0.9606, Precision: 0.9515, Recall: 0.9426, F1_score: 0.9470, Average_Precision: 0.9814
2023-12-06 01:53:56,058 - INFO - Epoch(test) test/inshore:
2023-12-06 01:54:12,701 - INFO - Metrics for ship: Accuracy: 0.8904, Precision: 0.5269, Recall: 0.8122, F1_score: 0.6392, Average_Precision: 0.6279
2023-12-06 01:54:13,696 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:54:13,751 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 4f7dd25f66da3c37892f12054f58df9d, with test/inshore image AP 0.6279
2023-12-06 01:55:05,281 - INFO - Epoch(train)[11/40][20/58]lr: 5.0500e-04  eta: 1:13:46  time: 51.4667  inter_cls_loss: 0.1491 inner_cls_loss: 13.3524
2023-12-06 01:55:38,009 - INFO - Epoch(train)[11/40][40/58]lr: 5.0500e-04  eta: 0:59:38  time: 84.1987  inter_cls_loss: 0.1738 inner_cls_loss: 13.9940
2023-12-06 01:56:08,113 - INFO - Epoch(test) test/all:
2023-12-06 01:56:52,743 - INFO - Epoch(test) : [20/31]
2023-12-06 01:57:10,988 - INFO - Metrics for ship: Accuracy: 0.9323, Precision: 0.8381, Recall: 0.7750, F1_score: 0.8053, Average_Precision: 0.8982
2023-12-06 01:57:11,023 - INFO - Epoch(test) test/offshore:
2023-12-06 01:57:54,744 - INFO - Epoch(test) : [20/26]
2023-12-06 01:58:05,571 - INFO - Metrics for ship: Accuracy: 0.9566, Precision: 0.9662, Recall: 0.9158, F1_score: 0.9403, Average_Precision: 0.9843
2023-12-06 01:58:05,574 - INFO - Epoch(test) test/inshore:
2023-12-06 01:58:22,034 - INFO - Metrics for ship: Accuracy: 0.9082, Precision: 0.5918, Recall: 0.7486, F1_score: 0.6610, Average_Precision: 0.6559
2023-12-06 01:58:23,051 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 01:58:23,108 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 3d919df1436cf5793d567b14ca30d4c1, with test/inshore image AP 0.6559
2023-12-06 01:59:13,234 - INFO - Epoch(train)[12/40][20/58]lr: 4.2756e-04  eta: 1:9:25  time: 50.1253  inter_cls_loss: 0.1557 inner_cls_loss: 13.0406
2023-12-06 01:59:48,281 - INFO - Epoch(train)[12/40][40/58]lr: 4.2756e-04  eta: 0:58:16  time: 85.1692  inter_cls_loss: 0.2058 inner_cls_loss: 14.4522
2023-12-06 02:00:17,885 - INFO - Epoch(test) test/all:
2023-12-06 02:01:02,683 - INFO - Epoch(test) : [20/31]
2023-12-06 02:01:20,374 - INFO - Metrics for ship: Accuracy: 0.9326, Precision: 0.8490, Recall: 0.7622, F1_score: 0.8032, Average_Precision: 0.9019
2023-12-06 02:01:20,401 - INFO - Epoch(test) test/offshore:
2023-12-06 02:02:03,925 - INFO - Epoch(test) : [20/26]
2023-12-06 02:02:14,748 - INFO - Metrics for ship: Accuracy: 0.9558, Precision: 0.9648, Recall: 0.9149, F1_score: 0.9392, Average_Precision: 0.9847
2023-12-06 02:02:14,751 - INFO - Epoch(test) test/inshore:
2023-12-06 02:02:31,223 - INFO - Metrics for ship: Accuracy: 0.9053, Precision: 0.5800, Recall: 0.7524, F1_score: 0.6551, Average_Precision: 0.6496
2023-12-06 02:02:32,241 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:03:22,063 - INFO - Epoch(train)[13/40][20/58]lr: 3.5204e-04  eta: 1:6:35  time: 49.8219  inter_cls_loss: 0.1106 inner_cls_loss: 11.2939
2023-12-06 02:03:56,800 - INFO - Epoch(train)[13/40][40/58]lr: 3.5204e-04  eta: 0:55:48  time: 84.5527  inter_cls_loss: 0.1197 inner_cls_loss: 11.4314
2023-12-06 02:04:27,252 - INFO - Epoch(test) test/all:
2023-12-06 02:05:11,753 - INFO - Epoch(test) : [20/31]
2023-12-06 02:05:29,683 - INFO - Metrics for ship: Accuracy: 0.9291, Precision: 0.7635, Recall: 0.8804, F1_score: 0.8178, Average_Precision: 0.9047
2023-12-06 02:05:29,711 - INFO - Epoch(test) test/offshore:
2023-12-06 02:06:13,170 - INFO - Epoch(test) : [20/26]
2023-12-06 02:06:23,541 - INFO - Metrics for ship: Accuracy: 0.9626, Precision: 0.9437, Recall: 0.9567, F1_score: 0.9502, Average_Precision: 0.9835
2023-12-06 02:06:23,544 - INFO - Epoch(test) test/inshore:
2023-12-06 02:06:40,074 - INFO - Metrics for ship: Accuracy: 0.8711, Precision: 0.4783, Recall: 0.8653, F1_score: 0.6161, Average_Precision: 0.6582
2023-12-06 02:06:41,079 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:06:41,134 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 6171cd1b1bbb271d755b86112a481936, with test/inshore image AP 0.6582
2023-12-06 02:07:31,697 - INFO - Epoch(train)[14/40][20/58]lr: 2.8027e-04  eta: 1:5:8  time: 50.5579  inter_cls_loss: 0.1175 inner_cls_loss: 11.3047
2023-12-06 02:08:06,513 - INFO - Epoch(train)[14/40][40/58]lr: 2.8027e-04  eta: 0:54:17  time: 85.3773  inter_cls_loss: 0.1397 inner_cls_loss: 11.8019
2023-12-06 02:08:35,611 - INFO - Epoch(test) test/all:
2023-12-06 02:09:20,386 - INFO - Epoch(test) : [20/31]
2023-12-06 02:09:37,542 - INFO - Metrics for ship: Accuracy: 0.9361, Precision: 0.8456, Recall: 0.7902, F1_score: 0.8170, Average_Precision: 0.9093
2023-12-06 02:09:37,576 - INFO - Epoch(test) test/offshore:
2023-12-06 02:10:20,524 - INFO - Epoch(test) : [20/26]
2023-12-06 02:10:31,343 - INFO - Metrics for ship: Accuracy: 0.9600, Precision: 0.9580, Recall: 0.9338, F1_score: 0.9458, Average_Precision: 0.9849
2023-12-06 02:10:31,345 - INFO - Epoch(test) test/inshore:
2023-12-06 02:10:47,979 - INFO - Metrics for ship: Accuracy: 0.9079, Precision: 0.5875, Recall: 0.7706, F1_score: 0.6667, Average_Precision: 0.6747
2023-12-06 02:10:48,978 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:10:49,031 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 a83ecefc5dbaf05fbe0687daa582ccc2, with test/inshore image AP 0.6747
2023-12-06 02:11:41,364 - INFO - Epoch(train)[15/40][20/58]lr: 2.1405e-04  eta: 1:4:53  time: 52.3326  inter_cls_loss: 0.1345 inner_cls_loss: 11.8441
2023-12-06 02:12:13,830 - INFO - Epoch(train)[15/40][40/58]lr: 2.1405e-04  eta: 0:51:52  time: 84.7991  inter_cls_loss: 0.2110 inner_cls_loss: 14.1813
2023-12-06 02:12:43,992 - INFO - Epoch(test) test/all:
2023-12-06 02:13:29,171 - INFO - Epoch(test) : [20/31]
2023-12-06 02:13:46,631 - INFO - Metrics for ship: Accuracy: 0.9366, Precision: 0.8597, Recall: 0.7756, F1_score: 0.8155, Average_Precision: 0.9104
2023-12-06 02:13:46,660 - INFO - Epoch(test) test/offshore:
2023-12-06 02:14:30,885 - INFO - Epoch(test) : [20/26]
2023-12-06 02:14:41,793 - INFO - Metrics for ship: Accuracy: 0.9598, Precision: 0.9564, Recall: 0.9348, F1_score: 0.9455, Average_Precision: 0.9847
2023-12-06 02:14:41,796 - INFO - Epoch(test) test/inshore:
2023-12-06 02:14:58,321 - INFO - Metrics for ship: Accuracy: 0.9073, Precision: 0.5856, Recall: 0.7676, F1_score: 0.6643, Average_Precision: 0.6603
2023-12-06 02:14:59,333 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:15:49,590 - INFO - Epoch(train)[16/40][20/58]lr: 1.5498e-04  eta: 0:59:53  time: 50.2545  inter_cls_loss: 0.1224 inner_cls_loss: 11.0538
2023-12-06 02:16:23,671 - INFO - Epoch(train)[16/40][40/58]lr: 1.5498e-04  eta: 0:49:32  time: 84.3372  inter_cls_loss: 0.2446 inner_cls_loss: 15.1181
2023-12-06 02:16:53,563 - INFO - Epoch(test) test/all:
2023-12-06 02:17:38,280 - INFO - Epoch(test) : [20/31]
2023-12-06 02:17:55,787 - INFO - Metrics for ship: Accuracy: 0.9381, Precision: 0.8481, Recall: 0.8008, F1_score: 0.8238, Average_Precision: 0.9135
2023-12-06 02:17:55,816 - INFO - Epoch(test) test/offshore:
2023-12-06 02:18:39,814 - INFO - Epoch(test) : [20/26]
2023-12-06 02:18:50,323 - INFO - Metrics for ship: Accuracy: 0.9619, Precision: 0.9538, Recall: 0.9435, F1_score: 0.9486, Average_Precision: 0.9860
2023-12-06 02:18:50,326 - INFO - Epoch(test) test/inshore:
2023-12-06 02:19:06,897 - INFO - Metrics for ship: Accuracy: 0.9022, Precision: 0.5645, Recall: 0.7954, F1_score: 0.6603, Average_Precision: 0.6743
2023-12-06 02:19:07,875 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:19:58,400 - INFO - Epoch(train)[17/40][20/58]lr: 1.0454e-04  eta: 0:57:45  time: 50.5204  inter_cls_loss: 0.1208 inner_cls_loss: 11.0386
2023-12-06 02:20:32,387 - INFO - Epoch(train)[17/40][40/58]lr: 1.0454e-04  eta: 0:47:36  time: 84.5093  inter_cls_loss: 0.2063 inner_cls_loss: 13.2972
2023-12-06 02:21:01,591 - INFO - Epoch(test) test/all:
2023-12-06 02:21:46,394 - INFO - Epoch(test) : [20/31]
2023-12-06 02:22:04,516 - INFO - Metrics for ship: Accuracy: 0.9382, Precision: 0.8343, Recall: 0.8211, F1_score: 0.8276, Average_Precision: 0.9145
2023-12-06 02:22:04,543 - INFO - Epoch(test) test/offshore:
2023-12-06 02:22:48,020 - INFO - Epoch(test) : [20/26]
2023-12-06 02:22:58,601 - INFO - Metrics for ship: Accuracy: 0.9615, Precision: 0.9549, Recall: 0.9413, F1_score: 0.9480, Average_Precision: 0.9853
2023-12-06 02:22:58,603 - INFO - Epoch(test) test/inshore:
2023-12-06 02:23:15,479 - INFO - Metrics for ship: Accuracy: 0.9033, Precision: 0.5679, Recall: 0.8003, F1_score: 0.6644, Average_Precision: 0.6846
2023-12-06 02:23:16,486 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:23:16,541 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 f43d1edc89e3a8bee432879af4e3c8fe, with test/inshore image AP 0.6846
2023-12-06 02:24:07,955 - INFO - Epoch(train)[18/40][20/58]lr: 6.3952e-05  eta: 0:56:17  time: 51.4137  inter_cls_loss: 0.1191 inner_cls_loss: 10.8692
2023-12-06 02:24:43,050 - INFO - Epoch(train)[18/40][40/58]lr: 6.3952e-05  eta: 0:46:38  time: 86.5091  inter_cls_loss: 0.1095 inner_cls_loss: 10.5451
2023-12-06 02:25:11,626 - INFO - Epoch(test) test/all:
2023-12-06 02:25:56,307 - INFO - Epoch(test) : [20/31]
2023-12-06 02:26:14,219 - INFO - Metrics for ship: Accuracy: 0.9385, Precision: 0.8236, Recall: 0.8393, F1_score: 0.8314, Average_Precision: 0.9140
2023-12-06 02:26:14,248 - INFO - Epoch(test) test/offshore:
2023-12-06 02:26:57,822 - INFO - Epoch(test) : [20/26]
2023-12-06 02:27:08,593 - INFO - Metrics for ship: Accuracy: 0.9620, Precision: 0.9543, Recall: 0.9433, F1_score: 0.9488, Average_Precision: 0.9858
2023-12-06 02:27:08,596 - INFO - Epoch(test) test/inshore:
2023-12-06 02:27:24,960 - INFO - Metrics for ship: Accuracy: 0.9006, Precision: 0.5577, Recall: 0.8157, F1_score: 0.6625, Average_Precision: 0.6895
2023-12-06 02:27:25,933 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:27:25,987 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 740911ac8653409773ba9eaeb650dd7d, with test/inshore image AP 0.6895
2023-12-06 02:28:15,970 - INFO - Epoch(train)[19/40][20/58]lr: 3.4227e-05  eta: 0:52:18  time: 49.9784  inter_cls_loss: 0.1372 inner_cls_loss: 11.4613
2023-12-06 02:28:50,958 - INFO - Epoch(train)[19/40][40/58]lr: 3.4227e-05  eta: 0:43:45  time: 84.9649  inter_cls_loss: 0.1088 inner_cls_loss: 10.5389
2023-12-06 02:29:20,711 - INFO - Epoch(test) test/all:
2023-12-06 02:30:05,517 - INFO - Epoch(test) : [20/31]
2023-12-06 02:30:23,505 - INFO - Metrics for ship: Accuracy: 0.9388, Precision: 0.8245, Recall: 0.8400, F1_score: 0.8322, Average_Precision: 0.9154
2023-12-06 02:30:23,537 - INFO - Epoch(test) test/offshore:
2023-12-06 02:31:06,803 - INFO - Epoch(test) : [20/26]
2023-12-06 02:31:18,217 - INFO - Metrics for ship: Accuracy: 0.9625, Precision: 0.9506, Recall: 0.9487, F1_score: 0.9496, Average_Precision: 0.9856
2023-12-06 02:31:18,220 - INFO - Epoch(test) test/inshore:
2023-12-06 02:31:34,645 - INFO - Metrics for ship: Accuracy: 0.8995, Precision: 0.5537, Recall: 0.8224, F1_score: 0.6618, Average_Precision: 0.6895
2023-12-06 02:31:35,647 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:31:35,699 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 7dcc4119466ae7598ab2ba9256f8eddd, with test/inshore image AP 0.6895
2023-12-06 02:32:25,941 - INFO - Epoch(train)[20/40][20/58]lr: 1.6094e-05  eta: 0:50:9  time: 50.2404  inter_cls_loss: 0.1652 inner_cls_loss: 12.1830
2023-12-06 02:33:00,003 - INFO - Epoch(train)[20/40][40/58]lr: 1.6094e-05  eta: 0:41:22  time: 84.3023  inter_cls_loss: 0.0981 inner_cls_loss: 10.1616
2023-12-06 02:33:29,820 - INFO - Epoch(test) test/all:
2023-12-06 02:34:14,468 - INFO - Epoch(test) : [20/31]
2023-12-06 02:34:32,669 - INFO - Metrics for ship: Accuracy: 0.9390, Precision: 0.8265, Recall: 0.8382, F1_score: 0.8323, Average_Precision: 0.9153
2023-12-06 02:34:32,698 - INFO - Epoch(test) test/offshore:
2023-12-06 02:35:16,149 - INFO - Epoch(test) : [20/26]
2023-12-06 02:35:25,799 - INFO - Metrics for ship: Accuracy: 0.9625, Precision: 0.9524, Recall: 0.9466, F1_score: 0.9495, Average_Precision: 0.9857
2023-12-06 02:35:25,802 - INFO - Epoch(test) test/inshore:
2023-12-06 02:35:42,375 - INFO - Metrics for ship: Accuracy: 0.9012, Precision: 0.5593, Recall: 0.8174, F1_score: 0.6641, Average_Precision: 0.6920
2023-12-06 02:35:43,358 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:35:43,412 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 cdaaa21e23f1e0af3b93bf0efa12a16a, with test/inshore image AP 0.6920
2023-12-06 02:36:34,198 - INFO - Epoch(train)[21/40][20/58]lr: 1.0000e-03  eta: 0:48:10  time: 50.7163  inter_cls_loss: 0.1637 inner_cls_loss: 11.8434
2023-12-06 02:37:08,634 - INFO - Epoch(train)[21/40][40/58]lr: 1.0000e-03  eta: 0:39:44  time: 85.1532  inter_cls_loss: 0.1526 inner_cls_loss: 11.2550
2023-12-06 02:37:38,011 - INFO - Epoch(test) test/all:
2023-12-06 02:38:22,667 - INFO - Epoch(test) : [20/31]
2023-12-06 02:38:40,085 - INFO - Metrics for ship: Accuracy: 0.9266, Precision: 0.7553, Recall: 0.8784, F1_score: 0.8122, Average_Precision: 0.9030
2023-12-06 02:38:40,112 - INFO - Epoch(test) test/offshore:
2023-12-06 02:39:23,087 - INFO - Epoch(test) : [20/26]
2023-12-06 02:39:33,600 - INFO - Metrics for ship: Accuracy: 0.9631, Precision: 0.9571, Recall: 0.9435, F1_score: 0.9503, Average_Precision: 0.9878
2023-12-06 02:39:33,603 - INFO - Epoch(test) test/inshore:
2023-12-06 02:39:50,161 - INFO - Metrics for ship: Accuracy: 0.8728, Precision: 0.4820, Recall: 0.8557, F1_score: 0.6167, Average_Precision: 0.7020
2023-12-06 02:39:51,186 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:39:51,241 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 cac8f1aa3d01e9cd3fb82c882761f3d3, with test/inshore image AP 0.7020
2023-12-06 02:40:41,076 - INFO - Epoch(train)[22/40][20/58]lr: 9.9847e-04  eta: 0:44:55  time: 49.8330  inter_cls_loss: 0.1022 inner_cls_loss: 9.2956
2023-12-06 02:41:15,375 - INFO - Epoch(train)[22/40][40/58]lr: 9.9847e-04  eta: 0:37:13  time: 84.1295  inter_cls_loss: 0.2348 inner_cls_loss: 12.5799
2023-12-06 02:41:44,614 - INFO - Epoch(test) test/all:
2023-12-06 02:42:29,574 - INFO - Epoch(test) : [20/31]
2023-12-06 02:42:47,315 - INFO - Metrics for ship: Accuracy: 0.9348, Precision: 0.7824, Recall: 0.8850, F1_score: 0.8305, Average_Precision: 0.9129
2023-12-06 02:42:47,343 - INFO - Epoch(test) test/offshore:
2023-12-06 02:43:30,734 - INFO - Epoch(test) : [20/26]
2023-12-06 02:43:41,297 - INFO - Metrics for ship: Accuracy: 0.9636, Precision: 0.9493, Recall: 0.9534, F1_score: 0.9513, Average_Precision: 0.9848
2023-12-06 02:43:41,300 - INFO - Epoch(test) test/inshore:
2023-12-06 02:43:57,833 - INFO - Metrics for ship: Accuracy: 0.8797, Precision: 0.4981, Recall: 0.8695, F1_score: 0.6334, Average_Precision: 0.6946
2023-12-06 02:43:58,844 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:44:49,738 - INFO - Epoch(train)[23/40][20/58]lr: 9.9391e-04  eta: 0:43:25  time: 50.8938  inter_cls_loss: 0.1146 inner_cls_loss: 8.9888
2023-12-06 02:45:23,104 - INFO - Epoch(train)[23/40][40/58]lr: 9.9391e-04  eta: 0:35:14  time: 84.2586  inter_cls_loss: 0.2000 inner_cls_loss: 10.6513
2023-12-06 02:45:52,999 - INFO - Epoch(test) test/all:
2023-12-06 02:46:37,075 - INFO - Epoch(test) : [20/31]
2023-12-06 02:46:55,031 - INFO - Metrics for ship: Accuracy: 0.9316, Precision: 0.8580, Recall: 0.7443, F1_score: 0.7971, Average_Precision: 0.9021
2023-12-06 02:46:55,059 - INFO - Epoch(test) test/offshore:
2023-12-06 02:47:38,795 - INFO - Epoch(test) : [20/26]
2023-12-06 02:47:49,431 - INFO - Metrics for ship: Accuracy: 0.9572, Precision: 0.9423, Recall: 0.9431, F1_score: 0.9427, Average_Precision: 0.9765
2023-12-06 02:47:49,433 - INFO - Epoch(test) test/inshore:
2023-12-06 02:48:06,028 - INFO - Metrics for ship: Accuracy: 0.9051, Precision: 0.5819, Recall: 0.7321, F1_score: 0.6484, Average_Precision: 0.6378
2023-12-06 02:48:07,052 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:48:56,400 - INFO - Epoch(train)[24/40][20/58]lr: 9.8632e-04  eta: 0:39:43  time: 49.3475  inter_cls_loss: 0.1685 inner_cls_loss: 9.4008
2023-12-06 02:49:31,143 - INFO - Epoch(train)[24/40][40/58]lr: 9.8632e-04  eta: 0:33:8  time: 84.0863  inter_cls_loss: 0.1968 inner_cls_loss: 9.8595
2023-12-06 02:50:00,801 - INFO - Epoch(test) test/all:
2023-12-06 02:50:45,696 - INFO - Epoch(test) : [20/31]
2023-12-06 02:51:03,346 - INFO - Metrics for ship: Accuracy: 0.9183, Precision: 0.7096, Recall: 0.9275, F1_score: 0.8040, Average_Precision: 0.9142
2023-12-06 02:51:03,377 - INFO - Epoch(test) test/offshore:
2023-12-06 02:51:47,643 - INFO - Epoch(test) : [20/26]
2023-12-06 02:51:57,318 - INFO - Metrics for ship: Accuracy: 0.9658, Precision: 0.9541, Recall: 0.9544, F1_score: 0.9542, Average_Precision: 0.9863
2023-12-06 02:51:57,321 - INFO - Epoch(test) test/inshore:
2023-12-06 02:52:13,989 - INFO - Metrics for ship: Accuracy: 0.8736, Precision: 0.4846, Recall: 0.8996, F1_score: 0.6299, Average_Precision: 0.6758
2023-12-06 02:52:14,950 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:53:05,956 - INFO - Epoch(train)[25/40][20/58]lr: 9.7577e-04  eta: 0:38:35  time: 50.9999  inter_cls_loss: 0.1901 inner_cls_loss: 9.2641
2023-12-06 02:53:39,894 - INFO - Epoch(train)[25/40][40/58]lr: 9.7577e-04  eta: 0:31:25  time: 84.9436  inter_cls_loss: 0.1636 inner_cls_loss: 8.1619
2023-12-06 02:54:09,558 - INFO - Epoch(test) test/all:
2023-12-06 02:54:54,831 - INFO - Epoch(test) : [20/31]
2023-12-06 02:55:12,310 - INFO - Metrics for ship: Accuracy: 0.9410, Precision: 0.8592, Recall: 0.8055, F1_score: 0.8315, Average_Precision: 0.9143
2023-12-06 02:55:12,336 - INFO - Epoch(test) test/offshore:
2023-12-06 02:55:55,146 - INFO - Epoch(test) : [20/26]
2023-12-06 02:56:05,884 - INFO - Metrics for ship: Accuracy: 0.9567, Precision: 0.9715, Recall: 0.9106, F1_score: 0.9400, Average_Precision: 0.9843
2023-12-06 02:56:05,887 - INFO - Epoch(test) test/inshore:
2023-12-06 02:56:22,413 - INFO - Metrics for ship: Accuracy: 0.9230, Precision: 0.6570, Recall: 0.7443, F1_score: 0.6980, Average_Precision: 0.7210
2023-12-06 02:56:24,057 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 02:56:24,114 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 efdad8d8ba8da736b9e5df50a8e7d9fc, with test/inshore image AP 0.7210
2023-12-06 02:57:14,214 - INFO - Epoch(train)[26/40][20/58]lr: 9.6232e-04  eta: 0:35:29  time: 50.0999  inter_cls_loss: 0.1286 inner_cls_loss: 7.3485
2023-12-06 02:57:49,202 - INFO - Epoch(train)[26/40][40/58]lr: 9.6232e-04  eta: 0:29:25  time: 85.0879  inter_cls_loss: 0.1899 inner_cls_loss: 8.3476
2023-12-06 02:58:18,375 - INFO - Epoch(test) test/all:
2023-12-06 02:59:03,620 - INFO - Epoch(test) : [20/31]
2023-12-06 02:59:21,917 - INFO - Metrics for ship: Accuracy: 0.9365, Precision: 0.7916, Recall: 0.8800, F1_score: 0.8335, Average_Precision: 0.9161
2023-12-06 02:59:21,943 - INFO - Epoch(test) test/offshore:
2023-12-06 03:00:05,888 - INFO - Epoch(test) : [20/26]
2023-12-06 03:00:16,632 - INFO - Metrics for ship: Accuracy: 0.9628, Precision: 0.9547, Recall: 0.9450, F1_score: 0.9498, Average_Precision: 0.9839
2023-12-06 03:00:16,634 - INFO - Epoch(test) test/inshore:
2023-12-06 03:00:33,056 - INFO - Metrics for ship: Accuracy: 0.9022, Precision: 0.5608, Recall: 0.8370, F1_score: 0.6716, Average_Precision: 0.6894
2023-12-06 03:00:34,071 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:01:23,429 - INFO - Epoch(train)[27/40][20/58]lr: 9.4605e-04  eta: 0:32:34  time: 49.3548  inter_cls_loss: 0.1125 inner_cls_loss: 6.7763
2023-12-06 03:01:58,439 - INFO - Epoch(train)[27/40][40/58]lr: 9.4605e-04  eta: 0:27:8  time: 84.3634  inter_cls_loss: 0.1194 inner_cls_loss: 6.6109
2023-12-06 03:02:28,100 - INFO - Epoch(test) test/all:
2023-12-06 03:03:12,772 - INFO - Epoch(test) : [20/31]
2023-12-06 03:03:30,528 - INFO - Metrics for ship: Accuracy: 0.9430, Precision: 0.8408, Recall: 0.8440, F1_score: 0.8424, Average_Precision: 0.9241
2023-12-06 03:03:30,556 - INFO - Epoch(test) test/offshore:
2023-12-06 03:04:14,940 - INFO - Epoch(test) : [20/26]
2023-12-06 03:04:25,050 - INFO - Metrics for ship: Accuracy: 0.9554, Precision: 0.9674, Recall: 0.9113, F1_score: 0.9385, Average_Precision: 0.9874
2023-12-06 03:04:25,053 - INFO - Epoch(test) test/inshore:
2023-12-06 03:04:41,591 - INFO - Metrics for ship: Accuracy: 0.9243, Precision: 0.6609, Recall: 0.7539, F1_score: 0.7044, Average_Precision: 0.7420
2023-12-06 03:04:42,558 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:04:42,612 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 be95919b1b590dcf82b010c8305fab89, with test/inshore image AP 0.7420
2023-12-06 03:05:33,701 - INFO - Epoch(train)[28/40][20/58]lr: 9.2706e-04  eta: 0:31:14  time: 51.0869  inter_cls_loss: 0.0956 inner_cls_loss: 5.9273
2023-12-06 03:06:08,318 - INFO - Epoch(train)[28/40][40/58]lr: 9.2706e-04  eta: 0:25:29  time: 85.7058  inter_cls_loss: 0.1459 inner_cls_loss: 6.6459
2023-12-06 03:06:37,099 - INFO - Epoch(test) test/all:
2023-12-06 03:07:21,447 - INFO - Epoch(test) : [20/31]
2023-12-06 03:07:39,170 - INFO - Metrics for ship: Accuracy: 0.9429, Precision: 0.8194, Recall: 0.8772, F1_score: 0.8474, Average_Precision: 0.9282
2023-12-06 03:07:39,197 - INFO - Epoch(test) test/offshore:
2023-12-06 03:08:23,359 - INFO - Epoch(test) : [20/26]
2023-12-06 03:08:34,161 - INFO - Metrics for ship: Accuracy: 0.9649, Precision: 0.9558, Recall: 0.9499, F1_score: 0.9528, Average_Precision: 0.9870
2023-12-06 03:08:34,164 - INFO - Epoch(test) test/inshore:
2023-12-06 03:08:50,413 - INFO - Metrics for ship: Accuracy: 0.9085, Precision: 0.5810, Recall: 0.8404, F1_score: 0.6870, Average_Precision: 0.7122
2023-12-06 03:08:51,436 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:09:40,729 - INFO - Epoch(train)[29/40][20/58]lr: 9.0546e-04  eta: 0:27:46  time: 49.2924  inter_cls_loss: 0.0954 inner_cls_loss: 5.6069
2023-12-06 03:10:16,113 - INFO - Epoch(train)[29/40][40/58]lr: 9.0546e-04  eta: 0:23:8  time: 84.6698  inter_cls_loss: 0.0900 inner_cls_loss: 5.3459
2023-12-06 03:10:46,006 - INFO - Epoch(test) test/all:
2023-12-06 03:11:30,277 - INFO - Epoch(test) : [20/31]
2023-12-06 03:11:47,515 - INFO - Metrics for ship: Accuracy: 0.9420, Precision: 0.8646, Recall: 0.8051, F1_score: 0.8338, Average_Precision: 0.9211
2023-12-06 03:11:47,542 - INFO - Epoch(test) test/offshore:
2023-12-06 03:12:31,564 - INFO - Epoch(test) : [20/26]
2023-12-06 03:12:42,692 - INFO - Metrics for ship: Accuracy: 0.9593, Precision: 0.9720, Recall: 0.9174, F1_score: 0.9439, Average_Precision: 0.9889
2023-12-06 03:12:42,695 - INFO - Epoch(test) test/inshore:
2023-12-06 03:12:58,879 - INFO - Metrics for ship: Accuracy: 0.9198, Precision: 0.6356, Recall: 0.7714, F1_score: 0.6969, Average_Precision: 0.7127
2023-12-06 03:12:59,883 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:13:49,972 - INFO - Epoch(train)[30/40][20/58]lr: 8.8140e-04  eta: 0:25:47  time: 50.0890  inter_cls_loss: 0.0715 inner_cls_loss: 4.8598
2023-12-06 03:14:24,150 - INFO - Epoch(train)[30/40][40/58]lr: 8.8140e-04  eta: 0:20:59  time: 84.2654  inter_cls_loss: 0.1141 inner_cls_loss: 5.3017
2023-12-06 03:14:53,306 - INFO - Epoch(test) test/all:
2023-12-06 03:15:37,281 - INFO - Epoch(test) : [20/31]
2023-12-06 03:15:55,596 - INFO - Metrics for ship: Accuracy: 0.9466, Precision: 0.8553, Recall: 0.8477, F1_score: 0.8515, Average_Precision: 0.9317
2023-12-06 03:15:55,623 - INFO - Epoch(test) test/offshore:
2023-12-06 03:16:40,251 - INFO - Epoch(test) : [20/26]
2023-12-06 03:16:50,605 - INFO - Metrics for ship: Accuracy: 0.9591, Precision: 0.9676, Recall: 0.9212, F1_score: 0.9438, Average_Precision: 0.9884
2023-12-06 03:16:50,607 - INFO - Epoch(test) test/inshore:
2023-12-06 03:17:07,059 - INFO - Metrics for ship: Accuracy: 0.9295, Precision: 0.6770, Recall: 0.7850, F1_score: 0.7270, Average_Precision: 0.7649
2023-12-06 03:17:08,039 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:17:08,093 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 7e24d9ea99b9c90d9db4c50b84a09b3d, with test/inshore image AP 0.7649
2023-12-06 03:17:59,235 - INFO - Epoch(train)[31/40][20/58]lr: 8.5502e-04  eta: 0:23:50  time: 51.0793  inter_cls_loss: 0.0831 inner_cls_loss: 4.7626
2023-12-06 03:18:32,432 - INFO - Epoch(train)[31/40][40/58]lr: 8.5502e-04  eta: 0:18:57  time: 84.2780  inter_cls_loss: 0.0901 inner_cls_loss: 4.7267
2023-12-06 03:19:02,206 - INFO - Epoch(test) test/all:
2023-12-06 03:19:46,104 - INFO - Epoch(test) : [20/31]
2023-12-06 03:20:04,101 - INFO - Metrics for ship: Accuracy: 0.9481, Precision: 0.8848, Recall: 0.8194, F1_score: 0.8509, Average_Precision: 0.9355
2023-12-06 03:20:04,129 - INFO - Epoch(test) test/offshore:
2023-12-06 03:20:47,757 - INFO - Epoch(test) : [20/26]
2023-12-06 03:20:58,147 - INFO - Metrics for ship: Accuracy: 0.9572, Precision: 0.9731, Recall: 0.9105, F1_score: 0.9408, Average_Precision: 0.9892
2023-12-06 03:20:58,150 - INFO - Epoch(test) test/inshore:
2023-12-06 03:21:14,641 - INFO - Metrics for ship: Accuracy: 0.9320, Precision: 0.6953, Recall: 0.7668, F1_score: 0.7293, Average_Precision: 0.7720
2023-12-06 03:21:15,639 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:21:15,693 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 478e5deba8ec9bfff96382dd9d85aa7e, with test/inshore image AP 0.7720
2023-12-06 03:22:06,695 - INFO - Epoch(train)[32/40][20/58]lr: 8.2648e-04  eta: 0:21:20  time: 50.9998  inter_cls_loss: 0.1013 inner_cls_loss: 4.6696
2023-12-06 03:22:40,330 - INFO - Epoch(train)[32/40][40/58]lr: 8.2648e-04  eta: 0:16:59  time: 84.6347  inter_cls_loss: 0.1020 inner_cls_loss: 4.5377
2023-12-06 03:23:10,231 - INFO - Epoch(test) test/all:
2023-12-06 03:23:55,356 - INFO - Epoch(test) : [20/31]
2023-12-06 03:24:13,096 - INFO - Metrics for ship: Accuracy: 0.9447, Precision: 0.8443, Recall: 0.8508, F1_score: 0.8475, Average_Precision: 0.9292
2023-12-06 03:24:13,128 - INFO - Epoch(test) test/offshore:
2023-12-06 03:24:57,784 - INFO - Epoch(test) : [20/26]
2023-12-06 03:25:07,602 - INFO - Metrics for ship: Accuracy: 0.9629, Precision: 0.9616, Recall: 0.9379, F1_score: 0.9496, Average_Precision: 0.9892
2023-12-06 03:25:07,604 - INFO - Epoch(test) test/inshore:
2023-12-06 03:25:24,533 - INFO - Metrics for ship: Accuracy: 0.9216, Precision: 0.6350, Recall: 0.8086, F1_score: 0.7114, Average_Precision: 0.7585
2023-12-06 03:25:25,622 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:26:15,743 - INFO - Epoch(train)[33/40][20/58]lr: 7.9595e-04  eta: 0:18:32  time: 50.1193  inter_cls_loss: 0.0959 inner_cls_loss: 4.3406
2023-12-06 03:26:49,560 - INFO - Epoch(train)[33/40][40/58]lr: 7.9595e-04  eta: 0:14:49  time: 83.9375  inter_cls_loss: 0.0873 inner_cls_loss: 4.1833
2023-12-06 03:27:18,911 - INFO - Epoch(test) test/all:
2023-12-06 03:28:03,199 - INFO - Epoch(test) : [20/31]
2023-12-06 03:28:21,017 - INFO - Metrics for ship: Accuracy: 0.9483, Precision: 0.8461, Recall: 0.8722, F1_score: 0.8590, Average_Precision: 0.9359
2023-12-06 03:28:21,046 - INFO - Epoch(test) test/offshore:
2023-12-06 03:29:04,008 - INFO - Epoch(test) : [20/26]
2023-12-06 03:29:14,643 - INFO - Metrics for ship: Accuracy: 0.9629, Precision: 0.9545, Recall: 0.9456, F1_score: 0.9500, Average_Precision: 0.9878
2023-12-06 03:29:14,646 - INFO - Epoch(test) test/inshore:
2023-12-06 03:29:31,169 - INFO - Metrics for ship: Accuracy: 0.9215, Precision: 0.6293, Recall: 0.8358, F1_score: 0.7180, Average_Precision: 0.7625
2023-12-06 03:29:32,124 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:30:23,173 - INFO - Epoch(train)[34/40][20/58]lr: 7.6364e-04  eta: 0:16:25  time: 51.0427  inter_cls_loss: 0.0802 inner_cls_loss: 3.9691
2023-12-06 03:30:57,191 - INFO - Epoch(train)[34/40][40/58]lr: 7.6364e-04  eta: 0:12:58  time: 85.0662  inter_cls_loss: 0.1027 inner_cls_loss: 4.1527
2023-12-06 03:31:26,292 - INFO - Epoch(test) test/all:
2023-12-06 03:32:11,008 - INFO - Epoch(test) : [20/31]
2023-12-06 03:32:28,425 - INFO - Metrics for ship: Accuracy: 0.9477, Precision: 0.8773, Recall: 0.8258, F1_score: 0.8508, Average_Precision: 0.9335
2023-12-06 03:32:28,456 - INFO - Epoch(test) test/offshore:
2023-12-06 03:33:13,257 - INFO - Epoch(test) : [20/26]
2023-12-06 03:33:23,349 - INFO - Metrics for ship: Accuracy: 0.9602, Precision: 0.9592, Recall: 0.9331, F1_score: 0.9460, Average_Precision: 0.9863
2023-12-06 03:33:23,352 - INFO - Epoch(test) test/inshore:
2023-12-06 03:33:39,792 - INFO - Metrics for ship: Accuracy: 0.9309, Precision: 0.6894, Recall: 0.7683, F1_score: 0.7267, Average_Precision: 0.7599
2023-12-06 03:33:40,779 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:34:31,228 - INFO - Epoch(train)[35/40][20/58]lr: 7.2973e-04  eta: 0:13:47  time: 50.4483  inter_cls_loss: 0.1085 inner_cls_loss: 4.1183
2023-12-06 03:35:05,170 - INFO - Epoch(train)[35/40][40/58]lr: 7.2973e-04  eta: 0:10:49  time: 84.3843  inter_cls_loss: 0.0781 inner_cls_loss: 3.6696
2023-12-06 03:35:35,013 - INFO - Epoch(test) test/all:
2023-12-06 03:36:19,372 - INFO - Epoch(test) : [20/31]
2023-12-06 03:36:37,297 - INFO - Metrics for ship: Accuracy: 0.9480, Precision: 0.8297, Recall: 0.8962, F1_score: 0.8617, Average_Precision: 0.9386
2023-12-06 03:36:37,324 - INFO - Epoch(test) test/offshore:
2023-12-06 03:37:20,123 - INFO - Epoch(test) : [20/26]
2023-12-06 03:37:30,400 - INFO - Metrics for ship: Accuracy: 0.9641, Precision: 0.9502, Recall: 0.9538, F1_score: 0.9520, Average_Precision: 0.9877
2023-12-06 03:37:30,403 - INFO - Epoch(test) test/inshore:
2023-12-06 03:37:46,985 - INFO - Metrics for ship: Accuracy: 0.9193, Precision: 0.6170, Recall: 0.8568, F1_score: 0.7174, Average_Precision: 0.7555
2023-12-06 03:37:47,982 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:38:38,669 - INFO - Epoch(train)[36/40][20/58]lr: 6.9443e-04  eta: 0:11:24  time: 50.6851  inter_cls_loss: 0.1069 inner_cls_loss: 3.8050
2023-12-06 03:39:12,676 - INFO - Epoch(train)[36/40][40/58]lr: 6.9443e-04  eta: 0:8:49  time: 84.6919  inter_cls_loss: 0.0841 inner_cls_loss: 3.6178
2023-12-06 03:39:42,515 - INFO - Epoch(test) test/all:
2023-12-06 03:40:26,870 - INFO - Epoch(test) : [20/31]
2023-12-06 03:40:44,354 - INFO - Metrics for ship: Accuracy: 0.9512, Precision: 0.8648, Recall: 0.8650, F1_score: 0.8649, Average_Precision: 0.9409
2023-12-06 03:40:44,384 - INFO - Epoch(test) test/offshore:
2023-12-06 03:41:26,789 - INFO - Epoch(test) : [20/26]
2023-12-06 03:41:37,598 - INFO - Metrics for ship: Accuracy: 0.9610, Precision: 0.9520, Recall: 0.9429, F1_score: 0.9474, Average_Precision: 0.9864
2023-12-06 03:41:37,602 - INFO - Epoch(test) test/inshore:
2023-12-06 03:41:53,876 - INFO - Metrics for ship: Accuracy: 0.9368, Precision: 0.7113, Recall: 0.7928, F1_score: 0.7499, Average_Precision: 0.7942
2023-12-06 03:41:54,839 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:41:54,894 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 d02c07622c9c60c4fdc27445e8bc9176, with test/inshore image AP 0.7942
2023-12-06 03:42:45,570 - INFO - Epoch(train)[37/40][20/58]lr: 6.5796e-04  eta: 0:8:57  time: 50.6758  inter_cls_loss: 0.1805 inner_cls_loss: 4.4998
2023-12-06 03:43:19,933 - INFO - Epoch(train)[37/40][40/58]lr: 6.5796e-04  eta: 0:6:48  time: 85.0352  inter_cls_loss: 0.0900 inner_cls_loss: 3.4969
2023-12-06 03:43:49,277 - INFO - Epoch(test) test/all:
2023-12-06 03:44:33,144 - INFO - Epoch(test) : [20/31]
2023-12-06 03:44:51,119 - INFO - Metrics for ship: Accuracy: 0.9502, Precision: 0.8432, Recall: 0.8900, F1_score: 0.8660, Average_Precision: 0.9414
2023-12-06 03:44:51,145 - INFO - Epoch(test) test/offshore:
2023-12-06 03:45:34,165 - INFO - Epoch(test) : [20/26]
2023-12-06 03:45:44,726 - INFO - Metrics for ship: Accuracy: 0.9653, Precision: 0.9518, Recall: 0.9553, F1_score: 0.9536, Average_Precision: 0.9882
2023-12-06 03:45:44,730 - INFO - Epoch(test) test/inshore:
2023-12-06 03:46:00,770 - INFO - Metrics for ship: Accuracy: 0.9231, Precision: 0.6312, Recall: 0.8579, F1_score: 0.7273, Average_Precision: 0.7826
2023-12-06 03:46:01,881 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:46:53,211 - INFO - Epoch(train)[38/40][20/58]lr: 6.2056e-04  eta: 0:6:35  time: 51.3233  inter_cls_loss: 0.0724 inner_cls_loss: 3.2320
2023-12-06 03:47:27,092 - INFO - Epoch(train)[38/40][40/58]lr: 6.2056e-04  eta: 0:4:45  time: 85.2098  inter_cls_loss: 0.0741 inner_cls_loss: 3.2142
2023-12-06 03:47:56,435 - INFO - Epoch(test) test/all:
2023-12-06 03:48:39,776 - INFO - Epoch(test) : [20/31]
2023-12-06 03:48:57,666 - INFO - Metrics for ship: Accuracy: 0.9505, Precision: 0.9147, Recall: 0.8006, F1_score: 0.8539, Average_Precision: 0.9423
2023-12-06 03:48:57,695 - INFO - Epoch(test) test/offshore:
2023-12-06 03:49:40,028 - INFO - Epoch(test) : [20/26]
2023-12-06 03:49:50,531 - INFO - Metrics for ship: Accuracy: 0.9581, Precision: 0.9674, Recall: 0.9186, F1_score: 0.9424, Average_Precision: 0.9889
2023-12-06 03:49:50,536 - INFO - Epoch(test) test/inshore:
2023-12-06 03:50:06,698 - INFO - Metrics for ship: Accuracy: 0.9376, Precision: 0.7280, Recall: 0.7635, F1_score: 0.7453, Average_Precision: 0.7853
2023-12-06 03:50:07,662 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:50:58,469 - INFO - Epoch(train)[39/40][20/58]lr: 5.8244e-04  eta: 0:4:3  time: 50.8043  inter_cls_loss: 0.1177 inner_cls_loss: 3.5420
2023-12-06 03:51:31,959 - INFO - Epoch(train)[39/40][40/58]lr: 5.8244e-04  eta: 0:2:40  time: 84.2901  inter_cls_loss: 0.0822 inner_cls_loss: 3.0602
2023-12-06 03:52:01,231 - INFO - Epoch(test) test/all:
2023-12-06 03:52:45,257 - INFO - Epoch(test) : [20/31]
2023-12-06 03:53:03,135 - INFO - Metrics for ship: Accuracy: 0.9525, Precision: 0.8690, Recall: 0.8679, F1_score: 0.8684, Average_Precision: 0.9423
2023-12-06 03:53:03,168 - INFO - Epoch(test) test/offshore:
2023-12-06 03:53:45,075 - INFO - Epoch(test) : [20/26]
2023-12-06 03:53:55,660 - INFO - Metrics for ship: Accuracy: 0.9631, Precision: 0.9579, Recall: 0.9426, F1_score: 0.9502, Average_Precision: 0.9890
2023-12-06 03:53:55,665 - INFO - Epoch(test) test/inshore:
2023-12-06 03:54:12,171 - INFO - Metrics for ship: Accuracy: 0.9299, Precision: 0.6648, Recall: 0.8344, F1_score: 0.7400, Average_Precision: 0.7984
2023-12-06 03:54:13,140 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:54:13,190 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 cfc959e96115126eb280ad5bfa17cf7b, with test/inshore image AP 0.7984
2023-12-06 03:55:02,400 - INFO - Epoch(train)[40/40][20/58]lr: 5.4384e-04  eta: 0:1:33  time: 49.2092  inter_cls_loss: 0.1308 inner_cls_loss: 3.5255
2023-12-06 03:55:36,278 - INFO - Epoch(train)[40/40][40/58]lr: 5.4384e-04  eta: 0:0:37  time: 83.0879  inter_cls_loss: 0.0828 inner_cls_loss: 3.0221
2023-12-06 03:56:06,325 - INFO - Epoch(test) test/all:
2023-12-06 03:56:50,542 - INFO - Epoch(test) : [20/31]
2023-12-06 03:57:08,438 - INFO - Metrics for ship: Accuracy: 0.9543, Precision: 0.8777, Recall: 0.8682, F1_score: 0.8729, Average_Precision: 0.9454
2023-12-06 03:57:08,467 - INFO - Epoch(test) test/offshore:
2023-12-06 03:57:51,006 - INFO - Epoch(test) : [20/26]
2023-12-06 03:58:01,280 - INFO - Metrics for ship: Accuracy: 0.9622, Precision: 0.9571, Recall: 0.9408, F1_score: 0.9489, Average_Precision: 0.9881
2023-12-06 03:58:01,287 - INFO - Epoch(test) test/inshore:
2023-12-06 03:58:17,506 - INFO - Metrics for ship: Accuracy: 0.9373, Precision: 0.7044, Recall: 0.8191, F1_score: 0.7574, Average_Precision: 0.8118
2023-12-06 03:58:18,504 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 03:58:18,560 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 cbb9aa3a98ac4fa6dd418ae73d427713, with test/inshore image AP 0.8118
2023-12-06 03:58:18,578 - INFO - Last model saved :work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_last_model_weight.pth
2023-12-06 03:58:18,661 - INFO - model weights saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 cbb9aa3a98ac4fa6dd418ae73d427713!
2023-12-06 03:58:18,699 - INFO - model weights loaded from work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 cbb9aa3a98ac4fa6dd418ae73d427713!
2023-12-06 03:58:18,700 - INFO - Epoch(test) test/all:
2023-12-06 03:59:02,556 - INFO - Epoch(test) : [20/31]
2023-12-06 03:59:19,846 - INFO - Metrics for ship: Accuracy: 0.9543, Precision: 0.8777, Recall: 0.8682, F1_score: 0.8729, Average_Precision: 0.9454
2023-12-06 03:59:19,873 - INFO - Epoch(test) test/offshore:
2023-12-06 04:00:03,423 - INFO - Epoch(test) : [20/26]
2023-12-06 04:00:12,703 - INFO - Metrics for ship: Accuracy: 0.9622, Precision: 0.9571, Recall: 0.9408, F1_score: 0.9489, Average_Precision: 0.9881
2023-12-06 04:00:12,707 - INFO - Epoch(test) test/inshore:
2023-12-06 04:00:28,926 - INFO - Metrics for ship: Accuracy: 0.9373, Precision: 0.7044, Recall: 0.8191, F1_score: 0.7574, Average_Precision: 0.8118
2023-12-06 04:00:29,883 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_eval_cbb9a.png!
2023-12-06 18:28:09,619 - INFO - >>>>>=========================Start Train!===========================<<<<<
2023-12-06 18:28:09,619 - INFO - descriptor: SuperPoint+Boost-B-attlay3
2023-12-06 18:28:09,619 - INFO - num_epochs: 100
2023-12-06 18:28:09,619 - INFO - train_ratio: 1.0
2023-12-06 18:28:09,619 - INFO - batch_size: 64
2023-12-06 18:28:09,619 - INFO - num_workers: 4
2023-12-06 18:28:09,619 - INFO - print_interval: 20
2023-12-06 18:28:09,619 - INFO - eval_interval: 1
2023-12-06 18:28:09,619 - INFO - save_interval: 10
2023-12-06 18:28:09,619 - INFO - lr: 0.001
2023-12-06 18:28:09,619 - INFO - warmup_step: 20
2023-12-06 18:28:09,619 - INFO - random_seed: 0
2023-12-06 18:28:09,619 - INFO - expand_piexl: 2
2023-12-06 18:28:09,620 - INFO - test_threshold: 0.5
2023-12-06 18:28:09,620 - INFO - test_image: 
2023-12-06 18:28:09,620 - INFO - test_images: []
2023-12-06 18:28:09,620 - INFO - eval: False
2023-12-06 18:28:09,620 - INFO - save_path: work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth
2023-12-06 18:28:09,620 - INFO - log_file: work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_dataset_repeat_1_positive_keypoint_repeat_1_scratch.log
2023-12-06 18:28:09,620 - INFO - checkpoint: 
2023-12-06 18:28:09,620 - INFO - multiprocessing_context: spawn
2023-12-06 18:28:09,620 - INFO - data_root: data/hrsid
2023-12-06 18:28:09,620 - INFO - img_suffix: .png
2023-12-06 18:28:09,620 - INFO - train_ann_file: ['train/', 'val/']
2023-12-06 18:28:09,620 - INFO - test_ann_file: ['test/all/', 'test/offshore/', 'test/inshore/']
2023-12-06 18:28:09,620 - INFO - dataset_class: {'ship': 1}
2023-12-06 18:28:09,620 - INFO - weight_decay: 0.0001
2023-12-06 18:28:09,621 - INFO - dataset_repeat: 1
2023-12-06 18:28:09,621 - INFO - positive_keypoint_repeat: 1
2023-12-06 18:28:09,621 - INFO - image_aug: False
2023-12-06 18:28:09,621 - INFO - print: True
2023-12-06 18:28:09,621 - INFO - feature_booster_pretrained: 
2023-12-06 18:28:09,621 - INFO - device: cuda
2023-12-06 18:28:09,621 - INFO - color: ['#00FF00', '#FF00FF', '#FF4500', '#0000FF', '#00FFFF', '#FF1493', '#808000']
# -*- coding: UTF-8 -*-
import pycolmap # pycolmap 占用的TLS最大,放在最前面 
# 原理参考: https://github.com/pytorch/pytorch/issues/2575#issue-254038499
from extract_features import normalize_keypoints, extractor_build, extract_img_feature
from torch.utils.data import DataLoader, Dataset
from os import path as osp
from pathlib import Path
from torch import nn
import numpy as np
import matplotlib
matplotlib.use('Agg')  # 设置Agg为后端
import matplotlib.pyplot as plt
import importlib
import warnings
import logging
import random
import torch
import copy
import time
import glob
import yaml
import cv2
import os
warnings.filterwarnings('ignore')

def parse_arguments():
    parser = importlib.import_module('argparse').ArgumentParser(description="Extract feature and refine descriptor using neural network to find ship keypoint.")

    parser.add_argument(
        '--descriptor', type=str, default='SuperPoint+Boost-B-attlay3',
        help='descriptor to extract' )

    parser.add_argument(
        '--num_epochs', type=int, default=40,)

    parser.add_argument(
        '--train_ratio', type=float, default=1.0,
        help='The ratio of data used for training out of the training set' )

    parser.add_argument(
        '--batch_size', type=int, default=64,)

    parser.add_argument(
        '--num_workers', type=int, default=4,)

    parser.add_argument(
        '--print_interval', type=int, default=20,)

    parser.add_argument(
        '--eval_interval', type=int, default=1,)

    parser.add_argument(
        '--save_interval', type=int, default=10,)

    parser.add_argument(
        '--lr', type=float, default=1e-3,)

    parser.add_argument(
        '--warmup_step', type=int, default=20,)

    parser.add_argument(
        '--random_seed', type=int, default=0,)

    parser.add_argument(
        '--expand_piexl', type=int, default=5,)

    parser.add_argument(
        '--test_threshold', type=float, default=0.5,)

    parser.add_argument(
        '--test_image', type=str, default='',)
    
    parser.add_argument(
        '--test_images', nargs='*', default=[],)
    
    parser.add_argument(
        '--eval', action='store_true',)

    parser.add_argument(
        '--save_path', type=str, default='',)

    parser.add_argument(
        '--log_file', type=str, default='',)

    parser.add_argument(
        '--checkpoint', type=str, default='',)

    parser.add_argument(
        '--multiprocessing_context', type=str, default=None,)

    parser.add_argument(
        '--data_root', type=str, default='data/hrsid',)

    parser.add_argument(
        '--img_suffix', type=str, default='.png',)

    parser.add_argument(
        '--train_ann_file', nargs='*', default=['train/','val/'],)

    parser.add_argument(
        '--test_ann_file', nargs='*', default=['test/all','test/offshore','test/inshore'],)

    parser.add_argument(
        '--dataset_class',
        nargs='*',
        # default=['ore-oil','Cell-Container','Fishing','LawEnforce','Dredger','Container'], # [166, 89 , 288 , 25 , 263 , 2053]
        default=["ship"],
        help='Dataset classes list. Default is ["ship"].'
    )
    
    parser.add_argument(
        '--weight_decay', type=float, default=1e-4,)
    
    parser.add_argument(
        '--dataset_repeat', type=int, default=1,)
    
    parser.add_argument(
        '--positive_keypoint_repeat', type=int, default=1,)

    parser.add_argument(
        '--image_aug', action='store_true',)
    
    parser.add_argument(
        '--print', action='store_true')

    args = parser.parse_args()
    args.dataset_class = {item: index + 1 for index, item in enumerate(args.dataset_class)}    
    return args

def calculate_md5(file_path):

    hash_md5 = importlib.import_module('hashlib').md5()
    with open(file_path, "rb") as f:
        # 以块的方式读取文件，以防文件太大
        for chunk in iter(lambda: f.read(4096), b""):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()

# 定义舰船目标关键点检测模型（示例）
class ShipKeyPointsModel(nn.Module):
    def __init__(self, args,):
        super().__init__()
        FeatureBooster = importlib.import_module('FeatureBooster.featurebooster').FeatureBooster
        MLP = importlib.import_module('FeatureBooster.featurebooster').MLP

        self.device = args.device

        with open(str(Path(__file__).parent / "config.yaml"), 'r') as f:
            config = yaml.load(f, Loader=yaml.FullLoader)
        self.config = config[args.descriptor]
        # Model
        self.feature_booster = FeatureBooster(self.config)
        # load the model
        if os.path.isfile(args.feature_booster_pretrained):
            self.feature_booster.load_state_dict(torch.load(args.feature_booster_pretrained), strict =False)
            args.logger.info(f"feature_booster weights loaded from {args.feature_booster_pretrained}!")
        self.fc_out = MLP([self.config['output_dim'], self.config['output_dim']//2, len(args.dataset_class) + 1]) 
        self.to(args.device)
        self.args = args

    def forward(self, x):
        feat = self.feature_booster(x[...,self.config['keypoint_dim']:], x[...,:self.config['keypoint_dim']])
        x = self.fc_out(feat)
        return feat, nn.functional.softmax(x, dim=-1)

def rotate_box_90_degrees(coords):
    x1, y1, x2, y2, x3, y3, x4, y4 = coords

    # 计算中心点
    cx = (x1 + x3) / 2
    cy = (y1 + y3) / 2

    # 将矩形平移到原点，旋转90度，然后平移回去
    rotated_coords = []
    for x, y in [(x1, y1), (x2, y2), (x3, y3), (x4, y4)]:
        x_prime = -y + cy + cx
        y_prime = x - cx + cy
        rotated_coords.extend([x_prime, y_prime])

    return rotated_coords

def load_txt_info_srsdd(txt_file, args):
    data_info = {}
    img_id = osp.split(txt_file)[1][:-4]
    data_info['img_id'] = img_id
    img_name = img_id + f'.{args.img_suffix.lstrip(".")}'
    data_info['file_name'] = img_name

    img_path = txt_file.replace('.txt',f'.{args.img_suffix.lstrip(".")}').replace('labels','images')
    data_info['img_path'] = img_path

    instances = []
    with open(txt_file) as f:
        s = f.readlines()
        for si in s[2:]:
            instance = {}
            bbox_info = si.split()
            instance['bbox_label'] = args.dataset_class[bbox_info[8]] if len(args.dataset_class) > 1 else 1
            instance['ignore_flag'] = 0
            instance['bbox'] = [float(i) for i in bbox_info[:8]]
            instances.append(instance)
    data_info['instances'] = instances
    return data_info

def load_txt_info_rsdd(txt_file, args):
    data_info = {}
    img_id = osp.split(txt_file)[1][:-4]
    data_info['img_id'] = img_id
    img_name = img_id + f'.{args.img_suffix.lstrip(".")}'
    data_info['file_name'] = img_name

    img_path = txt_file.replace('.txt',f'.{args.img_suffix.lstrip(".")}').replace('labels','images')
    data_info['img_path'] = img_path

    instances = []
    with open(txt_file) as f:
        s = f.readlines()
        for si in s:
            instance = {}
            bbox_info = si.split()
            instance['bbox_label'] = args.dataset_class[bbox_info[8]] if len(args.dataset_class) > 1 else 1
            instance['ignore_flag'] = 0
            instance['bbox'] = rotate_box_90_degrees([float(i) for i in bbox_info[2:]]) # 这里标注出的矩形框和真实中间差90度。可能是标注换换的问题。
            #人为旋转90度
            instances.append(instance)
    data_info['instances'] = instances
    return data_info

def load_txt_info_hrsid(txt_file, args):
    data_info = {}
    img_id = osp.split(txt_file)[1][:-4]
    data_info['img_id'] = img_id
    img_name = img_id + f'.{args.img_suffix.lstrip(".")}'
    data_info['file_name'] = img_name

    img_path = txt_file.replace('.txt',f'.{args.img_suffix.lstrip(".")}').replace('labelTxt','images')
    data_info['img_path'] = img_path

    instances = []
    with open(txt_file) as f:
        s = f.readlines()
        for si in s:
            instance = {}
            bbox_info = si.split()
            instance['bbox_label'] = args.dataset_class[bbox_info[8]]
            instance['ignore_flag'] = 0
            instance['bbox'] = [float(i) for i in bbox_info[:8]]
            instances.append(instance)
    data_info['instances'] = instances
    return data_info

def get_keypoint_label(keypoints, data_info, args):
    bboxes = []
    bbox_label = []
    for instances in data_info['instances']:
        bboxes.append(np.array([(instances['bbox'][i], instances['bbox'][i + 1]) for i in range(0, len(instances['bbox']), 2)], dtype=np.int32))
        bbox_label.append(instances['bbox_label'])

    tmp = np.zeros(data_info['image_shape'], dtype=np.uint8)
    for box, label in zip(bboxes, bbox_label):
        cv2.fillPoly(tmp, np.array([box]), label)
    target = []
    mode = importlib.import_module('scipy.stats').mode
    for kp in keypoints:
        region = tmp[max(0, int(kp[1] - args.expand_piexl)):min(int(kp[1] + args.expand_piexl), data_info['image_shape'][0]),
                    max(0, int(kp[0] - args.expand_piexl)):min(int(kp[0] +args.expand_piexl), data_info['image_shape'][1])].reshape(-1)
        region = region[region.astype(np.bool_)]
        if region.size > 0:
            # 计算区域的众数
            mode_val = mode(region, axis=None)[0][0]
            target.append(mode_val)
        else:
            target.append(0)
    return np.array(target), bboxes

# 定义数据集（示例）
class ShipKeyPointsDataset(Dataset):
    def __init__(self, args, dataset_repeat = 1, pipeline = [], debug = False, **kwargs):
        super(ShipKeyPointsDataset, self).__init__()
        if len(pipeline):
            importlib.import_module('mmdet.utils').register_all_modules(init_default_scope=False)
            importlib.import_module('mmdet.utils').register_all_modules(init_default_scope=False)
        self.transform = importlib.import_module('mmengine.dataset').Compose(pipeline)
        self.debug = debug
        self.args = args
        with open(str(Path(__file__).parent / "config.yaml"), 'r') as f:
            config = yaml.load(f, Loader=yaml.FullLoader)
        self.config = config[args.descriptor]
        self.extractor = extractor_build(self.args.descriptor, device = args.device)
        if 'ann_file' in kwargs and kwargs['ann_file'] !='':
            # train case
            ann_dir = kwargs['ann_file']
            if isinstance(ann_dir, str):
                ann_dir = [ann_dir]
        else:
            ann_dir = []
        self.txt_files = []
        for path in ann_dir:
            self.txt_files.extend(glob.glob(osp.join(args.data_root, path, "**/*.txt"), recursive=True)) 
        if (not args.eval) and (args.train_ratio<1):
            self.txt_files = random.sample(self.txt_files, int(np.ceil(len(self.txt_files)*args.train_ratio)))
        if (not args.eval) and (dataset_repeat > 1):
            self.txt_files = self.txt_files*dataset_repeat
            args.logger.info(f"The dataset located in {ann_dir} was duplicated {dataset_repeat} times!")

    def __len__(self):
        return len(self.txt_files)

    def load_data_info(self, idx):
        txt_file = self.txt_files[idx]
        load_txt_info_func = globals()['load_txt_info_' + self.args.data_root.rstrip('/').split('/')[-1]]
        return load_txt_info_func(txt_file, self.args)

    def __getitem__(self, idx):
        data_info = self.load_data_info(idx)
        bboxes = []
        if (not self.args.eval) and (len(self.transform.transforms)):
            data = self.transform(data_info)
            data_instance = data['data_samples'].gt_instances
            if (len(data_info['instances'])>0) and (len(data_instance.labels)<1):
                image = cv2.cvtColor(cv2.imread(data_info['img_path']), cv2.COLOR_BGR2RGB)
                data_info['image_shape'] = image.shape[:2]
            else:            
                image = data['inputs'].cpu().numpy().transpose(1, 2, 0)
                data_info['image_shape'] = image.shape[:2]
                data_info['instances'] = [] 
                for box_id in range(len(data_instance.labels)):
                    instance = {}
                    instance['bbox_label'] = int(data_instance.labels[box_id])
                    instance['bbox'] = list(data_instance.bboxes.vertices[box_id].reshape(-1).cpu().numpy())
                    data_info['instances'].append(instance)
            del data
        else:
            image = cv2.cvtColor(cv2.imread(data_info['img_path']), cv2.COLOR_BGR2RGB)
            data_info['image_shape'] = image.shape[:2]

        keypoints, descriptors, image = extract_img_feature(self.args.descriptor, image, self.extractor)
        if keypoints.size == 0:
            message = f"{data_info['img_path']} has no keypoint founded with {self.args.descriptor}"
            print(message)
            with open(self.args.log_file, "a") as file:   
                file.write(message+'\n')
            return torch.zeros([2, self.config['keypoint_dim'] + self.config['descriptor_dim'] + 2], dtype = torch.float32, requires_grad = False).float(), data_info['img_path']
        else:
            target, bboxes = get_keypoint_label(keypoints, data_info, self.args)
            
            if (not self.args.eval) and (self.args.positive_keypoint_repeat>1) and (np.random.rand() > 0.5): # 将正样本的关键点特征进行重复，增加正样本数目
                keypoints = np.concatenate([keypoints, np.tile(keypoints[target.astype(np.bool_)], (self.args.positive_keypoint_repeat,1))], axis=0)
                descriptors = np.concatenate([descriptors, np.tile(descriptors[target.astype(np.bool_)], (self.args.positive_keypoint_repeat,1))], axis=0)
                target = np.concatenate([target, np.tile(target[target.astype(np.bool_)], self.args.positive_keypoint_repeat)], axis=0)

            # visualization
            if self.debug:
                print(f"VISUALIZATION: {data_info['img_path']}")
                kps = np.array([cv2.KeyPoint(*kp) for kp in keypoints])
                image = cv2.drawKeypoints(image, kps[target.astype(np.bool_)], None, color=(255,0,0,))
                image = cv2.drawKeypoints(image, kps[~(target.astype(np.bool_))], None, color=(0,0,255))
                image = cv2.polylines(image, bboxes, isClosed=True, color=(0, 255, 0), thickness=2)
                cv2.imwrite(f"vis_dir/{data_info['img_id']}.png", cv2.cvtColor(image, cv2.COLOR_RGB2BGR))
                
            # boosted the descriptor using trained model
            keypoints = normalize_keypoints(keypoints, image.shape).astype(np.float32)
            if 'orb' in self.args.descriptor.lower():
                descriptors = np.unpackbits(descriptors, axis=1, bitorder='little').astype(np.float32)
                descriptors = descriptors * 2.0 - 1.0
            # 最后的全一是为了区分对齐batch的padding数据
            result = torch.from_numpy(np.concatenate([keypoints, descriptors, target.reshape(-1, 1), np.ones([len(target),1])], axis=-1))
            if (not self.args.eval) and (np.random.rand() > 0.5):
                result = result[torch.randperm(len(result))]
            result.requires_grad = False
            result = result.float()
            return result, data_info['img_path']

def hex_to_rgb(hex_color):
    hex_color = hex_color.lstrip('#')
    return tuple(int(hex_color[i:i+2], 16) for i in (0, 2, 4))

def get_metric(all_labels, all_output, args):
    accuracy_score = importlib.import_module('sklearn.metrics').accuracy_score
    recall_score = importlib.import_module('sklearn.metrics').recall_score
    precision_score = importlib.import_module('sklearn.metrics').precision_score
    precision_recall_curve = importlib.import_module('sklearn.metrics').precision_recall_curve
    average_precision_score = importlib.import_module('sklearn.metrics').average_precision_score
    f1_score = importlib.import_module('sklearn.metrics').f1_score
    if isinstance(all_output, torch.Tensor):
        if all_output.requires_grad:
            all_output = all_output.detach()
        all_output = all_output.cpu().numpy()
    if isinstance(all_labels, torch.Tensor):
        all_labels = all_labels.cpu().numpy()

    metrics_per_class = {}
    Average_Precision_Curve = {}
    avg_metrics = {}
  
    dataset_class = args.dataset_class.copy()
    if len(args.dataset_class) > 1:
        dataset_class['foreground'] = 0

    all_predict = np.zeros_like(all_output, dtype=bool)
    np.put_along_axis(all_predict, np.argmax(all_output, axis=-1).reshape(-1, 1), True, axis=-1)
     
    for class_name, idx in dataset_class.items():
        # 为当前类别准备标签和预测
        if class_name in 'foreground':
            class_labels = (all_labels != idx).astype(int)
            class_output = ~all_predict[:, 0]
            ap = average_precision_score(class_labels, 1-all_output[:, idx])
            precisions, recalls, _ = precision_recall_curve(class_labels, 1-all_output[:, idx])
        else:
            class_labels = (all_labels == idx).astype(int)
            class_output = all_predict[:, idx]
            ap = average_precision_score(class_labels, all_output[:, idx])
            precisions, recalls, _ = precision_recall_curve(class_labels, all_output[:, idx])
        # 计算指标
        accuracy = accuracy_score(class_labels, class_output)
        precision = precision_score(class_labels, class_output)
        recall = recall_score(class_labels, class_output)
        f1 = f1_score(class_labels, class_output)

        metrics_per_class[class_name] = {
            'Accuracy': accuracy,
            'Precision': precision,
            'Recall': recall,
            'F1_score': f1,
            'Average_Precision': ap,
        }
        Average_Precision_Curve[class_name] = {'Precision': precisions,'Recall': recalls}
        metrics_str = ', '.join(f"{metric}: {value:.4f}" for metric, value in metrics_per_class[class_name].items())
        args.logger.info(f"Metrics for {class_name}: {metrics_str}")

    if len(args.dataset_class)>1:    
        # 计算平均值
        for metric in metrics_per_class[list(args.dataset_class.keys())[0]].keys():
            avg_metrics[metric] = np.mean([class_metrics[metric] for class_metrics in metrics_per_class.values()])
        metrics_str = ', '.join(f"{metric}: {value:.4f}" for metric, value in avg_metrics.items())
        args.logger.info(f"Average metrics: {metrics_str}")
        
        if (not ( os.path.isfile(args.test_image) or (len(args.test_images)>0) )):
            for class_name, idx in dataset_class.items():
                plt.plot(Average_Precision_Curve[class_name]['Recall'], 
                        Average_Precision_Curve[class_name]['Precision'], label=class_name, color=args.color[idx % len(args.color)])
            # 设置图例和标签
            plt.xlabel('Recall')
            plt.ylabel('Precision')
            plt.title('Precision-Recall Curve')
            plt.legend()
            if (args.eval): 
                PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_eval.png'
            else:
                PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_train.png'
            plt.savefig(PR_curve_path, bbox_inches='tight', dpi=300)
            plt.close('all') 
            args.logger.info(f"PR_curve has been saved to {PR_curve_path}:")        
        return avg_metrics, Average_Precision_Curve['foreground']
    return metrics_per_class[list(args.dataset_class.keys())[0]], Average_Precision_Curve[list(args.dataset_class.keys())[0]] 

def evaluate(model, eva_loader, args):
    model.eval()

    all_output = torch.tensor([], device=args.device)
    all_labels = torch.tensor([], device=args.device)

    with torch.no_grad():
        for i, (data, img_paths) in enumerate(eva_loader):
            data = data.to(args.device)
            _, outputs = model(data[:,:,:-2])
            valid = data[:,:,-1].reshape(-1).bool()
            all_output = torch.cat([all_output, outputs.view(-1,len(args.dataset_class)+1)[valid,:]], dim=0)
            all_labels = torch.cat([all_labels, data[:,:,-2].long().reshape(-1)[valid]], dim=0)

            if (i + 1) % args.print_interval == 0:
                args.logger.info(f"Epoch(test) : [{i + 1}/{len(eva_loader)}]")

    return get_metric(all_labels, all_output, args)

def test(model, test_image, args):
    model.eval()
    extractor = extractor_build(args.descriptor)
    keypoints, descriptors, image = extract_img_feature(args.descriptor, cv2.cvtColor(cv2.imread(test_image), cv2.COLOR_BGR2RGB), extractor)

    load_txt_info_func = globals()['load_txt_info_' + args.data_root.rstrip('/').split('/')[-1]]
    txt_file = test_image.replace(f'.{args.img_suffix.lstrip(".")}','.txt').replace('images','**')
    txt_file = glob.glob(txt_file, recursive=True)[0] 
    data_info = load_txt_info_func(txt_file, args)
    data_info['image_shape'] = image.shape[:2]
    labels, bboxes = get_keypoint_label(keypoints, data_info, args)
    
    kps = np.array([cv2.KeyPoint(*kp) for kp in keypoints])
    # boosted the descriptor using trained model
    keypoints = normalize_keypoints(keypoints, image.shape).astype(np.float32)
    if 'orb' in args.descriptor.lower():
        descriptors = np.unpackbits(descriptors, axis=1, bitorder='little').astype(np.float32)
        descriptors = descriptors * 2.0 - 1.0
    with torch.no_grad():
        output = model(torch.from_numpy(np.concatenate([keypoints, descriptors,], axis=-1)).to(args.device).float())[1].cpu().numpy()

    metric_dict, PR_dict = get_metric(labels, output, args)
    # predict = (1-output[...,0]) > args.test_threshold
    predict = np.argmax(output, axis=-1)
    dataset_class = dict()
    for class_name, idx in args.dataset_class.items():
        dataset_class[str(idx)] = class_name
        index = (predict==idx) & (output[:,idx]>args.test_threshold)
        image = cv2.drawKeypoints(image, kps[index&(labels==idx)], None, color=hex_to_rgb(args.color[idx % len(args.color)]),)
        image = cv2.drawKeypoints(image, kps[index&(labels!=idx)], None, color=hex_to_rgb("#40E0D0"),)
        # image = cv2.drawKeypoints(image, kps[(~predict)&(labels)], None, color=(0,0,255)) # Aqua蓝色 漏检
        # image = cv2.drawKeypoints(image, kps[predict&labels], None, color=(0,0,255,),) # 黄色 正确预测(正样本)
        # image = cv2.drawKeypoints(image, kps[(~predict)&(~labels)], None, color= (0, 255, 0) ) # 绿色 正确预测(负样本)
        # image = cv2.drawKeypoints(image, kps[(label)], None, color=(255,0,0,))
        # image = cv2.drawKeypoints(image, kps[~predict], None, color=(0,255,0))
    for instance in data_info['instances']:
        color=hex_to_rgb(args.color[instance['bbox_label'] % len(args.color)])
        box = np.array([(instance['bbox'][i], instance['bbox'][i + 1]) for i in range(0, len(instance['bbox']), 2)], dtype=np.int32)
        image = cv2.polylines(image, [box], isClosed=True, color=color, thickness=1)
        # cls_name = dataset_class[str(instance['bbox_label'])]
        # assert args.dataset_class[cls_name] == instance['bbox_label']
        # cv2.putText(image, cls_name, (int(instance['bbox'][0]), int(instance['bbox'][1])), cv2.FONT_HERSHEY_SIMPLEX, 0.5, color, 1)
    save_path = f"{args.data_root.rstrip('/').split('/')[-1]}_keypoint_results/{args.descriptor}/vis/" + test_image.split('/')[-1]
    if not os.path.exists(os.path.dirname(save_path)):
        os.makedirs(os.path.dirname(save_path))
    cv2.imwrite(save_path, cv2.cvtColor(image, cv2.COLOR_RGB2BGR))
    return metric_dict, PR_dict

def keypoint_match(model, args, test_image1, test_image2):
    model.eval()
    extractor = extractor_build(args.descriptor)
    load_txt_info_func = globals()['load_txt_info_' + args.data_root.rstrip('/').split('/')[-1]]

    imgs = []
    kps = []
    descriptors = []
    labels = []
    for img_path in [test_image1, test_image2]:
        kp, des, img = extract_img_feature(args.descriptor, cv2.cvtColor(cv2.imread(img_path), cv2.COLOR_BGR2RGB), extractor)
        txt_file = img_path.replace(f'.{args.img_suffix.lstrip(".")}','.txt').replace('images','**')
        txt_file = glob.glob(txt_file, recursive=True)[0]
        data_info = load_txt_info_func(txt_file, args)
        data_info['image_shape'] = img.shape[:2]
        label, bboxes = get_keypoint_label(kp, data_info, args)

        if 'orb' in args.descriptor.lower():
            des = np.unpackbits(des, axis=1, bitorder='little').astype(np.float32)
            des = des * 2.0 - 1.0
        kp_norm = normalize_keypoints(kp, img.shape).astype(np.float32)
        des, _ = model(torch.from_numpy(np.concatenate([kp_norm, des], axis=-1)).to(args.device).float())
        des = des.detach().cpu().numpy()
        imgs.append(img)
        kps.append(kp)
        descriptors.append(des)
        labels.append(label)
        
    border = 10
    kps[1] = np.array([cv2.KeyPoint(kp_i[0] + border + imgs[0].shape[1], kp_i[1], kp_i[2]) for kp_i in kps[1]])
    kps[0] = np.array([cv2.KeyPoint(kp_i[0] , kp_i[1], kp_i[2]) for kp_i in kps[0]])
      
    imgs[1] = cv2.copyMakeBorder(imgs[1], 0, 0, border, 0, cv2.BORDER_CONSTANT, value=[255, 255, 255])
    dis = torch.cdist(torch.from_numpy(descriptors[0]),torch.from_numpy(descriptors[1]))
    matches_AB = torch.argmin(dis,dim=-1).cpu().numpy()
    matches_BA = torch.argmin(dis,dim=0).cpu().numpy()
    
    h1, w1 = imgs[0].shape[:2]
    h2, w2 = imgs[1].shape[:2]
    height = max(h1, h2)
    width = w1 + w2
    img_matches = np.zeros((height, width, 3), dtype="uint8")
    img_matches[:h1, :w1, :] = imgs[0]
    img_matches[:h2, w1:(w1 + w2), :] = imgs[1]

    for kp_i, label_i in zip(kps, labels):
        for kp_j, label_j in zip(kp_i, label_i):
            pt2 = tuple(np.round(kp_j.pt).astype(int))
            cv2.circle(img_matches, pt2, 5, color = hex_to_rgb("#40E0D0") if label_j>0 else hex_to_rgb("#FF0000"), thickness = 1) # if label_j>0 else hex_to_rgb("#FF0000")
    def draw_matches(img, kps, matches, color = hex_to_rgb("#FFFF00"), inverse = False):
        if inverse:
            color = hex_to_rgb("#00FF00")
        matches = matches[labels[int(inverse)].astype(np.bool_)] 
        for src,des,idx in zip(kps[int(inverse)][labels[int(inverse)].astype(np.bool_)], kps[1-int(inverse)][matches], matches):
            pt1 = tuple(np.round(src.pt).astype(int))
            pt2 = tuple(np.round(des.pt).astype(int))
            if labels[1-int(inverse)][idx]:
                cv2.arrowedLine(img, pt1, pt2, color , thickness = 1, tipLength=0.01)
            else:
                cv2.arrowedLine(img, pt1, pt2, hex_to_rgb("#FF0000"), thickness = 1, tipLength=0.01)
    draw_matches(img_matches, kps, matches_AB)
    draw_matches(img_matches, kps, matches_BA, inverse = True)

    # bf = cv2.BFMatcher(cv2.NORM_L2, crossCheck=True)
    # matches = bf.match(descriptors[0], descriptors[1])
    # matches = sorted(matches, key=lambda x: x.distance, reverse = True)
    # img_matches = cv2.drawMatches(imgs[0], kps[0], imgs[1], kps[1], matches, None, matchColor=(0, 255, 0), flags=cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS)

    save_path = f"{args.data_root.rstrip('/').split('/')[-1]}_keypoint_results/{args.descriptor}/kp_matched/{test_image1.split('/')[-1][:-4]}vs{test_image2.split('/')[-1]}"
    if not os.path.exists(os.path.dirname(save_path)):
        os.makedirs(os.path.dirname(save_path))        
    cv2.imwrite(save_path, cv2.cvtColor(img_matches, cv2.COLOR_RGB2BGR))
    args.logger.info(f"result saved to {save_path}")
    return img_matches

def worker_init_fn(worker_id, group, args):
    # torch.cuda.set_device(worker_id) 指定数加载设备
    torch.cuda.manual_seed_all(worker_id)

def custom_collate_fn(batch):
    rnn_utils = importlib.import_module('torch.nn.utils.rnn')
    results = [item[0] for item in batch]  # 提取每个样本的result
    img_paths = [item[1] for item in batch]  # 提取每个样本的img_path
    padded_results = rnn_utils.pad_sequence(results, batch_first=True, padding_value=0)
    return padded_results, img_paths

def train(model, args):
    CosineAnnealingWarmRestarts = importlib.import_module('torch.optim.lr_scheduler').CosineAnnealingWarmRestarts
    LinearLR = importlib.import_module('torch.optim.lr_scheduler').LinearLR
    MultiStepLR = importlib.import_module('torch.optim.lr_scheduler').MultiStepLR
    ChainedScheduler = importlib.import_module('torch.optim.lr_scheduler').ChainedScheduler
    clip_grad_norm_ = importlib.import_module('torch.nn.utils').clip_grad_norm_
    optimizer_class = importlib.import_module('torch.optim').AdamW
    partial = importlib.import_module('functools').partial
    train_pipeline = []
    if args.image_aug:
        train_pipeline = [
            dict(type='mmdet.LoadImageFromFile', backend_args=None),
            dict(type='mmdet.LoadAnnotations', with_bbox=True, box_type='qbox'),
            dict(
                type='mmrotate.ConvertBoxType',
                box_type_mapping=dict(gt_bboxes='rbox')),
            dict(
                type='mmrotate.RandomRotate',
                prob=0.5,
                angle_range=180,
                rotate_type='mmrotate.Rotate'),
            dict(
                type='mmdet.RandomFlip',
                prob=0.75,
                direction=['horizontal', 'vertical', 'diagonal']),
            dict(
                type='mmdet.RandomAffine',),
            dict(
                type='mmdet.PhotoMetricDistortion',),

            dict(
                type='mmrotate.ConvertBoxType',
                box_type_mapping=dict(gt_bboxes='qbox')),
            dict(type='mmdet.PackDetInputs', meta_keys=())]
    train_dataset = ShipKeyPointsDataset(args, ann_file = args.train_ann_file, dataset_repeat = args.dataset_repeat, pipeline = train_pipeline)
    train_loader = DataLoader(train_dataset, batch_size=args.batch_size, shuffle=True, 
                              num_workers=args.num_workers, collate_fn=custom_collate_fn, 
                              # worker_init_fn=partial(worker_init_fn, group='train', args = args),
                              # pin_memory=True, persistent_workers = True,
                              multiprocessing_context=args.multiprocessing_context)
    eva_loader = {}
    for ann_file in args.test_ann_file:
        eval_args = copy.deepcopy(args)
        eval_args.eval = True
        eva_dataset = ShipKeyPointsDataset(args = eval_args, ann_file = ann_file)
        eva_loader[ann_file] = DataLoader(eva_dataset, batch_size=args.batch_size, shuffle=False, 
                                num_workers=args.num_workers, collate_fn=custom_collate_fn, 
                                # worker_init_fn=partial(worker_init_fn, group='eval', args = args), 
                                # pin_memory=True, persistent_workers = True,
                                multiprocessing_context=args.multiprocessing_context)
    if args.print:
        outputs = importlib.import_module('mmengine.analysis').get_model_complexity_info(
            model,
            input_shape=None,
            inputs=train_dataset.__getitem__(0)[0][:,:-2].float().to(args.device),  # the input tensor of the model
            show_table=True,  # show the complexity table
            show_arch=False)  # show the complexity arch
        for k, v in outputs.items():
            args.logger.info(f"{k}: {v}")
    # 定义损失函数和优化器
    weight = torch.softmax(1/torch.tensor([100000.0,  166, 89 , 288 , 25 , 263 , 2053], device = args.device),dim=-1) # [100000.0,  166, 89 , 288 , 25 , 263 , 2053]

    CenterLoss = getattr(importlib.import_module("CenterLoss"), "CenterLoss")
    loss_weight = 20
    centerloss = CenterLoss(len(args.dataset_class) + 1, model.config['output_dim']).to(args.device)
    nllloss = nn.NLLLoss().to(args.device)
    param_groups = [
        {'params': model.parameters(), 'lr': args.lr, 'weight_decay': 1e-4},
        {'params': centerloss.parameters(), 'lr': args.lr, 'weight_decay': 1e-4}
    ]
    optimizer = optimizer_class(param_groups) # 
    # warmup_scheduler = LinearLR(optimizer, start_factor=1.0 / 20, end_factor=1.0, total_iters=args.warmup_step) 
    if 'srsdd' in args.data_root: 
        scheduler = MultiStepLR(optimizer, milestones=[10, 50, 80, 90], gamma=0.5)
    else:
        scheduler = CosineAnnealingWarmRestarts(optimizer, T_0=20, T_mult=2, eta_min = 1e-5)
    # scheduler = MultiStepLR(optimizer, milestones=[40, 70, 90], gamma=0.5)
    # scheduler = ChainedScheduler([warmup_scheduler, step_scheduler])

    start_epoch = 0
    best_AP = 0.0
    if os.path.isfile(args.checkpoint):
        checkpoint = torch.load(args.checkpoint)
        model.load_state_dict(checkpoint['model_state_dict'])
        centerloss.load_state_dict(checkpoint['centerloss_state_dict'])
        optimizer.load_state_dict(checkpoint['optimizer_state_dict']),
        scheduler.load_state_dict(checkpoint['scheduler_state_dict'])
        start_epoch = checkpoint['epoch']+1
        best_AP = checkpoint['best_AP']
        args.logger.info(f'Continue training from epoch [{start_epoch}] !')

    # getGPUs = importlib.import_module('GPUtil').getGPUs
    # virtual_memory = importlib.import_module('psutil').virtual_memory
    # collect = importlib.import_module('gc').collect
    for epoch in range(start_epoch, args.num_epochs):
        start_time = time.time()
        model.train()
        for i, (data, img_paths)  in enumerate(train_loader):
            torch.cuda.empty_cache() # 在显存资源有限的情况下使用
            data = data.to(args.device)
            # collect() # 显式垃圾回收
            # memory = virtual_memory()
            # args.logger.info(f"总内存: {memory.total / (1024 ** 3):.2f} GB, 可用内存: {memory.available / (1024 ** 3):.2f} GB, 内存使用率: {memory.percent}%")
            # gpu = getGPUs()[0]
            # args.logger.info(f">>>before: GPU: {gpu.name}, 显存总量: {gpu.memoryTotal}MB, 显存使用: {gpu.memoryUsed}MB, 显存空闲: {gpu.memoryFree}MB")
            feat, outputs = model(data[:,:,:-2])
            # args.logger.info(f">>>after: GPU: {gpu.name}, 显存总量: {gpu.memoryTotal}MB, 显存使用: {gpu.memoryUsed}MB, 显存空闲: {gpu.memoryFree}MB")
            valid = data[:,:,-1].reshape(-1).bool()
            label_inc = data[:,:,-2].long().view(-1)[valid]
            feat = feat.view(-1,model.config['output_dim'])[valid,:]
            outputs = outputs.view(-1,len(args.dataset_class)+1)[valid,:]
            
            # label = nn.functional.one_hot(label_inc, num_classes= len(args.dataset_class) + 1).float()
            
            # if len(args.dataset_class) > 1: # soft_label
            #     softening_value = 0.1
            #     non_background_mask = (label_inc != 0).unsqueeze(dim=-1).repeat(1,len(args.dataset_class)+1)
            #     non_background_mask[...,0] = False
            #     label[non_background_mask] = label[non_background_mask]  * (1 - softening_value) + \
            #                                     (1 - label[non_background_mask]) * softening_value / (len(args.dataset_class)-1)  
                                                          
            # loss_cls = torch.mean(- 0.75*label * ((1-outputs)**2) *torch.log(outputs) - 0.25*((1-label) *(outputs**2)* torch.log(1-outputs)), dim = 0)
            # inter_cls_loss = torch.sum(loss_cls*weight)
            inter_cls_loss = nllloss(torch.log(outputs), label_inc)
            inner_cls_loss = centerloss(feat, label_inc)
            loss = loss_weight * inter_cls_loss + inner_cls_loss
            
            optimizer.zero_grad()
            loss.backward()
            clip_grad_norm_(model.parameters(), 35, 2)
            clip_grad_norm_(centerloss.parameters(), 35, 2)
            optimizer.step()
            del outputs, data, valid
            if (i + 1) % args.print_interval == 0:
                current_time = time.time()
                eta_seconds = (current_time - start_time) / (i+1) * ( (args.num_epochs - epoch ) * len(train_loader) - (i + 1))
                eta_str = str(int(eta_seconds // 3600)) + ':' + str(int((eta_seconds % 3600) // 60)) + ':' + str(int(eta_seconds % 60))
                # loss_str = ' '.join([f"{cls_name}:{loss_value:.4f}" for cls_name,loss_value in zip(['background'] + list(args.dataset_class.keys()), loss_cls)])
                args.logger.info(f"Epoch(train)"
                      f"[{epoch + 1}/{args.num_epochs}][{i + 1}/{len(train_loader)}]"
                      f"lr: {optimizer.param_groups[0]['lr']:.4e}  eta: {eta_str}  " 
                      f"time: {current_time - start_time:.4f}  inter_cls_loss: {inter_cls_loss:.4f} inner_cls_loss: {inner_cls_loss.item():.4f}")
        scheduler.step()
        if ((epoch+1) % args.eval_interval == 0) or (epoch == 0) or (epoch == args.num_epochs-1): #            
            for idx, ann_file in enumerate(args.test_ann_file): 
                args.logger.info(f"Epoch(test) {ann_file}:")
                metric_dict_all, PR_dict_all = evaluate(model, eva_loader[ann_file], args)
                if len(args.test_ann_file) >1:
                    plt.plot(PR_dict_all['Recall'], PR_dict_all['Precision'], label=ann_file, color=args.color[idx % len(args.color)])
            if len(args.test_ann_file) >1:
                plt.xlabel('Recall')
                plt.ylabel('Precision')
                plt.title('Precision-Recall Curve')
                plt.legend()
                PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_train.png'
                plt.savefig(PR_curve_path, bbox_inches='tight', dpi=300)
                plt.close('all') 
                args.logger.info(f"PR_curve has been saved to {PR_curve_path}:")      
                               
            # 检查是否有更好的模型，如果有，则保存权重
            if metric_dict_all['Average_Precision'] > best_AP:
                best_AP = metric_dict_all['Average_Precision']
                # 保存当前模型的权重
                torch.save(model.state_dict(), args.save_path)
                args.logger.info(f"Best model saved to  {args.save_path} with MD5 {calculate_md5(args.save_path)}, with {args.test_ann_file[-1]} image AP {best_AP:.4f}")
            if (epoch >= args.num_epochs-1):
                last_save_path = 'work_dirs/' + args.data_root.rstrip('/').split('/')[-1] + '_' + args.descriptor + f'_{args.train_ratio*100:.0f}' + '_last_model_weight.pth'
                torch.save(model.state_dict(), last_save_path)
                args.logger.info(f"Last model saved :{last_save_path}")

        if ((epoch+1) % args.save_interval == 0):
            for file_path in glob.glob(args.save_path[:-4] + '*_epoch.pth'):
                os.remove(file_path)
            torch.save({
                'model_state_dict': model.state_dict(),
                'centerloss_state_dict': centerloss.state_dict(),
                'optimizer_state_dict': optimizer.state_dict(),
                'scheduler_state_dict': scheduler.state_dict(),
                'epoch': epoch,
                'best_AP': best_AP,
                }, args.save_path[:-4] + f'_{epoch+1}_epoch.pth')

if __name__ == '__main__':
    args = parse_arguments()

    random.seed(args.random_seed)
    np.random.seed(args.random_seed)
    torch.manual_seed(args.random_seed)
    if torch.cuda.is_available():
        torch.cuda.manual_seed_all(args.random_seed)

    if ('alike' in args.descriptor.lower()) or ('superpoint' in args.descriptor.lower()) or ('hardnet' in args.descriptor.lower()) or ('sosnet' in args.descriptor.lower()):
        args.multiprocessing_context = 'spawn'

    args.feature_booster_pretrained = '' # Path(__file__).parent / str("FeatureBooster/models/" + args.descriptor + ".pth")
    pretrained_str = 'finetune' if os.path.isfile(args.feature_booster_pretrained) else 'scratch'
    args.save_path = args.save_path if len(args.save_path) else 'work_dirs/' + args.data_root.rstrip('/').split('/')[-1] + '_' + args.descriptor + f'_{args.train_ratio*100:.0f}' + f"_bs{args.batch_size}" + f'_best_model_weights_{pretrained_str}.pth'
    args.device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    args.color = ['#00FF00', '#FF00FF', '#FF4500', '#0000FF', '#00FFFF','#FF1493', '#808000'] 
    model = ShipKeyPointsModel(args)
    
    # 创建日志器
    logger = logging.getLogger()
    logger.setLevel(logging.INFO)
    # 创建控制台处理程序
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.INFO)
    console_handler.setFormatter(logging.Formatter('%(asctime)s - %(levelname)s - %(message)s'))    
    logger.addHandler(console_handler)
    args.logger = logger
    if (not args.eval) and (not ( os.path.isfile(args.test_image) or (len(args.test_images)>0) )): # train
        args.log_file = args.log_file if len(args.log_file) else 'work_dirs/' + args.data_root.rstrip('/').split('/')[-1] + '_' + args.descriptor + f'_{args.train_ratio*100:.0f}' + f"_bs{args.batch_size}" + f'_dataset_repeat_{args.dataset_repeat}_positive_keypoint_repeat_{args.positive_keypoint_repeat}_{pretrained_str}.log'
        if not os.path.exists(os.path.dirname(args.log_file)):
            os.makedirs(os.path.dirname(args.log_file))
        # 创建文件处理程序
        file_handler = logging.FileHandler(args.log_file, mode='a')
        file_handler.setLevel(logging.INFO)
        file_handler.setFormatter(logging.Formatter('%(asctime)s - %(levelname)s - %(message)s'))
        # 添加处理程序到日志器
        logger.addHandler(file_handler)
        logger.info(">>>>>=========================Start Train!===========================<<<<<")
        for k, v in vars(args).items():
            if k not in 'logger':
                logger.info(f"{k}: {v}")

        if args.print: 
            with open(__file__, 'r') as file:
                lines = file.readlines()
            with open(args.log_file, "a") as file:   
                for line in lines:
                    file.write(line[:-1]+'\n')
                file.write('\n')
        train(model, args)
        args.logger.info(f"model weights saved to {args.save_path} with MD5 {calculate_md5(args.save_path)}!")
        args.checkpoint = args.save_path
        args.eval = True

    model_weights_md5 = "init_md5"
    if os.path.isfile(args.checkpoint):
        if 'cpu' in args.device.type:
            model.load_state_dict(torch.load(args.checkpoint, map_location=lambda storage, loc:storage), strict=False)
        else:
            model.load_state_dict(torch.load(args.checkpoint), strict=False)
        model_weights_md5 = calculate_md5(args.checkpoint)
        args.logger.info(f"model weights loaded from {args.checkpoint} with MD5 {model_weights_md5}!")
        model_weights_md5 = model_weights_md5[:5]
    
    for img in args.test_images:
        if os.path.isfile(img):
            args.logger.info(f"Epoch(test) - {img}:")
            metric_dict, PR_dict = test(model,img, args)
    for idx in range(len(args.test_images)):
        keypoint_match(model, args, args.test_images[idx%len(args.test_images)], args.test_images[(idx+1)%len(args.test_images)])
    if os.path.isfile(args.test_image):
        args.logger.info(f"Epoch(test) - {args.test_image}:")
        metric_dict, PR_dict = test(model, args.test_image, args)
    if args.eval:
        for idx, ann_file in enumerate(args.test_ann_file):
            args.logger.info(f"Epoch(test) {ann_file}:")
            eva_dataset = ShipKeyPointsDataset(args = args, ann_file = ann_file)
            eva_loader = DataLoader(eva_dataset, batch_size=args.batch_size, shuffle=False, 
                                    num_workers=args.num_workers, collate_fn=custom_collate_fn, 
                                    pin_memory=True, persistent_workers = True, multiprocessing_context=args.multiprocessing_context)
            metric_dict, PR_dict_all = evaluate(model, eva_loader, args)
            if len(args.test_ann_file) >1:
                plt.plot(PR_dict_all['Recall'], PR_dict_all['Precision'], label=ann_file, color=args.color[idx % len(args.color)])
        if len(args.test_ann_file) >1:
            plt.xlabel('Recall')
            plt.ylabel('Precision')
            plt.title('Precision-Recall Curve')
            plt.legend()
            PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_eval_{model_weights_md5}.png'
            plt.savefig(PR_curve_path, bbox_inches='tight', dpi=300)
            plt.close('all') 
            args.logger.info(f"PR_curve has been saved to {PR_curve_path}!"

2023-12-06 18:28:11,624 - INFO - flops: 43683904
2023-12-06 18:28:11,624 - INFO - flops_str: 43.684M
2023-12-06 18:28:11,624 - INFO - activations: 159852
2023-12-06 18:28:11,624 - INFO - activations_str: 0.16M
2023-12-06 18:28:11,624 - INFO - params: 1987522
2023-12-06 18:28:11,624 - INFO - params_str: 1.988M
2023-12-06 18:28:11,624 - INFO - out_table: 
+---------------------------+----------------------+------------+--------------+
| module                    | #parameters or shape | #flops     | #activations |
+---------------------------+----------------------+------------+--------------+
| model                     | 1.988M               | 43.684M    | 0.16M        |
|  feature_booster          |  1.954M              |  42.957M   |  0.157M      |
|   feature_booster.kenc.e… |   0.109M             |   2.39M    |   16.192K    |
|    feature_booster.kenc.… |    0.128K            |    2.112K  |    0.704K    |
|    feature_booster.kenc.… |    2.112K            |    45.056K |    1.408K    |
|    feature_booster.kenc.… |    8.32K             |    0.18M   |    2.816K    |
|    feature_booster.kenc.… |    33.024K           |    0.721M  |    5.632K    |
|    feature_booster.kenc.… |    65.792K           |    1.442M  |    5.632K    |
|   feature_booster.denc.e… |   0.197M             |   4.325M   |   16.896K    |
|    feature_booster.denc.… |    65.792K           |    1.442M  |    5.632K    |
|    feature_booster.denc.… |    65.792K           |    1.442M  |    5.632K    |
|    feature_booster.denc.… |    65.792K           |    1.442M  |    5.632K    |
|   feature_booster.attn_p… |   1.581M             |   34.772M  |   0.118M     |
|    feature_booster.attn_… |    0.527M            |    11.591M |    39.424K   |
|    feature_booster.attn_… |    0.527M            |    11.591M |    39.424K   |
|    feature_booster.attn_… |    0.527M            |    11.591M |    39.424K   |
|   feature_booster.final_… |   65.792K            |   1.442M   |   5.632K     |
|    feature_booster.final… |    (256, 256)        |            |              |
|    feature_booster.final… |    (256,)            |            |              |
|   feature_booster.layer_… |   0.512K             |   28.16K   |   0          |
|    feature_booster.layer… |    (256,)            |            |              |
|    feature_booster.layer… |    (256,)            |            |              |
|  fc_out                   |  33.154K             |  0.727M    |  2.86K       |
|   fc_out.0                |   32.896K            |   0.721M   |   2.816K     |
|    fc_out.0.weight        |    (128, 256)        |            |              |
|    fc_out.0.bias          |    (128,)            |            |              |
|   fc_out.2                |   0.258K             |   5.632K   |   44         |
|    fc_out.2.weight        |    (2, 128)          |            |              |
|    fc_out.2.bias          |    (2,)              |            |              |
+---------------------------+----------------------+------------+--------------+

2023-12-06 18:28:11,624 - INFO - out_arch: 
2023-12-06 18:29:03,455 - INFO - Epoch(train)[1/100][20/58]lr: 1.0000e-03  eta: 4:9:36  time: 51.8214  inter_cls_loss: 0.5998 inner_cls_loss: 55.5478
2023-12-06 18:29:39,457 - INFO - Epoch(train)[1/100][40/58]lr: 1.0000e-03  eta: 3:30:46  time: 87.8258  inter_cls_loss: 0.6348 inner_cls_loss: 57.8812
2023-12-06 18:30:11,891 - INFO - Epoch(test) test/all/:
2023-12-06 18:30:59,505 - INFO - Epoch(test) : [20/31]
2023-12-06 18:31:19,130 - INFO - Metrics for ship: Accuracy: 0.8335, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.3667
2023-12-06 18:31:19,169 - INFO - Epoch(test) test/offshore/:
2023-12-06 18:32:03,076 - INFO - Epoch(test) : [20/26]
2023-12-06 18:32:15,099 - INFO - Metrics for ship: Accuracy: 0.6520, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.5330
2023-12-06 18:32:15,107 - INFO - Epoch(test) test/inshore/:
2023-12-06 18:32:33,335 - INFO - Metrics for ship: Accuracy: 0.8911, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.1974
2023-12-06 18:32:34,149 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 18:32:34,206 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 59dda062bcf3f9c116393ddea130d457, with test/inshore/ image AP 0.1974
2023-12-06 18:33:24,732 - INFO - Epoch(train)[2/100][20/58]lr: 9.9391e-04  eta: 4:0:55  time: 50.5246  inter_cls_loss: 0.4646 inner_cls_loss: 39.8886
2023-12-06 18:33:57,718 - INFO - Epoch(train)[2/100][40/58]lr: 9.9391e-04  eta: 3:18:23  time: 83.5060  inter_cls_loss: 0.5225 inner_cls_loss: 43.7563
2023-12-06 18:34:27,646 - INFO - Epoch(test) test/all/:
2023-12-06 18:35:13,340 - INFO - Epoch(test) : [20/31]
2023-12-06 18:35:30,736 - INFO - Metrics for ship: Accuracy: 0.8335, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.4342
2023-12-06 18:35:30,771 - INFO - Epoch(test) test/offshore/:
2023-12-06 18:36:14,422 - INFO - Epoch(test) : [20/26]
2023-12-06 18:36:24,774 - INFO - Metrics for ship: Accuracy: 0.6520, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.5660
2023-12-06 18:36:24,779 - INFO - Epoch(test) test/inshore/:
2023-12-06 18:36:41,552 - INFO - Metrics for ship: Accuracy: 0.8911, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.2096
2023-12-06 18:36:42,255 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 18:36:42,314 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 e3280b9617811a69588130f23fcf0d79, with test/inshore/ image AP 0.2096
2023-12-06 18:37:33,771 - INFO - Epoch(train)[3/100][20/58]lr: 9.7577e-04  eta: 4:2:51  time: 51.4543  inter_cls_loss: 0.2461 inner_cls_loss: 26.8769
2023-12-06 18:38:06,075 - INFO - Epoch(train)[3/100][40/58]lr: 9.7577e-04  eta: 3:16:58  time: 83.7599  inter_cls_loss: 0.2155 inner_cls_loss: 23.1094
2023-12-06 18:38:34,317 - INFO - Epoch(test) test/all/:
2023-12-06 18:39:17,237 - INFO - Epoch(test) : [20/31]
2023-12-06 18:39:34,635 - INFO - Metrics for ship: Accuracy: 0.9005, Precision: 0.6977, Recall: 0.7102, F1_score: 0.7039, Average_Precision: 0.7746
2023-12-06 18:39:34,683 - INFO - Epoch(test) test/offshore/:
2023-12-06 18:40:16,578 - INFO - Epoch(test) : [20/26]
2023-12-06 18:40:26,756 - INFO - Metrics for ship: Accuracy: 0.9247, Precision: 0.8974, Recall: 0.8847, F1_score: 0.8910, Average_Precision: 0.9178
2023-12-06 18:40:26,762 - INFO - Epoch(test) test/inshore/:
2023-12-06 18:40:43,152 - INFO - Metrics for ship: Accuracy: 0.8278, Precision: 0.3533, Recall: 0.7010, F1_score: 0.4698, Average_Precision: 0.4065
2023-12-06 18:40:45,045 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 18:40:45,105 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 34467ea187c4cf8099d41234a657a60f, with test/inshore/ image AP 0.4065
2023-12-06 18:41:36,292 - INFO - Epoch(train)[4/100][20/58]lr: 9.4605e-04  eta: 3:59:7  time: 51.1850  inter_cls_loss: 0.1908 inner_cls_loss: 21.1256
2023-12-06 18:42:07,669 - INFO - Epoch(train)[4/100][40/58]lr: 9.4605e-04  eta: 3:12:9  time: 82.5634  inter_cls_loss: 0.2795 inner_cls_loss: 24.2125
2023-12-06 18:42:37,146 - INFO - Epoch(test) test/all/:
2023-12-06 18:43:21,115 - INFO - Epoch(test) : [20/31]
2023-12-06 18:43:37,923 - INFO - Metrics for ship: Accuracy: 0.9054, Precision: 0.9334, Recall: 0.4647, F1_score: 0.6205, Average_Precision: 0.8266
2023-12-06 18:43:37,953 - INFO - Epoch(test) test/offshore/:
2023-12-06 18:44:21,665 - INFO - Epoch(test) : [20/26]
2023-12-06 18:44:31,264 - INFO - Metrics for ship: Accuracy: 0.8768, Precision: 0.9511, Recall: 0.6810, F1_score: 0.7937, Average_Precision: 0.9521
2023-12-06 18:44:31,269 - INFO - Epoch(test) test/inshore/:
2023-12-06 18:44:47,833 - INFO - Metrics for ship: Accuracy: 0.8997, Precision: 0.5761, Recall: 0.2981, F1_score: 0.3929, Average_Precision: 0.5009
2023-12-06 18:44:48,945 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 18:44:49,010 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 a4ad013b6251fcf3806eb88cd38af315, with test/inshore/ image AP 0.5009
2023-12-06 18:45:40,165 - INFO - Epoch(train)[5/100][20/58]lr: 9.0546e-04  eta: 3:56:30  time: 51.1541  inter_cls_loss: 0.1502 inner_cls_loss: 18.2381
2023-12-06 18:46:13,008 - INFO - Epoch(train)[5/100][40/58]lr: 9.0546e-04  eta: 3:13:28  time: 83.9964  inter_cls_loss: 0.2149 inner_cls_loss: 20.8907
2023-12-06 18:46:42,628 - INFO - Epoch(test) test/all/:
2023-12-06 18:47:26,356 - INFO - Epoch(test) : [20/31]
2023-12-06 18:47:44,035 - INFO - Metrics for ship: Accuracy: 0.9156, Precision: 0.7062, Recall: 0.8438, F1_score: 0.7689, Average_Precision: 0.8574
2023-12-06 18:47:44,078 - INFO - Epoch(test) test/offshore/:
2023-12-06 18:48:26,549 - INFO - Epoch(test) : [20/26]
2023-12-06 18:48:37,234 - INFO - Metrics for ship: Accuracy: 0.9516, Precision: 0.9006, Recall: 0.9677, F1_score: 0.9329, Average_Precision: 0.9690
2023-12-06 18:48:37,240 - INFO - Epoch(test) test/inshore/:
2023-12-06 18:48:53,797 - INFO - Metrics for ship: Accuracy: 0.8553, Precision: 0.4175, Recall: 0.8321, F1_score: 0.5560, Average_Precision: 0.5652
2023-12-06 18:48:54,839 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 18:48:54,898 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 0122a95e2dd84f9b9b30388c2c66bc4a, with test/inshore/ image AP 0.5652
2023-12-06 18:49:45,079 - INFO - Epoch(train)[6/100][20/58]lr: 8.5502e-04  eta: 3:49:33  time: 50.1773  inter_cls_loss: 0.2446 inner_cls_loss: 21.0029
2023-12-06 18:50:18,899 - INFO - Epoch(train)[6/100][40/58]lr: 8.5502e-04  eta: 3:11:27  time: 84.0014  inter_cls_loss: 0.1604 inner_cls_loss: 17.5037
2023-12-06 18:50:47,643 - INFO - Epoch(test) test/all/:
2023-12-06 18:51:32,293 - INFO - Epoch(test) : [20/31]
2023-12-06 18:51:49,812 - INFO - Metrics for ship: Accuracy: 0.9288, Precision: 0.7664, Recall: 0.8231, F1_score: 0.7937, Average_Precision: 0.8738
2023-12-06 18:51:49,841 - INFO - Epoch(test) test/offshore/:
2023-12-06 18:52:33,045 - INFO - Epoch(test) : [20/26]
2023-12-06 18:52:44,656 - INFO - Metrics for ship: Accuracy: 0.9578, Precision: 0.9330, Recall: 0.9467, F1_score: 0.9398, Average_Precision: 0.9725
2023-12-06 18:52:44,660 - INFO - Epoch(test) test/inshore/:
2023-12-06 18:53:01,118 - INFO - Metrics for ship: Accuracy: 0.8963, Precision: 0.5153, Recall: 0.7888, F1_score: 0.6234, Average_Precision: 0.6021
2023-12-06 18:53:02,308 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 18:53:02,366 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 a6eafedeb6d7684b8265a89f79caf97f, with test/inshore/ image AP 0.6021
2023-12-06 18:53:52,799 - INFO - Epoch(train)[7/100][20/58]lr: 7.9595e-04  eta: 3:48:17  time: 50.4322  inter_cls_loss: 0.1610 inner_cls_loss: 16.7697
2023-12-06 18:54:25,952 - INFO - Epoch(train)[7/100][40/58]lr: 7.9595e-04  eta: 3:8:28  time: 83.5816  inter_cls_loss: 0.2190 inner_cls_loss: 18.9154
2023-12-06 18:54:54,842 - INFO - Epoch(test) test/all/:
2023-12-06 18:55:39,385 - INFO - Epoch(test) : [20/31]
2023-12-06 18:55:56,766 - INFO - Metrics for ship: Accuracy: 0.9237, Precision: 0.7421, Recall: 0.8307, F1_score: 0.7839, Average_Precision: 0.8715
2023-12-06 18:55:56,798 - INFO - Epoch(test) test/offshore/:
2023-12-06 18:56:39,034 - INFO - Epoch(test) : [20/26]
2023-12-06 18:56:49,696 - INFO - Metrics for ship: Accuracy: 0.9494, Precision: 0.9234, Recall: 0.9319, F1_score: 0.9276, Average_Precision: 0.9757
2023-12-06 18:56:49,700 - INFO - Epoch(test) test/inshore/:
2023-12-06 18:57:06,329 - INFO - Metrics for ship: Accuracy: 0.8892, Precision: 0.4944, Recall: 0.7853, F1_score: 0.6068, Average_Precision: 0.6093
2023-12-06 18:57:07,402 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 18:57:07,458 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 0ee191178c1c5594e9579c69342c64be, with test/inshore/ image AP 0.6093
2023-12-06 18:57:57,994 - INFO - Epoch(train)[8/100][20/58]lr: 7.2973e-04  eta: 3:46:17  time: 50.5293  inter_cls_loss: 0.1500 inner_cls_loss: 15.3515
2023-12-06 18:58:31,421 - INFO - Epoch(train)[8/100][40/58]lr: 7.2973e-04  eta: 3:7:17  time: 83.9572  inter_cls_loss: 0.2117 inner_cls_loss: 18.1417
2023-12-06 18:58:59,122 - INFO - Epoch(test) test/all/:
2023-12-06 18:59:43,061 - INFO - Epoch(test) : [20/31]
2023-12-06 19:00:00,263 - INFO - Metrics for ship: Accuracy: 0.9302, Precision: 0.7694, Recall: 0.8291, F1_score: 0.7981, Average_Precision: 0.8826
2023-12-06 19:00:00,297 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:00:43,494 - INFO - Epoch(test) : [20/26]
2023-12-06 19:00:53,326 - INFO - Metrics for ship: Accuracy: 0.9586, Precision: 0.9265, Recall: 0.9568, F1_score: 0.9414, Average_Precision: 0.9741
2023-12-06 19:00:53,330 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:01:09,902 - INFO - Metrics for ship: Accuracy: 0.8979, Precision: 0.5200, Recall: 0.8071, F1_score: 0.6325, Average_Precision: 0.6279
2023-12-06 19:01:10,986 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:01:11,043 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 ef00d1d03401cbba188b5061f4bd5058, with test/inshore/ image AP 0.6279
2023-12-06 19:02:00,389 - INFO - Epoch(train)[9/100][20/58]lr: 6.5796e-04  eta: 3:38:34  time: 49.3409  inter_cls_loss: 0.1398 inner_cls_loss: 14.3807
2023-12-06 19:02:33,932 - INFO - Epoch(train)[9/100][40/58]lr: 6.5796e-04  eta: 3:2:53  time: 82.8835  inter_cls_loss: 0.1609 inner_cls_loss: 15.0711
2023-12-06 19:03:03,002 - INFO - Epoch(test) test/all/:
2023-12-06 19:03:46,394 - INFO - Epoch(test) : [20/31]
2023-12-06 19:04:03,231 - INFO - Metrics for ship: Accuracy: 0.9340, Precision: 0.7991, Recall: 0.8060, F1_score: 0.8026, Average_Precision: 0.8868
2023-12-06 19:04:03,260 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:04:46,572 - INFO - Epoch(test) : [20/26]
2023-12-06 19:04:57,362 - INFO - Metrics for ship: Accuracy: 0.9355, Precision: 0.8936, Recall: 0.9250, F1_score: 0.9090, Average_Precision: 0.9146
2023-12-06 19:04:57,366 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:05:14,367 - INFO - Metrics for ship: Accuracy: 0.9111, Precision: 0.5676, Recall: 0.7708, F1_score: 0.6538, Average_Precision: 0.6662
2023-12-06 19:05:15,443 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:05:15,500 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 c00d739c3f7fa64f4d1410f5af79e55a, with test/inshore/ image AP 0.6662
2023-12-06 19:06:06,256 - INFO - Epoch(train)[10/100][20/58]lr: 5.8244e-04  eta: 3:42:22  time: 50.7517  inter_cls_loss: 0.1373 inner_cls_loss: 13.7254
2023-12-06 19:06:38,996 - INFO - Epoch(train)[10/100][40/58]lr: 5.8244e-04  eta: 3:2:13  time: 83.4920  inter_cls_loss: 0.1532 inner_cls_loss: 13.9931
2023-12-06 19:07:07,861 - INFO - Epoch(test) test/all/:
2023-12-06 19:07:52,622 - INFO - Epoch(test) : [20/31]
2023-12-06 19:08:09,734 - INFO - Metrics for ship: Accuracy: 0.9342, Precision: 0.7719, Recall: 0.8588, F1_score: 0.8130, Average_Precision: 0.8945
2023-12-06 19:08:09,792 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:08:53,116 - INFO - Epoch(test) : [20/26]
2023-12-06 19:09:03,635 - INFO - Metrics for ship: Accuracy: 0.9343, Precision: 0.8677, Recall: 0.9570, F1_score: 0.9102, Average_Precision: 0.8544
2023-12-06 19:09:03,642 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:09:20,456 - INFO - Metrics for ship: Accuracy: 0.8995, Precision: 0.5241, Recall: 0.8343, F1_score: 0.6438, Average_Precision: 0.6564
2023-12-06 19:09:21,548 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:10:12,964 - INFO - Epoch(train)[11/100][20/58]lr: 5.0500e-04  eta: 3:42:30  time: 51.3486  inter_cls_loss: 0.1394 inner_cls_loss: 13.3121
2023-12-06 19:10:46,129 - INFO - Epoch(train)[11/100][40/58]lr: 5.0500e-04  eta: 3:2:24  time: 84.5161  inter_cls_loss: 0.1498 inner_cls_loss: 13.4618
2023-12-06 19:11:15,492 - INFO - Epoch(test) test/all/:
2023-12-06 19:12:00,328 - INFO - Epoch(test) : [20/31]
2023-12-06 19:12:17,740 - INFO - Metrics for ship: Accuracy: 0.9383, Precision: 0.8251, Recall: 0.7986, F1_score: 0.8116, Average_Precision: 0.8993
2023-12-06 19:12:17,776 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:13:01,517 - INFO - Epoch(test) : [20/26]
2023-12-06 19:13:12,428 - INFO - Metrics for ship: Accuracy: 0.9582, Precision: 0.9469, Recall: 0.9322, F1_score: 0.9395, Average_Precision: 0.9827
2023-12-06 19:13:12,431 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:13:28,930 - INFO - Metrics for ship: Accuracy: 0.9156, Precision: 0.5867, Recall: 0.7607, F1_score: 0.6625, Average_Precision: 0.6857
2023-12-06 19:13:29,979 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:13:30,036 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 f3f3e6430e0f024f26715226631e19c1, with test/inshore/ image AP 0.6857
2023-12-06 19:14:19,645 - INFO - Epoch(train)[12/100][20/58]lr: 4.2756e-04  eta: 3:32:32  time: 49.6031  inter_cls_loss: 0.1197 inner_cls_loss: 12.1225
2023-12-06 19:14:53,940 - INFO - Epoch(train)[12/100][40/58]lr: 4.2756e-04  eta: 2:59:3  time: 83.9033  inter_cls_loss: 0.1772 inner_cls_loss: 14.1450
2023-12-06 19:15:24,252 - INFO - Epoch(test) test/all/:
2023-12-06 19:16:08,024 - INFO - Epoch(test) : [20/31]
2023-12-06 19:16:25,587 - INFO - Metrics for ship: Accuracy: 0.9364, Precision: 0.8682, Recall: 0.7289, F1_score: 0.7925, Average_Precision: 0.9036
2023-12-06 19:16:25,617 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:17:08,090 - INFO - Epoch(test) : [20/26]
2023-12-06 19:17:18,229 - INFO - Metrics for ship: Accuracy: 0.9599, Precision: 0.9474, Recall: 0.9367, F1_score: 0.9420, Average_Precision: 0.9809
2023-12-06 19:17:18,232 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:17:34,576 - INFO - Metrics for ship: Accuracy: 0.9209, Precision: 0.6164, Recall: 0.7230, F1_score: 0.6654, Average_Precision: 0.6736
2023-12-06 19:17:35,630 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:18:24,950 - INFO - Epoch(train)[13/100][20/58]lr: 3.5204e-04  eta: 3:28:56  time: 49.3182  inter_cls_loss: 0.0959 inner_cls_loss: 11.1330
2023-12-06 19:18:58,700 - INFO - Epoch(train)[13/100][40/58]lr: 3.5204e-04  eta: 2:55:16  time: 83.0680  inter_cls_loss: 0.1037 inner_cls_loss: 11.2841
2023-12-06 19:19:27,739 - INFO - Epoch(test) test/all/:
2023-12-06 19:20:11,307 - INFO - Epoch(test) : [20/31]
2023-12-06 19:20:28,671 - INFO - Metrics for ship: Accuracy: 0.9379, Precision: 0.7816, Recall: 0.8700, F1_score: 0.8235, Average_Precision: 0.9058
2023-12-06 19:20:28,701 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:21:11,889 - INFO - Epoch(test) : [20/26]
2023-12-06 19:21:22,805 - INFO - Metrics for ship: Accuracy: 0.9617, Precision: 0.9320, Recall: 0.9600, F1_score: 0.9458, Average_Precision: 0.9826
2023-12-06 19:21:22,809 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:21:39,702 - INFO - Metrics for ship: Accuracy: 0.9018, Precision: 0.5306, Recall: 0.8469, F1_score: 0.6525, Average_Precision: 0.6903
2023-12-06 19:21:40,784 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:21:40,842 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 44bab99bda34f23bace8300cbf9f6dcd, with test/inshore/ image AP 0.6903
2023-12-06 19:22:31,450 - INFO - Epoch(train)[14/100][20/58]lr: 2.8027e-04  eta: 3:31:57  time: 50.6079  inter_cls_loss: 0.1041 inner_cls_loss: 11.1252
2023-12-06 19:23:05,193 - INFO - Epoch(train)[14/100][40/58]lr: 2.8027e-04  eta: 2:55:56  time: 84.3470  inter_cls_loss: 0.1252 inner_cls_loss: 11.5656
2023-12-06 19:23:33,483 - INFO - Epoch(test) test/all/:
2023-12-06 19:24:18,485 - INFO - Epoch(test) : [20/31]
2023-12-06 19:24:35,829 - INFO - Metrics for ship: Accuracy: 0.9414, Precision: 0.8483, Recall: 0.7891, F1_score: 0.8176, Average_Precision: 0.9093
2023-12-06 19:24:35,861 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:25:19,526 - INFO - Epoch(test) : [20/26]
2023-12-06 19:25:30,773 - INFO - Metrics for ship: Accuracy: 0.9614, Precision: 0.9462, Recall: 0.9429, F1_score: 0.9445, Average_Precision: 0.9836
2023-12-06 19:25:30,778 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:25:47,691 - INFO - Metrics for ship: Accuracy: 0.9204, Precision: 0.6064, Recall: 0.7646, F1_score: 0.6764, Average_Precision: 0.6963
2023-12-06 19:25:48,755 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:25:48,812 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 4154c0f8f4787efa8ad771ff9f75a068, with test/inshore/ image AP 0.6963
2023-12-06 19:26:38,884 - INFO - Epoch(train)[15/100][20/58]lr: 2.1405e-04  eta: 3:27:17  time: 50.0714  inter_cls_loss: 0.1229 inner_cls_loss: 11.7110
2023-12-06 19:27:10,532 - INFO - Epoch(train)[15/100][40/58]lr: 2.1405e-04  eta: 2:48:28  time: 81.7178  inter_cls_loss: 0.2061 inner_cls_loss: 14.6420
2023-12-06 19:27:39,916 - INFO - Epoch(test) test/all/:
2023-12-06 19:28:23,810 - INFO - Epoch(test) : [20/31]
2023-12-06 19:28:40,589 - INFO - Metrics for ship: Accuracy: 0.9410, Precision: 0.8593, Recall: 0.7721, F1_score: 0.8134, Average_Precision: 0.9105
2023-12-06 19:28:40,621 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:29:24,365 - INFO - Epoch(test) : [20/26]
2023-12-06 19:29:34,584 - INFO - Metrics for ship: Accuracy: 0.9604, Precision: 0.9457, Recall: 0.9402, F1_score: 0.9430, Average_Precision: 0.9829
2023-12-06 19:29:34,587 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:29:51,277 - INFO - Metrics for ship: Accuracy: 0.9198, Precision: 0.6045, Recall: 0.7604, F1_score: 0.6735, Average_Precision: 0.6851
2023-12-06 19:29:52,371 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:30:41,591 - INFO - Epoch(train)[16/100][20/58]lr: 1.5498e-04  eta: 3:21:22  time: 49.2174  inter_cls_loss: 0.1026 inner_cls_loss: 10.7804
2023-12-06 19:31:16,608 - INFO - Epoch(train)[16/100][40/58]lr: 1.5498e-04  eta: 2:51:37  time: 84.2358  inter_cls_loss: 0.2396 inner_cls_loss: 15.4704
2023-12-06 19:31:45,792 - INFO - Epoch(test) test/all/:
2023-12-06 19:32:30,396 - INFO - Epoch(test) : [20/31]
2023-12-06 19:32:48,623 - INFO - Metrics for ship: Accuracy: 0.9427, Precision: 0.8435, Recall: 0.8051, F1_score: 0.8239, Average_Precision: 0.9123
2023-12-06 19:32:48,654 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:33:31,744 - INFO - Epoch(test) : [20/26]
2023-12-06 19:33:42,201 - INFO - Metrics for ship: Accuracy: 0.9616, Precision: 0.9416, Recall: 0.9486, F1_score: 0.9451, Average_Precision: 0.9837
2023-12-06 19:33:42,204 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:33:58,801 - INFO - Metrics for ship: Accuracy: 0.9189, Precision: 0.5972, Recall: 0.7827, F1_score: 0.6775, Average_Precision: 0.7008
2023-12-06 19:33:59,865 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:33:59,922 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 7d1767d1ccebf4885a477e0b5e5e5095, with test/inshore/ image AP 0.7008
2023-12-06 19:34:49,838 - INFO - Epoch(train)[17/100][20/58]lr: 1.0454e-04  eta: 3:21:49  time: 49.9149  inter_cls_loss: 0.1080 inner_cls_loss: 10.8204
2023-12-06 19:35:22,654 - INFO - Epoch(train)[17/100][40/58]lr: 1.0454e-04  eta: 2:46:33  time: 82.7315  inter_cls_loss: 0.1930 inner_cls_loss: 13.1769
2023-12-06 19:35:51,774 - INFO - Epoch(test) test/all/:
2023-12-06 19:36:35,747 - INFO - Epoch(test) : [20/31]
2023-12-06 19:36:53,301 - INFO - Metrics for ship: Accuracy: 0.9435, Precision: 0.8250, Recall: 0.8387, F1_score: 0.8318, Average_Precision: 0.9139
2023-12-06 19:36:53,332 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:37:36,639 - INFO - Epoch(test) : [20/26]
2023-12-06 19:37:46,663 - INFO - Metrics for ship: Accuracy: 0.9615, Precision: 0.9436, Recall: 0.9461, F1_score: 0.9448, Average_Precision: 0.9845
2023-12-06 19:37:46,666 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:38:03,288 - INFO - Metrics for ship: Accuracy: 0.9176, Precision: 0.5890, Recall: 0.8050, F1_score: 0.6803, Average_Precision: 0.7111
2023-12-06 19:38:04,379 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:38:04,435 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 4f8c782ed70d5e9fa47e64feaf6d5a2b, with test/inshore/ image AP 0.7111
2023-12-06 19:38:54,673 - INFO - Epoch(train)[18/100][20/58]lr: 6.3952e-05  eta: 3:20:41  time: 50.2361  inter_cls_loss: 0.0876 inner_cls_loss: 10.2337
2023-12-06 19:39:28,005 - INFO - Epoch(train)[18/100][40/58]lr: 6.3952e-05  eta: 2:46:13  time: 83.5692  inter_cls_loss: 0.0909 inner_cls_loss: 10.1800
2023-12-06 19:39:56,432 - INFO - Epoch(test) test/all/:
2023-12-06 19:40:40,323 - INFO - Epoch(test) : [20/31]
2023-12-06 19:40:57,832 - INFO - Metrics for ship: Accuracy: 0.9439, Precision: 0.8263, Recall: 0.8396, F1_score: 0.8329, Average_Precision: 0.9144
2023-12-06 19:40:57,870 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:41:40,618 - INFO - Epoch(test) : [20/26]
2023-12-06 19:41:51,540 - INFO - Metrics for ship: Accuracy: 0.9619, Precision: 0.9458, Recall: 0.9446, F1_score: 0.9452, Average_Precision: 0.9846
2023-12-06 19:41:51,543 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:42:08,335 - INFO - Metrics for ship: Accuracy: 0.9204, Precision: 0.5998, Recall: 0.8068, F1_score: 0.6881, Average_Precision: 0.7167
2023-12-06 19:42:09,393 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:42:09,442 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 e4036f038b1bae683006a7e09182887d, with test/inshore/ image AP 0.7167
2023-12-06 19:42:58,546 - INFO - Epoch(train)[19/100][20/58]lr: 3.4227e-05  eta: 3:13:47  time: 49.1026  inter_cls_loss: 0.1136 inner_cls_loss: 10.9839
2023-12-06 19:43:32,316 - INFO - Epoch(train)[19/100][40/58]lr: 3.4227e-05  eta: 2:42:50  time: 82.8734  inter_cls_loss: 0.0894 inner_cls_loss: 10.1383
2023-12-06 19:44:01,179 - INFO - Epoch(test) test/all/:
2023-12-06 19:44:46,276 - INFO - Epoch(test) : [20/31]
2023-12-06 19:45:03,142 - INFO - Metrics for ship: Accuracy: 0.9437, Precision: 0.8175, Recall: 0.8522, F1_score: 0.8345, Average_Precision: 0.9150
2023-12-06 19:45:03,173 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:45:46,220 - INFO - Epoch(test) : [20/26]
2023-12-06 19:45:57,483 - INFO - Metrics for ship: Accuracy: 0.9627, Precision: 0.9434, Recall: 0.9497, F1_score: 0.9465, Average_Precision: 0.9845
2023-12-06 19:45:57,486 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:46:14,121 - INFO - Metrics for ship: Accuracy: 0.9178, Precision: 0.5879, Recall: 0.8202, F1_score: 0.6849, Average_Precision: 0.7174
2023-12-06 19:46:15,232 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:46:15,289 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 9dc673575e297c8e3fd48b812498d929, with test/inshore/ image AP 0.7174
2023-12-06 19:47:05,259 - INFO - Epoch(train)[20/100][20/58]lr: 1.6094e-05  eta: 3:14:47  time: 49.9695  inter_cls_loss: 0.1424 inner_cls_loss: 11.8038
2023-12-06 19:47:37,976 - INFO - Epoch(train)[20/100][40/58]lr: 1.6094e-05  eta: 2:40:28  time: 82.6867  inter_cls_loss: 0.0811 inner_cls_loss: 9.8189
2023-12-06 19:48:06,973 - INFO - Epoch(test) test/all/:
2023-12-06 19:48:51,366 - INFO - Epoch(test) : [20/31]
2023-12-06 19:49:08,545 - INFO - Metrics for ship: Accuracy: 0.9441, Precision: 0.8281, Recall: 0.8382, F1_score: 0.8332, Average_Precision: 0.9150
2023-12-06 19:49:08,576 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:49:52,159 - INFO - Epoch(test) : [20/26]
2023-12-06 19:50:02,873 - INFO - Metrics for ship: Accuracy: 0.9619, Precision: 0.9451, Recall: 0.9454, F1_score: 0.9453, Average_Precision: 0.9845
2023-12-06 19:50:02,877 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:50:19,986 - INFO - Metrics for ship: Accuracy: 0.9203, Precision: 0.5996, Recall: 0.8063, F1_score: 0.6877, Average_Precision: 0.7180
2023-12-06 19:50:21,180 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:50:21,244 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 48a817535d63ae0c3ac4e606bf66fec9, with test/inshore/ image AP 0.7180
2023-12-06 19:51:12,792 - INFO - Epoch(train)[21/100][20/58]lr: 1.0000e-03  eta: 3:18:11  time: 51.4790  inter_cls_loss: 0.1450 inner_cls_loss: 11.3558
2023-12-06 19:51:45,466 - INFO - Epoch(train)[21/100][40/58]lr: 1.0000e-03  eta: 2:41:17  time: 84.1554  inter_cls_loss: 0.1381 inner_cls_loss: 11.2935
2023-12-06 19:52:14,113 - INFO - Epoch(test) test/all/:
2023-12-06 19:52:58,841 - INFO - Epoch(test) : [20/31]
2023-12-06 19:53:16,489 - INFO - Metrics for ship: Accuracy: 0.9366, Precision: 0.7762, Recall: 0.8704, F1_score: 0.8206, Average_Precision: 0.9036
2023-12-06 19:53:16,527 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:54:00,411 - INFO - Epoch(test) : [20/26]
2023-12-06 19:54:11,110 - INFO - Metrics for ship: Accuracy: 0.9624, Precision: 0.9386, Recall: 0.9543, F1_score: 0.9464, Average_Precision: 0.9807
2023-12-06 19:54:11,114 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:54:27,672 - INFO - Metrics for ship: Accuracy: 0.9065, Precision: 0.5458, Recall: 0.8419, F1_score: 0.6623, Average_Precision: 0.7075
2023-12-06 19:54:28,792 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:55:18,832 - INFO - Epoch(train)[22/100][20/58]lr: 9.9847e-04  eta: 3:10:13  time: 50.0383  inter_cls_loss: 0.0888 inner_cls_loss: 9.1162
2023-12-06 19:55:52,637 - INFO - Epoch(train)[22/100][40/58]lr: 9.9847e-04  eta: 2:38:40  time: 83.8433  inter_cls_loss: 0.1815 inner_cls_loss: 11.6809
2023-12-06 19:56:21,764 - INFO - Epoch(test) test/all/:
2023-12-06 19:57:06,726 - INFO - Epoch(test) : [20/31]
2023-12-06 19:57:23,930 - INFO - Metrics for ship: Accuracy: 0.9419, Precision: 0.8166, Recall: 0.8394, F1_score: 0.8278, Average_Precision: 0.9081
2023-12-06 19:57:23,968 - INFO - Epoch(test) test/offshore/:
2023-12-06 19:58:07,176 - INFO - Epoch(test) : [20/26]
2023-12-06 19:58:17,148 - INFO - Metrics for ship: Accuracy: 0.9510, Precision: 0.8987, Recall: 0.9682, F1_score: 0.9322, Average_Precision: 0.9743
2023-12-06 19:58:17,152 - INFO - Epoch(test) test/inshore/:
2023-12-06 19:58:34,443 - INFO - Metrics for ship: Accuracy: 0.9019, Precision: 0.5309, Recall: 0.8493, F1_score: 0.6534, Average_Precision: 0.6839
2023-12-06 19:58:35,543 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 19:59:26,151 - INFO - Epoch(train)[23/100][20/58]lr: 9.9391e-04  eta: 3:9:56  time: 50.6075  inter_cls_loss: 0.1085 inner_cls_loss: 9.0581
2023-12-06 19:59:58,441 - INFO - Epoch(train)[23/100][40/58]lr: 9.9391e-04  eta: 2:34:52  time: 82.8982  inter_cls_loss: 0.1593 inner_cls_loss: 10.2810
2023-12-06 20:00:26,979 - INFO - Epoch(test) test/all/:
2023-12-06 20:01:12,158 - INFO - Epoch(test) : [20/31]
2023-12-06 20:01:29,573 - INFO - Metrics for ship: Accuracy: 0.9386, Precision: 0.8537, Recall: 0.7617, F1_score: 0.8051, Average_Precision: 0.9017
2023-12-06 20:01:29,604 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:02:12,798 - INFO - Epoch(test) : [20/26]
2023-12-06 20:02:23,559 - INFO - Metrics for ship: Accuracy: 0.9586, Precision: 0.9359, Recall: 0.9457, F1_score: 0.9408, Average_Precision: 0.9731
2023-12-06 20:02:23,564 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:02:41,143 - INFO - Metrics for ship: Accuracy: 0.9170, Precision: 0.5889, Recall: 0.7864, F1_score: 0.6735, Average_Precision: 0.6654
2023-12-06 20:02:42,254 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:03:31,546 - INFO - Epoch(train)[24/100][20/58]lr: 9.8632e-04  eta: 3:2:36  time: 49.2866  inter_cls_loss: 0.1455 inner_cls_loss: 9.2722
2023-12-06 20:04:05,674 - INFO - Epoch(train)[24/100][40/58]lr: 9.8632e-04  eta: 2:33:50  time: 83.4187  inter_cls_loss: 0.1716 inner_cls_loss: 9.8654
2023-12-06 20:04:34,915 - INFO - Epoch(test) test/all/:
2023-12-06 20:05:19,156 - INFO - Epoch(test) : [20/31]
2023-12-06 20:05:36,339 - INFO - Metrics for ship: Accuracy: 0.9432, Precision: 0.8019, Recall: 0.8749, F1_score: 0.8368, Average_Precision: 0.9149
2023-12-06 20:05:36,369 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:06:19,389 - INFO - Epoch(test) : [20/26]
2023-12-06 20:06:30,076 - INFO - Metrics for ship: Accuracy: 0.9616, Precision: 0.9539, Recall: 0.9347, F1_score: 0.9442, Average_Precision: 0.9849
2023-12-06 20:06:30,080 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:06:47,156 - INFO - Metrics for ship: Accuracy: 0.9214, Precision: 0.5989, Recall: 0.8406, F1_score: 0.6995, Average_Precision: 0.7271
2023-12-06 20:06:48,308 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:06:48,368 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 7e17118f466c1357fa2e5bfeb64c3c88, with test/inshore/ image AP 0.7271
2023-12-06 20:07:38,840 - INFO - Epoch(train)[25/100][20/58]lr: 9.7577e-04  eta: 3:4:33  time: 50.4696  inter_cls_loss: 0.1547 inner_cls_loss: 9.0014
2023-12-06 20:08:12,258 - INFO - Epoch(train)[25/100][40/58]lr: 9.7577e-04  eta: 2:32:40  time: 83.8892  inter_cls_loss: 0.1570 inner_cls_loss: 8.3676
2023-12-06 20:08:40,271 - INFO - Epoch(test) test/all/:
2023-12-06 20:09:25,172 - INFO - Epoch(test) : [20/31]
2023-12-06 20:09:42,704 - INFO - Metrics for ship: Accuracy: 0.9444, Precision: 0.8381, Recall: 0.8252, F1_score: 0.8316, Average_Precision: 0.9126
2023-12-06 20:09:42,734 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:10:24,597 - INFO - Epoch(test) : [20/26]
2023-12-06 20:10:34,552 - INFO - Metrics for ship: Accuracy: 0.9563, Precision: 0.9605, Recall: 0.9117, F1_score: 0.9355, Average_Precision: 0.9831
2023-12-06 20:10:34,556 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:10:51,156 - INFO - Metrics for ship: Accuracy: 0.9305, Precision: 0.6499, Recall: 0.7827, F1_score: 0.7101, Average_Precision: 0.7395
2023-12-06 20:10:52,205 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:10:52,261 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 8669db02492beeb2c0e1df235ae080d0, with test/inshore/ image AP 0.7395
2023-12-06 20:11:42,599 - INFO - Epoch(train)[26/100][20/58]lr: 9.6232e-04  eta: 3:1:37  time: 50.3340  inter_cls_loss: 0.1327 inner_cls_loss: 7.5881
2023-12-06 20:12:16,580 - INFO - Epoch(train)[26/100][40/58]lr: 9.6232e-04  eta: 2:31:24  time: 84.3144  inter_cls_loss: 0.1733 inner_cls_loss: 8.3583
2023-12-06 20:12:44,945 - INFO - Epoch(test) test/all/:
2023-12-06 20:13:29,113 - INFO - Epoch(test) : [20/31]
2023-12-06 20:13:47,165 - INFO - Metrics for ship: Accuracy: 0.9432, Precision: 0.7994, Recall: 0.8792, F1_score: 0.8374, Average_Precision: 0.9157
2023-12-06 20:13:47,200 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:14:30,079 - INFO - Epoch(test) : [20/26]
2023-12-06 20:14:40,147 - INFO - Metrics for ship: Accuracy: 0.9617, Precision: 0.9359, Recall: 0.9555, F1_score: 0.9456, Average_Precision: 0.9804
2023-12-06 20:14:40,151 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:14:56,698 - INFO - Metrics for ship: Accuracy: 0.9062, Precision: 0.5432, Recall: 0.8672, F1_score: 0.6680, Average_Precision: 0.6987
2023-12-06 20:14:57,768 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:15:47,666 - INFO - Epoch(train)[27/100][20/58]lr: 9.4605e-04  eta: 2:57:37  time: 49.8969  inter_cls_loss: 0.1161 inner_cls_loss: 7.0833
2023-12-06 20:16:21,093 - INFO - Epoch(train)[27/100][40/58]lr: 9.4605e-04  eta: 2:27:37  time: 83.3226  inter_cls_loss: 0.0913 inner_cls_loss: 6.3182
2023-12-06 20:16:49,874 - INFO - Epoch(test) test/all/:
2023-12-06 20:17:33,637 - INFO - Epoch(test) : [20/31]
2023-12-06 20:17:51,430 - INFO - Metrics for ship: Accuracy: 0.9477, Precision: 0.8343, Recall: 0.8561, F1_score: 0.8451, Average_Precision: 0.9227
2023-12-06 20:17:51,460 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:18:34,186 - INFO - Epoch(test) : [20/26]
2023-12-06 20:18:44,816 - INFO - Metrics for ship: Accuracy: 0.9593, Precision: 0.9541, Recall: 0.9277, F1_score: 0.9407, Average_Precision: 0.9852
2023-12-06 20:18:44,821 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:19:01,993 - INFO - Metrics for ship: Accuracy: 0.9337, Precision: 0.6587, Recall: 0.8109, F1_score: 0.7269, Average_Precision: 0.7617
2023-12-06 20:19:03,084 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:19:03,144 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 0c898247b0e900978a03832342fdb9d7, with test/inshore/ image AP 0.7617
2023-12-06 20:19:54,898 - INFO - Epoch(train)[28/100][20/58]lr: 9.2706e-04  eta: 3:1:44  time: 51.7522  inter_cls_loss: 0.0924 inner_cls_loss: 6.0858
2023-12-06 20:20:28,057 - INFO - Epoch(train)[28/100][40/58]lr: 9.2706e-04  eta: 2:28:23  time: 84.9127  inter_cls_loss: 0.1303 inner_cls_loss: 6.5942
2023-12-06 20:20:56,563 - INFO - Epoch(test) test/all/:
2023-12-06 20:21:41,299 - INFO - Epoch(test) : [20/31]
2023-12-06 20:21:58,887 - INFO - Metrics for ship: Accuracy: 0.9467, Precision: 0.8066, Recall: 0.8940, F1_score: 0.8480, Average_Precision: 0.9262
2023-12-06 20:21:58,917 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:22:41,754 - INFO - Epoch(test) : [20/26]
2023-12-06 20:22:52,455 - INFO - Metrics for ship: Accuracy: 0.9461, Precision: 0.9040, Recall: 0.9454, F1_score: 0.9242, Average_Precision: 0.9409
2023-12-06 20:22:52,459 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:23:09,383 - INFO - Metrics for ship: Accuracy: 0.9140, Precision: 0.5685, Recall: 0.8724, F1_score: 0.6884, Average_Precision: 0.7414
2023-12-06 20:23:10,448 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:23:59,648 - INFO - Epoch(train)[29/100][20/58]lr: 9.0546e-04  eta: 2:50:23  time: 49.1980  inter_cls_loss: 0.0914 inner_cls_loss: 5.7205
2023-12-06 20:24:34,324 - INFO - Epoch(train)[29/100][40/58]lr: 9.0546e-04  eta: 2:24:32  time: 83.8721  inter_cls_loss: 0.0759 inner_cls_loss: 5.3321
2023-12-06 20:25:03,323 - INFO - Epoch(test) test/all/:
2023-12-06 20:25:47,881 - INFO - Epoch(test) : [20/31]
2023-12-06 20:26:05,891 - INFO - Metrics for ship: Accuracy: 0.9484, Precision: 0.8712, Recall: 0.8099, F1_score: 0.8394, Average_Precision: 0.9256
2023-12-06 20:26:05,921 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:26:49,135 - INFO - Epoch(test) : [20/26]
2023-12-06 20:26:59,971 - INFO - Metrics for ship: Accuracy: 0.9562, Precision: 0.9643, Recall: 0.9077, F1_score: 0.9351, Average_Precision: 0.9844
2023-12-06 20:26:59,973 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:27:16,255 - INFO - Metrics for ship: Accuracy: 0.9343, Precision: 0.6717, Recall: 0.7746, F1_score: 0.7195, Average_Precision: 0.7534
2023-12-06 20:27:17,316 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:28:07,273 - INFO - Epoch(train)[30/100][20/58]lr: 8.8140e-04  eta: 2:50:35  time: 49.9542  inter_cls_loss: 0.0598 inner_cls_loss: 4.9030
2023-12-06 20:28:40,431 - INFO - Epoch(train)[30/100][40/58]lr: 8.8140e-04  eta: 2:21:13  time: 83.1137  inter_cls_loss: 0.0811 inner_cls_loss: 5.1036
2023-12-06 20:29:10,586 - INFO - Epoch(test) test/all/:
2023-12-06 20:29:55,851 - INFO - Epoch(test) : [20/31]
2023-12-06 20:30:13,751 - INFO - Metrics for ship: Accuracy: 0.9513, Precision: 0.8423, Recall: 0.8707, F1_score: 0.8562, Average_Precision: 0.9303
2023-12-06 20:30:13,782 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:30:57,410 - INFO - Epoch(test) : [20/26]
2023-12-06 20:31:07,787 - INFO - Metrics for ship: Accuracy: 0.9621, Precision: 0.9582, Recall: 0.9318, F1_score: 0.9448, Average_Precision: 0.9863
2023-12-06 20:31:07,791 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:31:24,322 - INFO - Metrics for ship: Accuracy: 0.9325, Precision: 0.6479, Recall: 0.8326, F1_score: 0.7287, Average_Precision: 0.7712
2023-12-06 20:31:25,392 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:31:25,450 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 6b0488171c5804bfca6520b4468fb6c7, with test/inshore/ image AP 0.7712
2023-12-06 20:32:16,501 - INFO - Epoch(train)[31/100][20/58]lr: 8.5502e-04  eta: 2:51:37  time: 50.9768  inter_cls_loss: 0.0730 inner_cls_loss: 4.8146
2023-12-06 20:32:49,789 - INFO - Epoch(train)[31/100][40/58]lr: 8.5502e-04  eta: 2:21:9  time: 84.2687  inter_cls_loss: 0.0698 inner_cls_loss: 4.6530
2023-12-06 20:33:19,368 - INFO - Epoch(test) test/all/:
2023-12-06 20:34:03,643 - INFO - Epoch(test) : [20/31]
2023-12-06 20:34:20,521 - INFO - Metrics for ship: Accuracy: 0.9525, Precision: 0.8840, Recall: 0.8223, F1_score: 0.8521, Average_Precision: 0.9339
2023-12-06 20:34:20,561 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:35:02,803 - INFO - Epoch(test) : [20/26]
2023-12-06 20:35:13,472 - INFO - Metrics for ship: Accuracy: 0.9563, Precision: 0.9631, Recall: 0.9091, F1_score: 0.9353, Average_Precision: 0.9845
2023-12-06 20:35:13,475 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:35:30,386 - INFO - Metrics for ship: Accuracy: 0.9440, Precision: 0.7311, Recall: 0.7683, F1_score: 0.7493, Average_Precision: 0.7961
2023-12-06 20:35:31,409 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:35:31,466 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 bd5b2f78ac9468323de061b54bed0637, with test/inshore/ image AP 0.7961
2023-12-06 20:36:22,521 - INFO - Epoch(train)[32/100][20/58]lr: 8.2648e-04  eta: 2:49:24  time: 51.0527  inter_cls_loss: 0.0835 inner_cls_loss: 4.6506
2023-12-06 20:36:56,714 - INFO - Epoch(train)[32/100][40/58]lr: 8.2648e-04  eta: 2:20:43  time: 85.2447  inter_cls_loss: 0.0916 inner_cls_loss: 4.6240
2023-12-06 20:37:26,497 - INFO - Epoch(test) test/all/:
2023-12-06 20:38:11,436 - INFO - Epoch(test) : [20/31]
2023-12-06 20:38:29,061 - INFO - Metrics for ship: Accuracy: 0.9493, Precision: 0.8295, Recall: 0.8756, F1_score: 0.8519, Average_Precision: 0.9294
2023-12-06 20:38:29,091 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:39:11,626 - INFO - Epoch(test) : [20/26]
2023-12-06 20:39:21,527 - INFO - Metrics for ship: Accuracy: 0.9641, Precision: 0.9514, Recall: 0.9451, F1_score: 0.9482, Average_Precision: 0.9848
2023-12-06 20:39:21,531 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:39:38,364 - INFO - Metrics for ship: Accuracy: 0.9227, Precision: 0.6013, Recall: 0.8600, F1_score: 0.7077, Average_Precision: 0.7811
2023-12-06 20:39:39,425 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:40:30,392 - INFO - Epoch(train)[33/100][20/58]lr: 7.9595e-04  eta: 2:46:39  time: 50.9673  inter_cls_loss: 0.0913 inner_cls_loss: 4.5107
2023-12-06 20:41:02,465 - INFO - Epoch(train)[33/100][40/58]lr: 7.9595e-04  eta: 2:15:4  time: 83.0386  inter_cls_loss: 0.0732 inner_cls_loss: 4.1796
2023-12-06 20:41:31,382 - INFO - Epoch(test) test/all/:
2023-12-06 20:42:15,034 - INFO - Epoch(test) : [20/31]
2023-12-06 20:42:32,152 - INFO - Metrics for ship: Accuracy: 0.9516, Precision: 0.8611, Recall: 0.8460, F1_score: 0.8535, Average_Precision: 0.9320
2023-12-06 20:42:32,181 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:43:14,408 - INFO - Epoch(test) : [20/26]
2023-12-06 20:43:25,154 - INFO - Metrics for ship: Accuracy: 0.9612, Precision: 0.9409, Recall: 0.9480, F1_score: 0.9444, Average_Precision: 0.9824
2023-12-06 20:43:25,159 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:43:42,107 - INFO - Metrics for ship: Accuracy: 0.9363, Precision: 0.6710, Recall: 0.8144, F1_score: 0.7358, Average_Precision: 0.7838
2023-12-06 20:43:43,194 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:44:33,905 - INFO - Epoch(train)[34/100][20/58]lr: 7.6364e-04  eta: 2:43:22  time: 50.7103  inter_cls_loss: 0.0659 inner_cls_loss: 3.9311
2023-12-06 20:45:08,295 - INFO - Epoch(train)[34/100][40/58]lr: 7.6364e-04  eta: 2:16:22  time: 85.0986  inter_cls_loss: 0.0791 inner_cls_loss: 4.0687
2023-12-06 20:45:37,388 - INFO - Epoch(test) test/all/:
2023-12-06 20:46:22,519 - INFO - Epoch(test) : [20/31]
2023-12-06 20:46:39,983 - INFO - Metrics for ship: Accuracy: 0.9517, Precision: 0.8699, Recall: 0.8347, F1_score: 0.8519, Average_Precision: 0.9300
2023-12-06 20:46:40,013 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:47:22,857 - INFO - Epoch(test) : [20/26]
2023-12-06 20:47:33,962 - INFO - Metrics for ship: Accuracy: 0.9607, Precision: 0.9435, Recall: 0.9435, F1_score: 0.9435, Average_Precision: 0.9818
2023-12-06 20:47:33,966 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:47:50,574 - INFO - Metrics for ship: Accuracy: 0.9386, Precision: 0.6869, Recall: 0.8010, F1_score: 0.7396, Average_Precision: 0.7785
2023-12-06 20:47:51,808 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:48:42,849 - INFO - Epoch(train)[35/100][20/58]lr: 7.2973e-04  eta: 2:41:57  time: 51.0396  inter_cls_loss: 0.1001 inner_cls_loss: 4.2576
2023-12-06 20:49:16,237 - INFO - Epoch(train)[35/100][40/58]lr: 7.2973e-04  eta: 2:13:15  time: 84.4254  inter_cls_loss: 0.0697 inner_cls_loss: 3.7317
2023-12-06 20:49:45,975 - INFO - Epoch(test) test/all/:
2023-12-06 20:50:29,738 - INFO - Epoch(test) : [20/31]
2023-12-06 20:50:47,091 - INFO - Metrics for ship: Accuracy: 0.9511, Precision: 0.8200, Recall: 0.9045, F1_score: 0.8602, Average_Precision: 0.9373
2023-12-06 20:50:47,130 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:51:31,369 - INFO - Epoch(test) : [20/26]
2023-12-06 20:51:41,117 - INFO - Metrics for ship: Accuracy: 0.9303, Precision: 0.8564, Recall: 0.9608, F1_score: 0.9056, Average_Precision: 0.9316
2023-12-06 20:51:41,121 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:51:57,726 - INFO - Metrics for ship: Accuracy: 0.9303, Precision: 0.6309, Recall: 0.8681, F1_score: 0.7307, Average_Precision: 0.7974
2023-12-06 20:51:58,780 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:51:58,839 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 e8d950c685493083221888637723d1ac, with test/inshore/ image AP 0.7974
2023-12-06 20:52:49,849 - INFO - Epoch(train)[36/100][20/58]lr: 6.9443e-04  eta: 2:39:24  time: 51.0092  inter_cls_loss: 0.0917 inner_cls_loss: 3.8021
2023-12-06 20:53:22,605 - INFO - Epoch(train)[36/100][40/58]lr: 6.9443e-04  eta: 2:10:10  time: 83.7637  inter_cls_loss: 0.0770 inner_cls_loss: 3.7116
2023-12-06 20:53:51,644 - INFO - Epoch(test) test/all/:
2023-12-06 20:54:37,451 - INFO - Epoch(test) : [20/31]
2023-12-06 20:54:54,889 - INFO - Metrics for ship: Accuracy: 0.9557, Precision: 0.8722, Recall: 0.8595, F1_score: 0.8658, Average_Precision: 0.9378
2023-12-06 20:54:54,953 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:55:39,010 - INFO - Epoch(test) : [20/26]
2023-12-06 20:55:49,242 - INFO - Metrics for ship: Accuracy: 0.9548, Precision: 0.9251, Recall: 0.9467, F1_score: 0.9358, Average_Precision: 0.9820
2023-12-06 20:55:49,245 - INFO - Epoch(test) test/inshore/:
2023-12-06 20:56:05,737 - INFO - Metrics for ship: Accuracy: 0.9415, Precision: 0.6957, Recall: 0.8214, F1_score: 0.7534, Average_Precision: 0.7958
2023-12-06 20:56:06,870 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 20:56:57,269 - INFO - Epoch(train)[37/100][20/58]lr: 6.5796e-04  eta: 2:35:3  time: 50.3983  inter_cls_loss: 0.1715 inner_cls_loss: 4.8209
2023-12-06 20:57:30,234 - INFO - Epoch(train)[37/100][40/58]lr: 6.5796e-04  eta: 2:7:32  time: 83.3619  inter_cls_loss: 0.0710 inner_cls_loss: 3.4197
2023-12-06 20:57:58,577 - INFO - Epoch(test) test/all/:
2023-12-06 20:58:44,533 - INFO - Epoch(test) : [20/31]
2023-12-06 20:59:01,520 - INFO - Metrics for ship: Accuracy: 0.9555, Precision: 0.8604, Recall: 0.8747, F1_score: 0.8675, Average_Precision: 0.9398
2023-12-06 20:59:01,557 - INFO - Epoch(test) test/offshore/:
2023-12-06 20:59:44,363 - INFO - Epoch(test) : [20/26]
2023-12-06 20:59:55,286 - INFO - Metrics for ship: Accuracy: 0.9634, Precision: 0.9477, Recall: 0.9470, F1_score: 0.9473, Average_Precision: 0.9839
2023-12-06 20:59:55,291 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:00:12,351 - INFO - Metrics for ship: Accuracy: 0.9412, Precision: 0.6876, Recall: 0.8424, F1_score: 0.7572, Average_Precision: 0.8092
2023-12-06 21:00:13,423 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:00:13,479 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 aeb22ff8fb17ecc9555f433447be5ffa, with test/inshore/ image AP 0.8092
2023-12-06 21:01:05,059 - INFO - Epoch(train)[38/100][20/58]lr: 6.2056e-04  eta: 2:36:12  time: 51.5801  inter_cls_loss: 0.0578 inner_cls_loss: 3.2024
2023-12-06 21:01:38,612 - INFO - Epoch(train)[38/100][40/58]lr: 6.2056e-04  eta: 2:8:11  time: 85.1320  inter_cls_loss: 0.0539 inner_cls_loss: 3.1432
2023-12-06 21:02:07,835 - INFO - Epoch(test) test/all/:
2023-12-06 21:02:53,252 - INFO - Epoch(test) : [20/31]
2023-12-06 21:03:10,684 - INFO - Metrics for ship: Accuracy: 0.9558, Precision: 0.8870, Recall: 0.8420, F1_score: 0.8639, Average_Precision: 0.9383
2023-12-06 21:03:10,714 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:03:54,425 - INFO - Epoch(test) : [20/26]
2023-12-06 21:04:05,956 - INFO - Metrics for ship: Accuracy: 0.9638, Precision: 0.9537, Recall: 0.9418, F1_score: 0.9477, Average_Precision: 0.9845
2023-12-06 21:04:05,960 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:04:23,215 - INFO - Metrics for ship: Accuracy: 0.9406, Precision: 0.6905, Recall: 0.8226, F1_score: 0.7508, Average_Precision: 0.7944
2023-12-06 21:04:24,299 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:05:15,962 - INFO - Epoch(train)[39/100][20/58]lr: 5.8244e-04  eta: 2:33:57  time: 51.6612  inter_cls_loss: 0.0878 inner_cls_loss: 3.4050
2023-12-06 21:05:49,079 - INFO - Epoch(train)[39/100][40/58]lr: 5.8244e-04  eta: 2:5:36  time: 84.7800  inter_cls_loss: 0.0653 inner_cls_loss: 3.0956
2023-12-06 21:06:18,265 - INFO - Epoch(test) test/all/:
2023-12-06 21:07:03,394 - INFO - Epoch(test) : [20/31]
2023-12-06 21:07:20,379 - INFO - Metrics for ship: Accuracy: 0.9571, Precision: 0.8782, Recall: 0.8621, F1_score: 0.8700, Average_Precision: 0.9403
2023-12-06 21:07:20,416 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:08:04,578 - INFO - Epoch(test) : [20/26]
2023-12-06 21:08:15,585 - INFO - Metrics for ship: Accuracy: 0.9618, Precision: 0.9425, Recall: 0.9482, F1_score: 0.9453, Average_Precision: 0.9828
2023-12-06 21:08:15,588 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:08:32,346 - INFO - Metrics for ship: Accuracy: 0.9405, Precision: 0.6857, Recall: 0.8369, F1_score: 0.7538, Average_Precision: 0.8054
2023-12-06 21:08:33,431 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:09:24,319 - INFO - Epoch(train)[40/100][20/58]lr: 5.4384e-04  eta: 2:29:11  time: 50.8879  inter_cls_loss: 0.1215 inner_cls_loss: 3.6829
2023-12-06 21:09:58,132 - INFO - Epoch(train)[40/100][40/58]lr: 5.4384e-04  eta: 2:3:26  time: 84.6967  inter_cls_loss: 0.0733 inner_cls_loss: 3.0756
2023-12-06 21:10:26,758 - INFO - Epoch(test) test/all/:
2023-12-06 21:11:13,014 - INFO - Epoch(test) : [20/31]
2023-12-06 21:11:30,156 - INFO - Metrics for ship: Accuracy: 0.9569, Precision: 0.8603, Recall: 0.8851, F1_score: 0.8725, Average_Precision: 0.9407
2023-12-06 21:11:30,186 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:12:14,675 - INFO - Epoch(test) : [20/26]
2023-12-06 21:12:25,483 - INFO - Metrics for ship: Accuracy: 0.9647, Precision: 0.9479, Recall: 0.9508, F1_score: 0.9493, Average_Precision: 0.9836
2023-12-06 21:12:25,488 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:12:42,395 - INFO - Metrics for ship: Accuracy: 0.9419, Precision: 0.6904, Recall: 0.8445, F1_score: 0.7597, Average_Precision: 0.8152
2023-12-06 21:12:43,485 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:12:43,542 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 20d1554302bd986da88549491c155ae1, with test/inshore/ image AP 0.8152
2023-12-06 21:13:35,017 - INFO - Epoch(train)[41/100][20/58]lr: 5.0500e-04  eta: 2:28:14  time: 51.4114  inter_cls_loss: 0.0728 inner_cls_loss: 2.9810
2023-12-06 21:14:08,876 - INFO - Epoch(train)[41/100][40/58]lr: 5.0500e-04  eta: 2:2:13  time: 85.2718  inter_cls_loss: 0.0566 inner_cls_loss: 2.7980
2023-12-06 21:14:37,670 - INFO - Epoch(test) test/all/:
2023-12-06 21:15:22,824 - INFO - Epoch(test) : [20/31]
2023-12-06 21:15:40,508 - INFO - Metrics for ship: Accuracy: 0.9562, Precision: 0.8614, Recall: 0.8782, F1_score: 0.8697, Average_Precision: 0.9404
2023-12-06 21:15:40,538 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:16:24,805 - INFO - Epoch(test) : [20/26]
2023-12-06 21:16:35,219 - INFO - Metrics for ship: Accuracy: 0.9620, Precision: 0.9466, Recall: 0.9440, F1_score: 0.9453, Average_Precision: 0.9838
2023-12-06 21:16:35,222 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:16:52,679 - INFO - Metrics for ship: Accuracy: 0.9375, Precision: 0.6673, Recall: 0.8497, F1_score: 0.7475, Average_Precision: 0.8082
2023-12-06 21:16:53,813 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:17:45,796 - INFO - Epoch(train)[42/100][20/58]lr: 4.6616e-04  eta: 2:27:21  time: 51.9789  inter_cls_loss: 0.0497 inner_cls_loss: 2.7204
2023-12-06 21:18:19,326 - INFO - Epoch(train)[42/100][40/58]lr: 4.6616e-04  eta: 2:0:29  time: 85.5111  inter_cls_loss: 0.0623 inner_cls_loss: 2.7729
2023-12-06 21:18:48,863 - INFO - Epoch(test) test/all/:
2023-12-06 21:19:35,166 - INFO - Epoch(test) : [20/31]
2023-12-06 21:19:53,441 - INFO - Metrics for ship: Accuracy: 0.9584, Precision: 0.8705, Recall: 0.8810, F1_score: 0.8757, Average_Precision: 0.9428
2023-12-06 21:19:53,477 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:20:37,637 - INFO - Epoch(test) : [20/26]
2023-12-06 21:20:48,284 - INFO - Metrics for ship: Accuracy: 0.9626, Precision: 0.9475, Recall: 0.9448, F1_score: 0.9462, Average_Precision: 0.9830
2023-12-06 21:20:48,289 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:21:05,071 - INFO - Metrics for ship: Accuracy: 0.9429, Precision: 0.6966, Recall: 0.8427, F1_score: 0.7627, Average_Precision: 0.8191
2023-12-06 21:21:06,143 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:21:06,200 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 63aaee8f458fb1e3e9a7b63c40e161c1, with test/inshore/ image AP 0.8191
2023-12-06 21:21:57,355 - INFO - Epoch(train)[43/100][20/58]lr: 4.2756e-04  eta: 2:22:32  time: 51.1526  inter_cls_loss: 0.0558 inner_cls_loss: 2.6450
2023-12-06 21:22:31,242 - INFO - Epoch(train)[43/100][40/58]lr: 4.2756e-04  eta: 1:57:46  time: 85.0407  inter_cls_loss: 0.1490 inner_cls_loss: 3.5758
2023-12-06 21:23:00,791 - INFO - Epoch(test) test/all/:
2023-12-06 21:23:47,027 - INFO - Epoch(test) : [20/31]
2023-12-06 21:24:04,504 - INFO - Metrics for ship: Accuracy: 0.9589, Precision: 0.8948, Recall: 0.8532, F1_score: 0.8735, Average_Precision: 0.9423
2023-12-06 21:24:04,536 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:24:48,917 - INFO - Epoch(test) : [20/26]
2023-12-06 21:24:59,486 - INFO - Metrics for ship: Accuracy: 0.9620, Precision: 0.9483, Recall: 0.9421, F1_score: 0.9452, Average_Precision: 0.9824
2023-12-06 21:24:59,490 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:25:16,539 - INFO - Metrics for ship: Accuracy: 0.9461, Precision: 0.7265, Recall: 0.8098, F1_score: 0.7659, Average_Precision: 0.8116
2023-12-06 21:25:17,728 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:26:11,787 - INFO - Epoch(train)[44/100][20/58]lr: 3.8944e-04  eta: 2:28:1  time: 54.0584  inter_cls_loss: 0.0523 inner_cls_loss: 2.5455
2023-12-06 21:26:45,480 - INFO - Epoch(train)[44/100][40/58]lr: 3.8944e-04  eta: 1:59:24  time: 87.7486  inter_cls_loss: 0.0643 inner_cls_loss: 2.6285
2023-12-06 21:27:15,705 - INFO - Epoch(test) test/all/:
2023-12-06 21:28:02,153 - INFO - Epoch(test) : [20/31]
2023-12-06 21:28:20,372 - INFO - Metrics for ship: Accuracy: 0.9572, Precision: 0.8542, Recall: 0.8955, F1_score: 0.8744, Average_Precision: 0.9408
2023-12-06 21:28:20,409 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:29:04,698 - INFO - Epoch(test) : [20/26]
2023-12-06 21:29:15,845 - INFO - Metrics for ship: Accuracy: 0.9631, Precision: 0.9348, Recall: 0.9610, F1_score: 0.9477, Average_Precision: 0.9806
2023-12-06 21:29:15,850 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:29:33,448 - INFO - Metrics for ship: Accuracy: 0.9344, Precision: 0.6497, Recall: 0.8613, F1_score: 0.7407, Average_Precision: 0.8044
2023-12-06 21:29:34,664 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:30:25,542 - INFO - Epoch(train)[45/100][20/58]lr: 3.5204e-04  eta: 2:16:50  time: 50.8721  inter_cls_loss: 0.0884 inner_cls_loss: 2.7378
2023-12-06 21:31:00,211 - INFO - Epoch(train)[45/100][40/58]lr: 3.5204e-04  eta: 1:54:20  time: 85.5459  inter_cls_loss: 0.0620 inner_cls_loss: 2.5361
2023-12-06 21:31:29,841 - INFO - Epoch(test) test/all/:
2023-12-06 21:32:15,289 - INFO - Epoch(test) : [20/31]
2023-12-06 21:32:33,337 - INFO - Metrics for ship: Accuracy: 0.9593, Precision: 0.8845, Recall: 0.8692, F1_score: 0.8768, Average_Precision: 0.9426
2023-12-06 21:32:33,377 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:33:18,265 - INFO - Epoch(test) : [20/26]
2023-12-06 21:33:27,991 - INFO - Metrics for ship: Accuracy: 0.9636, Precision: 0.9499, Recall: 0.9451, F1_score: 0.9475, Average_Precision: 0.9821
2023-12-06 21:33:27,997 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:33:45,875 - INFO - Metrics for ship: Accuracy: 0.9437, Precision: 0.7032, Recall: 0.8357, F1_score: 0.7637, Average_Precision: 0.8121
2023-12-06 21:33:47,017 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:34:38,838 - INFO - Epoch(train)[46/100][20/58]lr: 3.1557e-04  eta: 2:16:53  time: 51.8201  inter_cls_loss: 0.0562 inner_cls_loss: 2.4301
2023-12-06 21:35:11,093 - INFO - Epoch(train)[46/100][40/58]lr: 3.1557e-04  eta: 1:50:20  time: 84.0734  inter_cls_loss: 0.0646 inner_cls_loss: 2.5628
2023-12-06 21:35:41,312 - INFO - Epoch(test) test/all/:
2023-12-06 21:36:26,523 - INFO - Epoch(test) : [20/31]
2023-12-06 21:36:44,067 - INFO - Metrics for ship: Accuracy: 0.9583, Precision: 0.8650, Recall: 0.8882, F1_score: 0.8765, Average_Precision: 0.9420
2023-12-06 21:36:44,112 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:37:28,435 - INFO - Epoch(test) : [20/26]
2023-12-06 21:37:38,966 - INFO - Metrics for ship: Accuracy: 0.9655, Precision: 0.9546, Recall: 0.9459, F1_score: 0.9503, Average_Precision: 0.9835
2023-12-06 21:37:38,969 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:37:56,673 - INFO - Metrics for ship: Accuracy: 0.9424, Precision: 0.6926, Recall: 0.8466, F1_score: 0.7619, Average_Precision: 0.8154
2023-12-06 21:37:57,880 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:38:49,576 - INFO - Epoch(train)[47/100][20/58]lr: 2.8027e-04  eta: 2:14:3  time: 51.6943  inter_cls_loss: 0.0371 inner_cls_loss: 2.2316
2023-12-06 21:39:22,803 - INFO - Epoch(train)[47/100][40/58]lr: 2.8027e-04  eta: 1:49:24  time: 84.9216  inter_cls_loss: 0.0913 inner_cls_loss: 2.7560
2023-12-06 21:39:51,426 - INFO - Epoch(test) test/all/:
2023-12-06 21:40:37,645 - INFO - Epoch(test) : [20/31]
2023-12-06 21:40:55,571 - INFO - Metrics for ship: Accuracy: 0.9583, Precision: 0.8536, Recall: 0.9048, F1_score: 0.8784, Average_Precision: 0.9429
2023-12-06 21:40:55,602 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:41:38,583 - INFO - Epoch(test) : [20/26]
2023-12-06 21:41:48,157 - INFO - Metrics for ship: Accuracy: 0.9666, Precision: 0.9427, Recall: 0.9626, F1_score: 0.9525, Average_Precision: 0.9817
2023-12-06 21:41:48,161 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:42:05,910 - INFO - Metrics for ship: Accuracy: 0.9432, Precision: 0.6920, Recall: 0.8610, F1_score: 0.7673, Average_Precision: 0.8256
2023-12-06 21:42:07,127 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:42:07,190 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 3bcca2a490d02410ed276d34c2d13e17, with test/inshore/ image AP 0.8256
2023-12-06 21:42:58,768 - INFO - Epoch(train)[48/100][20/58]lr: 2.4636e-04  eta: 2:11:15  time: 51.5721  inter_cls_loss: 0.0338 inner_cls_loss: 2.2045
2023-12-06 21:43:30,463 - INFO - Epoch(train)[48/100][40/58]lr: 2.4636e-04  eta: 1:45:16  time: 83.2716  inter_cls_loss: 0.0515 inner_cls_loss: 2.3144
2023-12-06 21:43:59,582 - INFO - Epoch(test) test/all/:
2023-12-06 21:44:43,511 - INFO - Epoch(test) : [20/31]
2023-12-06 21:45:01,274 - INFO - Metrics for ship: Accuracy: 0.9597, Precision: 0.8691, Recall: 0.8921, F1_score: 0.8804, Average_Precision: 0.9432
2023-12-06 21:45:01,305 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:45:44,880 - INFO - Epoch(test) : [20/26]
2023-12-06 21:45:56,051 - INFO - Metrics for ship: Accuracy: 0.9648, Precision: 0.9439, Recall: 0.9557, F1_score: 0.9498, Average_Precision: 0.9810
2023-12-06 21:45:56,056 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:46:13,295 - INFO - Metrics for ship: Accuracy: 0.9428, Precision: 0.6929, Recall: 0.8520, F1_score: 0.7642, Average_Precision: 0.8242
2023-12-06 21:46:14,636 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:47:06,396 - INFO - Epoch(train)[49/100][20/58]lr: 2.1405e-04  eta: 2:9:13  time: 51.7578  inter_cls_loss: 0.0641 inner_cls_loss: 2.3598
2023-12-06 21:47:40,732 - INFO - Epoch(train)[49/100][40/58]lr: 2.1405e-04  eta: 1:46:45  time: 86.0938  inter_cls_loss: 0.0501 inner_cls_loss: 2.2426
2023-12-06 21:48:10,121 - INFO - Epoch(test) test/all/:
2023-12-06 21:48:56,003 - INFO - Epoch(test) : [20/31]
2023-12-06 21:49:13,898 - INFO - Metrics for ship: Accuracy: 0.9606, Precision: 0.8778, Recall: 0.8866, F1_score: 0.8822, Average_Precision: 0.9431
2023-12-06 21:49:13,936 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:49:57,066 - INFO - Epoch(test) : [20/26]
2023-12-06 21:50:07,934 - INFO - Metrics for ship: Accuracy: 0.9631, Precision: 0.9448, Recall: 0.9496, F1_score: 0.9472, Average_Precision: 0.9799
2023-12-06 21:50:07,938 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:50:25,087 - INFO - Metrics for ship: Accuracy: 0.9451, Precision: 0.7075, Recall: 0.8456, F1_score: 0.7704, Average_Precision: 0.8172
2023-12-06 21:50:26,273 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:51:18,196 - INFO - Epoch(train)[50/100][20/58]lr: 1.8352e-04  eta: 2:7:7  time: 51.9232  inter_cls_loss: 0.0608 inner_cls_loss: 2.3221
2023-12-06 21:51:52,465 - INFO - Epoch(train)[50/100][40/58]lr: 1.8352e-04  eta: 1:44:47  time: 86.1885  inter_cls_loss: 0.0584 inner_cls_loss: 2.3256
2023-12-06 21:52:20,463 - INFO - Epoch(test) test/all/:
2023-12-06 21:53:06,521 - INFO - Epoch(test) : [20/31]
2023-12-06 21:53:24,761 - INFO - Metrics for ship: Accuracy: 0.9616, Precision: 0.8865, Recall: 0.8825, F1_score: 0.8845, Average_Precision: 0.9444
2023-12-06 21:53:24,792 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:54:08,713 - INFO - Epoch(test) : [20/26]
2023-12-06 21:54:19,214 - INFO - Metrics for ship: Accuracy: 0.9644, Precision: 0.9483, Recall: 0.9495, F1_score: 0.9489, Average_Precision: 0.9809
2023-12-06 21:54:19,226 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:54:36,723 - INFO - Metrics for ship: Accuracy: 0.9467, Precision: 0.7170, Recall: 0.8426, F1_score: 0.7747, Average_Precision: 0.8220
2023-12-06 21:54:37,963 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:55:31,122 - INFO - Epoch(train)[51/100][20/58]lr: 1.5498e-04  eta: 2:7:23  time: 53.0815  inter_cls_loss: 0.0515 inner_cls_loss: 2.2126
2023-12-06 21:56:04,467 - INFO - Epoch(train)[51/100][40/58]lr: 1.5498e-04  eta: 1:42:59  time: 86.4262  inter_cls_loss: 0.0769 inner_cls_loss: 2.3814
2023-12-06 21:56:33,545 - INFO - Epoch(test) test/all/:
2023-12-06 21:57:19,224 - INFO - Epoch(test) : [20/31]
2023-12-06 21:57:37,685 - INFO - Metrics for ship: Accuracy: 0.9616, Precision: 0.8834, Recall: 0.8862, F1_score: 0.8848, Average_Precision: 0.9435
2023-12-06 21:57:37,718 - INFO - Epoch(test) test/offshore/:
2023-12-06 21:58:21,585 - INFO - Epoch(test) : [20/26]
2023-12-06 21:58:31,822 - INFO - Metrics for ship: Accuracy: 0.9644, Precision: 0.9473, Recall: 0.9506, F1_score: 0.9489, Average_Precision: 0.9797
2023-12-06 21:58:31,827 - INFO - Epoch(test) test/inshore/:
2023-12-06 21:58:48,880 - INFO - Metrics for ship: Accuracy: 0.9479, Precision: 0.7240, Recall: 0.8423, F1_score: 0.7787, Average_Precision: 0.8253
2023-12-06 21:58:50,029 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 21:59:41,142 - INFO - Epoch(train)[52/100][20/58]lr: 1.2860e-04  eta: 2:0:11  time: 51.1074  inter_cls_loss: 0.0347 inner_cls_loss: 2.0327
2023-12-06 22:00:17,459 - INFO - Epoch(train)[52/100][40/58]lr: 1.2860e-04  eta: 1:42:4  time: 87.4293  inter_cls_loss: 0.0473 inner_cls_loss: 2.1293
2023-12-06 22:00:46,509 - INFO - Epoch(test) test/all/:
2023-12-06 22:01:32,722 - INFO - Epoch(test) : [20/31]
2023-12-06 22:01:51,123 - INFO - Metrics for ship: Accuracy: 0.9618, Precision: 0.8920, Recall: 0.8765, F1_score: 0.8842, Average_Precision: 0.9434
2023-12-06 22:01:51,162 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:02:35,435 - INFO - Epoch(test) : [20/26]
2023-12-06 22:02:46,311 - INFO - Metrics for ship: Accuracy: 0.9638, Precision: 0.9501, Recall: 0.9457, F1_score: 0.9479, Average_Precision: 0.9801
2023-12-06 22:02:46,315 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:03:03,371 - INFO - Metrics for ship: Accuracy: 0.9494, Precision: 0.7361, Recall: 0.8338, F1_score: 0.7819, Average_Precision: 0.8227
2023-12-06 22:03:04,485 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:03:56,357 - INFO - Epoch(train)[53/100][20/58]lr: 1.0454e-04  eta: 1:59:28  time: 51.8696  inter_cls_loss: 0.0640 inner_cls_loss: 2.2944
2023-12-06 22:04:29,392 - INFO - Epoch(train)[53/100][40/58]lr: 1.0454e-04  eta: 1:37:4  time: 84.9062  inter_cls_loss: 0.0323 inner_cls_loss: 2.0184
2023-12-06 22:04:59,781 - INFO - Epoch(test) test/all/:
2023-12-06 22:05:45,972 - INFO - Epoch(test) : [20/31]
2023-12-06 22:06:03,617 - INFO - Metrics for ship: Accuracy: 0.9610, Precision: 0.8761, Recall: 0.8920, F1_score: 0.8840, Average_Precision: 0.9425
2023-12-06 22:06:03,655 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:06:47,119 - INFO - Epoch(test) : [20/26]
2023-12-06 22:06:57,968 - INFO - Metrics for ship: Accuracy: 0.9650, Precision: 0.9478, Recall: 0.9519, F1_score: 0.9499, Average_Precision: 0.9799
2023-12-06 22:06:57,974 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:07:15,570 - INFO - Metrics for ship: Accuracy: 0.9451, Precision: 0.7046, Recall: 0.8527, F1_score: 0.7716, Average_Precision: 0.8202
2023-12-06 22:07:16,793 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:08:08,704 - INFO - Epoch(train)[54/100][20/58]lr: 8.2943e-05  eta: 1:57:2  time: 51.9068  inter_cls_loss: 0.0241 inner_cls_loss: 1.9469
2023-12-06 22:08:42,343 - INFO - Epoch(train)[54/100][40/58]lr: 8.2943e-05  eta: 1:35:44  time: 85.5440  inter_cls_loss: 0.0437 inner_cls_loss: 2.0556
2023-12-06 22:09:12,467 - INFO - Epoch(test) test/all/:
2023-12-06 22:09:58,950 - INFO - Epoch(test) : [20/31]
2023-12-06 22:10:16,739 - INFO - Metrics for ship: Accuracy: 0.9617, Precision: 0.8822, Recall: 0.8887, F1_score: 0.8854, Average_Precision: 0.9426
2023-12-06 22:10:16,799 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:10:59,834 - INFO - Epoch(test) : [20/26]
2023-12-06 22:11:10,848 - INFO - Metrics for ship: Accuracy: 0.9645, Precision: 0.9438, Recall: 0.9547, F1_score: 0.9492, Average_Precision: 0.9788
2023-12-06 22:11:10,851 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:11:28,278 - INFO - Metrics for ship: Accuracy: 0.9460, Precision: 0.7101, Recall: 0.8513, F1_score: 0.7743, Average_Precision: 0.8186
2023-12-06 22:11:29,444 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:12:20,664 - INFO - Epoch(train)[55/100][20/58]lr: 6.3952e-05  eta: 1:53:1  time: 51.2183  inter_cls_loss: 0.0530 inner_cls_loss: 2.1188
2023-12-06 22:12:54,735 - INFO - Epoch(train)[55/100][40/58]lr: 6.3952e-05  eta: 1:33:23  time: 85.2898  inter_cls_loss: 0.0314 inner_cls_loss: 1.9812
2023-12-06 22:13:24,575 - INFO - Epoch(test) test/all/:
2023-12-06 22:14:10,846 - INFO - Epoch(test) : [20/31]
2023-12-06 22:14:28,708 - INFO - Metrics for ship: Accuracy: 0.9622, Precision: 0.8870, Recall: 0.8860, F1_score: 0.8865, Average_Precision: 0.9430
2023-12-06 22:14:28,737 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:15:11,222 - INFO - Epoch(test) : [20/26]
2023-12-06 22:15:21,862 - INFO - Metrics for ship: Accuracy: 0.9645, Precision: 0.9463, Recall: 0.9519, F1_score: 0.9491, Average_Precision: 0.9789
2023-12-06 22:15:21,865 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:15:39,137 - INFO - Metrics for ship: Accuracy: 0.9473, Precision: 0.7187, Recall: 0.8469, F1_score: 0.7776, Average_Precision: 0.8198
2023-12-06 22:15:40,313 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:16:31,157 - INFO - Epoch(train)[56/100][20/58]lr: 4.7680e-05  eta: 1:49:44  time: 50.8428  inter_cls_loss: 0.0324 inner_cls_loss: 1.9958
2023-12-06 22:17:04,233 - INFO - Epoch(train)[56/100][40/58]lr: 4.7680e-05  eta: 1:29:51  time: 83.9184  inter_cls_loss: 0.0308 inner_cls_loss: 1.9729
2023-12-06 22:17:33,476 - INFO - Epoch(test) test/all/:
2023-12-06 22:18:19,038 - INFO - Epoch(test) : [20/31]
2023-12-06 22:18:36,472 - INFO - Metrics for ship: Accuracy: 0.9621, Precision: 0.8831, Recall: 0.8902, F1_score: 0.8866, Average_Precision: 0.9427
2023-12-06 22:18:36,502 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:19:19,332 - INFO - Epoch(test) : [20/26]
2023-12-06 22:19:29,425 - INFO - Metrics for ship: Accuracy: 0.9648, Precision: 0.9462, Recall: 0.9529, F1_score: 0.9495, Average_Precision: 0.9783
2023-12-06 22:19:29,428 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:19:46,775 - INFO - Metrics for ship: Accuracy: 0.9468, Precision: 0.7150, Recall: 0.8502, F1_score: 0.7768, Average_Precision: 0.8195
2023-12-06 22:19:47,896 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:20:39,105 - INFO - Epoch(train)[57/100][20/58]lr: 3.4227e-05  eta: 1:48:2  time: 51.2081  inter_cls_loss: 0.0463 inner_cls_loss: 2.0854
2023-12-06 22:21:12,354 - INFO - Epoch(train)[57/100][40/58]lr: 3.4227e-05  eta: 1:28:23  time: 84.4539  inter_cls_loss: 0.0349 inner_cls_loss: 1.9792
2023-12-06 22:21:41,675 - INFO - Epoch(test) test/all/:
2023-12-06 22:22:28,295 - INFO - Epoch(test) : [20/31]
2023-12-06 22:22:45,907 - INFO - Metrics for ship: Accuracy: 0.9625, Precision: 0.8879, Recall: 0.8866, F1_score: 0.8872, Average_Precision: 0.9426
2023-12-06 22:22:45,943 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:23:30,471 - INFO - Epoch(test) : [20/26]
2023-12-06 22:23:40,789 - INFO - Metrics for ship: Accuracy: 0.9647, Precision: 0.9472, Recall: 0.9517, F1_score: 0.9495, Average_Precision: 0.9783
2023-12-06 22:23:40,794 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:23:58,242 - INFO - Metrics for ship: Accuracy: 0.9480, Precision: 0.7245, Recall: 0.8428, F1_score: 0.7792, Average_Precision: 0.8188
2023-12-06 22:23:59,423 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:24:51,107 - INFO - Epoch(train)[58/100][20/58]lr: 2.3677e-05  eta: 1:46:33  time: 51.6823  inter_cls_loss: 0.0333 inner_cls_loss: 1.9265
2023-12-06 22:25:24,531 - INFO - Epoch(train)[58/100][40/58]lr: 2.3677e-05  eta: 1:27:1  time: 85.1061  inter_cls_loss: 0.0506 inner_cls_loss: 2.1441
2023-12-06 22:25:53,703 - INFO - Epoch(test) test/all/:
2023-12-06 22:26:39,711 - INFO - Epoch(test) : [20/31]
2023-12-06 22:26:57,410 - INFO - Metrics for ship: Accuracy: 0.9623, Precision: 0.8843, Recall: 0.8901, F1_score: 0.8872, Average_Precision: 0.9425
2023-12-06 22:26:57,444 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:27:41,989 - INFO - Epoch(test) : [20/26]
2023-12-06 22:27:52,744 - INFO - Metrics for ship: Accuracy: 0.9647, Precision: 0.9458, Recall: 0.9531, F1_score: 0.9495, Average_Precision: 0.9780
2023-12-06 22:27:52,747 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:28:10,404 - INFO - Metrics for ship: Accuracy: 0.9472, Precision: 0.7179, Recall: 0.8477, F1_score: 0.7774, Average_Precision: 0.8167
2023-12-06 22:28:11,539 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:29:04,046 - INFO - Epoch(train)[59/100][20/58]lr: 1.6094e-05  eta: 1:45:42  time: 52.5072  inter_cls_loss: 0.0389 inner_cls_loss: 1.9846
2023-12-06 22:29:38,402 - INFO - Epoch(train)[59/100][40/58]lr: 1.6094e-05  eta: 1:26:43  time: 86.8617  inter_cls_loss: 0.0387 inner_cls_loss: 1.9390
2023-12-06 22:30:07,476 - INFO - Epoch(test) test/all/:
2023-12-06 22:30:54,078 - INFO - Epoch(test) : [20/31]
2023-12-06 22:31:11,523 - INFO - Metrics for ship: Accuracy: 0.9624, Precision: 0.8849, Recall: 0.8902, F1_score: 0.8875, Average_Precision: 0.9424
2023-12-06 22:31:11,555 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:31:55,625 - INFO - Epoch(test) : [20/26]
2023-12-06 22:32:06,140 - INFO - Metrics for ship: Accuracy: 0.9645, Precision: 0.9453, Recall: 0.9531, F1_score: 0.9492, Average_Precision: 0.9778
2023-12-06 22:32:06,143 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:32:23,383 - INFO - Metrics for ship: Accuracy: 0.9476, Precision: 0.7210, Recall: 0.8465, F1_score: 0.7788, Average_Precision: 0.8176
2023-12-06 22:32:24,481 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:33:16,850 - INFO - Epoch(train)[60/100][20/58]lr: 1.1526e-05  eta: 1:42:53  time: 52.3645  inter_cls_loss: 0.0764 inner_cls_loss: 2.3696
2023-12-06 22:33:50,782 - INFO - Epoch(train)[60/100][40/58]lr: 1.1526e-05  eta: 1:24:4  time: 86.2995  inter_cls_loss: 0.0328 inner_cls_loss: 1.9130
2023-12-06 22:34:20,882 - INFO - Epoch(test) test/all/:
2023-12-06 22:35:06,531 - INFO - Epoch(test) : [20/31]
2023-12-06 22:35:23,762 - INFO - Metrics for ship: Accuracy: 0.9625, Precision: 0.8857, Recall: 0.8896, F1_score: 0.8876, Average_Precision: 0.9423
2023-12-06 22:35:23,791 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:36:06,799 - INFO - Epoch(test) : [20/26]
2023-12-06 22:36:17,475 - INFO - Metrics for ship: Accuracy: 0.9647, Precision: 0.9467, Recall: 0.9523, F1_score: 0.9495, Average_Precision: 0.9782
2023-12-06 22:36:17,477 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:36:34,695 - INFO - Metrics for ship: Accuracy: 0.9476, Precision: 0.7204, Recall: 0.8474, F1_score: 0.7788, Average_Precision: 0.8180
2023-12-06 22:36:35,727 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:37:25,982 - INFO - Epoch(train)[61/100][20/58]lr: 1.0000e-03  eta: 1:36:12  time: 50.1930  inter_cls_loss: 0.0814 inner_cls_loss: 2.4182
2023-12-06 22:38:00,388 - INFO - Epoch(train)[61/100][40/58]lr: 1.0000e-03  eta: 1:20:22  time: 84.6026  inter_cls_loss: 0.1026 inner_cls_loss: 2.6298
2023-12-06 22:38:29,755 - INFO - Epoch(test) test/all/:
2023-12-06 22:39:14,768 - INFO - Epoch(test) : [20/31]
2023-12-06 22:39:32,144 - INFO - Metrics for ship: Accuracy: 0.9500, Precision: 0.8095, Recall: 0.9153, F1_score: 0.8591, Average_Precision: 0.9329
2023-12-06 22:39:32,187 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:40:15,553 - INFO - Epoch(test) : [20/26]
2023-12-06 22:40:26,119 - INFO - Metrics for ship: Accuracy: 0.9619, Precision: 0.9226, Recall: 0.9719, F1_score: 0.9466, Average_Precision: 0.9772
2023-12-06 22:40:26,122 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:40:43,508 - INFO - Metrics for ship: Accuracy: 0.9212, Precision: 0.5917, Recall: 0.8894, F1_score: 0.7106, Average_Precision: 0.7669
2023-12-06 22:40:44,636 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:41:36,362 - INFO - Epoch(train)[62/100][20/58]lr: 9.9962e-04  eta: 1:36:38  time: 51.7243  inter_cls_loss: 0.0867 inner_cls_loss: 2.2194
2023-12-06 22:42:10,973 - INFO - Epoch(train)[62/100][40/58]lr: 9.9962e-04  eta: 1:19:55  time: 86.3335  inter_cls_loss: 0.0908 inner_cls_loss: 2.0934
2023-12-06 22:42:41,402 - INFO - Epoch(test) test/all/:
2023-12-06 22:43:27,949 - INFO - Epoch(test) : [20/31]
2023-12-06 22:43:44,877 - INFO - Metrics for ship: Accuracy: 0.9573, Precision: 0.8917, Recall: 0.8463, F1_score: 0.8684, Average_Precision: 0.9376
2023-12-06 22:43:44,910 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:44:29,355 - INFO - Epoch(test) : [20/26]
2023-12-06 22:44:38,966 - INFO - Metrics for ship: Accuracy: 0.9652, Precision: 0.9594, Recall: 0.9397, F1_score: 0.9495, Average_Precision: 0.9841
2023-12-06 22:44:38,970 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:44:56,488 - INFO - Metrics for ship: Accuracy: 0.9494, Precision: 0.7578, Recall: 0.7860, F1_score: 0.7716, Average_Precision: 0.8195
2023-12-06 22:44:57,707 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:45:49,233 - INFO - Epoch(train)[63/100][20/58]lr: 9.9847e-04  eta: 1:33:46  time: 51.5248  inter_cls_loss: 0.0814 inner_cls_loss: 2.0096
2023-12-06 22:46:23,250 - INFO - Epoch(train)[63/100][40/58]lr: 9.9847e-04  eta: 1:17:7  time: 85.5416  inter_cls_loss: 0.1407 inner_cls_loss: 2.3701
2023-12-06 22:46:53,200 - INFO - Epoch(test) test/all/:
2023-12-06 22:47:38,751 - INFO - Epoch(test) : [20/31]
2023-12-06 22:47:56,535 - INFO - Metrics for ship: Accuracy: 0.9517, Precision: 0.8227, Recall: 0.9047, F1_score: 0.8617, Average_Precision: 0.9327
2023-12-06 22:47:56,567 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:48:39,708 - INFO - Epoch(test) : [20/26]
2023-12-06 22:48:50,062 - INFO - Metrics for ship: Accuracy: 0.9635, Precision: 0.9329, Recall: 0.9646, F1_score: 0.9485, Average_Precision: 0.9758
2023-12-06 22:48:50,068 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:49:07,581 - INFO - Metrics for ship: Accuracy: 0.9220, Precision: 0.5970, Recall: 0.8718, F1_score: 0.7087, Average_Precision: 0.7536
2023-12-06 22:49:08,695 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:49:59,425 - INFO - Epoch(train)[64/100][20/58]lr: 9.9657e-04  eta: 1:29:52  time: 50.7258  inter_cls_loss: 0.1014 inner_cls_loss: 1.9843
2023-12-06 22:50:33,891 - INFO - Epoch(train)[64/100][40/58]lr: 9.9657e-04  eta: 1:14:45  time: 85.1943  inter_cls_loss: 0.0642 inner_cls_loss: 1.6322
2023-12-06 22:51:04,567 - INFO - Epoch(test) test/all/:
2023-12-06 22:51:50,957 - INFO - Epoch(test) : [20/31]
2023-12-06 22:52:08,690 - INFO - Metrics for ship: Accuracy: 0.9587, Precision: 0.8662, Recall: 0.8890, F1_score: 0.8775, Average_Precision: 0.9432
2023-12-06 22:52:08,722 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:52:53,163 - INFO - Epoch(test) : [20/26]
2023-12-06 22:53:03,109 - INFO - Metrics for ship: Accuracy: 0.9645, Precision: 0.9350, Recall: 0.9653, F1_score: 0.9499, Average_Precision: 0.9813
2023-12-06 22:53:03,113 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:53:20,347 - INFO - Metrics for ship: Accuracy: 0.9421, Precision: 0.6891, Recall: 0.8525, F1_score: 0.7621, Average_Precision: 0.8162
2023-12-06 22:53:21,441 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:54:13,745 - INFO - Epoch(train)[65/100][20/58]lr: 9.9391e-04  eta: 1:30:7  time: 52.2975  inter_cls_loss: 0.0348 inner_cls_loss: 1.4463
2023-12-06 22:54:47,084 - INFO - Epoch(train)[65/100][40/58]lr: 9.9391e-04  eta: 1:13:4  time: 85.6405  inter_cls_loss: 0.0685 inner_cls_loss: 1.5600
2023-12-06 22:55:17,247 - INFO - Epoch(test) test/all/:
2023-12-06 22:56:02,850 - INFO - Epoch(test) : [20/31]
2023-12-06 22:56:20,862 - INFO - Metrics for ship: Accuracy: 0.9582, Precision: 0.8567, Recall: 0.8994, F1_score: 0.8776, Average_Precision: 0.9446
2023-12-06 22:56:20,898 - INFO - Epoch(test) test/offshore/:
2023-12-06 22:57:05,034 - INFO - Epoch(test) : [20/26]
2023-12-06 22:57:15,565 - INFO - Metrics for ship: Accuracy: 0.9644, Precision: 0.9398, Recall: 0.9593, F1_score: 0.9494, Average_Precision: 0.9823
2023-12-06 22:57:15,569 - INFO - Epoch(test) test/inshore/:
2023-12-06 22:57:32,880 - INFO - Metrics for ship: Accuracy: 0.9446, Precision: 0.7014, Recall: 0.8549, F1_score: 0.7705, Average_Precision: 0.8389
2023-12-06 22:57:34,024 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 22:57:34,083 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 0cb65572ad1da58d2ee497e68d5f6300, with test/inshore/ image AP 0.8389
2023-12-06 22:58:24,026 - INFO - Epoch(train)[66/100][20/58]lr: 9.9049e-04  eta: 1:23:38  time: 49.9389  inter_cls_loss: 0.0482 inner_cls_loss: 1.3556
2023-12-06 22:58:58,576 - INFO - Epoch(train)[66/100][40/58]lr: 9.9049e-04  eta: 1:10:3  time: 84.4871  inter_cls_loss: 0.0471 inner_cls_loss: 1.3677
2023-12-06 22:59:27,197 - INFO - Epoch(test) test/all/:
2023-12-06 23:00:12,317 - INFO - Epoch(test) : [20/31]
2023-12-06 23:00:30,139 - INFO - Metrics for ship: Accuracy: 0.9592, Precision: 0.8869, Recall: 0.8654, F1_score: 0.8760, Average_Precision: 0.9434
2023-12-06 23:00:30,170 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:01:12,153 - INFO - Epoch(test) : [20/26]
2023-12-06 23:01:22,921 - INFO - Metrics for ship: Accuracy: 0.9631, Precision: 0.9346, Recall: 0.9613, F1_score: 0.9478, Average_Precision: 0.9804
2023-12-06 23:01:22,924 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:01:40,194 - INFO - Metrics for ship: Accuracy: 0.9422, Precision: 0.6952, Recall: 0.8346, F1_score: 0.7585, Average_Precision: 0.8147
2023-12-06 23:01:41,340 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:02:32,899 - INFO - Epoch(train)[67/100][20/58]lr: 9.8632e-04  eta: 1:23:52  time: 51.5587  inter_cls_loss: 0.0496 inner_cls_loss: 1.3636
2023-12-06 23:03:05,695 - INFO - Epoch(train)[67/100][40/58]lr: 9.8632e-04  eta: 1:7:54  time: 84.3494  inter_cls_loss: 0.0751 inner_cls_loss: 1.3983
2023-12-06 23:03:34,600 - INFO - Epoch(test) test/all/:
2023-12-06 23:04:20,038 - INFO - Epoch(test) : [20/31]
2023-12-06 23:04:38,191 - INFO - Metrics for ship: Accuracy: 0.9537, Precision: 0.8599, Recall: 0.8626, F1_score: 0.8612, Average_Precision: 0.9329
2023-12-06 23:04:38,226 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:05:20,766 - INFO - Epoch(test) : [20/26]
2023-12-06 23:05:30,588 - INFO - Metrics for ship: Accuracy: 0.9629, Precision: 0.9634, Recall: 0.9286, F1_score: 0.9457, Average_Precision: 0.9850
2023-12-06 23:05:30,591 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:05:47,578 - INFO - Metrics for ship: Accuracy: 0.9421, Precision: 0.6963, Recall: 0.8296, F1_score: 0.7572, Average_Precision: 0.8200
2023-12-06 23:05:48,669 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:06:38,092 - INFO - Epoch(train)[68/100][20/58]lr: 9.8142e-04  eta: 1:18:0  time: 49.4216  inter_cls_loss: 0.1092 inner_cls_loss: 1.4816
2023-12-06 23:07:12,543 - INFO - Epoch(train)[68/100][40/58]lr: 9.8142e-04  eta: 1:5:29  time: 83.8716  inter_cls_loss: 0.0754 inner_cls_loss: 1.2752
2023-12-06 23:07:41,573 - INFO - Epoch(test) test/all/:
2023-12-06 23:08:27,216 - INFO - Epoch(test) : [20/31]
2023-12-06 23:08:44,484 - INFO - Metrics for ship: Accuracy: 0.9612, Precision: 0.9002, Recall: 0.8625, F1_score: 0.8810, Average_Precision: 0.9452
2023-12-06 23:08:44,518 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:09:26,472 - INFO - Epoch(test) : [20/26]
2023-12-06 23:09:36,849 - INFO - Metrics for ship: Accuracy: 0.9613, Precision: 0.9643, Recall: 0.9231, F1_score: 0.9432, Average_Precision: 0.9855
2023-12-06 23:09:36,852 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:09:54,165 - INFO - Metrics for ship: Accuracy: 0.9518, Precision: 0.7631, Recall: 0.8080, F1_score: 0.7849, Average_Precision: 0.8347
2023-12-06 23:09:55,285 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:10:46,164 - INFO - Epoch(train)[69/100][20/58]lr: 9.7577e-04  eta: 1:17:50  time: 50.8789  inter_cls_loss: 0.0519 inner_cls_loss: 1.1194
2023-12-06 23:11:18,853 - INFO - Epoch(train)[69/100][40/58]lr: 9.7577e-04  eta: 1:3:13  time: 83.5677  inter_cls_loss: 0.0702 inner_cls_loss: 1.1895
2023-12-06 23:11:54,663 - INFO - Epoch(test) test/all/:
2023-12-06 23:12:41,710 - INFO - Epoch(test) : [20/31]
2023-12-06 23:12:59,257 - INFO - Metrics for ship: Accuracy: 0.9604, Precision: 0.8641, Recall: 0.9044, F1_score: 0.8838, Average_Precision: 0.9474
2023-12-06 23:12:59,287 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:13:42,500 - INFO - Epoch(test) : [20/26]
2023-12-06 23:13:52,980 - INFO - Metrics for ship: Accuracy: 0.9652, Precision: 0.9437, Recall: 0.9570, F1_score: 0.9503, Average_Precision: 0.9836
2023-12-06 23:13:52,984 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:14:09,618 - INFO - Metrics for ship: Accuracy: 0.9434, Precision: 0.6931, Recall: 0.8612, F1_score: 0.7680, Average_Precision: 0.8343
2023-12-06 23:14:10,649 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:15:01,980 - INFO - Epoch(train)[70/100][20/58]lr: 9.6940e-04  eta: 1:16:3  time: 51.3287  inter_cls_loss: 0.0338 inner_cls_loss: 0.9814
2023-12-06 23:15:35,650 - INFO - Epoch(train)[70/100][40/58]lr: 9.6940e-04  eta: 1:2:15  time: 84.9969  inter_cls_loss: 0.0444 inner_cls_loss: 0.9844
2023-12-06 23:16:05,380 - INFO - Epoch(test) test/all/:
2023-12-06 23:16:49,941 - INFO - Epoch(test) : [20/31]
2023-12-06 23:17:07,110 - INFO - Metrics for ship: Accuracy: 0.9627, Precision: 0.8869, Recall: 0.8891, F1_score: 0.8880, Average_Precision: 0.9480
2023-12-06 23:17:07,145 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:17:51,100 - INFO - Epoch(test) : [20/26]
2023-12-06 23:18:01,683 - INFO - Metrics for ship: Accuracy: 0.9666, Precision: 0.9542, Recall: 0.9496, F1_score: 0.9519, Average_Precision: 0.9847
2023-12-06 23:18:01,686 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:18:18,425 - INFO - Metrics for ship: Accuracy: 0.9496, Precision: 0.7324, Recall: 0.8466, F1_score: 0.7854, Average_Precision: 0.8355
2023-12-06 23:18:19,465 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:19:11,300 - INFO - Epoch(train)[71/100][20/58]lr: 9.6232e-04  eta: 1:14:12  time: 51.7723  inter_cls_loss: 0.0585 inner_cls_loss: 0.9752
2023-12-06 23:19:45,355 - INFO - Epoch(train)[71/100][40/58]lr: 9.6232e-04  eta: 1:0:47  time: 85.8272  inter_cls_loss: 0.0488 inner_cls_loss: 0.9301
2023-12-06 23:20:14,068 - INFO - Epoch(test) test/all/:
2023-12-06 23:20:59,503 - INFO - Epoch(test) : [20/31]
2023-12-06 23:21:17,169 - INFO - Metrics for ship: Accuracy: 0.9609, Precision: 0.8784, Recall: 0.8881, F1_score: 0.8832, Average_Precision: 0.9463
2023-12-06 23:21:17,198 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:22:00,145 - INFO - Epoch(test) : [20/26]
2023-12-06 23:22:10,881 - INFO - Metrics for ship: Accuracy: 0.9657, Precision: 0.9490, Recall: 0.9527, F1_score: 0.9509, Average_Precision: 0.9834
2023-12-06 23:22:10,885 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:22:27,477 - INFO - Metrics for ship: Accuracy: 0.9462, Precision: 0.7121, Recall: 0.8485, F1_score: 0.7743, Average_Precision: 0.8325
2023-12-06 23:22:28,589 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:23:19,409 - INFO - Epoch(train)[72/100][20/58]lr: 9.5453e-04  eta: 1:10:23  time: 50.8186  inter_cls_loss: 0.0344 inner_cls_loss: 0.8338
2023-12-06 23:23:52,443 - INFO - Epoch(train)[72/100][40/58]lr: 9.5453e-04  eta: 0:57:21  time: 83.8481  inter_cls_loss: 0.0631 inner_cls_loss: 0.9176
2023-12-06 23:24:23,182 - INFO - Epoch(test) test/all/:
2023-12-06 23:25:08,391 - INFO - Epoch(test) : [20/31]
2023-12-06 23:25:26,829 - INFO - Metrics for ship: Accuracy: 0.9617, Precision: 0.8829, Recall: 0.8879, F1_score: 0.8854, Average_Precision: 0.9492
2023-12-06 23:25:26,859 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:26:10,721 - INFO - Epoch(test) : [20/26]
2023-12-06 23:26:20,313 - INFO - Metrics for ship: Accuracy: 0.9664, Precision: 0.9604, Recall: 0.9425, F1_score: 0.9513, Average_Precision: 0.9849
2023-12-06 23:26:20,317 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:26:37,859 - INFO - Metrics for ship: Accuracy: 0.9517, Precision: 0.7446, Recall: 0.8462, F1_score: 0.7922, Average_Precision: 0.8496
2023-12-06 23:26:38,991 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:26:39,056 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 d3ae58ee015f3f92db8015ab6d77b129, with test/inshore/ image AP 0.8496
2023-12-06 23:27:30,735 - INFO - Epoch(train)[73/100][20/58]lr: 9.4605e-04  eta: 1:9:4  time: 51.6752  inter_cls_loss: 0.0355 inner_cls_loss: 0.7797
2023-12-06 23:28:05,904 - INFO - Epoch(train)[73/100][40/58]lr: 9.4605e-04  eta: 0:57:19  time: 86.8463  inter_cls_loss: 0.0638 inner_cls_loss: 0.8615
2023-12-06 23:28:34,557 - INFO - Epoch(test) test/all/:
2023-12-06 23:29:20,203 - INFO - Epoch(test) : [20/31]
2023-12-06 23:29:37,976 - INFO - Metrics for ship: Accuracy: 0.9606, Precision: 0.9205, Recall: 0.8356, F1_score: 0.8760, Average_Precision: 0.9468
2023-12-06 23:29:38,017 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:30:20,679 - INFO - Epoch(test) : [20/26]
2023-12-06 23:30:31,391 - INFO - Metrics for ship: Accuracy: 0.9606, Precision: 0.9592, Recall: 0.9263, F1_score: 0.9425, Average_Precision: 0.9827
2023-12-06 23:30:31,395 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:30:48,355 - INFO - Metrics for ship: Accuracy: 0.9533, Precision: 0.7850, Recall: 0.7868, F1_score: 0.7859, Average_Precision: 0.8357
2023-12-06 23:30:49,474 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:31:39,983 - INFO - Epoch(train)[74/100][20/58]lr: 9.3689e-04  eta: 1:5:4  time: 50.5082  inter_cls_loss: 0.0349 inner_cls_loss: 0.7252
2023-12-06 23:32:14,286 - INFO - Epoch(train)[74/100][40/58]lr: 9.3689e-04  eta: 0:53:55  time: 84.8116  inter_cls_loss: 0.0527 inner_cls_loss: 0.7352
2023-12-06 23:32:44,332 - INFO - Epoch(test) test/all/:
2023-12-06 23:33:30,577 - INFO - Epoch(test) : [20/31]
2023-12-06 23:33:48,700 - INFO - Metrics for ship: Accuracy: 0.9626, Precision: 0.8970, Recall: 0.8761, F1_score: 0.8865, Average_Precision: 0.9476
2023-12-06 23:33:48,729 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:34:33,291 - INFO - Epoch(test) : [20/26]
2023-12-06 23:34:43,691 - INFO - Metrics for ship: Accuracy: 0.9652, Precision: 0.9642, Recall: 0.9348, F1_score: 0.9493, Average_Precision: 0.9843
2023-12-06 23:34:43,696 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:35:01,182 - INFO - Metrics for ship: Accuracy: 0.9539, Precision: 0.7752, Recall: 0.8118, F1_score: 0.7931, Average_Precision: 0.8464
2023-12-06 23:35:02,348 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:35:54,207 - INFO - Epoch(train)[75/100][20/58]lr: 9.2706e-04  eta: 1:4:18  time: 51.8565  inter_cls_loss: 0.0304 inner_cls_loss: 0.6542
2023-12-06 23:36:29,532 - INFO - Epoch(train)[75/100][40/58]lr: 9.2706e-04  eta: 0:53:19  time: 87.1819  inter_cls_loss: 0.0552 inner_cls_loss: 0.7216
2023-12-06 23:36:58,830 - INFO - Epoch(test) test/all/:
2023-12-06 23:37:45,015 - INFO - Epoch(test) : [20/31]
2023-12-06 23:38:03,021 - INFO - Metrics for ship: Accuracy: 0.9587, Precision: 0.8429, Recall: 0.9240, F1_score: 0.8816, Average_Precision: 0.9490
2023-12-06 23:38:03,057 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:38:46,229 - INFO - Epoch(test) : [20/26]
2023-12-06 23:38:57,028 - INFO - Metrics for ship: Accuracy: 0.9660, Precision: 0.9376, Recall: 0.9668, F1_score: 0.9520, Average_Precision: 0.9807
2023-12-06 23:38:57,031 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:39:14,589 - INFO - Metrics for ship: Accuracy: 0.9411, Precision: 0.6755, Recall: 0.8831, F1_score: 0.7655, Average_Precision: 0.8283
2023-12-06 23:39:16,645 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:40:07,673 - INFO - Epoch(train)[76/100][20/58]lr: 9.1658e-04  eta: 1:0:48  time: 51.0269  inter_cls_loss: 0.0570 inner_cls_loss: 0.6924
2023-12-06 23:40:41,687 - INFO - Epoch(train)[76/100][40/58]lr: 9.1658e-04  eta: 0:49:57  time: 85.0404  inter_cls_loss: 0.0524 inner_cls_loss: 0.6817
2023-12-06 23:41:12,204 - INFO - Epoch(test) test/all/:
2023-12-06 23:41:57,813 - INFO - Epoch(test) : [20/31]
2023-12-06 23:42:15,968 - INFO - Metrics for ship: Accuracy: 0.9615, Precision: 0.8797, Recall: 0.8908, F1_score: 0.8852, Average_Precision: 0.9468
2023-12-06 23:42:15,999 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:43:00,078 - INFO - Epoch(test) : [20/26]
2023-12-06 23:43:11,088 - INFO - Metrics for ship: Accuracy: 0.9687, Precision: 0.9512, Recall: 0.9593, F1_score: 0.9553, Average_Precision: 0.9845
2023-12-06 23:43:11,091 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:43:28,624 - INFO - Metrics for ship: Accuracy: 0.9485, Precision: 0.7280, Recall: 0.8413, F1_score: 0.7805, Average_Precision: 0.8362
2023-12-06 23:43:29,674 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:44:19,400 - INFO - Epoch(train)[77/100][20/58]lr: 9.0546e-04  eta: 0:56:51  time: 49.7256  inter_cls_loss: 0.0411 inner_cls_loss: 0.5980
2023-12-06 23:44:55,335 - INFO - Epoch(train)[77/100][40/58]lr: 9.0546e-04  eta: 0:48:15  time: 85.6598  inter_cls_loss: 0.0327 inner_cls_loss: 0.5567
2023-12-06 23:45:24,838 - INFO - Epoch(test) test/all/:
2023-12-06 23:46:09,971 - INFO - Epoch(test) : [20/31]
2023-12-06 23:46:28,124 - INFO - Metrics for ship: Accuracy: 0.9606, Precision: 0.8643, Recall: 0.9056, F1_score: 0.8845, Average_Precision: 0.9470
2023-12-06 23:46:28,154 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:47:10,734 - INFO - Epoch(test) : [20/26]
2023-12-06 23:47:20,619 - INFO - Metrics for ship: Accuracy: 0.9671, Precision: 0.9481, Recall: 0.9578, F1_score: 0.9529, Average_Precision: 0.9839
2023-12-06 23:47:20,623 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:47:38,238 - INFO - Metrics for ship: Accuracy: 0.9486, Precision: 0.7212, Recall: 0.8597, F1_score: 0.7844, Average_Precision: 0.8415
2023-12-06 23:47:39,358 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:48:31,100 - INFO - Epoch(train)[78/100][20/58]lr: 8.9373e-04  eta: 0:56:39  time: 51.7407  inter_cls_loss: 0.0460 inner_cls_loss: 0.5656
2023-12-06 23:49:04,044 - INFO - Epoch(train)[78/100][40/58]lr: 8.9373e-04  eta: 0:45:39  time: 84.6849  inter_cls_loss: 0.0649 inner_cls_loss: 0.5970
2023-12-06 23:49:32,857 - INFO - Epoch(test) test/all/:
2023-12-06 23:50:17,157 - INFO - Epoch(test) : [20/31]
2023-12-06 23:50:34,916 - INFO - Metrics for ship: Accuracy: 0.9578, Precision: 0.8346, Recall: 0.9307, F1_score: 0.8800, Average_Precision: 0.9487
2023-12-06 23:50:34,946 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:51:17,442 - INFO - Epoch(test) : [20/26]
2023-12-06 23:51:27,533 - INFO - Metrics for ship: Accuracy: 0.9661, Precision: 0.9333, Recall: 0.9722, F1_score: 0.9523, Average_Precision: 0.9794
2023-12-06 23:51:27,539 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:51:44,300 - INFO - Metrics for ship: Accuracy: 0.9445, Precision: 0.6927, Recall: 0.8810, F1_score: 0.7756, Average_Precision: 0.8298
2023-12-06 23:51:45,362 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:52:35,346 - INFO - Epoch(train)[79/100][20/58]lr: 8.8140e-04  eta: 0:52:18  time: 49.9802  inter_cls_loss: 0.0585 inner_cls_loss: 0.6264
2023-12-06 23:53:08,772 - INFO - Epoch(train)[79/100][40/58]lr: 8.8140e-04  eta: 0:42:57  time: 83.4098  inter_cls_loss: 0.0249 inner_cls_loss: 0.4749
2023-12-06 23:53:38,606 - INFO - Epoch(test) test/all/:
2023-12-06 23:54:23,346 - INFO - Epoch(test) : [20/31]
2023-12-06 23:54:41,478 - INFO - Metrics for ship: Accuracy: 0.9617, Precision: 0.8752, Recall: 0.8980, F1_score: 0.8864, Average_Precision: 0.9478
2023-12-06 23:54:41,513 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:55:24,203 - INFO - Epoch(test) : [20/26]
2023-12-06 23:55:34,152 - INFO - Metrics for ship: Accuracy: 0.9668, Precision: 0.9583, Recall: 0.9459, F1_score: 0.9520, Average_Precision: 0.9818
2023-12-06 23:55:34,155 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:55:51,348 - INFO - Metrics for ship: Accuracy: 0.9477, Precision: 0.7162, Recall: 0.8601, F1_score: 0.7816, Average_Precision: 0.8340
2023-12-06 23:55:52,497 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-06 23:56:43,165 - INFO - Epoch(train)[80/100][20/58]lr: 8.6849e-04  eta: 0:50:34  time: 50.6655  inter_cls_loss: 0.0717 inner_cls_loss: 0.5402
2023-12-06 23:57:16,886 - INFO - Epoch(train)[80/100][40/58]lr: 8.6849e-04  eta: 0:41:25  time: 84.3849  inter_cls_loss: 0.0308 inner_cls_loss: 0.4465
2023-12-06 23:57:47,225 - INFO - Epoch(test) test/all/:
2023-12-06 23:58:32,106 - INFO - Epoch(test) : [20/31]
2023-12-06 23:58:50,143 - INFO - Metrics for ship: Accuracy: 0.9638, Precision: 0.8801, Recall: 0.9062, F1_score: 0.8929, Average_Precision: 0.9506
2023-12-06 23:58:50,179 - INFO - Epoch(test) test/offshore/:
2023-12-06 23:59:32,302 - INFO - Epoch(test) : [20/26]
2023-12-06 23:59:42,253 - INFO - Metrics for ship: Accuracy: 0.9684, Precision: 0.9516, Recall: 0.9578, F1_score: 0.9547, Average_Precision: 0.9826
2023-12-06 23:59:42,256 - INFO - Epoch(test) test/inshore/:
2023-12-06 23:59:59,472 - INFO - Metrics for ship: Accuracy: 0.9515, Precision: 0.7378, Recall: 0.8599, F1_score: 0.7942, Average_Precision: 0.8477
2023-12-07 00:00:00,603 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:00:51,981 - INFO - Epoch(train)[81/100][20/58]lr: 8.5502e-04  eta: 0:48:44  time: 51.3118  inter_cls_loss: 0.0231 inner_cls_loss: 0.3973
2023-12-07 00:01:27,125 - INFO - Epoch(train)[81/100][40/58]lr: 8.5502e-04  eta: 0:40:20  time: 86.4603  inter_cls_loss: 0.0378 inner_cls_loss: 0.4281
2023-12-07 00:01:56,210 - INFO - Epoch(test) test/all/:
2023-12-07 00:02:40,485 - INFO - Epoch(test) : [20/31]
2023-12-07 00:02:57,350 - INFO - Metrics for ship: Accuracy: 0.9648, Precision: 0.9089, Recall: 0.8762, F1_score: 0.8923, Average_Precision: 0.9524
2023-12-07 00:02:57,380 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:03:39,726 - INFO - Epoch(test) : [20/26]
2023-12-07 00:03:49,472 - INFO - Metrics for ship: Accuracy: 0.9653, Precision: 0.9578, Recall: 0.9418, F1_score: 0.9497, Average_Precision: 0.9832
2023-12-07 00:03:49,475 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:04:06,564 - INFO - Metrics for ship: Accuracy: 0.9554, Precision: 0.7733, Recall: 0.8355, F1_score: 0.8032, Average_Precision: 0.8477
2023-12-07 00:04:07,743 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:04:57,621 - INFO - Epoch(train)[82/100][20/58]lr: 8.4101e-04  eta: 0:44:58  time: 49.8712  inter_cls_loss: 0.0428 inner_cls_loss: 0.4260
2023-12-07 00:05:30,738 - INFO - Epoch(train)[82/100][40/58]lr: 8.4101e-04  eta: 0:36:43  time: 82.9878  inter_cls_loss: 0.0363 inner_cls_loss: 0.4024
2023-12-07 00:05:59,386 - INFO - Epoch(test) test/all/:
2023-12-07 00:06:43,950 - INFO - Epoch(test) : [20/31]
2023-12-07 00:07:01,059 - INFO - Metrics for ship: Accuracy: 0.9637, Precision: 0.8930, Recall: 0.8881, F1_score: 0.8906, Average_Precision: 0.9487
2023-12-07 00:07:01,089 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:07:44,902 - INFO - Epoch(test) : [20/26]
2023-12-07 00:07:54,138 - INFO - Metrics for ship: Accuracy: 0.9672, Precision: 0.9641, Recall: 0.9408, F1_score: 0.9523, Average_Precision: 0.9835
2023-12-07 00:07:54,141 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:08:11,241 - INFO - Metrics for ship: Accuracy: 0.9561, Precision: 0.7754, Recall: 0.8397, F1_score: 0.8063, Average_Precision: 0.8515
2023-12-07 00:08:12,374 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:08:12,444 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 0fdd539b7f2edefeb65e46c80f06f10b, with test/inshore/ image AP 0.8515
2023-12-07 00:09:04,023 - INFO - Epoch(train)[83/100][20/58]lr: 8.2648e-04  eta: 0:44:0  time: 51.5757  inter_cls_loss: 0.0331 inner_cls_loss: 0.3588
2023-12-07 00:09:36,595 - INFO - Epoch(train)[83/100][40/58]lr: 8.2648e-04  eta: 0:35:12  time: 84.1488  inter_cls_loss: 0.0303 inner_cls_loss: 0.3438
2023-12-07 00:10:06,640 - INFO - Epoch(test) test/all/:
2023-12-07 00:10:52,033 - INFO - Epoch(test) : [20/31]
2023-12-07 00:11:10,058 - INFO - Metrics for ship: Accuracy: 0.9633, Precision: 0.8738, Recall: 0.9111, F1_score: 0.8920, Average_Precision: 0.9508
2023-12-07 00:11:10,086 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:11:53,096 - INFO - Epoch(test) : [20/26]
2023-12-07 00:12:03,538 - INFO - Metrics for ship: Accuracy: 0.9681, Precision: 0.9507, Recall: 0.9582, F1_score: 0.9544, Average_Precision: 0.9831
2023-12-07 00:12:03,541 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:12:21,084 - INFO - Metrics for ship: Accuracy: 0.9515, Precision: 0.7338, Recall: 0.8697, F1_score: 0.7960, Average_Precision: 0.8414
2023-12-07 00:12:22,203 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:13:14,261 - INFO - Epoch(train)[84/100][20/58]lr: 8.1145e-04  eta: 0:41:54  time: 52.0517  inter_cls_loss: 0.0350 inner_cls_loss: 0.3485
2023-12-07 00:13:48,098 - INFO - Epoch(train)[84/100][40/58]lr: 8.1145e-04  eta: 0:33:51  time: 85.8939  inter_cls_loss: 0.0403 inner_cls_loss: 0.3397
2023-12-07 00:14:17,766 - INFO - Epoch(test) test/all/:
2023-12-07 00:15:03,587 - INFO - Epoch(test) : [20/31]
2023-12-07 00:15:21,030 - INFO - Metrics for ship: Accuracy: 0.9631, Precision: 0.8695, Recall: 0.9159, F1_score: 0.8921, Average_Precision: 0.9518
2023-12-07 00:15:21,060 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:16:04,949 - INFO - Epoch(test) : [20/26]
2023-12-07 00:16:14,932 - INFO - Metrics for ship: Accuracy: 0.9693, Precision: 0.9505, Recall: 0.9618, F1_score: 0.9561, Average_Precision: 0.9823
2023-12-07 00:16:14,935 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:16:32,647 - INFO - Metrics for ship: Accuracy: 0.9506, Precision: 0.7295, Recall: 0.8679, F1_score: 0.7927, Average_Precision: 0.8514
2023-12-07 00:16:33,820 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:17:25,826 - INFO - Epoch(train)[85/100][20/58]lr: 7.9595e-04  eta: 0:39:20  time: 52.0041  inter_cls_loss: 0.0333 inner_cls_loss: 0.3327
2023-12-07 00:17:59,827 - INFO - Epoch(train)[85/100][40/58]lr: 7.9595e-04  eta: 0:31:49  time: 86.0055  inter_cls_loss: 0.0346 inner_cls_loss: 0.3162
2023-12-07 00:18:28,996 - INFO - Epoch(test) test/all/:
2023-12-07 00:19:14,553 - INFO - Epoch(test) : [20/31]
2023-12-07 00:19:32,340 - INFO - Metrics for ship: Accuracy: 0.9648, Precision: 0.8945, Recall: 0.8939, F1_score: 0.8942, Average_Precision: 0.9497
2023-12-07 00:19:32,376 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:20:15,780 - INFO - Epoch(test) : [20/26]
2023-12-07 00:20:26,340 - INFO - Metrics for ship: Accuracy: 0.9678, Precision: 0.9537, Recall: 0.9537, F1_score: 0.9537, Average_Precision: 0.9840
2023-12-07 00:20:26,343 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:20:43,757 - INFO - Metrics for ship: Accuracy: 0.9547, Precision: 0.7663, Recall: 0.8394, F1_score: 0.8012, Average_Precision: 0.8470
2023-12-07 00:20:44,857 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:21:34,626 - INFO - Epoch(train)[86/100][20/58]lr: 7.8001e-04  eta: 0:35:15  time: 49.7681  inter_cls_loss: 0.0333 inner_cls_loss: 0.2948
2023-12-07 00:22:10,388 - INFO - Epoch(train)[86/100][40/58]lr: 7.8001e-04  eta: 0:29:34  time: 85.5297  inter_cls_loss: 0.0413 inner_cls_loss: 0.2939
2023-12-07 00:22:38,589 - INFO - Epoch(test) test/all/:
2023-12-07 00:23:24,269 - INFO - Epoch(test) : [20/31]
2023-12-07 00:23:42,416 - INFO - Metrics for ship: Accuracy: 0.9649, Precision: 0.9006, Recall: 0.8874, F1_score: 0.8939, Average_Precision: 0.9514
2023-12-07 00:23:42,445 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:24:26,206 - INFO - Epoch(test) : [20/26]
2023-12-07 00:24:36,482 - INFO - Metrics for ship: Accuracy: 0.9652, Precision: 0.9542, Recall: 0.9453, F1_score: 0.9497, Average_Precision: 0.9832
2023-12-07 00:24:36,484 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:24:54,002 - INFO - Metrics for ship: Accuracy: 0.9556, Precision: 0.7760, Recall: 0.8328, F1_score: 0.8034, Average_Precision: 0.8502
2023-12-07 00:24:55,153 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:25:46,916 - INFO - Epoch(train)[87/100][20/58]lr: 7.6364e-04  eta: 0:34:9  time: 51.7606  inter_cls_loss: 0.0316 inner_cls_loss: 0.2758
2023-12-07 00:26:19,358 - INFO - Epoch(train)[87/100][40/58]lr: 7.6364e-04  eta: 0:27:5  time: 84.2047  inter_cls_loss: 0.0138 inner_cls_loss: 0.2425
2023-12-07 00:26:50,180 - INFO - Epoch(test) test/all/:
2023-12-07 00:27:35,765 - INFO - Epoch(test) : [20/31]
2023-12-07 00:27:53,756 - INFO - Metrics for ship: Accuracy: 0.9651, Precision: 0.8956, Recall: 0.8943, F1_score: 0.8950, Average_Precision: 0.9515
2023-12-07 00:27:53,786 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:28:36,708 - INFO - Epoch(test) : [20/26]
2023-12-07 00:28:47,708 - INFO - Metrics for ship: Accuracy: 0.9671, Precision: 0.9587, Recall: 0.9462, F1_score: 0.9524, Average_Precision: 0.9832
2023-12-07 00:28:47,713 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:29:04,642 - INFO - Metrics for ship: Accuracy: 0.9566, Precision: 0.7827, Recall: 0.8320, F1_score: 0.8066, Average_Precision: 0.8572
2023-12-07 00:29:05,791 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:29:05,847 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 87db9207811cd9504dcb1dabebfcc8ec, with test/inshore/ image AP 0.8572
2023-12-07 00:29:56,652 - INFO - Epoch(train)[88/100][20/58]lr: 7.4687e-04  eta: 0:31:4  time: 50.8004  inter_cls_loss: 0.0402 inner_cls_loss: 0.2681
2023-12-07 00:30:29,034 - INFO - Epoch(train)[88/100][40/58]lr: 7.4687e-04  eta: 0:24:44  time: 83.1826  inter_cls_loss: 0.0346 inner_cls_loss: 0.2611
2023-12-07 00:30:58,316 - INFO - Epoch(test) test/all/:
2023-12-07 00:31:42,974 - INFO - Epoch(test) : [20/31]
2023-12-07 00:32:00,435 - INFO - Metrics for ship: Accuracy: 0.9661, Precision: 0.9125, Recall: 0.8806, F1_score: 0.8963, Average_Precision: 0.9513
2023-12-07 00:32:00,469 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:32:43,309 - INFO - Epoch(test) : [20/26]
2023-12-07 00:32:53,744 - INFO - Metrics for ship: Accuracy: 0.9674, Precision: 0.9590, Recall: 0.9467, F1_score: 0.9528, Average_Precision: 0.9839
2023-12-07 00:32:53,749 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:33:10,614 - INFO - Metrics for ship: Accuracy: 0.9586, Precision: 0.8015, Recall: 0.8234, F1_score: 0.8123, Average_Precision: 0.8559
2023-12-07 00:33:11,678 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:34:03,697 - INFO - Epoch(train)[89/100][20/58]lr: 7.2973e-04  eta: 0:29:18  time: 52.0165  inter_cls_loss: 0.0180 inner_cls_loss: 0.2147
2023-12-07 00:34:36,132 - INFO - Epoch(train)[89/100][40/58]lr: 7.2973e-04  eta: 0:23:4  time: 84.4473  inter_cls_loss: 0.0480 inner_cls_loss: 0.2584
2023-12-07 00:35:05,134 - INFO - Epoch(test) test/all/:
2023-12-07 00:35:49,498 - INFO - Epoch(test) : [20/31]
2023-12-07 00:36:07,133 - INFO - Metrics for ship: Accuracy: 0.9664, Precision: 0.9066, Recall: 0.8897, F1_score: 0.8981, Average_Precision: 0.9522
2023-12-07 00:36:07,164 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:36:49,660 - INFO - Epoch(test) : [20/26]
2023-12-07 00:37:00,295 - INFO - Metrics for ship: Accuracy: 0.9680, Precision: 0.9631, Recall: 0.9444, F1_score: 0.9536, Average_Precision: 0.9844
2023-12-07 00:37:00,300 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:37:18,029 - INFO - Metrics for ship: Accuracy: 0.9581, Precision: 0.7947, Recall: 0.8293, F1_score: 0.8116, Average_Precision: 0.8557
2023-12-07 00:37:19,101 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:38:10,800 - INFO - Epoch(train)[90/100][20/58]lr: 7.1224e-04  eta: 0:26:37  time: 51.6940  inter_cls_loss: 0.0136 inner_cls_loss: 0.2100
2023-12-07 00:38:43,110 - INFO - Epoch(train)[90/100][40/58]lr: 7.1224e-04  eta: 0:20:55  time: 84.0070  inter_cls_loss: 0.0403 inner_cls_loss: 0.2426
2023-12-07 00:39:12,369 - INFO - Epoch(test) test/all/:
2023-12-07 00:39:57,354 - INFO - Epoch(test) : [20/31]
2023-12-07 00:40:14,803 - INFO - Metrics for ship: Accuracy: 0.9644, Precision: 0.8734, Recall: 0.9191, F1_score: 0.8957, Average_Precision: 0.9524
2023-12-07 00:40:14,839 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:40:58,019 - INFO - Epoch(test) : [20/26]
2023-12-07 00:41:08,509 - INFO - Metrics for ship: Accuracy: 0.9696, Precision: 0.9499, Recall: 0.9634, F1_score: 0.9566, Average_Precision: 0.9829
2023-12-07 00:41:08,513 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:41:26,199 - INFO - Metrics for ship: Accuracy: 0.9541, Precision: 0.7483, Recall: 0.8714, F1_score: 0.8051, Average_Precision: 0.8599
2023-12-07 00:41:27,273 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:41:27,331 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 3b47fbf656270224e79b52641c7da37a, with test/inshore/ image AP 0.8599
2023-12-07 00:42:18,634 - INFO - Epoch(train)[91/100][20/58]lr: 6.9443e-04  eta: 0:23:54  time: 51.2389  inter_cls_loss: 0.0237 inner_cls_loss: 0.1990
2023-12-07 00:42:52,938 - INFO - Epoch(train)[91/100][40/58]lr: 6.9443e-04  eta: 0:19:14  time: 85.5410  inter_cls_loss: 0.0288 inner_cls_loss: 0.2105
2023-12-07 00:43:21,598 - INFO - Epoch(test) test/all/:
2023-12-07 00:44:06,869 - INFO - Epoch(test) : [20/31]
2023-12-07 00:44:24,797 - INFO - Metrics for ship: Accuracy: 0.9649, Precision: 0.8861, Recall: 0.9059, F1_score: 0.8959, Average_Precision: 0.9519
2023-12-07 00:44:24,829 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:45:07,821 - INFO - Epoch(test) : [20/26]
2023-12-07 00:45:18,367 - INFO - Metrics for ship: Accuracy: 0.9679, Precision: 0.9569, Recall: 0.9506, F1_score: 0.9537, Average_Precision: 0.9838
2023-12-07 00:45:18,375 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:45:35,528 - INFO - Metrics for ship: Accuracy: 0.9527, Precision: 0.7433, Recall: 0.8643, F1_score: 0.7992, Average_Precision: 0.8376
2023-12-07 00:45:36,697 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:46:27,623 - INFO - Epoch(train)[92/100][20/58]lr: 6.7633e-04  eta: 0:21:18  time: 50.9222  inter_cls_loss: 0.0236 inner_cls_loss: 0.1864
2023-12-07 00:47:02,306 - INFO - Epoch(train)[92/100][40/58]lr: 6.7633e-04  eta: 0:17:11  time: 85.6063  inter_cls_loss: 0.0303 inner_cls_loss: 0.1913
2023-12-07 00:47:31,860 - INFO - Epoch(test) test/all/:
2023-12-07 00:48:17,320 - INFO - Epoch(test) : [20/31]
2023-12-07 00:48:35,910 - INFO - Metrics for ship: Accuracy: 0.9652, Precision: 0.8832, Recall: 0.9115, F1_score: 0.8971, Average_Precision: 0.9523
2023-12-07 00:48:35,940 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:49:18,986 - INFO - Epoch(test) : [20/26]
2023-12-07 00:49:29,577 - INFO - Metrics for ship: Accuracy: 0.9691, Precision: 0.9521, Recall: 0.9594, F1_score: 0.9557, Average_Precision: 0.9838
2023-12-07 00:49:29,580 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:49:47,228 - INFO - Metrics for ship: Accuracy: 0.9552, Precision: 0.7595, Recall: 0.8612, F1_score: 0.8071, Average_Precision: 0.8551
2023-12-07 00:49:48,363 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:50:40,176 - INFO - Epoch(train)[93/100][20/58]lr: 6.5796e-04  eta: 0:19:10  time: 51.8114  inter_cls_loss: 0.0291 inner_cls_loss: 0.1906
2023-12-07 00:51:13,697 - INFO - Epoch(train)[93/100][40/58]lr: 6.5796e-04  eta: 0:15:4  time: 85.3325  inter_cls_loss: 0.0229 inner_cls_loss: 0.1769
2023-12-07 00:51:42,186 - INFO - Epoch(test) test/all/:
2023-12-07 00:52:28,029 - INFO - Epoch(test) : [20/31]
2023-12-07 00:52:46,083 - INFO - Metrics for ship: Accuracy: 0.9651, Precision: 0.8998, Recall: 0.8895, F1_score: 0.8946, Average_Precision: 0.9516
2023-12-07 00:52:46,114 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:53:30,284 - INFO - Epoch(test) : [20/26]
2023-12-07 00:53:40,650 - INFO - Metrics for ship: Accuracy: 0.9687, Precision: 0.9558, Recall: 0.9543, F1_score: 0.9551, Average_Precision: 0.9833
2023-12-07 00:53:40,654 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:53:57,892 - INFO - Metrics for ship: Accuracy: 0.9561, Precision: 0.7803, Recall: 0.8306, F1_score: 0.8047, Average_Precision: 0.8519
2023-12-07 00:53:58,999 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:54:50,719 - INFO - Epoch(train)[94/100][20/58]lr: 6.3936e-04  eta: 0:16:38  time: 51.7186  inter_cls_loss: 0.0280 inner_cls_loss: 0.1629
2023-12-07 00:55:25,659 - INFO - Epoch(train)[94/100][40/58]lr: 6.3936e-04  eta: 0:13:12  time: 86.6584  inter_cls_loss: 0.0376 inner_cls_loss: 0.1809
2023-12-07 00:55:54,108 - INFO - Epoch(test) test/all/:
2023-12-07 00:56:39,437 - INFO - Epoch(test) : [20/31]
2023-12-07 00:56:57,828 - INFO - Metrics for ship: Accuracy: 0.9649, Precision: 0.8850, Recall: 0.9071, F1_score: 0.8959, Average_Precision: 0.9529
2023-12-07 00:56:57,858 - INFO - Epoch(test) test/offshore/:
2023-12-07 00:57:42,986 - INFO - Epoch(test) : [20/26]
2023-12-07 00:57:52,746 - INFO - Metrics for ship: Accuracy: 0.9655, Precision: 0.9438, Recall: 0.9578, F1_score: 0.9508, Average_Precision: 0.9795
2023-12-07 00:57:52,754 - INFO - Epoch(test) test/inshore/:
2023-12-07 00:58:09,688 - INFO - Metrics for ship: Accuracy: 0.9564, Precision: 0.7719, Recall: 0.8505, F1_score: 0.8093, Average_Precision: 0.8569
2023-12-07 00:58:10,724 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 00:59:02,490 - INFO - Epoch(train)[95/100][20/58]lr: 6.2056e-04  eta: 0:14:8  time: 51.7647  inter_cls_loss: 0.0351 inner_cls_loss: 0.1694
2023-12-07 00:59:36,998 - INFO - Epoch(train)[95/100][40/58]lr: 6.2056e-04  eta: 0:11:4  time: 86.2721  inter_cls_loss: 0.0168 inner_cls_loss: 0.1444
2023-12-07 01:00:05,984 - INFO - Epoch(test) test/all/:
2023-12-07 01:00:51,180 - INFO - Epoch(test) : [20/31]
2023-12-07 01:01:09,063 - INFO - Metrics for ship: Accuracy: 0.9655, Precision: 0.8949, Recall: 0.8985, F1_score: 0.8967, Average_Precision: 0.9516
2023-12-07 01:01:09,103 - INFO - Epoch(test) test/offshore/:
2023-12-07 01:01:52,836 - INFO - Epoch(test) : [20/26]
2023-12-07 01:02:03,329 - INFO - Metrics for ship: Accuracy: 0.9685, Precision: 0.9580, Recall: 0.9512, F1_score: 0.9546, Average_Precision: 0.9844
2023-12-07 01:02:03,331 - INFO - Epoch(test) test/inshore/:
2023-12-07 01:02:20,758 - INFO - Metrics for ship: Accuracy: 0.9584, Precision: 0.7883, Recall: 0.8453, F1_score: 0.8158, Average_Precision: 0.8623
2023-12-07 01:02:21,983 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 01:02:22,040 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 5eff9b547236af6732ccb29d1127cb58, with test/inshore/ image AP 0.8623
2023-12-07 01:03:13,677 - INFO - Epoch(train)[96/100][20/58]lr: 6.0157e-04  eta: 0:11:37  time: 51.6354  inter_cls_loss: 0.0357 inner_cls_loss: 0.1541
2023-12-07 01:03:47,773 - INFO - Epoch(train)[96/100][40/58]lr: 6.0157e-04  eta: 0:8:55  time: 85.7315  inter_cls_loss: 0.0275 inner_cls_loss: 0.1509
2023-12-07 01:04:16,148 - INFO - Epoch(test) test/all/:
2023-12-07 01:05:01,244 - INFO - Epoch(test) : [20/31]
2023-12-07 01:05:18,784 - INFO - Metrics for ship: Accuracy: 0.9661, Precision: 0.8905, Recall: 0.9078, F1_score: 0.8990, Average_Precision: 0.9534
2023-12-07 01:05:18,827 - INFO - Epoch(test) test/offshore/:
2023-12-07 01:06:02,162 - INFO - Epoch(test) : [20/26]
2023-12-07 01:06:11,874 - INFO - Metrics for ship: Accuracy: 0.9677, Precision: 0.9512, Recall: 0.9564, F1_score: 0.9538, Average_Precision: 0.9812
2023-12-07 01:06:11,876 - INFO - Epoch(test) test/inshore/:
2023-12-07 01:06:28,842 - INFO - Metrics for ship: Accuracy: 0.9576, Precision: 0.7747, Recall: 0.8608, F1_score: 0.8155, Average_Precision: 0.8670
2023-12-07 01:06:29,884 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 01:06:29,938 - INFO - Best model saved to  work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 6a15caa66c7788d9d7f6f3553a9d7443, with test/inshore/ image AP 0.8670
2023-12-07 01:07:20,888 - INFO - Epoch(train)[97/100][20/58]lr: 5.8244e-04  eta: 0:9:0  time: 50.9485  inter_cls_loss: 0.0387 inner_cls_loss: 0.1616
2023-12-07 01:07:55,502 - INFO - Epoch(train)[97/100][40/58]lr: 5.8244e-04  eta: 0:6:50  time: 85.5619  inter_cls_loss: 0.0287 inner_cls_loss: 0.1437
2023-12-07 01:08:25,190 - INFO - Epoch(test) test/all/:
2023-12-07 01:09:10,500 - INFO - Epoch(test) : [20/31]
2023-12-07 01:09:28,431 - INFO - Metrics for ship: Accuracy: 0.9674, Precision: 0.9017, Recall: 0.9023, F1_score: 0.9020, Average_Precision: 0.9535
2023-12-07 01:09:28,460 - INFO - Epoch(test) test/offshore/:
2023-12-07 01:10:11,887 - INFO - Epoch(test) : [20/26]
2023-12-07 01:10:22,042 - INFO - Metrics for ship: Accuracy: 0.9687, Precision: 0.9550, Recall: 0.9551, F1_score: 0.9550, Average_Precision: 0.9805
2023-12-07 01:10:22,045 - INFO - Epoch(test) test/inshore/:
2023-12-07 01:10:38,960 - INFO - Metrics for ship: Accuracy: 0.9587, Precision: 0.7877, Recall: 0.8497, F1_score: 0.8175, Average_Precision: 0.8569
2023-12-07 01:10:40,079 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 01:11:29,550 - INFO - Epoch(train)[98/100][20/58]lr: 5.6318e-04  eta: 0:6:20  time: 49.4655  inter_cls_loss: 0.0231 inner_cls_loss: 0.1308
2023-12-07 01:12:05,449 - INFO - Epoch(train)[98/100][40/58]lr: 5.6318e-04  eta: 0:4:45  time: 85.3663  inter_cls_loss: 0.0216 inner_cls_loss: 0.1235
2023-12-07 01:12:34,688 - INFO - Epoch(test) test/all/:
2023-12-07 01:13:18,903 - INFO - Epoch(test) : [20/31]
2023-12-07 01:13:35,945 - INFO - Metrics for ship: Accuracy: 0.9666, Precision: 0.9004, Recall: 0.8985, F1_score: 0.8995, Average_Precision: 0.9512
2023-12-07 01:13:35,982 - INFO - Epoch(test) test/offshore/:
2023-12-07 01:14:18,375 - INFO - Epoch(test) : [20/26]
2023-12-07 01:14:28,817 - INFO - Metrics for ship: Accuracy: 0.9673, Precision: 0.9531, Recall: 0.9528, F1_score: 0.9530, Average_Precision: 0.9827
2023-12-07 01:14:28,820 - INFO - Epoch(test) test/inshore/:
2023-12-07 01:14:46,039 - INFO - Metrics for ship: Accuracy: 0.9579, Precision: 0.7848, Recall: 0.8449, F1_score: 0.8137, Average_Precision: 0.8594
2023-12-07 01:14:47,085 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 01:15:37,814 - INFO - Epoch(train)[99/100][20/58]lr: 5.4384e-04  eta: 0:4:3  time: 50.7283  inter_cls_loss: 0.0310 inner_cls_loss: 0.1355
2023-12-07 01:16:10,639 - INFO - Epoch(train)[99/100][40/58]lr: 5.4384e-04  eta: 0:2:38  time: 83.5497  inter_cls_loss: 0.0162 inner_cls_loss: 0.1074
2023-12-07 01:16:40,597 - INFO - Epoch(test) test/all/:
2023-12-07 01:17:25,576 - INFO - Epoch(test) : [20/31]
2023-12-07 01:17:43,224 - INFO - Metrics for ship: Accuracy: 0.9653, Precision: 0.8833, Recall: 0.9119, F1_score: 0.8973, Average_Precision: 0.9510
2023-12-07 01:17:43,253 - INFO - Epoch(test) test/offshore/:
2023-12-07 01:18:26,528 - INFO - Epoch(test) : [20/26]
2023-12-07 01:18:36,084 - INFO - Metrics for ship: Accuracy: 0.9678, Precision: 0.9517, Recall: 0.9561, F1_score: 0.9539, Average_Precision: 0.9819
2023-12-07 01:18:36,088 - INFO - Epoch(test) test/inshore/:
2023-12-07 01:18:53,225 - INFO - Metrics for ship: Accuracy: 0.9561, Precision: 0.7685, Recall: 0.8538, F1_score: 0.8089, Average_Precision: 0.8486
2023-12-07 01:18:54,337 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 01:19:45,612 - INFO - Epoch(train)[100/100][20/58]lr: 5.2443e-04  eta: 0:1:37  time: 51.2732  inter_cls_loss: 0.0309 inner_cls_loss: 0.1303
2023-12-07 01:20:18,771 - INFO - Epoch(train)[100/100][40/58]lr: 5.2443e-04  eta: 0:0:37  time: 84.4330  inter_cls_loss: 0.0302 inner_cls_loss: 0.1231
2023-12-07 01:20:48,526 - INFO - Epoch(test) test/all/:
2023-12-07 01:21:33,862 - INFO - Epoch(test) : [20/31]
2023-12-07 01:21:51,196 - INFO - Metrics for ship: Accuracy: 0.9654, Precision: 0.8837, Recall: 0.9120, F1_score: 0.8976, Average_Precision: 0.9516
2023-12-07 01:21:51,225 - INFO - Epoch(test) test/offshore/:
2023-12-07 01:22:33,841 - INFO - Epoch(test) : [20/26]
2023-12-07 01:22:44,721 - INFO - Metrics for ship: Accuracy: 0.9695, Precision: 0.9546, Recall: 0.9578, F1_score: 0.9562, Average_Precision: 0.9834
2023-12-07 01:22:44,725 - INFO - Epoch(test) test/inshore/:
2023-12-07 01:23:01,784 - INFO - Metrics for ship: Accuracy: 0.9556, Precision: 0.7606, Recall: 0.8648, F1_score: 0.8093, Average_Precision: 0.8574
2023-12-07 01:23:02,824 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-07 01:23:02,859 - INFO - Last model saved :work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_last_model_weight.pth
2023-12-07 01:23:02,970 - INFO - model weights saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 6a15caa66c7788d9d7f6f3553a9d7443!
2023-12-07 01:23:03,025 - INFO - model weights loaded from work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 6a15caa66c7788d9d7f6f3553a9d7443!
2023-12-07 01:23:03,025 - INFO - Epoch(test) test/all/:
2023-12-07 01:23:48,759 - INFO - Epoch(test) : [20/31]
2023-12-07 01:24:06,118 - INFO - Metrics for ship: Accuracy: 0.9661, Precision: 0.8905, Recall: 0.9078, F1_score: 0.8990, Average_Precision: 0.9534
2023-12-07 01:24:06,149 - INFO - Epoch(test) test/offshore/:
2023-12-07 01:24:50,995 - INFO - Epoch(test) : [20/26]
2023-12-07 01:25:00,235 - INFO - Metrics for ship: Accuracy: 0.9677, Precision: 0.9512, Recall: 0.9564, F1_score: 0.9538, Average_Precision: 0.9812
2023-12-07 01:25:00,240 - INFO - Epoch(test) test/inshore/:
2023-12-07 01:25:17,925 - INFO - Metrics for ship: Accuracy: 0.9576, Precision: 0.7747, Recall: 0.8608, F1_score: 0.8155, Average_Precision: 0.8670
2023-12-07 01:25:19,034 - INFO - PR_curve has been saved to work_dirs/hrsid_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_eval_6a15c.png!
