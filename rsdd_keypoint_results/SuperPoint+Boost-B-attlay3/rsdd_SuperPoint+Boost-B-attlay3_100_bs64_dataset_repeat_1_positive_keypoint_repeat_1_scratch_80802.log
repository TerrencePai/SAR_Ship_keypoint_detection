2023-12-04 19:29:25,198 - INFO - >>>>>=========================Start Train!===========================<<<<<
2023-12-04 19:29:25,199 - INFO - descriptor: SuperPoint+Boost-B-attlay3
2023-12-04 19:29:25,199 - INFO - num_epochs: 40
2023-12-04 19:29:25,199 - INFO - train_ratio: 1.0
2023-12-04 19:29:25,199 - INFO - batch_size: 64
2023-12-04 19:29:25,199 - INFO - num_workers: 4
2023-12-04 19:29:25,199 - INFO - print_interval: 20
2023-12-04 19:29:25,199 - INFO - eval_interval: 1
2023-12-04 19:29:25,199 - INFO - save_interval: 10
2023-12-04 19:29:25,199 - INFO - lr: 0.001
2023-12-04 19:29:25,199 - INFO - warmup_step: 20
2023-12-04 19:29:25,199 - INFO - random_seed: 0
2023-12-04 19:29:25,199 - INFO - expand_piexl: 3
2023-12-04 19:29:25,199 - INFO - test_threshold: 0.5
2023-12-04 19:29:25,199 - INFO - test_image: 
2023-12-04 19:29:25,199 - INFO - test_images: []
2023-12-04 19:29:25,199 - INFO - eval: False
2023-12-04 19:29:25,199 - INFO - save_path: work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth
2023-12-04 19:29:25,199 - INFO - log_file: work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_dataset_repeat_1_positive_keypoint_repeat_1_scratch.log
2023-12-04 19:29:25,199 - INFO - checkpoint: 
2023-12-04 19:29:25,199 - INFO - multiprocessing_context: spawn
2023-12-04 19:29:25,199 - INFO - data_root: data/rsdd
2023-12-04 19:29:25,199 - INFO - img_suffix: .jpg
2023-12-04 19:29:25,200 - INFO - train_ann_file: ['train/']
2023-12-04 19:29:25,200 - INFO - test_ann_file: ['test/all', 'test/offshore', 'test/inshore']
2023-12-04 19:29:25,200 - INFO - dataset_class: {'ship': 1}
2023-12-04 19:29:25,200 - INFO - dataset_repeat: 1
2023-12-04 19:29:25,200 - INFO - positive_keypoint_repeat: 1
2023-12-04 19:29:25,200 - INFO - image_aug: False
2023-12-04 19:29:25,200 - INFO - print: True
2023-12-04 19:29:25,200 - INFO - feature_booster_pretrained: 
2023-12-04 19:29:25,200 - INFO - device: cuda
2023-12-04 19:29:25,200 - INFO - color: ['#00FF00', '#FF00FF', '#00FF00', '#009900', '#009999', '#ff0000', '#ffff00', '#00ff00', '#00ffff', '#0000ff']
# -*- coding: UTF-8 -*-
import pycolmap # pycolmap 占用的TLS最大,放在最前面 
# 原理参考: https://github.com/pytorch/pytorch/issues/2575#issue-254038499
from extract_features import normalize_keypoints, extractor_build, extract_img_feature
from torch.utils.data import DataLoader, Dataset
from os import path as osp
from pathlib import Path
from torch import nn
import numpy as np
import matplotlib
matplotlib.use('Agg')  # 设置Agg为后端
import matplotlib.pyplot as plt
import importlib
import warnings
import logging
import random
import torch
import copy
import time
import glob
import yaml
import cv2
import os
warnings.filterwarnings('ignore')

def parse_arguments():
    parser = importlib.import_module('argparse').ArgumentParser(description="Extract feature and refine descriptor using neural network to find ship keypoint.")

    parser.add_argument(
        '--descriptor', type=str, default='SuperPoint+Boost-B-attlay3',
        help='descriptor to extract' )

    parser.add_argument(
        '--num_epochs', type=int, default=40,)

    parser.add_argument(
        '--train_ratio', type=float, default=1.0,
        help='The ratio of data used for training out of the training set' )

    parser.add_argument(
        '--batch_size', type=int, default=64,)

    parser.add_argument(
        '--num_workers', type=int, default=4,)

    parser.add_argument(
        '--print_interval', type=int, default=20,)

    parser.add_argument(
        '--eval_interval', type=int, default=1,)

    parser.add_argument(
        '--save_interval', type=int, default=10,)

    parser.add_argument(
        '--lr', type=float, default=1e-3,)

    parser.add_argument(
        '--warmup_step', type=int, default=20,)

    parser.add_argument(
        '--random_seed', type=int, default=0,)

    parser.add_argument(
        '--expand_piexl', type=int, default=3,)

    parser.add_argument(
        '--test_threshold', type=float, default=0.5,)

    parser.add_argument(
        '--test_image', type=str, default='',)
    
    parser.add_argument(
        '--test_images', nargs='*', default=[],)
    
    parser.add_argument(
        '--eval', action='store_true',)

    parser.add_argument(
        '--save_path', type=str, default='',)

    parser.add_argument(
        '--log_file', type=str, default='',)

    parser.add_argument(
        '--checkpoint', type=str, default='',)

    parser.add_argument(
        '--multiprocessing_context', type=str, default=None,)

    parser.add_argument(
        '--data_root', type=str, default='data/rsdd',)

    parser.add_argument(
        '--img_suffix', type=str, default='.jpg',)

    parser.add_argument(
        '--train_ann_file', nargs='*', default=['train/'],)

    parser.add_argument(
        '--test_ann_file', nargs='*', default=['test/all','test/offshore','test/inshore'],)

    parser.add_argument(
        '--dataset_class',
        nargs='*',
        # default=['ore-oil','Cell-Container','Fishing','LawEnforce','Dredger','Container'], # [166, 89 , 288 , 25 , 263 , 2053]
        default=["ship"],
        help='Dataset classes list. Default is ["ship"].'
    )

    parser.add_argument(
        '--dataset_repeat', type=int, default=1,)
    
    parser.add_argument(
        '--positive_keypoint_repeat', type=int, default=1,)

    parser.add_argument(
        '--image_aug', action='store_true',)
    
    parser.add_argument(
        '--print', action='store_true')

    args = parser.parse_args()
    args.dataset_class = {item: index + 1 for index, item in enumerate(args.dataset_class)}    
    return args

def calculate_md5(file_path):

    hash_md5 = importlib.import_module('hashlib').md5()
    with open(file_path, "rb") as f:
        # 以块的方式读取文件，以防文件太大
        for chunk in iter(lambda: f.read(4096), b""):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()

# 定义舰船目标关键点检测模型（示例）
class ShipKeyPointsModel(nn.Module):
    def __init__(self, args,):
        super().__init__()
        FeatureBooster = importlib.import_module('FeatureBooster.featurebooster').FeatureBooster
        MLP = importlib.import_module('FeatureBooster.featurebooster').MLP

        self.device = args.device

        with open(str(Path(__file__).parent / "config.yaml"), 'r') as f:
            config = yaml.load(f, Loader=yaml.FullLoader)
        self.config = config[args.descriptor]
        # Model
        self.feature_booster = FeatureBooster(self.config)
        # load the model
        if os.path.isfile(args.feature_booster_pretrained):
            self.feature_booster.load_state_dict(torch.load(args.feature_booster_pretrained), strict =False)
            args.logger.info(f"feature_booster weights loaded from {args.feature_booster_pretrained}!")
        self.fc_out = MLP([self.config['output_dim'], self.config['output_dim']//2, len(args.dataset_class)+1])
        self.to(args.device)
        self.args = args

    def forward(self, x):
        feat = self.feature_booster(x[...,self.config['keypoint_dim']:], x[...,:self.config['keypoint_dim']])
        x = self.fc_out(feat)
        if self.training:
            return feat, nn.functional.softmax(x, dim=-1)
        else:
            return nn.functional.softmax(x, dim=-1)

def rotate_box_90_degrees(coords):
    x1, y1, x2, y2, x3, y3, x4, y4 = coords

    # 计算中心点
    cx = (x1 + x3) / 2
    cy = (y1 + y3) / 2

    # 将矩形平移到原点，旋转90度，然后平移回去
    rotated_coords = []
    for x, y in [(x1, y1), (x2, y2), (x3, y3), (x4, y4)]:
        x_prime = -y + cy + cx
        y_prime = x - cx + cy
        rotated_coords.extend([x_prime, y_prime])

    return rotated_coords

def load_txt_info_srsdd(txt_file, args):
    data_info = {}
    img_id = osp.split(txt_file)[1][:-4]
    data_info['img_id'] = img_id
    img_name = img_id + f'.{args.img_suffix.lstrip(".")}'
    data_info['file_name'] = img_name

    img_path = txt_file.replace('.txt',f'.{args.img_suffix.lstrip(".")}').replace('labels','images')
    data_info['img_path'] = img_path

    instances = []
    with open(txt_file) as f:
        s = f.readlines()
        for si in s[2:]:
            instance = {}
            bbox_info = si.split()
            instance['bbox_label'] = args.dataset_class[bbox_info[8]] if len(args.dataset_class) > 1 else 1
            instance['ignore_flag'] = 0
            instance['bbox'] = [float(i) for i in bbox_info[:8]]
            instances.append(instance)
    data_info['instances'] = instances
    return data_info

def load_txt_info_rsdd(txt_file, args):
    data_info = {}
    img_id = osp.split(txt_file)[1][:-4]
    data_info['img_id'] = img_id
    img_name = img_id + f'.{args.img_suffix.lstrip(".")}'
    data_info['file_name'] = img_name

    img_path = txt_file.replace('.txt',f'.{args.img_suffix.lstrip(".")}').replace('labels','images')
    data_info['img_path'] = img_path

    instances = []
    with open(txt_file) as f:
        s = f.readlines()
        for si in s:
            instance = {}
            bbox_info = si.split()
            instance['bbox_label'] = args.dataset_class[bbox_info[8]] if len(args.dataset_class) > 1 else 1
            instance['ignore_flag'] = 0
            instance['bbox'] = rotate_box_90_degrees([float(i) for i in bbox_info[2:]]) # 这里标注出的矩形框和真实中间差90度。可能是标注换换的问题。
            #人为旋转90度
            instances.append(instance)
    data_info['instances'] = instances
    return data_info

def load_txt_info_hrsid(txt_file, args):
    data_info = {}
    img_id = osp.split(txt_file)[1][:-4]
    data_info['img_id'] = img_id
    img_name = img_id + f'.{args.img_suffix.lstrip(".")}'
    data_info['file_name'] = img_name

    img_path = txt_file.replace('.txt',f'.{args.img_suffix.lstrip(".")}').replace('labelTxt','images')
    data_info['img_path'] = img_path

    instances = []
    with open(txt_file) as f:
        s = f.readlines()
        for si in s:
            instance = {}
            bbox_info = si.split()
            instance['bbox_label'] = args.dataset_class[bbox_info[8]]
            instance['ignore_flag'] = 0
            instance['bbox'] = [float(i) for i in bbox_info[:8]]
            instances.append(instance)
    data_info['instances'] = instances
    return data_info

def get_keypoint_label(keypoints, data_info, args):
    bboxes = []
    bbox_label = []
    for instances in data_info['instances']:
        bboxes.append(np.array([(instances['bbox'][i], instances['bbox'][i + 1]) for i in range(0, len(instances['bbox']), 2)], dtype=np.int32))
        bbox_label.append(instances['bbox_label'])

    tmp = np.zeros(data_info['image_shape'], dtype=np.uint8)
    for box, label in zip(bboxes, bbox_label):
        cv2.fillPoly(tmp, np.array([box]), label)
    target = []
    mode = importlib.import_module('scipy.stats').mode
    for kp in keypoints: 
        region = tmp[max(0, int(kp[1] - args.expand_piexl)):min(int(kp[1] + args.expand_piexl), data_info['image_shape'][0]),
                    max(0, int(kp[0] - args.expand_piexl)):min(int(kp[0] +args.expand_piexl), data_info['image_shape'][1])]
        if region[region != 0].size > 0:
            # 计算区域的众数
            mode_val = mode(region, axis=None)[0][0]
            target.append(mode_val)
        else:
            target.append(0)  
    return np.array(target), bboxes

# 定义数据集（示例）
class ShipKeyPointsDataset(Dataset):
    def __init__(self, args, dataset_repeat = 1, pipeline = [], debug = False, **kwargs):
        super(ShipKeyPointsDataset, self).__init__()
        if len(pipeline):
            importlib.import_module('mmdet.utils').register_all_modules(init_default_scope=False)
            importlib.import_module('mmdet.utils').register_all_modules(init_default_scope=False)
        self.transform = importlib.import_module('mmengine.dataset').Compose(pipeline)
        self.debug = debug
        self.args = args
        with open(str(Path(__file__).parent / "config.yaml"), 'r') as f:
            config = yaml.load(f, Loader=yaml.FullLoader)
        self.config = config[args.descriptor]
        self.extractor = extractor_build(self.args.descriptor, device = args.device)
        if 'ann_file' in kwargs and kwargs['ann_file'] !='':
            # train case
            ann_dir = kwargs['ann_file']
            if isinstance(ann_dir, str):
                ann_dir = [ann_dir]
        else:
            ann_dir = []
        self.txt_files = []
        for path in ann_dir:
            self.txt_files.extend(glob.glob(osp.join(args.data_root, path, "**/*.txt"), recursive=True)) 
        if (not args.eval) and (args.train_ratio<1):
            self.txt_files = random.sample(self.txt_files, int(np.ceil(len(self.txt_files)*args.train_ratio)))
        if (not args.eval) and (dataset_repeat > 1):
            self.txt_files = self.txt_files*dataset_repeat
            args.logger.info(f"The dataset located in {ann_dir} was duplicated {dataset_repeat} times!")

    def __len__(self):
        return len(self.txt_files)

    def load_data_info(self, idx):
        txt_file = self.txt_files[idx]
        load_txt_info_func = globals()['load_txt_info_' + self.args.data_root.rstrip('/').split('/')[-1]]
        return load_txt_info_func(txt_file, self.args)

    def __getitem__(self, idx):
        data_info = self.load_data_info(idx)
        bboxes = []
        if (not self.args.eval) and (len(self.transform.transforms)):
            data = self.transform(data_info)
            data_instance = data['data_samples'].gt_instances
            if (len(data_info['instances'])>0) and (len(data_instance.labels)<1):
                image = cv2.cvtColor(cv2.imread(data_info['img_path']), cv2.COLOR_BGR2RGB)
                data_info['image_shape'] = image.shape[:2]
            else:            
                image = data['inputs'].cpu().numpy().transpose(1, 2, 0)
                data_info['image_shape'] = image.shape[:2]
                data_info['instances'] = [] 
                for box_id in range(len(data_instance.labels)):
                    instance = {}
                    instance['bbox_label'] = int(data_instance.labels[box_id])
                    instance['bbox'] = list(data_instance.bboxes.vertices[box_id].reshape(-1).cpu().numpy())
                    data_info['instances'].append(instance)
            del data
        else:
            image = cv2.cvtColor(cv2.imread(data_info['img_path']), cv2.COLOR_BGR2RGB)
            data_info['image_shape'] = image.shape[:2]

        keypoints, descriptors, image = extract_img_feature(self.args.descriptor, image, self.extractor)
        if keypoints.size == 0:
            message = f"{data_info['img_path']} has no keypoint founded with {self.args.descriptor}"
            print(message)
            with open(self.args.log_file, "a") as file:   
                file.write(message+'\n')
            return torch.zeros([2, self.config['keypoint_dim'] + self.config['descriptor_dim'] + 2], dtype = torch.float32, requires_grad = False).float(), data_info['img_path']
        else:
            target, bboxes = get_keypoint_label(keypoints, data_info, self.args)
            
            if (not self.args.eval) and (self.args.positive_keypoint_repeat>1) and (np.random.rand() > 0.5): # 将正样本的关键点特征进行重复，增加正样本数目
                keypoints = np.concatenate([keypoints, np.tile(keypoints[target.astype(np.bool_)], (self.args.positive_keypoint_repeat,1))], axis=0)
                descriptors = np.concatenate([descriptors, np.tile(descriptors[target.astype(np.bool_)], (self.args.positive_keypoint_repeat,1))], axis=0)
                target = np.concatenate([target, np.tile(target[target.astype(np.bool_)], self.args.positive_keypoint_repeat)], axis=0)

            # visualization
            if self.debug:
                print(f"VISUALIZATION: {data_info['img_path']}")
                kps = np.array([cv2.KeyPoint(*kp) for kp in keypoints])
                image = cv2.drawKeypoints(image, kps[target.astype(np.bool_)], None, color=(255,0,0,))
                image = cv2.drawKeypoints(image, kps[~(target.astype(np.bool_))], None, color=(0,0,255))
                image = cv2.polylines(image, bboxes, isClosed=True, color=(0, 255, 0), thickness=2)
                cv2.imwrite(f"vis_dir/{data_info['img_id']}.png", cv2.cvtColor(image, cv2.COLOR_RGB2BGR))
                
            # boosted the descriptor using trained model
            keypoints = normalize_keypoints(keypoints, image.shape).astype(np.float32)
            if 'orb' in self.args.descriptor.lower():
                descriptors = np.unpackbits(descriptors, axis=1, bitorder='little').astype(np.float32)
                descriptors = descriptors * 2.0 - 1.0
            # 最后的全一是为了区分对齐batch的padding数据
            result = torch.from_numpy(np.concatenate([keypoints, descriptors, target.reshape(-1, 1), np.ones([len(target),1])], axis=-1))
            if (not self.args.eval) and (np.random.rand() > 0.5):
                result = result[torch.randperm(len(result))]
            result.requires_grad = False
            result = result.float()
            return result, data_info['img_path']

def hex_to_rgb(hex_color):
    hex_color = hex_color.lstrip('#')
    return tuple(int(hex_color[i:i+2], 16) for i in (0, 2, 4))

def get_metric(all_labels, all_output, args):
    accuracy_score = importlib.import_module('sklearn.metrics').accuracy_score
    recall_score = importlib.import_module('sklearn.metrics').recall_score
    precision_score = importlib.import_module('sklearn.metrics').precision_score
    precision_recall_curve = importlib.import_module('sklearn.metrics').precision_recall_curve
    average_precision_score = importlib.import_module('sklearn.metrics').average_precision_score
    f1_score = importlib.import_module('sklearn.metrics').f1_score
    if isinstance(all_output, torch.Tensor):
        if all_output.requires_grad:
            all_output = all_output.detach()
        all_output = all_output.cpu().numpy()
    if isinstance(all_labels, torch.Tensor):
        all_labels = all_labels.cpu().numpy()

    metrics_per_class = {}
    Average_Precision_Curve = {}
    avg_metrics = {}
  
    dataset_class = args.dataset_class.copy()
    if len(args.dataset_class) > 1:
        dataset_class['foreground'] = 0

    all_predict = np.zeros_like(all_output, dtype=bool)
    np.put_along_axis(all_predict, np.argmax(all_output, axis=-1).reshape(-1, 1), True, axis=-1)
     
    for class_name, idx in dataset_class.items():
        # 为当前类别准备标签和预测
        if class_name in 'foreground':
            class_labels = (all_labels != idx).astype(int)
            class_output = ~all_predict[:, 0]
            ap = average_precision_score(class_labels, 1-all_output[:, idx])
            precisions, recalls, _ = precision_recall_curve(class_labels, 1-all_output[:, idx])
        else:
            class_labels = (all_labels == idx).astype(int)
            class_output = all_predict[:, idx]
            ap = average_precision_score(class_labels, all_output[:, idx])
            precisions, recalls, _ = precision_recall_curve(class_labels, all_output[:, idx])
        # 计算指标
        accuracy = accuracy_score(class_labels, class_output)
        precision = precision_score(class_labels, class_output)
        recall = recall_score(class_labels, class_output)
        f1 = f1_score(class_labels, class_output)

        metrics_per_class[class_name] = {
            'Accuracy': accuracy,
            'Precision': precision,
            'Recall': recall,
            'F1_score': f1,
            'Average_Precision': ap,
        }
        Average_Precision_Curve[class_name] = {'Precision': precisions,'Recall': recalls}
        metrics_str = ', '.join(f"{metric}: {value:.4f}" for metric, value in metrics_per_class[class_name].items())
        args.logger.info(f"Metrics for {class_name}: {metrics_str}")

    if len(args.dataset_class)>1:    
        # 计算平均值
        for metric in metrics_per_class[list(args.dataset_class.keys())[0]].keys():
            avg_metrics[metric] = np.mean([class_metrics[metric] for class_metrics in metrics_per_class.values()])
        metrics_str = ', '.join(f"{metric}: {value:.4f}" for metric, value in avg_metrics.items())
        args.logger.info(f"Average metrics: {metrics_str}")
        
        if (not ( os.path.isfile(args.test_image) or (len(args.test_images)>0) )):
            for class_name, idx in dataset_class.items():
                plt.plot(Average_Precision_Curve[class_name]['Recall'], 
                        Average_Precision_Curve[class_name]['Precision'], label=class_name, color=args.color[idx % len(args.color)])
            # 设置图例和标签
            plt.xlabel('Recall')
            plt.ylabel('Precision')
            plt.title('Precision-Recall Curve')
            plt.legend()
            if (args.eval): 
                PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_eval.png'
            else:
                PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_train.png'
            plt.savefig(PR_curve_path, bbox_inches='tight', dpi=300)
            plt.close('all') 
            args.logger.info(f"PR_curve has been saved to {PR_curve_path}:")        
        return avg_metrics, Average_Precision_Curve['foreground']
    return metrics_per_class[list(args.dataset_class.keys())[0]], Average_Precision_Curve[list(args.dataset_class.keys())[0]] 

def evaluate(model, eva_loader, args):
    model.eval()

    all_output = torch.tensor([], device=args.device)
    all_labels = torch.tensor([], device=args.device)

    with torch.no_grad():
        for i, (data, img_paths) in enumerate(eva_loader):
            data = data.to(args.device)
            outputs = model(data[:,:,:-2])
            valid = data[:,:,-1].reshape(-1).bool()
            all_output = torch.cat([all_output, outputs.view(-1,len(args.dataset_class)+1)[valid,:]], dim=0)
            all_labels = torch.cat([all_labels, data[:,:,-2].long().reshape(-1)[valid]], dim=0)

            if (i + 1) % args.print_interval == 0:
                args.logger.info(f"Epoch(test) : [{i + 1}/{len(eva_loader)}]")

    return get_metric(all_labels, all_output, args)

def test(model, test_image, args):
    model.eval()
    extractor = extractor_build(args.descriptor)
    keypoints, descriptors, image = extract_img_feature(args.descriptor, cv2.cvtColor(cv2.imread(test_image), cv2.COLOR_BGR2RGB), extractor)

    load_txt_info_func = globals()['load_txt_info_' + args.data_root.rstrip('/').split('/')[-1]]
    txt_file = test_image.replace(f'.{args.img_suffix.lstrip(".")}','.txt').replace('images','**')
    txt_file = glob.glob(txt_file, recursive=True)[0]
    data_info = load_txt_info_func(txt_file, args)
    data_info['image_shape'] = image.shape[:2]
    labels, bboxes = get_keypoint_label(keypoints, data_info, args)
    
    kps = np.array([cv2.KeyPoint(*kp) for kp in keypoints])
    # boosted the descriptor using trained model
    keypoints = normalize_keypoints(keypoints, image.shape).astype(np.float32)
    if 'orb' in args.descriptor.lower():
        descriptors = np.unpackbits(descriptors, axis=1, bitorder='little').astype(np.float32)
        descriptors = descriptors * 2.0 - 1.0
    with torch.no_grad():
        output = model(torch.from_numpy(np.concatenate([keypoints, descriptors,], axis=-1)).to(args.device).float()).cpu().numpy()

    metric_dict, PR_dict = get_metric(labels, output, args)
    # predict = (1-output[...,0]) > args.test_threshold
    predict = np.argmax(output, axis=-1)
    dataset_class = dict()
    for class_name, idx in args.dataset_class.items():
        dataset_class[str(idx)] = class_name
        index = (predict==idx) # & (output[:,idx]>args.test_threshold)
        image = cv2.drawKeypoints(image, kps[index&labels.astype(np.bool_)], None, color=hex_to_rgb(args.color[idx % len(args.color)]),) 
        image = cv2.drawKeypoints(image, kps[index&(~labels.astype(np.bool_))], None, color=hex_to_rgb(args.color[(idx+1) % len(args.color)]),) 
        # image = cv2.drawKeypoints(image, kps[(~predict)&(labels)], None, color=(0,0,255)) # Aqua蓝色 漏检
        # image = cv2.drawKeypoints(image, kps[predict&labels], None, color=(0,0,255,),) # 黄色 正确预测(正样本)
        # image = cv2.drawKeypoints(image, kps[(~predict)&(~labels)], None, color= (0, 255, 0) ) # 绿色 正确预测(负样本)
        # image = cv2.drawKeypoints(image, kps[(label)], None, color=(255,0,0,))
        # image = cv2.drawKeypoints(image, kps[~predict], None, color=(0,255,0))
    for instance in data_info['instances']:
        color=hex_to_rgb(args.color[instance['bbox_label'] % len(args.color)])
        box = np.array([(instance['bbox'][i], instance['bbox'][i + 1]) for i in range(0, len(instance['bbox']), 2)], dtype=np.int32)
        image = cv2.polylines(image, [box], isClosed=True, color=color, thickness=1)
        # cls_name = dataset_class[str(instance['bbox_label'])]
        # assert args.dataset_class[cls_name] == instance['bbox_label']
        # cv2.putText(image, cls_name, (int(instance['bbox'][0]), int(instance['bbox'][1])), cv2.FONT_HERSHEY_SIMPLEX, 0.5, color, 1)
    save_path = f"{args.data_root.rstrip('/').split('/')[-1]}_keypoint_results/{args.descriptor}/vis/" + test_image.split('/')[-1]
    if not os.path.exists(os.path.dirname(save_path)):
        os.makedirs(os.path.dirname(save_path))        
    cv2.imwrite(save_path, cv2.cvtColor(image, cv2.COLOR_RGB2BGR))
    return metric_dict, PR_dict

def worker_init_fn(worker_id, group, args):
    # torch.cuda.set_device(worker_id) 指定数加载设备
    torch.cuda.manual_seed_all(worker_id)

def custom_collate_fn(batch):
    rnn_utils = importlib.import_module('torch.nn.utils.rnn')
    results = [item[0] for item in batch]  # 提取每个样本的result
    img_paths = [item[1] for item in batch]  # 提取每个样本的img_path
    padded_results = rnn_utils.pad_sequence(results, batch_first=True, padding_value=0)
    return padded_results, img_paths

def train(model, args):
    CosineAnnealingWarmRestarts = importlib.import_module('torch.optim.lr_scheduler').CosineAnnealingWarmRestarts
    LinearLR = importlib.import_module('torch.optim.lr_scheduler').LinearLR
    MultiStepLR = importlib.import_module('torch.optim.lr_scheduler').MultiStepLR
    ChainedScheduler = importlib.import_module('torch.optim.lr_scheduler').ChainedScheduler
    clip_grad_norm_ = importlib.import_module('torch.nn.utils').clip_grad_norm_
    optimizer_class = importlib.import_module('torch.optim').AdamW
    partial = importlib.import_module('functools').partial
    train_pipeline = []
    if args.image_aug:
        train_pipeline = [
            dict(type='mmdet.LoadImageFromFile', backend_args=None),
            dict(type='mmdet.LoadAnnotations', with_bbox=True, box_type='qbox'),
            dict(
                type='mmrotate.ConvertBoxType',
                box_type_mapping=dict(gt_bboxes='rbox')),
            dict(
                type='mmrotate.RandomRotate',
                prob=0.5,
                angle_range=180,
                rotate_type='mmrotate.Rotate'),
            dict(
                type='mmdet.RandomFlip',
                prob=0.75,
                direction=['horizontal', 'vertical', 'diagonal']),
            dict(
                type='mmdet.RandomAffine',),
            dict(
                type='mmdet.PhotoMetricDistortion',),

            dict(
                type='mmrotate.ConvertBoxType',
                box_type_mapping=dict(gt_bboxes='qbox')),
            dict(type='mmdet.PackDetInputs', meta_keys=())]
    train_dataset = ShipKeyPointsDataset(args, ann_file = args.train_ann_file, dataset_repeat = args.dataset_repeat, pipeline = train_pipeline)
    train_loader = DataLoader(train_dataset, batch_size=args.batch_size, shuffle=True, 
                              num_workers=args.num_workers, collate_fn=custom_collate_fn, 
                              # worker_init_fn=partial(worker_init_fn, group='train', args = args),
                              # pin_memory=True, persistent_workers = True,
                              multiprocessing_context=args.multiprocessing_context)
    eva_loader = {}
    for ann_file in args.test_ann_file:
        eval_args = copy.deepcopy(args)
        eval_args.eval = True
        eva_dataset = ShipKeyPointsDataset(args = eval_args, ann_file = ann_file)
        eva_loader[ann_file] = DataLoader(eva_dataset, batch_size=args.batch_size, shuffle=False, 
                                num_workers=args.num_workers, collate_fn=custom_collate_fn, 
                                # worker_init_fn=partial(worker_init_fn, group='eval', args = args), 
                                # pin_memory=True, persistent_workers = True,
                                multiprocessing_context=args.multiprocessing_context)
    if args.print:
        outputs = importlib.import_module('mmengine.analysis').get_model_complexity_info(
            model,
            input_shape=None,
            inputs=train_dataset.__getitem__(0)[0][:,:-2].float().to(args.device),  # the input tensor of the model
            show_table=True,  # show the complexity table
            show_arch=False)  # show the complexity arch
        for k, v in outputs.items():
            args.logger.info(f"{k}: {v}")
    # 定义损失函数和优化器
    weight = torch.softmax(1/torch.tensor([100000.0,  166, 89 , 288 , 25 , 263 , 2053], device = args.device),dim=-1) # [100000.0,  166, 89 , 288 , 25 , 263 , 2053]

    CenterLoss = getattr(importlib.import_module("CenterLoss"), "CenterLoss")
    loss_weight = 20
    centerloss = CenterLoss(len(args.dataset_class) + 1, model.config['output_dim']).to(args.device)
    nllloss = nn.NLLLoss().to(args.device)
    param_groups = [
        {'params': model.parameters(), 'lr': args.lr, 'weight_decay': 1e-4},
        {'params': centerloss.parameters(), 'lr': args.lr, 'weight_decay': 1e-4}
    ]
    optimizer = optimizer_class(param_groups) # 
    # warmup_scheduler = LinearLR(optimizer, start_factor=1.0 / 20, end_factor=1.0, total_iters=args.warmup_step)
    scheduler = CosineAnnealingWarmRestarts(optimizer, T_0=20, T_mult=2, eta_min = 1e-5)
    # scheduler = MultiStepLR(optimizer, milestones=[40, 70, 90], gamma=0.5)
    # scheduler = ChainedScheduler([warmup_scheduler, step_scheduler])

    start_epoch = 0
    best_AP = 0.0
    if os.path.isfile(args.checkpoint):
        checkpoint = torch.load(args.checkpoint)
        model.load_state_dict(checkpoint['model_state_dict'])
        centerloss.load_state_dict(checkpoint['centerloss_state_dict'])
        optimizer.load_state_dict(checkpoint['optimizer_state_dict']),
        scheduler.load_state_dict(checkpoint['scheduler_state_dict'])
        start_epoch = checkpoint['epoch']+1
        best_AP = checkpoint['best_AP']
        args.logger.info(f'Continue training from epoch [{start_epoch}] !')

    # getGPUs = importlib.import_module('GPUtil').getGPUs
    # virtual_memory = importlib.import_module('psutil').virtual_memory
    # collect = importlib.import_module('gc').collect
    for epoch in range(start_epoch, args.num_epochs):
        start_time = time.time()
        model.train()
        for i, (data, img_paths)  in enumerate(train_loader):
            torch.cuda.empty_cache() # 在显存资源有限的情况下使用
            data = data.to(args.device)
            # collect() # 显式垃圾回收
            # memory = virtual_memory()
            # args.logger.info(f"总内存: {memory.total / (1024 ** 3):.2f} GB, 可用内存: {memory.available / (1024 ** 3):.2f} GB, 内存使用率: {memory.percent}%")
            # gpu = getGPUs()[0]
            # args.logger.info(f">>>before: GPU: {gpu.name}, 显存总量: {gpu.memoryTotal}MB, 显存使用: {gpu.memoryUsed}MB, 显存空闲: {gpu.memoryFree}MB")
            feat, outputs = model(data[:,:,:-2])
            # args.logger.info(f">>>after: GPU: {gpu.name}, 显存总量: {gpu.memoryTotal}MB, 显存使用: {gpu.memoryUsed}MB, 显存空闲: {gpu.memoryFree}MB")
            valid = data[:,:,-1].reshape(-1).bool()
            label_inc = data[:,:,-2].long().view(-1)[valid]
            feat = feat.view(-1,model.config['output_dim'])[valid,:]
            outputs = outputs.view(-1,len(args.dataset_class)+1)[valid,:]
            
            # label = nn.functional.one_hot(label_inc, num_classes= len(args.dataset_class) + 1).float()
            
            # if len(args.dataset_class) > 1: # soft_label
            #     softening_value = 0.1
            #     non_background_mask = (label_inc != 0).unsqueeze(dim=-1).repeat(1,len(args.dataset_class)+1)
            #     non_background_mask[...,0] = False
            #     label[non_background_mask] = label[non_background_mask]  * (1 - softening_value) + \
            #                                     (1 - label[non_background_mask]) * softening_value / (len(args.dataset_class)-1)  
                                                          
            # loss_cls = torch.mean(- 0.75*label * ((1-outputs)**2) *torch.log(outputs) - 0.25*((1-label) *(outputs**2)* torch.log(1-outputs)), dim = 0)
            # inter_cls_loss = torch.sum(loss_cls*weight)
            inter_cls_loss = nllloss(torch.log(outputs), label_inc)
            inner_cls_loss = centerloss(feat, label_inc)
            loss = loss_weight * inter_cls_loss + inner_cls_loss
            
            optimizer.zero_grad()
            loss.backward()
            clip_grad_norm_(model.parameters(), 35, 2)
            clip_grad_norm_(centerloss.parameters(), 35, 2)
            optimizer.step()
            del outputs, data, valid
            if (i + 1) % args.print_interval == 0:
                current_time = time.time()
                eta_seconds = (current_time - start_time) / (i+1) * ( (args.num_epochs - epoch ) * len(train_loader) - (i + 1))
                eta_str = str(int(eta_seconds // 3600)) + ':' + str(int((eta_seconds % 3600) // 60)) + ':' + str(int(eta_seconds % 60))
                # loss_str = ' '.join([f"{cls_name}:{loss_value:.4f}" for cls_name,loss_value in zip(['background'] + list(args.dataset_class.keys()), loss_cls)])
                args.logger.info(f"Epoch(train)"
                      f"[{epoch + 1}/{args.num_epochs}][{i + 1}/{len(train_loader)}]"
                      f"lr: {optimizer.param_groups[0]['lr']:.4e}  eta: {eta_str}  " 
                      f"time: {current_time - start_time:.4f}  inter_cls_loss: {inter_cls_loss:.4f} inner_cls_loss: {inner_cls_loss.item():.4f}")
        scheduler.step()
        if ((epoch+1) % args.eval_interval == 0) or (epoch == 0) or (epoch == args.num_epochs-1): #            
            for idx, ann_file in enumerate(args.test_ann_file): 
                args.logger.info(f"Epoch(test) {ann_file}:")
                metric_dict_all, PR_dict_all = evaluate(model, eva_loader[ann_file], args)
                if len(args.test_ann_file) >1:
                    plt.plot(PR_dict_all['Recall'], PR_dict_all['Precision'], label=ann_file, color=args.color[idx % len(args.color)])
            if len(args.test_ann_file) >1:
                plt.xlabel('Recall')
                plt.ylabel('Precision')
                plt.title('Precision-Recall Curve')
                plt.legend()
                PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_train.png'
                plt.savefig(PR_curve_path, bbox_inches='tight', dpi=300)
                plt.close('all') 
                args.logger.info(f"PR_curve has been saved to {PR_curve_path}:")      
                               
            # 检查是否有更好的模型，如果有，则保存权重
            if metric_dict_all['Average_Precision'] > best_AP:
                best_AP = metric_dict_all['Average_Precision']
                # 保存当前模型的权重
                torch.save(model.state_dict(), args.save_path)
                args.logger.info(f"Best model saved to  {args.save_path} with MD5 {calculate_md5(args.save_path)}, with {args.test_ann_file[-1]} image AP {best_AP:.4f}")
            if (epoch >= args.num_epochs-1):
                last_save_path = 'work_dirs/' + args.data_root.rstrip('/').split('/')[-1] + '_' + args.descriptor + f'_{args.train_ratio*100:.0f}' + '_last_model_weight.pth'
                torch.save(model.state_dict(), last_save_path)
                args.logger.info(f"Last model saved :{last_save_path}")

        if ((epoch+1) % args.save_interval == 0):
            for file_path in glob.glob(args.save_path[:-4] + '*_epoch.pth'):
                os.remove(file_path)
            torch.save({
                'model_state_dict': model.state_dict(),
                'centerloss_state_dict': centerloss.state_dict(),
                'optimizer_state_dict': optimizer.state_dict(),
                'scheduler_state_dict': scheduler.state_dict(),
                'epoch': epoch,
                'best_AP': best_AP,
                }, args.save_path[:-4] + f'_{epoch+1}_epoch.pth')

if __name__ == '__main__':
    args = parse_arguments()

    random.seed(args.random_seed)
    np.random.seed(args.random_seed)
    torch.manual_seed(args.random_seed)
    if torch.cuda.is_available():
        torch.cuda.manual_seed_all(args.random_seed)

    if ('alike' in args.descriptor.lower()) or ('superpoint' in args.descriptor.lower()) or ('hardnet' in args.descriptor.lower()) or ('sosnet' in args.descriptor.lower()):
        args.multiprocessing_context = 'spawn'

    args.feature_booster_pretrained = '' # Path(__file__).parent / str("FeatureBooster/models/" + args.descriptor + ".pth")
    pretrained_str = 'finetune' if os.path.isfile(args.feature_booster_pretrained) else 'scratch'
    args.save_path = args.save_path if len(args.save_path) else 'work_dirs/' + args.data_root.rstrip('/').split('/')[-1] + '_' + args.descriptor + f'_{args.train_ratio*100:.0f}' + f"_bs{args.batch_size}" + f'_best_model_weights_{pretrained_str}.pth'
    args.device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    # args.color = ['#ff0000', '#ffff00', '#00ff00', '#00ffff', '#0000ff', '#ff00ff', '#990000', '#999900', '#009900', '#009999'] 
    args.color = ['#00FF00', '#FF00FF', '#00FF00', '#009900', '#009999','#ff0000', '#ffff00', '#00ff00','#00ffff', '#0000ff', ] 
    model = ShipKeyPointsModel(args)
    
    # 创建日志器
    logger = logging.getLogger()
    logger.setLevel(logging.INFO)
    # 创建控制台处理程序
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.INFO)
    console_handler.setFormatter(logging.Formatter('%(asctime)s - %(levelname)s - %(message)s'))    
    logger.addHandler(console_handler)
    args.logger = logger
    if (not args.eval) and (not ( os.path.isfile(args.test_image) or (len(args.test_images)>0) )): # train
        args.log_file = args.log_file if len(args.log_file) else 'work_dirs/' + args.data_root.rstrip('/').split('/')[-1] + '_' + args.descriptor + f'_{args.train_ratio*100:.0f}' + f"_bs{args.batch_size}" + f'_dataset_repeat_{args.dataset_repeat}_positive_keypoint_repeat_{args.positive_keypoint_repeat}_{pretrained_str}.log'
        if not os.path.exists(os.path.dirname(args.log_file)):
            os.makedirs(os.path.dirname(args.log_file))
        # 创建文件处理程序
        file_handler = logging.FileHandler(args.log_file, mode='a')
        file_handler.setLevel(logging.INFO)
        file_handler.setFormatter(logging.Formatter('%(asctime)s - %(levelname)s - %(message)s'))
        # 添加处理程序到日志器
        logger.addHandler(file_handler)
        logger.info(">>>>>=========================Start Train!===========================<<<<<")
        for k, v in vars(args).items():
            if k not in 'logger':
                logger.info(f"{k}: {v}")

        if args.print: 
            with open(__file__, 'r') as file:
                lines = file.readlines()
            with open(args.log_file, "a") as file:   
                for line in lines:
                    file.write(line[:-1]+'\n')
                file.write('\n')
        train(model, args)
        args.logger.info(f"model weights saved to {args.save_path} with MD5 {calculate_md5(args.save_path)}!")
        args.checkpoint = args.save_path
        args.eval = True

    model_weights_md5 = "init_md5"
    if os.path.isfile(args.checkpoint):
        if 'cpu' in args.device.type:
            model.load_state_dict(torch.load(args.checkpoint, map_location=lambda storage, loc:storage), strict=False)
        else:
            model.load_state_dict(torch.load(args.checkpoint), strict=False)
        model_weights_md5 = calculate_md5(args.checkpoint)
        args.logger.info(f"model weights loaded from {args.checkpoint} with MD5 {model_weights_md5}!")
        model_weights_md5 = model_weights_md5[:5]

    for img in args.test_images:
        if os.path.isfile(img):
            args.logger.info(f"Epoch(test) - {img}:")
            metric_dict, PR_dict = test(model,img, args)
    if os.path.isfile(args.test_image):
        args.logger.info(f"Epoch(test) - {args.test_image}:")
        metric_dict, PR_dict = test(model, args.test_image, args)
    if args.eval:
        for idx, ann_file in enumerate(args.test_ann_file):
            args.logger.info(f"Epoch(test) {ann_file}:")
            eva_dataset = ShipKeyPointsDataset(args = args, ann_file = ann_file)
            eva_loader = DataLoader(eva_dataset, batch_size=args.batch_size, shuffle=False, 
                                    num_workers=args.num_workers, collate_fn=custom_collate_fn, 
                                    pin_memory=True, persistent_workers = True, multiprocessing_context=args.multiprocessing_context)
            metric_dict, PR_dict_all = evaluate(model, eva_loader, args)
            if len(args.test_ann_file) >1:
                plt.plot(PR_dict_all['Recall'], PR_dict_all['Precision'], label=ann_file, color=args.color[idx % len(args.color)])
        if len(args.test_ann_file) >1:
            plt.xlabel('Recall')
            plt.ylabel('Precision')
            plt.title('Precision-Recall Curve')
            plt.legend()
            PR_curve_path = 'work_dirs/' + f'{args.save_path.split("/")[-1][:-4]}_PR_curve_eval_{model_weights_md5}.png'
            plt.savefig(PR_curve_path, bbox_inches='tight', dpi=300)
            plt.close('all') 
            args.logger.info(f"PR_curve has been saved to {PR_curve_path}!"

2023-12-04 19:29:26,355 - INFO - flops: 224376416
2023-12-04 19:29:26,355 - INFO - flops_str: 0.224G
2023-12-04 19:29:26,355 - INFO - activations: 821058
2023-12-04 19:29:26,355 - INFO - activations_str: 0.821M
2023-12-04 19:29:26,355 - INFO - params: 1987522
2023-12-04 19:29:26,355 - INFO - params_str: 1.988M
2023-12-04 19:29:26,355 - INFO - out_table: 
+---------------------------+----------------------+------------+--------------+
| module                    | #parameters or shape | #flops     | #activations |
+---------------------------+----------------------+------------+--------------+
| model                     | 1.988M               | 0.224G     | 0.821M       |
|  feature_booster          |  1.954M              |  0.221G    |  0.806M      |
|   feature_booster.kenc.e… |   0.109M             |   12.276M  |   83.168K    |
|    feature_booster.kenc.… |    0.128K            |    10.848K |    3.616K    |
|    feature_booster.kenc.… |    2.112K            |    0.231M  |    7.232K    |
|    feature_booster.kenc.… |    8.32K             |    0.926M  |    14.464K   |
|    feature_booster.kenc.… |    33.024K           |    3.703M  |    28.928K   |
|    feature_booster.kenc.… |    65.792K           |    7.406M  |    28.928K   |
|   feature_booster.denc.e… |   0.197M             |   22.217M  |   86.784K    |
|    feature_booster.denc.… |    65.792K           |    7.406M  |    28.928K   |
|    feature_booster.denc.… |    65.792K           |    7.406M  |    28.928K   |
|    feature_booster.denc.… |    65.792K           |    7.406M  |    28.928K   |
|   feature_booster.attn_p… |   1.581M             |   0.179G   |   0.607M     |
|    feature_booster.attn_… |    0.527M            |    59.534M |    0.202M    |
|    feature_booster.attn_… |    0.527M            |    59.534M |    0.202M    |
|    feature_booster.attn_… |    0.527M            |    59.534M |    0.202M    |
|   feature_booster.final_… |   65.792K            |   7.406M   |   28.928K    |
|    feature_booster.final… |    (256, 256)        |            |              |
|    feature_booster.final… |    (256,)            |            |              |
|   feature_booster.layer_… |   0.512K             |   0.145M   |   0          |
|    feature_booster.layer… |    (256,)            |            |              |
|    feature_booster.layer… |    (256,)            |            |              |
|  fc_out                   |  33.154K             |  3.732M    |  14.69K      |
|   fc_out.0                |   32.896K            |   3.703M   |   14.464K    |
|    fc_out.0.weight        |    (128, 256)        |            |              |
|    fc_out.0.bias          |    (128,)            |            |              |
|   fc_out.2                |   0.258K             |   28.928K  |   0.226K     |
|    fc_out.2.weight        |    (2, 128)          |            |              |
|    fc_out.2.bias          |    (2,)              |            |              |
+---------------------------+----------------------+------------+--------------+

2023-12-04 19:29:26,355 - INFO - out_arch: 
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:29:44,110 - INFO - Epoch(train)[1/40][20/79]lr: 1.0000e-03  eta: 0:46:26  time: 17.7478  inter_cls_loss: 0.4665 inner_cls_loss: 52.8456
2023-12-04 19:29:51,451 - INFO - Epoch(train)[1/40][40/79]lr: 1.0000e-03  eta: 0:32:36  time: 25.0889  inter_cls_loss: 0.4582 inner_cls_loss: 50.3743
2023-12-04 19:29:58,674 - INFO - Epoch(train)[1/40][60/79]lr: 1.0000e-03  eta: 0:27:49  time: 32.3115  inter_cls_loss: 0.4344 inner_cls_loss: 47.2344
2023-12-04 19:30:06,246 - INFO - Epoch(test) test/all:
2023-12-04 19:30:21,862 - INFO - Epoch(test) : [20/32]
2023-12-04 19:30:26,790 - INFO - Metrics for ship: Accuracy: 0.8132, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.1472
2023-12-04 19:30:26,813 - INFO - Epoch(test) test/offshore:
2023-12-04 19:30:42,330 - INFO - Epoch(test) : [20/29]
2023-12-04 19:30:46,097 - INFO - Metrics for ship: Accuracy: 0.7785, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.1844
2023-12-04 19:30:46,099 - INFO - Epoch(test) test/inshore:
2023-12-04 19:30:52,146 - INFO - Metrics for ship: Accuracy: 0.8718, Precision: 0.0000, Recall: 0.0000, F1_score: 0.0000, Average_Precision: 0.0959
2023-12-04 19:30:52,601 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:30:52,646 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 f676a31d844275d74f8f9b645d53e7a5, with test/inshore image AP 0.0959
2023-12-04 19:31:10,216 - INFO - Epoch(train)[2/40][20/79]lr: 9.9391e-04  eta: 0:44:48  time: 17.5694  inter_cls_loss: 0.4808 inner_cls_loss: 46.3099
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:31:17,553 - INFO - Epoch(train)[2/40][40/79]lr: 9.9391e-04  eta: 0:31:33  time: 24.9064  inter_cls_loss: 0.4785 inner_cls_loss: 44.9178
2023-12-04 19:31:25,017 - INFO - Epoch(train)[2/40][60/79]lr: 9.9391e-04  eta: 0:27:9  time: 32.3703  inter_cls_loss: 0.4001 inner_cls_loss: 38.6206
2023-12-04 19:31:32,423 - INFO - Epoch(test) test/all:
2023-12-04 19:31:47,919 - INFO - Epoch(test) : [20/32]
2023-12-04 19:31:52,921 - INFO - Metrics for ship: Accuracy: 0.8767, Precision: 0.6224, Recall: 0.8643, F1_score: 0.7236, Average_Precision: 0.6119
2023-12-04 19:31:52,944 - INFO - Epoch(test) test/offshore:
2023-12-04 19:32:08,343 - INFO - Epoch(test) : [20/29]
2023-12-04 19:32:12,311 - INFO - Metrics for ship: Accuracy: 0.8957, Precision: 0.7089, Recall: 0.8978, F1_score: 0.7923, Average_Precision: 0.7045
2023-12-04 19:32:12,313 - INFO - Epoch(test) test/inshore:
2023-12-04 19:32:18,253 - INFO - Metrics for ship: Accuracy: 0.8090, Precision: 0.3852, Recall: 0.8210, F1_score: 0.5243, Average_Precision: 0.3588
2023-12-04 19:32:18,788 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:32:18,834 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 e29084b1b1de92d363887dec0def5d59, with test/inshore image AP 0.3588
2023-12-04 19:32:36,314 - INFO - Epoch(train)[3/40][20/79]lr: 9.7577e-04  eta: 0:43:26  time: 17.4788  inter_cls_loss: 0.2687 inner_cls_loss: 32.5205
2023-12-04 19:32:43,746 - INFO - Epoch(train)[3/40][40/79]lr: 9.7577e-04  eta: 0:30:44  time: 24.9124  inter_cls_loss: 0.2707 inner_cls_loss: 29.5387
2023-12-04 19:32:51,528 - INFO - Epoch(train)[3/40][60/79]lr: 9.7577e-04  eta: 0:26:43  time: 32.6930  inter_cls_loss: 0.2397 inner_cls_loss: 27.2673
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:32:58,576 - INFO - Epoch(test) test/all:
2023-12-04 19:33:14,078 - INFO - Epoch(test) : [20/32]
2023-12-04 19:33:18,954 - INFO - Metrics for ship: Accuracy: 0.8934, Precision: 0.6515, Recall: 0.9234, F1_score: 0.7640, Average_Precision: 0.8388
2023-12-04 19:33:18,973 - INFO - Epoch(test) test/offshore:
2023-12-04 19:33:34,599 - INFO - Epoch(test) : [20/29]
2023-12-04 19:33:38,386 - INFO - Metrics for ship: Accuracy: 0.9149, Precision: 0.7363, Recall: 0.9592, F1_score: 0.8331, Average_Precision: 0.8779
2023-12-04 19:33:38,389 - INFO - Epoch(test) test/inshore:
2023-12-04 19:33:44,461 - INFO - Metrics for ship: Accuracy: 0.7881, Precision: 0.3677, Recall: 0.9072, F1_score: 0.5233, Average_Precision: 0.6580
2023-12-04 19:33:45,102 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:33:45,155 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 87e62bb0eb54d43daca875545ca758b3, with test/inshore image AP 0.6580
2023-12-04 19:34:03,206 - INFO - Epoch(train)[4/40][20/79]lr: 9.4605e-04  eta: 0:43:40  time: 18.0514  inter_cls_loss: 0.1576 inner_cls_loss: 22.3896
2023-12-04 19:34:10,582 - INFO - Epoch(train)[4/40][40/79]lr: 9.4605e-04  eta: 0:30:32  time: 25.4266  inter_cls_loss: 0.1801 inner_cls_loss: 22.7758
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:34:17,732 - INFO - Epoch(train)[4/40][60/79]lr: 9.4605e-04  eta: 0:25:54  time: 32.5769  inter_cls_loss: 0.1977 inner_cls_loss: 22.6972
2023-12-04 19:34:25,257 - INFO - Epoch(test) test/all:
2023-12-04 19:34:40,824 - INFO - Epoch(test) : [20/32]
2023-12-04 19:34:45,760 - INFO - Metrics for ship: Accuracy: 0.9219, Precision: 0.7695, Recall: 0.8304, F1_score: 0.7988, Average_Precision: 0.8521
2023-12-04 19:34:45,783 - INFO - Epoch(test) test/offshore:
2023-12-04 19:35:01,493 - INFO - Epoch(test) : [20/29]
2023-12-04 19:35:05,358 - INFO - Metrics for ship: Accuracy: 0.9292, Precision: 0.8088, Recall: 0.8912, F1_score: 0.8480, Average_Precision: 0.8952
2023-12-04 19:35:05,361 - INFO - Epoch(test) test/inshore:
2023-12-04 19:35:11,205 - INFO - Metrics for ship: Accuracy: 0.8781, Precision: 0.5176, Recall: 0.7279, F1_score: 0.6050, Average_Precision: 0.6609
2023-12-04 19:35:11,854 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:35:11,906 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 2783716c594de52afe4c1408a1a8b139, with test/inshore image AP 0.6609
2023-12-04 19:35:29,513 - INFO - Epoch(train)[5/40][20/79]lr: 9.0546e-04  eta: 0:41:26  time: 17.6071  inter_cls_loss: 0.1657 inner_cls_loss: 20.4614
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:35:37,292 - INFO - Epoch(train)[5/40][40/79]lr: 9.0546e-04  eta: 0:29:39  time: 25.3830  inter_cls_loss: 0.1478 inner_cls_loss: 19.1824
2023-12-04 19:35:44,437 - INFO - Epoch(train)[5/40][60/79]lr: 9.0546e-04  eta: 0:25:9  time: 32.5291  inter_cls_loss: 0.1939 inner_cls_loss: 20.9529
2023-12-04 19:35:51,811 - INFO - Epoch(test) test/all:
2023-12-04 19:36:07,560 - INFO - Epoch(test) : [20/32]
2023-12-04 19:36:12,480 - INFO - Metrics for ship: Accuracy: 0.9248, Precision: 0.8305, Recall: 0.7506, F1_score: 0.7885, Average_Precision: 0.8711
2023-12-04 19:36:12,500 - INFO - Epoch(test) test/offshore:
2023-12-04 19:36:28,037 - INFO - Epoch(test) : [20/29]
2023-12-04 19:36:31,973 - INFO - Metrics for ship: Accuracy: 0.9304, Precision: 0.8591, Recall: 0.8205, F1_score: 0.8393, Average_Precision: 0.9108
2023-12-04 19:36:31,976 - INFO - Epoch(test) test/inshore:
2023-12-04 19:36:38,011 - INFO - Metrics for ship: Accuracy: 0.9055, Precision: 0.6231, Recall: 0.6650, F1_score: 0.6433, Average_Precision: 0.6844
2023-12-04 19:36:38,656 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:36:38,709 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 9a4acc4b33908bf0975ab4a2e11c0843, with test/inshore image AP 0.6844
2023-12-04 19:36:56,440 - INFO - Epoch(train)[6/40][20/79]lr: 8.5502e-04  eta: 0:40:33  time: 17.7270  inter_cls_loss: 0.1868 inner_cls_loss: 19.5572
2023-12-04 19:37:03,917 - INFO - Epoch(train)[6/40][40/79]lr: 8.5502e-04  eta: 0:28:37  time: 25.2081  inter_cls_loss: 0.2157 inner_cls_loss: 20.2063
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:37:11,191 - INFO - Epoch(train)[6/40][60/79]lr: 8.5502e-04  eta: 0:24:24  time: 32.4813  inter_cls_loss: 0.2000 inner_cls_loss: 19.6236
2023-12-04 19:37:19,003 - INFO - Epoch(test) test/all:
2023-12-04 19:37:34,652 - INFO - Epoch(test) : [20/32]
2023-12-04 19:37:39,530 - INFO - Metrics for ship: Accuracy: 0.9279, Precision: 0.7950, Recall: 0.8273, F1_score: 0.8108, Average_Precision: 0.8777
2023-12-04 19:37:39,550 - INFO - Epoch(test) test/offshore:
2023-12-04 19:37:54,869 - INFO - Epoch(test) : [20/29]
2023-12-04 19:37:58,744 - INFO - Metrics for ship: Accuracy: 0.9369, Precision: 0.8307, Recall: 0.8979, F1_score: 0.8630, Average_Precision: 0.9144
2023-12-04 19:37:58,747 - INFO - Epoch(test) test/inshore:
2023-12-04 19:38:04,692 - INFO - Metrics for ship: Accuracy: 0.9003, Precision: 0.5893, Recall: 0.7334, F1_score: 0.6535, Average_Precision: 0.6994
2023-12-04 19:38:05,321 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:38:05,372 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 de07fb9ee99806d150221655aff8ee63, with test/inshore image AP 0.6994
2023-12-04 19:38:22,550 - INFO - Epoch(train)[7/40][20/79]lr: 7.9595e-04  eta: 0:38:9  time: 17.1748  inter_cls_loss: 0.1786 inner_cls_loss: 17.7104
2023-12-04 19:38:30,247 - INFO - Epoch(train)[7/40][40/79]lr: 7.9595e-04  eta: 0:27:25  time: 24.8747  inter_cls_loss: 0.1585 inner_cls_loss: 16.4015
2023-12-04 19:38:37,473 - INFO - Epoch(train)[7/40][60/79]lr: 7.9595e-04  eta: 0:23:24  time: 32.1004  inter_cls_loss: 0.1609 inner_cls_loss: 16.4040
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:38:45,240 - INFO - Epoch(test) test/all:
2023-12-04 19:39:00,928 - INFO - Epoch(test) : [20/32]
2023-12-04 19:39:05,798 - INFO - Metrics for ship: Accuracy: 0.9171, Precision: 0.7194, Recall: 0.9123, F1_score: 0.8044, Average_Precision: 0.8739
2023-12-04 19:39:05,821 - INFO - Epoch(test) test/offshore:
2023-12-04 19:39:21,530 - INFO - Epoch(test) : [20/29]
2023-12-04 19:39:25,380 - INFO - Metrics for ship: Accuracy: 0.9253, Precision: 0.7596, Recall: 0.9697, F1_score: 0.8519, Average_Precision: 0.9095
2023-12-04 19:39:25,382 - INFO - Epoch(test) test/inshore:
2023-12-04 19:39:31,417 - INFO - Metrics for ship: Accuracy: 0.8655, Precision: 0.4859, Recall: 0.8403, F1_score: 0.6157, Average_Precision: 0.6928
2023-12-04 19:39:32,058 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:39:49,718 - INFO - Epoch(train)[8/40][20/79]lr: 7.2973e-04  eta: 0:38:4  time: 17.6603  inter_cls_loss: 0.1428 inner_cls_loss: 15.5476
2023-12-04 19:39:57,574 - INFO - Epoch(train)[8/40][40/79]lr: 7.2973e-04  eta: 0:27:17  time: 25.5145  inter_cls_loss: 0.1216 inner_cls_loss: 14.4053
2023-12-04 19:40:04,494 - INFO - Epoch(train)[8/40][60/79]lr: 7.2973e-04  eta: 0:22:56  time: 32.4352  inter_cls_loss: 0.1663 inner_cls_loss: 15.7242
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:40:11,934 - INFO - Epoch(test) test/all:
2023-12-04 19:40:27,576 - INFO - Epoch(test) : [20/32]
2023-12-04 19:40:32,381 - INFO - Metrics for ship: Accuracy: 0.9303, Precision: 0.8022, Recall: 0.8316, F1_score: 0.8167, Average_Precision: 0.8840
2023-12-04 19:40:32,401 - INFO - Epoch(test) test/offshore:
2023-12-04 19:40:47,982 - INFO - Epoch(test) : [20/29]
2023-12-04 19:40:52,019 - INFO - Metrics for ship: Accuracy: 0.9366, Precision: 0.8185, Recall: 0.9171, F1_score: 0.8650, Average_Precision: 0.9187
2023-12-04 19:40:52,022 - INFO - Epoch(test) test/inshore:
2023-12-04 19:40:58,024 - INFO - Metrics for ship: Accuracy: 0.8964, Precision: 0.5761, Recall: 0.7264, F1_score: 0.6426, Average_Precision: 0.6994
2023-12-04 19:40:58,661 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:40:58,713 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 82573148e668c07d506ceac9cf72f364, with test/inshore image AP 0.6994
2023-12-04 19:41:16,353 - INFO - Epoch(train)[9/40][20/79]lr: 6.5796e-04  eta: 0:36:52  time: 17.6396  inter_cls_loss: 0.1866 inner_cls_loss: 16.0486
2023-12-04 19:41:23,908 - INFO - Epoch(train)[9/40][40/79]lr: 6.5796e-04  eta: 0:26:6  time: 25.1927  inter_cls_loss: 0.1239 inner_cls_loss: 13.8830
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:41:31,389 - INFO - Epoch(train)[9/40][60/79]lr: 6.5796e-04  eta: 0:22:24  time: 32.6757  inter_cls_loss: 0.1744 inner_cls_loss: 14.9270
2023-12-04 19:41:38,945 - INFO - Epoch(test) test/all:
2023-12-04 19:41:54,651 - INFO - Epoch(test) : [20/32]
2023-12-04 19:41:59,476 - INFO - Metrics for ship: Accuracy: 0.9310, Precision: 0.7907, Recall: 0.8574, F1_score: 0.8227, Average_Precision: 0.8849
2023-12-04 19:41:59,498 - INFO - Epoch(test) test/offshore:
2023-12-04 19:42:14,975 - INFO - Epoch(test) : [20/29]
2023-12-04 19:42:18,906 - INFO - Metrics for ship: Accuracy: 0.9375, Precision: 0.8216, Recall: 0.9170, F1_score: 0.8667, Average_Precision: 0.9191
2023-12-04 19:42:18,909 - INFO - Epoch(test) test/inshore:
2023-12-04 19:42:24,843 - INFO - Metrics for ship: Accuracy: 0.8927, Precision: 0.5578, Recall: 0.7861, F1_score: 0.6526, Average_Precision: 0.7112
2023-12-04 19:42:25,478 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:42:25,537 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 0d1a7bd6fb2082bd1a96143baf75417f, with test/inshore image AP 0.7112
2023-12-04 19:42:43,005 - INFO - Epoch(train)[10/40][20/79]lr: 5.8244e-04  eta: 0:35:20  time: 17.4621  inter_cls_loss: 0.1514 inner_cls_loss: 13.9276
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:42:50,491 - INFO - Epoch(train)[10/40][40/79]lr: 5.8244e-04  eta: 0:25:2  time: 24.9524  inter_cls_loss: 0.1208 inner_cls_loss: 12.6589
2023-12-04 19:42:58,022 - INFO - Epoch(train)[10/40][60/79]lr: 5.8244e-04  eta: 0:21:33  time: 32.4847  inter_cls_loss: 0.1162 inner_cls_loss: 12.4575
2023-12-04 19:43:05,383 - INFO - Epoch(test) test/all:
2023-12-04 19:43:21,058 - INFO - Epoch(test) : [20/32]
2023-12-04 19:43:25,880 - INFO - Metrics for ship: Accuracy: 0.9323, Precision: 0.8125, Recall: 0.8289, F1_score: 0.8206, Average_Precision: 0.8903
2023-12-04 19:43:25,900 - INFO - Epoch(test) test/offshore:
2023-12-04 19:43:41,465 - INFO - Epoch(test) : [20/29]
2023-12-04 19:43:45,394 - INFO - Metrics for ship: Accuracy: 0.9378, Precision: 0.8477, Recall: 0.8766, F1_score: 0.8619, Average_Precision: 0.9237
2023-12-04 19:43:45,396 - INFO - Epoch(test) test/inshore:
2023-12-04 19:43:51,356 - INFO - Metrics for ship: Accuracy: 0.8929, Precision: 0.5588, Recall: 0.7837, F1_score: 0.6524, Average_Precision: 0.7182
2023-12-04 19:43:52,007 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:43:52,060 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 27c2fcb147e3a1ab9f94d27e47d3e98e, with test/inshore image AP 0.7182
2023-12-04 19:44:09,577 - INFO - Epoch(train)[11/40][20/79]lr: 5.0500e-04  eta: 0:34:12  time: 17.4713  inter_cls_loss: 0.0967 inner_cls_loss: 11.4672
2023-12-04 19:44:17,154 - INFO - Epoch(train)[11/40][40/79]lr: 5.0500e-04  eta: 0:24:18  time: 25.0465  inter_cls_loss: 0.1391 inner_cls_loss: 12.5419
2023-12-04 19:44:24,703 - INFO - Epoch(train)[11/40][60/79]lr: 5.0500e-04  eta: 0:20:54  time: 32.5966  inter_cls_loss: 0.1060 inner_cls_loss: 11.7530
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:44:32,033 - INFO - Epoch(test) test/all:
2023-12-04 19:44:47,748 - INFO - Epoch(test) : [20/32]
2023-12-04 19:44:52,778 - INFO - Metrics for ship: Accuracy: 0.9327, Precision: 0.8141, Recall: 0.8289, F1_score: 0.8214, Average_Precision: 0.8925
2023-12-04 19:44:52,798 - INFO - Epoch(test) test/offshore:
2023-12-04 19:45:08,527 - INFO - Epoch(test) : [20/29]
2023-12-04 19:45:12,617 - INFO - Metrics for ship: Accuracy: 0.9382, Precision: 0.8412, Recall: 0.8889, F1_score: 0.8644, Average_Precision: 0.9234
2023-12-04 19:45:12,619 - INFO - Epoch(test) test/inshore:
2023-12-04 19:45:18,557 - INFO - Metrics for ship: Accuracy: 0.9024, Precision: 0.5932, Recall: 0.7596, F1_score: 0.6661, Average_Precision: 0.7211
2023-12-04 19:45:19,210 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:45:19,263 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 0a84d4a908ba36c9b448ce304e5df689, with test/inshore image AP 0.7211
2023-12-04 19:45:37,471 - INFO - Epoch(train)[12/40][20/79]lr: 4.2756e-04  eta: 0:34:27  time: 18.2077  inter_cls_loss: 0.1607 inner_cls_loss: 12.8918
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:45:44,984 - INFO - Epoch(train)[12/40][40/79]lr: 4.2756e-04  eta: 0:24:7  time: 25.7194  inter_cls_loss: 0.1296 inner_cls_loss: 11.8354
2023-12-04 19:45:52,457 - INFO - Epoch(train)[12/40][60/79]lr: 4.2756e-04  eta: 0:20:34  time: 33.1940  inter_cls_loss: 0.1252 inner_cls_loss: 11.4079
2023-12-04 19:46:00,038 - INFO - Epoch(test) test/all:
2023-12-04 19:46:15,953 - INFO - Epoch(test) : [20/32]
2023-12-04 19:46:20,818 - INFO - Metrics for ship: Accuracy: 0.9333, Precision: 0.8139, Recall: 0.8335, F1_score: 0.8236, Average_Precision: 0.8908
2023-12-04 19:46:20,838 - INFO - Epoch(test) test/offshore:
2023-12-04 19:46:36,371 - INFO - Epoch(test) : [20/29]
2023-12-04 19:46:40,207 - INFO - Metrics for ship: Accuracy: 0.9385, Precision: 0.8417, Recall: 0.8898, F1_score: 0.8651, Average_Precision: 0.9233
2023-12-04 19:46:40,210 - INFO - Epoch(test) test/inshore:
2023-12-04 19:46:46,285 - INFO - Metrics for ship: Accuracy: 0.9038, Precision: 0.6014, Recall: 0.7406, F1_score: 0.6638, Average_Precision: 0.7150
2023-12-04 19:46:46,937 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:47:04,568 - INFO - Epoch(train)[13/40][20/79]lr: 3.5204e-04  eta: 0:32:12  time: 17.6305  inter_cls_loss: 0.1252 inner_cls_loss: 11.4879
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:47:12,168 - INFO - Epoch(train)[13/40][40/79]lr: 3.5204e-04  eta: 0:22:49  time: 25.2301  inter_cls_loss: 0.1476 inner_cls_loss: 12.0023
2023-12-04 19:47:19,567 - INFO - Epoch(train)[13/40][60/79]lr: 3.5204e-04  eta: 0:19:30  time: 32.6294  inter_cls_loss: 0.1266 inner_cls_loss: 11.1958
2023-12-04 19:47:26,916 - INFO - Epoch(test) test/all:
2023-12-04 19:47:42,606 - INFO - Epoch(test) : [20/32]
2023-12-04 19:47:47,567 - INFO - Metrics for ship: Accuracy: 0.9334, Precision: 0.8080, Recall: 0.8444, F1_score: 0.8258, Average_Precision: 0.8936
2023-12-04 19:47:47,589 - INFO - Epoch(test) test/offshore:
2023-12-04 19:48:03,262 - INFO - Epoch(test) : [20/29]
2023-12-04 19:48:07,192 - INFO - Metrics for ship: Accuracy: 0.9392, Precision: 0.8382, Recall: 0.8989, F1_score: 0.8675, Average_Precision: 0.9252
2023-12-04 19:48:07,195 - INFO - Epoch(test) test/inshore:
2023-12-04 19:48:13,054 - INFO - Metrics for ship: Accuracy: 0.8993, Precision: 0.5812, Recall: 0.7692, F1_score: 0.6621, Average_Precision: 0.7093
2023-12-04 19:48:13,694 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:48:31,754 - INFO - Epoch(train)[14/40][20/79]lr: 2.8027e-04  eta: 0:31:47  time: 18.0578  inter_cls_loss: 0.1428 inner_cls_loss: 11.4472
2023-12-04 19:48:38,751 - INFO - Epoch(train)[14/40][40/79]lr: 2.8027e-04  eta: 0:21:51  time: 25.0567  inter_cls_loss: 0.1529 inner_cls_loss: 11.7103
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:48:46,659 - INFO - Epoch(train)[14/40][60/79]lr: 2.8027e-04  eta: 0:18:58  time: 32.9635  inter_cls_loss: 0.1671 inner_cls_loss: 12.0067
2023-12-04 19:48:53,971 - INFO - Epoch(test) test/all:
2023-12-04 19:49:09,429 - INFO - Epoch(test) : [20/32]
2023-12-04 19:49:14,324 - INFO - Metrics for ship: Accuracy: 0.9339, Precision: 0.8178, Recall: 0.8315, F1_score: 0.8246, Average_Precision: 0.8951
2023-12-04 19:49:14,344 - INFO - Epoch(test) test/offshore:
2023-12-04 19:49:29,792 - INFO - Epoch(test) : [20/29]
2023-12-04 19:49:33,710 - INFO - Metrics for ship: Accuracy: 0.9398, Precision: 0.8504, Recall: 0.8834, F1_score: 0.8666, Average_Precision: 0.9277
2023-12-04 19:49:33,713 - INFO - Epoch(test) test/inshore:
2023-12-04 19:49:39,687 - INFO - Metrics for ship: Accuracy: 0.8997, Precision: 0.5842, Recall: 0.7547, F1_score: 0.6586, Average_Precision: 0.7025
2023-12-04 19:49:40,332 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:49:58,169 - INFO - Epoch(train)[15/40][20/79]lr: 2.1405e-04  eta: 0:30:13  time: 17.8366  inter_cls_loss: 0.1261 inner_cls_loss: 10.8199
2023-12-04 19:50:05,379 - INFO - Epoch(train)[15/40][40/79]lr: 2.1405e-04  eta: 0:21:0  time: 25.0428  inter_cls_loss: 0.1036 inner_cls_loss: 10.2346
2023-12-04 19:50:12,641 - INFO - Epoch(train)[15/40][60/79]lr: 2.1405e-04  eta: 0:17:53  time: 32.3071  inter_cls_loss: 0.1711 inner_cls_loss: 11.7835
2023-12-04 19:50:19,953 - INFO - Epoch(test) test/all:
2023-12-04 19:50:35,524 - INFO - Epoch(test) : [20/32]
2023-12-04 19:50:40,504 - INFO - Metrics for ship: Accuracy: 0.9346, Precision: 0.8181, Recall: 0.8358, F1_score: 0.8268, Average_Precision: 0.8964
2023-12-04 19:50:40,526 - INFO - Epoch(test) test/offshore:
2023-12-04 19:50:56,119 - INFO - Epoch(test) : [20/29]
2023-12-04 19:50:59,932 - INFO - Metrics for ship: Accuracy: 0.9395, Precision: 0.8511, Recall: 0.8811, F1_score: 0.8658, Average_Precision: 0.9274
2023-12-04 19:50:59,934 - INFO - Epoch(test) test/inshore:
2023-12-04 19:51:05,922 - INFO - Metrics for ship: Accuracy: 0.9021, Precision: 0.5922, Recall: 0.7596, F1_score: 0.6655, Average_Precision: 0.7171
2023-12-04 19:51:06,556 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:51:23,996 - INFO - Epoch(train)[16/40][20/79]lr: 1.5498e-04  eta: 0:28:24  time: 17.4388  inter_cls_loss: 0.1061 inner_cls_loss: 10.1089
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:51:31,875 - INFO - Epoch(train)[16/40][40/79]lr: 1.5498e-04  eta: 0:20:24  time: 25.3191  inter_cls_loss: 0.1141 inner_cls_loss: 10.3411
2023-12-04 19:51:39,190 - INFO - Epoch(train)[16/40][60/79]lr: 1.5498e-04  eta: 0:17:21  time: 32.6328  inter_cls_loss: 0.1254 inner_cls_loss: 10.5861
2023-12-04 19:51:46,472 - INFO - Epoch(test) test/all:
2023-12-04 19:52:02,090 - INFO - Epoch(test) : [20/32]
2023-12-04 19:52:06,890 - INFO - Metrics for ship: Accuracy: 0.9345, Precision: 0.8153, Recall: 0.8395, F1_score: 0.8272, Average_Precision: 0.8963
2023-12-04 19:52:06,910 - INFO - Epoch(test) test/offshore:
2023-12-04 19:52:22,437 - INFO - Epoch(test) : [20/29]
2023-12-04 19:52:26,340 - INFO - Metrics for ship: Accuracy: 0.9394, Precision: 0.8508, Recall: 0.8810, F1_score: 0.8656, Average_Precision: 0.9278
2023-12-04 19:52:26,343 - INFO - Epoch(test) test/inshore:
2023-12-04 19:52:32,464 - INFO - Metrics for ship: Accuracy: 0.9015, Precision: 0.5878, Recall: 0.7755, F1_score: 0.6687, Average_Precision: 0.7158
2023-12-04 19:52:33,098 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:52:50,652 - INFO - Epoch(train)[17/40][20/79]lr: 1.0454e-04  eta: 0:27:26  time: 17.5536  inter_cls_loss: 0.1118 inner_cls_loss: 10.0408
2023-12-04 19:52:58,098 - INFO - Epoch(train)[17/40][40/79]lr: 1.0454e-04  eta: 0:19:19  time: 24.9987  inter_cls_loss: 0.0851 inner_cls_loss: 9.4476
2023-12-04 19:53:05,185 - INFO - Epoch(train)[17/40][60/79]lr: 1.0454e-04  eta: 0:16:21  time: 32.0847  inter_cls_loss: 0.1334 inner_cls_loss: 10.5150
2023-12-04 19:53:12,762 - INFO - Epoch(test) test/all:
2023-12-04 19:53:28,340 - INFO - Epoch(test) : [20/32]
2023-12-04 19:53:33,225 - INFO - Metrics for ship: Accuracy: 0.9340, Precision: 0.8253, Recall: 0.8205, F1_score: 0.8229, Average_Precision: 0.8963
2023-12-04 19:53:33,245 - INFO - Epoch(test) test/offshore:
2023-12-04 19:53:48,775 - INFO - Epoch(test) : [20/29]
2023-12-04 19:53:52,644 - INFO - Metrics for ship: Accuracy: 0.9387, Precision: 0.8582, Recall: 0.8667, F1_score: 0.8624, Average_Precision: 0.9268
2023-12-04 19:53:52,647 - INFO - Epoch(test) test/inshore:
2023-12-04 19:53:58,763 - INFO - Metrics for ship: Accuracy: 0.9054, Precision: 0.6070, Recall: 0.7445, F1_score: 0.6687, Average_Precision: 0.7151
2023-12-04 19:53:59,412 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:54:16,790 - INFO - Epoch(train)[18/40][20/79]lr: 6.3952e-05  eta: 0:26:1  time: 17.3759  inter_cls_loss: 0.1289 inner_cls_loss: 10.3305
2023-12-04 19:54:24,331 - INFO - Epoch(train)[18/40][40/79]lr: 6.3952e-05  eta: 0:18:26  time: 24.9176  inter_cls_loss: 0.1612 inner_cls_loss: 11.1824
2023-12-04 19:54:31,662 - INFO - Epoch(train)[18/40][60/79]lr: 6.3952e-05  eta: 0:15:44  time: 32.2488  inter_cls_loss: 0.1112 inner_cls_loss: 9.9948
2023-12-04 19:54:39,336 - INFO - Epoch(test) test/all:
2023-12-04 19:54:54,937 - INFO - Epoch(test) : [20/32]
2023-12-04 19:54:59,922 - INFO - Metrics for ship: Accuracy: 0.9347, Precision: 0.8243, Recall: 0.8268, F1_score: 0.8255, Average_Precision: 0.8974
2023-12-04 19:54:59,942 - INFO - Epoch(test) test/offshore:
2023-12-04 19:55:15,563 - INFO - Epoch(test) : [20/29]
2023-12-04 19:55:19,421 - INFO - Metrics for ship: Accuracy: 0.9396, Precision: 0.8575, Recall: 0.8721, F1_score: 0.8648, Average_Precision: 0.9279
2023-12-04 19:55:19,424 - INFO - Epoch(test) test/inshore:
2023-12-04 19:55:25,428 - INFO - Metrics for ship: Accuracy: 0.9047, Precision: 0.6027, Recall: 0.7529, F1_score: 0.6695, Average_Precision: 0.7135
2023-12-04 19:55:26,088 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:55:43,874 - INFO - Epoch(train)[19/40][20/79]lr: 3.4227e-05  eta: 0:25:27  time: 17.7857  inter_cls_loss: 0.1197 inner_cls_loss: 10.1382
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:55:51,356 - INFO - Epoch(train)[19/40][40/79]lr: 3.4227e-05  eta: 0:17:52  time: 25.2666  inter_cls_loss: 0.1228 inner_cls_loss: 10.3246
2023-12-04 19:55:58,857 - INFO - Epoch(train)[19/40][60/79]lr: 3.4227e-05  eta: 0:15:16  time: 32.7681  inter_cls_loss: 0.1344 inner_cls_loss: 10.3987
2023-12-04 19:56:06,358 - INFO - Epoch(test) test/all:
2023-12-04 19:56:22,174 - INFO - Epoch(test) : [20/32]
2023-12-04 19:56:27,076 - INFO - Metrics for ship: Accuracy: 0.9346, Precision: 0.8201, Recall: 0.8326, F1_score: 0.8263, Average_Precision: 0.8974
2023-12-04 19:56:27,095 - INFO - Epoch(test) test/offshore:
2023-12-04 19:56:42,648 - INFO - Epoch(test) : [20/29]
2023-12-04 19:56:46,549 - INFO - Metrics for ship: Accuracy: 0.9402, Precision: 0.8519, Recall: 0.8835, F1_score: 0.8674, Average_Precision: 0.9281
2023-12-04 19:56:46,551 - INFO - Epoch(test) test/inshore:
2023-12-04 19:56:52,643 - INFO - Metrics for ship: Accuracy: 0.9013, Precision: 0.5898, Recall: 0.7572, F1_score: 0.6631, Average_Precision: 0.7082
2023-12-04 19:56:53,313 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:57:10,995 - INFO - Epoch(train)[20/40][20/79]lr: 1.6094e-05  eta: 0:24:8  time: 17.6813  inter_cls_loss: 0.1537 inner_cls_loss: 10.9558
2023-12-04 19:57:18,480 - INFO - Epoch(train)[20/40][40/79]lr: 1.6094e-05  eta: 0:16:58  time: 25.1657  inter_cls_loss: 0.1267 inner_cls_loss: 10.0555
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:57:26,303 - INFO - Epoch(train)[20/40][60/79]lr: 1.6094e-05  eta: 0:14:39  time: 32.9896  inter_cls_loss: 0.1029 inner_cls_loss: 9.7554
2023-12-04 19:57:33,613 - INFO - Epoch(test) test/all:
2023-12-04 19:57:49,193 - INFO - Epoch(test) : [20/32]
2023-12-04 19:57:54,329 - INFO - Metrics for ship: Accuracy: 0.9350, Precision: 0.8184, Recall: 0.8379, F1_score: 0.8280, Average_Precision: 0.8975
2023-12-04 19:57:54,352 - INFO - Epoch(test) test/offshore:
2023-12-04 19:58:10,122 - INFO - Epoch(test) : [20/29]
2023-12-04 19:58:13,990 - INFO - Metrics for ship: Accuracy: 0.9400, Precision: 0.8513, Recall: 0.8832, F1_score: 0.8669, Average_Precision: 0.9280
2023-12-04 19:58:13,993 - INFO - Epoch(test) test/inshore:
2023-12-04 19:58:20,119 - INFO - Metrics for ship: Accuracy: 0.9021, Precision: 0.5918, Recall: 0.7626, F1_score: 0.6664, Average_Precision: 0.7117
2023-12-04 19:58:20,769 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:58:38,296 - INFO - Epoch(train)[21/40][20/79]lr: 1.0000e-03  eta: 0:22:43  time: 17.4758  inter_cls_loss: 0.1986 inner_cls_loss: 11.6769
2023-12-04 19:58:46,170 - INFO - Epoch(train)[21/40][40/79]lr: 1.0000e-03  eta: 0:16:16  time: 25.3542  inter_cls_loss: 0.1401 inner_cls_loss: 10.3245
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 19:58:53,912 - INFO - Epoch(train)[21/40][60/79]lr: 1.0000e-03  eta: 0:13:58  time: 33.0945  inter_cls_loss: 0.1070 inner_cls_loss: 9.2441
2023-12-04 19:59:01,428 - INFO - Epoch(test) test/all:
2023-12-04 19:59:17,045 - INFO - Epoch(test) : [20/32]
2023-12-04 19:59:22,046 - INFO - Metrics for ship: Accuracy: 0.9239, Precision: 0.8387, Recall: 0.7339, F1_score: 0.7828, Average_Precision: 0.8818
2023-12-04 19:59:22,066 - INFO - Epoch(test) test/offshore:
2023-12-04 19:59:38,312 - INFO - Epoch(test) : [20/29]
2023-12-04 19:59:41,864 - INFO - Metrics for ship: Accuracy: 0.9324, Precision: 0.8080, Recall: 0.9112, F1_score: 0.8565, Average_Precision: 0.9147
2023-12-04 19:59:41,867 - INFO - Epoch(test) test/inshore:
2023-12-04 19:59:47,894 - INFO - Metrics for ship: Accuracy: 0.9173, Precision: 0.7489, Recall: 0.5339, F1_score: 0.6234, Average_Precision: 0.7223
2023-12-04 19:59:48,894 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 19:59:48,946 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 a60fd217599f303744adec9eb6e321a9, with test/inshore image AP 0.7223
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:00:06,672 - INFO - Epoch(train)[22/40][20/79]lr: 9.9847e-04  eta: 0:21:52  time: 17.7242  inter_cls_loss: 0.2007 inner_cls_loss: 10.4270
2023-12-04 20:00:14,026 - INFO - Epoch(train)[22/40][40/79]lr: 9.9847e-04  eta: 0:15:16  time: 25.0797  inter_cls_loss: 0.1073 inner_cls_loss: 8.5275
2023-12-04 20:00:21,591 - INFO - Epoch(train)[22/40][60/79]lr: 9.9847e-04  eta: 0:13:3  time: 32.6439  inter_cls_loss: 0.1250 inner_cls_loss: 8.6016
2023-12-04 20:00:29,029 - INFO - Epoch(test) test/all:
2023-12-04 20:00:44,597 - INFO - Epoch(test) : [20/32]
2023-12-04 20:00:49,523 - INFO - Metrics for ship: Accuracy: 0.9306, Precision: 0.8488, Recall: 0.7647, F1_score: 0.8046, Average_Precision: 0.8949
2023-12-04 20:00:49,543 - INFO - Epoch(test) test/offshore:
2023-12-04 20:01:04,866 - INFO - Epoch(test) : [20/29]
2023-12-04 20:01:08,783 - INFO - Metrics for ship: Accuracy: 0.9368, Precision: 0.8667, Recall: 0.8443, F1_score: 0.8554, Average_Precision: 0.9274
2023-12-04 20:01:08,785 - INFO - Epoch(test) test/inshore:
2023-12-04 20:01:14,822 - INFO - Metrics for ship: Accuracy: 0.9062, Precision: 0.6266, Recall: 0.6635, F1_score: 0.6445, Average_Precision: 0.6976
2023-12-04 20:01:15,470 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:01:33,080 - INFO - Epoch(train)[23/40][20/79]lr: 9.9391e-04  eta: 0:20:34  time: 17.6096  inter_cls_loss: 0.1595 inner_cls_loss: 8.7288
2023-12-04 20:01:40,916 - INFO - Epoch(train)[23/40][40/79]lr: 9.9391e-04  eta: 0:14:39  time: 25.4441  inter_cls_loss: 0.1068 inner_cls_loss: 7.7582
2023-12-04 20:01:48,173 - INFO - Epoch(train)[23/40][60/79]lr: 9.9391e-04  eta: 0:12:22  time: 32.7016  inter_cls_loss: 0.1417 inner_cls_loss: 8.1386
2023-12-04 20:01:55,413 - INFO - Epoch(test) test/all:
2023-12-04 20:02:11,034 - INFO - Epoch(test) : [20/32]
2023-12-04 20:02:15,922 - INFO - Metrics for ship: Accuracy: 0.9302, Precision: 0.7747, Recall: 0.8834, F1_score: 0.8255, Average_Precision: 0.8921
2023-12-04 20:02:15,945 - INFO - Epoch(test) test/offshore:
2023-12-04 20:02:31,548 - INFO - Epoch(test) : [20/29]
2023-12-04 20:02:35,413 - INFO - Metrics for ship: Accuracy: 0.9402, Precision: 0.8326, Recall: 0.9138, F1_score: 0.8713, Average_Precision: 0.9289
2023-12-04 20:02:35,415 - INFO - Epoch(test) test/inshore:
2023-12-04 20:02:41,420 - INFO - Metrics for ship: Accuracy: 0.8823, Precision: 0.5261, Recall: 0.8262, F1_score: 0.6428, Average_Precision: 0.7085
2023-12-04 20:02:42,073 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:02:59,535 - INFO - Epoch(train)[24/40][20/79]lr: 9.8632e-04  eta: 0:19:15  time: 17.4609  inter_cls_loss: 0.1577 inner_cls_loss: 7.7679
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:03:07,373 - INFO - Epoch(train)[24/40][40/79]lr: 9.8632e-04  eta: 0:13:44  time: 25.2997  inter_cls_loss: 0.1348 inner_cls_loss: 7.3576
2023-12-04 20:03:14,677 - INFO - Epoch(train)[24/40][60/79]lr: 9.8632e-04  eta: 0:11:37  time: 32.6039  inter_cls_loss: 0.1444 inner_cls_loss: 7.2238
2023-12-04 20:03:22,108 - INFO - Epoch(test) test/all:
2023-12-04 20:03:37,908 - INFO - Epoch(test) : [20/32]
2023-12-04 20:03:42,671 - INFO - Metrics for ship: Accuracy: 0.9265, Precision: 0.7524, Recall: 0.9038, F1_score: 0.8212, Average_Precision: 0.8922
2023-12-04 20:03:42,691 - INFO - Epoch(test) test/offshore:
2023-12-04 20:03:58,206 - INFO - Epoch(test) : [20/29]
2023-12-04 20:04:02,045 - INFO - Metrics for ship: Accuracy: 0.9337, Precision: 0.7927, Recall: 0.9487, F1_score: 0.8637, Average_Precision: 0.9224
2023-12-04 20:04:02,047 - INFO - Epoch(test) test/inshore:
2023-12-04 20:04:07,960 - INFO - Metrics for ship: Accuracy: 0.8668, Precision: 0.4889, Recall: 0.8469, F1_score: 0.6199, Average_Precision: 0.7052
2023-12-04 20:04:08,600 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:04:26,069 - INFO - Epoch(train)[25/40][20/79]lr: 9.7577e-04  eta: 0:18:6  time: 17.4669  inter_cls_loss: 0.1222 inner_cls_loss: 6.5976
2023-12-04 20:04:33,905 - INFO - Epoch(train)[25/40][40/79]lr: 9.7577e-04  eta: 0:12:54  time: 25.3051  inter_cls_loss: 0.0665 inner_cls_loss: 5.8227
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:04:41,171 - INFO - Epoch(train)[25/40][60/79]lr: 9.7577e-04  eta: 0:10:53  time: 32.5707  inter_cls_loss: 0.2011 inner_cls_loss: 7.3007
2023-12-04 20:04:49,021 - INFO - Epoch(test) test/all:
2023-12-04 20:05:04,607 - INFO - Epoch(test) : [20/32]
2023-12-04 20:05:09,639 - INFO - Metrics for ship: Accuracy: 0.9314, Precision: 0.7826, Recall: 0.8764, F1_score: 0.8269, Average_Precision: 0.8890
2023-12-04 20:05:09,661 - INFO - Epoch(test) test/offshore:
2023-12-04 20:05:25,395 - INFO - Epoch(test) : [20/29]
2023-12-04 20:05:29,165 - INFO - Metrics for ship: Accuracy: 0.9379, Precision: 0.8215, Recall: 0.9193, F1_score: 0.8677, Average_Precision: 0.9208
2023-12-04 20:05:29,168 - INFO - Epoch(test) test/inshore:
2023-12-04 20:05:35,111 - INFO - Metrics for ship: Accuracy: 0.9026, Precision: 0.5860, Recall: 0.8189, F1_score: 0.6832, Average_Precision: 0.7304
2023-12-04 20:05:35,758 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:05:35,811 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 e56f180387acaf7e5c2f150d7c1de4a7, with test/inshore image AP 0.7304
2023-12-04 20:05:53,348 - INFO - Epoch(train)[26/40][20/79]lr: 9.6232e-04  eta: 0:17:1  time: 17.5358  inter_cls_loss: 0.1785 inner_cls_loss: 6.6838
2023-12-04 20:06:00,967 - INFO - Epoch(train)[26/40][40/79]lr: 9.6232e-04  eta: 0:12:0  time: 25.1548  inter_cls_loss: 0.1373 inner_cls_loss: 6.1777
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:06:08,385 - INFO - Epoch(train)[26/40][60/79]lr: 9.6232e-04  eta: 0:10:10  time: 32.5730  inter_cls_loss: 0.1211 inner_cls_loss: 5.8298
2023-12-04 20:06:15,863 - INFO - Epoch(test) test/all:
2023-12-04 20:06:31,323 - INFO - Epoch(test) : [20/32]
2023-12-04 20:06:36,346 - INFO - Metrics for ship: Accuracy: 0.9340, Precision: 0.8012, Recall: 0.8599, F1_score: 0.8295, Average_Precision: 0.8937
2023-12-04 20:06:36,367 - INFO - Epoch(test) test/offshore:
2023-12-04 20:06:52,058 - INFO - Epoch(test) : [20/29]
2023-12-04 20:06:56,035 - INFO - Metrics for ship: Accuracy: 0.9398, Precision: 0.8369, Recall: 0.9046, F1_score: 0.8694, Average_Precision: 0.9233
2023-12-04 20:06:56,039 - INFO - Epoch(test) test/inshore:
2023-12-04 20:07:01,956 - INFO - Metrics for ship: Accuracy: 0.8902, Precision: 0.5496, Recall: 0.7960, F1_score: 0.6503, Average_Precision: 0.6808
2023-12-04 20:07:02,611 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:07:20,816 - INFO - Epoch(train)[27/40][20/79]lr: 9.4605e-04  eta: 0:16:28  time: 18.2047  inter_cls_loss: 0.1236 inner_cls_loss: 5.4277
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:07:27,987 - INFO - Epoch(train)[27/40][40/79]lr: 9.4605e-04  eta: 0:11:16  time: 25.3755  inter_cls_loss: 0.1235 inner_cls_loss: 5.2902
2023-12-04 20:07:35,699 - INFO - Epoch(train)[27/40][60/79]lr: 9.4605e-04  eta: 0:9:36  time: 33.0876  inter_cls_loss: 0.0880 inner_cls_loss: 4.9699
2023-12-04 20:07:42,811 - INFO - Epoch(test) test/all:
2023-12-04 20:07:58,550 - INFO - Epoch(test) : [20/32]
2023-12-04 20:08:03,476 - INFO - Metrics for ship: Accuracy: 0.9350, Precision: 0.8228, Recall: 0.8310, F1_score: 0.8269, Average_Precision: 0.8970
2023-12-04 20:08:03,496 - INFO - Epoch(test) test/offshore:
2023-12-04 20:08:19,157 - INFO - Epoch(test) : [20/29]
2023-12-04 20:08:22,933 - INFO - Metrics for ship: Accuracy: 0.9380, Precision: 0.8531, Recall: 0.8701, F1_score: 0.8615, Average_Precision: 0.9247
2023-12-04 20:08:22,936 - INFO - Epoch(test) test/inshore:
2023-12-04 20:08:28,936 - INFO - Metrics for ship: Accuracy: 0.9131, Precision: 0.6301, Recall: 0.7798, F1_score: 0.6970, Average_Precision: 0.7466
2023-12-04 20:08:29,649 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:08:29,703 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 8d2550fdb56f68eb776f12cfd45758db, with test/inshore image AP 0.7466
2023-12-04 20:08:47,527 - INFO - Epoch(train)[28/40][20/79]lr: 9.2706e-04  eta: 0:14:57  time: 17.8226  inter_cls_loss: 0.0963 inner_cls_loss: 4.7758
2023-12-04 20:08:55,015 - INFO - Epoch(train)[28/40][40/79]lr: 9.2706e-04  eta: 0:10:24  time: 25.3111  inter_cls_loss: 0.1193 inner_cls_loss: 4.8994
2023-12-04 20:09:02,407 - INFO - Epoch(train)[28/40][60/79]lr: 9.2706e-04  eta: 0:8:47  time: 32.7032  inter_cls_loss: 0.1060 inner_cls_loss: 4.5017
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:09:09,801 - INFO - Epoch(test) test/all:
2023-12-04 20:09:25,396 - INFO - Epoch(test) : [20/32]
2023-12-04 20:09:30,327 - INFO - Metrics for ship: Accuracy: 0.9342, Precision: 0.8122, Recall: 0.8422, F1_score: 0.8270, Average_Precision: 0.8953
2023-12-04 20:09:30,350 - INFO - Epoch(test) test/offshore:
2023-12-04 20:09:45,999 - INFO - Epoch(test) : [20/29]
2023-12-04 20:09:49,898 - INFO - Metrics for ship: Accuracy: 0.9387, Precision: 0.8482, Recall: 0.8809, F1_score: 0.8643, Average_Precision: 0.9242
2023-12-04 20:09:49,901 - INFO - Epoch(test) test/inshore:
2023-12-04 20:09:55,957 - INFO - Metrics for ship: Accuracy: 0.9026, Precision: 0.5889, Recall: 0.7963, F1_score: 0.6771, Average_Precision: 0.7260
2023-12-04 20:09:56,623 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:10:14,635 - INFO - Epoch(train)[29/40][20/79]lr: 9.0546e-04  eta: 0:13:55  time: 18.0102  inter_cls_loss: 0.1437 inner_cls_loss: 4.8776
2023-12-04 20:10:21,907 - INFO - Epoch(train)[29/40][40/79]lr: 9.0546e-04  eta: 0:9:33  time: 25.2817  inter_cls_loss: 0.0847 inner_cls_loss: 4.1272
2023-12-04 20:10:28,855 - INFO - Epoch(train)[29/40][60/79]lr: 9.0546e-04  eta: 0:7:57  time: 32.2314  inter_cls_loss: 0.0985 inner_cls_loss: 4.1371
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:10:36,717 - INFO - Epoch(test) test/all:
2023-12-04 20:10:52,468 - INFO - Epoch(test) : [20/32]
2023-12-04 20:10:57,331 - INFO - Metrics for ship: Accuracy: 0.9348, Precision: 0.8145, Recall: 0.8430, F1_score: 0.8285, Average_Precision: 0.8969
2023-12-04 20:10:57,351 - INFO - Epoch(test) test/offshore:
2023-12-04 20:11:13,057 - INFO - Epoch(test) : [20/29]
2023-12-04 20:11:16,962 - INFO - Metrics for ship: Accuracy: 0.9387, Precision: 0.8401, Recall: 0.8934, F1_score: 0.8660, Average_Precision: 0.9255
2023-12-04 20:11:16,965 - INFO - Epoch(test) test/inshore:
2023-12-04 20:11:23,009 - INFO - Metrics for ship: Accuracy: 0.9172, Precision: 0.6500, Recall: 0.7671, F1_score: 0.7037, Average_Precision: 0.7550
2023-12-04 20:11:23,654 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:11:23,708 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 598afcac8f38e896dbaa4a4c18213783, with test/inshore image AP 0.7550
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:11:41,362 - INFO - Epoch(train)[30/40][20/79]lr: 8.8140e-04  eta: 0:12:29  time: 17.6532  inter_cls_loss: 0.1249 inner_cls_loss: 4.1867
2023-12-04 20:11:48,663 - INFO - Epoch(train)[30/40][40/79]lr: 8.8140e-04  eta: 0:8:37  time: 24.9531  inter_cls_loss: 0.1173 inner_cls_loss: 4.1290
2023-12-04 20:11:56,087 - INFO - Epoch(train)[30/40][60/79]lr: 8.8140e-04  eta: 0:7:16  time: 32.3781  inter_cls_loss: 0.1358 inner_cls_loss: 4.3075
2023-12-04 20:12:03,884 - INFO - Epoch(test) test/all:
2023-12-04 20:12:19,516 - INFO - Epoch(test) : [20/32]
2023-12-04 20:12:24,322 - INFO - Metrics for ship: Accuracy: 0.9353, Precision: 0.8170, Recall: 0.8426, F1_score: 0.8296, Average_Precision: 0.8989
2023-12-04 20:12:24,346 - INFO - Epoch(test) test/offshore:
2023-12-04 20:12:39,945 - INFO - Epoch(test) : [20/29]
2023-12-04 20:12:43,815 - INFO - Metrics for ship: Accuracy: 0.9379, Precision: 0.8393, Recall: 0.8901, F1_score: 0.8640, Average_Precision: 0.9235
2023-12-04 20:12:43,817 - INFO - Epoch(test) test/inshore:
2023-12-04 20:12:49,729 - INFO - Metrics for ship: Accuracy: 0.9099, Precision: 0.6164, Recall: 0.7873, F1_score: 0.6915, Average_Precision: 0.7581
2023-12-04 20:12:50,386 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:12:50,443 - INFO - Best model saved to  work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 80802ecea598dfe23f213cec94ba461f, with test/inshore image AP 0.7581
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:13:08,154 - INFO - Epoch(train)[31/40][20/79]lr: 8.5502e-04  eta: 0:11:19  time: 17.6622  inter_cls_loss: 0.1013 inner_cls_loss: 3.7506
2023-12-04 20:13:15,602 - INFO - Epoch(train)[31/40][40/79]lr: 8.5502e-04  eta: 0:7:50  time: 25.1103  inter_cls_loss: 0.1684 inner_cls_loss: 4.1173
2023-12-04 20:13:22,978 - INFO - Epoch(train)[31/40][60/79]lr: 8.5502e-04  eta: 0:6:35  time: 32.4870  inter_cls_loss: 0.1007 inner_cls_loss: 3.5640
2023-12-04 20:13:30,520 - INFO - Epoch(test) test/all:
2023-12-04 20:13:46,039 - INFO - Epoch(test) : [20/32]
2023-12-04 20:13:50,872 - INFO - Metrics for ship: Accuracy: 0.9353, Precision: 0.8236, Recall: 0.8321, F1_score: 0.8278, Average_Precision: 0.8994
2023-12-04 20:13:50,892 - INFO - Epoch(test) test/offshore:
2023-12-04 20:14:06,289 - INFO - Epoch(test) : [20/29]
2023-12-04 20:14:10,297 - INFO - Metrics for ship: Accuracy: 0.9397, Precision: 0.8594, Recall: 0.8703, F1_score: 0.8648, Average_Precision: 0.9256
2023-12-04 20:14:10,299 - INFO - Epoch(test) test/inshore:
2023-12-04 20:14:16,353 - INFO - Metrics for ship: Accuracy: 0.9104, Precision: 0.6199, Recall: 0.7798, F1_score: 0.6907, Average_Precision: 0.7401
2023-12-04 20:14:16,997 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:14:34,480 - INFO - Epoch(train)[32/40][20/79]lr: 8.2648e-04  eta: 0:10:3  time: 17.4816  inter_cls_loss: 0.1350 inner_cls_loss: 3.8273
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:14:41,985 - INFO - Epoch(train)[32/40][40/79]lr: 8.2648e-04  eta: 0:6:59  time: 24.9882  inter_cls_loss: 0.1110 inner_cls_loss: 3.5183
2023-12-04 20:14:48,978 - INFO - Epoch(train)[32/40][60/79]lr: 8.2648e-04  eta: 0:5:46  time: 31.9808  inter_cls_loss: 0.0885 inner_cls_loss: 3.2175
2023-12-04 20:14:56,915 - INFO - Epoch(test) test/all:
2023-12-04 20:15:12,447 - INFO - Epoch(test) : [20/32]
2023-12-04 20:15:17,426 - INFO - Metrics for ship: Accuracy: 0.9348, Precision: 0.8181, Recall: 0.8369, F1_score: 0.8274, Average_Precision: 0.8976
2023-12-04 20:15:17,446 - INFO - Epoch(test) test/offshore:
2023-12-04 20:15:32,834 - INFO - Epoch(test) : [20/29]
2023-12-04 20:15:36,558 - INFO - Metrics for ship: Accuracy: 0.9391, Precision: 0.8507, Recall: 0.8792, F1_score: 0.8647, Average_Precision: 0.9244
2023-12-04 20:15:36,561 - INFO - Epoch(test) test/inshore:
2023-12-04 20:15:42,599 - INFO - Metrics for ship: Accuracy: 0.9107, Precision: 0.6200, Recall: 0.7837, F1_score: 0.6923, Average_Precision: 0.7512
2023-12-04 20:15:43,234 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:16:01,136 - INFO - Epoch(train)[33/40][20/79]lr: 7.9595e-04  eta: 0:9:7  time: 17.8995  inter_cls_loss: 0.1090 inner_cls_loss: 3.2444
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:16:08,745 - INFO - Epoch(train)[33/40][40/79]lr: 7.9595e-04  eta: 0:6:17  time: 25.5091  inter_cls_loss: 0.1111 inner_cls_loss: 3.2465
2023-12-04 20:16:16,404 - INFO - Epoch(train)[33/40][60/79]lr: 7.9595e-04  eta: 0:5:16  time: 33.1699  inter_cls_loss: 0.0995 inner_cls_loss: 3.0982
2023-12-04 20:16:23,615 - INFO - Epoch(test) test/all:
2023-12-04 20:16:39,230 - INFO - Epoch(test) : [20/32]
2023-12-04 20:16:44,135 - INFO - Metrics for ship: Accuracy: 0.9339, Precision: 0.8311, Recall: 0.8111, F1_score: 0.8210, Average_Precision: 0.8960
2023-12-04 20:16:44,158 - INFO - Epoch(test) test/offshore:
2023-12-04 20:16:59,873 - INFO - Epoch(test) : [20/29]
2023-12-04 20:17:03,765 - INFO - Metrics for ship: Accuracy: 0.9371, Precision: 0.8601, Recall: 0.8550, F1_score: 0.8576, Average_Precision: 0.9254
2023-12-04 20:17:03,768 - INFO - Epoch(test) test/inshore:
2023-12-04 20:17:09,791 - INFO - Metrics for ship: Accuracy: 0.9110, Precision: 0.6277, Recall: 0.7514, F1_score: 0.6840, Average_Precision: 0.7235
2023-12-04 20:17:10,432 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:17:28,322 - INFO - Epoch(train)[34/40][20/79]lr: 7.6364e-04  eta: 0:7:56  time: 17.8897  inter_cls_loss: 0.0878 inner_cls_loss: 2.8967
2023-12-04 20:17:35,392 - INFO - Epoch(train)[34/40][40/79]lr: 7.6364e-04  eta: 0:5:20  time: 24.9594  inter_cls_loss: 0.1045 inner_cls_loss: 2.9776
2023-12-04 20:17:42,768 - INFO - Epoch(train)[34/40][60/79]lr: 7.6364e-04  eta: 0:4:25  time: 32.3347  inter_cls_loss: 0.1402 inner_cls_loss: 3.1385
2023-12-04 20:17:50,477 - INFO - Epoch(test) test/all:
2023-12-04 20:18:06,008 - INFO - Epoch(test) : [20/32]
2023-12-04 20:18:10,912 - INFO - Metrics for ship: Accuracy: 0.9327, Precision: 0.7952, Recall: 0.8617, F1_score: 0.8271, Average_Precision: 0.8902
2023-12-04 20:18:10,932 - INFO - Epoch(test) test/offshore:
2023-12-04 20:18:26,535 - INFO - Epoch(test) : [20/29]
2023-12-04 20:18:30,414 - INFO - Metrics for ship: Accuracy: 0.9404, Precision: 0.8599, Recall: 0.8732, F1_score: 0.8665, Average_Precision: 0.9274
2023-12-04 20:18:30,417 - INFO - Epoch(test) test/inshore:
2023-12-04 20:18:36,361 - INFO - Metrics for ship: Accuracy: 0.9014, Precision: 0.5811, Recall: 0.8277, F1_score: 0.6828, Average_Precision: 0.7408
2023-12-04 20:18:37,004 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:18:54,568 - INFO - Epoch(train)[35/40][20/79]lr: 7.2973e-04  eta: 0:6:38  time: 17.5592  inter_cls_loss: 0.1035 inner_cls_loss: 2.8187
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:19:02,214 - INFO - Epoch(train)[35/40][40/79]lr: 7.2973e-04  eta: 0:4:33  time: 25.2088  inter_cls_loss: 0.0713 inner_cls_loss: 2.5608
2023-12-04 20:19:09,598 - INFO - Epoch(train)[35/40][60/79]lr: 7.2973e-04  eta: 0:3:44  time: 32.5920  inter_cls_loss: 0.0887 inner_cls_loss: 2.6959
2023-12-04 20:19:17,177 - INFO - Epoch(test) test/all:
2023-12-04 20:19:32,752 - INFO - Epoch(test) : [20/32]
2023-12-04 20:19:37,712 - INFO - Metrics for ship: Accuracy: 0.9315, Precision: 0.8426, Recall: 0.7785, F1_score: 0.8093, Average_Precision: 0.8906
2023-12-04 20:19:37,733 - INFO - Epoch(test) test/offshore:
2023-12-04 20:19:53,405 - INFO - Epoch(test) : [20/29]
2023-12-04 20:19:57,272 - INFO - Metrics for ship: Accuracy: 0.9332, Precision: 0.8821, Recall: 0.8062, F1_score: 0.8424, Average_Precision: 0.9240
2023-12-04 20:19:57,275 - INFO - Epoch(test) test/inshore:
2023-12-04 20:20:03,226 - INFO - Metrics for ship: Accuracy: 0.9142, Precision: 0.6469, Recall: 0.7291, F1_score: 0.6856, Average_Precision: 0.7284
2023-12-04 20:20:04,191 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:20:21,850 - INFO - Epoch(train)[36/40][20/79]lr: 6.9443e-04  eta: 0:5:31  time: 17.6583  inter_cls_loss: 0.0849 inner_cls_loss: 2.5075
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:20:29,029 - INFO - Epoch(train)[36/40][40/79]lr: 6.9443e-04  eta: 0:3:40  time: 24.8379  inter_cls_loss: 0.0972 inner_cls_loss: 2.6080
2023-12-04 20:20:36,502 - INFO - Epoch(train)[36/40][60/79]lr: 6.9443e-04  eta: 0:3:0  time: 32.3107  inter_cls_loss: 0.1365 inner_cls_loss: 2.7581
2023-12-04 20:20:43,860 - INFO - Epoch(test) test/all:
2023-12-04 20:20:59,491 - INFO - Epoch(test) : [20/32]
2023-12-04 20:21:04,388 - INFO - Metrics for ship: Accuracy: 0.9309, Precision: 0.8343, Recall: 0.7864, F1_score: 0.8097, Average_Precision: 0.8892
2023-12-04 20:21:04,408 - INFO - Epoch(test) test/offshore:
2023-12-04 20:21:20,216 - INFO - Epoch(test) : [20/29]
2023-12-04 20:21:24,084 - INFO - Metrics for ship: Accuracy: 0.9349, Precision: 0.8753, Recall: 0.8236, F1_score: 0.8487, Average_Precision: 0.9242
2023-12-04 20:21:24,086 - INFO - Epoch(test) test/inshore:
2023-12-04 20:21:30,143 - INFO - Metrics for ship: Accuracy: 0.9129, Precision: 0.6390, Recall: 0.7370, F1_score: 0.6845, Average_Precision: 0.7446
2023-12-04 20:21:30,775 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:21:48,176 - INFO - Epoch(train)[37/40][20/79]lr: 6.5796e-04  eta: 0:4:17  time: 17.3994  inter_cls_loss: 0.0845 inner_cls_loss: 2.3596
2023-12-04 20:21:55,771 - INFO - Epoch(train)[37/40][40/79]lr: 6.5796e-04  eta: 0:2:52  time: 24.9932  inter_cls_loss: 0.0885 inner_cls_loss: 2.3356
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:22:03,087 - INFO - Epoch(train)[37/40][60/79]lr: 6.5796e-04  eta: 0:2:17  time: 32.3115  inter_cls_loss: 0.0828 inner_cls_loss: 2.2722
2023-12-04 20:22:10,521 - INFO - Epoch(test) test/all:
2023-12-04 20:22:26,193 - INFO - Epoch(test) : [20/32]
2023-12-04 20:22:31,135 - INFO - Metrics for ship: Accuracy: 0.9340, Precision: 0.8305, Recall: 0.8124, F1_score: 0.8214, Average_Precision: 0.8942
2023-12-04 20:22:31,155 - INFO - Epoch(test) test/offshore:
2023-12-04 20:22:46,847 - INFO - Epoch(test) : [20/29]
2023-12-04 20:22:50,640 - INFO - Metrics for ship: Accuracy: 0.9381, Precision: 0.8598, Recall: 0.8608, F1_score: 0.8603, Average_Precision: 0.9225
2023-12-04 20:22:50,643 - INFO - Epoch(test) test/inshore:
2023-12-04 20:22:56,606 - INFO - Metrics for ship: Accuracy: 0.9159, Precision: 0.6519, Recall: 0.7376, F1_score: 0.6921, Average_Precision: 0.7407
2023-12-04 20:22:57,248 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:23:15,007 - INFO - Epoch(train)[38/40][20/79]lr: 6.2056e-04  eta: 0:3:12  time: 17.7585  inter_cls_loss: 0.0718 inner_cls_loss: 2.0603
2023-12-04 20:23:22,130 - INFO - Epoch(train)[38/40][40/79]lr: 6.2056e-04  eta: 0:2:2  time: 24.8813  inter_cls_loss: 0.0782 inner_cls_loss: 2.1563
2023-12-04 20:23:29,380 - INFO - Epoch(train)[38/40][60/79]lr: 6.2056e-04  eta: 0:1:34  time: 32.1306  inter_cls_loss: 0.0786 inner_cls_loss: 2.0879
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:23:36,943 - INFO - Epoch(test) test/all:
2023-12-04 20:23:52,609 - INFO - Epoch(test) : [20/32]
2023-12-04 20:23:57,575 - INFO - Metrics for ship: Accuracy: 0.9326, Precision: 0.8316, Recall: 0.8015, F1_score: 0.8163, Average_Precision: 0.8929
2023-12-04 20:23:57,599 - INFO - Epoch(test) test/offshore:
2023-12-04 20:24:13,251 - INFO - Epoch(test) : [20/29]
2023-12-04 20:24:17,051 - INFO - Metrics for ship: Accuracy: 0.9364, Precision: 0.8532, Recall: 0.8611, F1_score: 0.8571, Average_Precision: 0.9223
2023-12-04 20:24:17,053 - INFO - Epoch(test) test/inshore:
2023-12-04 20:24:23,110 - INFO - Metrics for ship: Accuracy: 0.9172, Precision: 0.6665, Recall: 0.7086, F1_score: 0.6869, Average_Precision: 0.7370
2023-12-04 20:24:23,747 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:24:41,136 - INFO - Epoch(train)[39/40][20/79]lr: 5.8244e-04  eta: 0:1:59  time: 17.3871  inter_cls_loss: 0.0729 inner_cls_loss: 1.9770
2023-12-04 20:24:48,393 - INFO - Epoch(train)[39/40][40/79]lr: 5.8244e-04  eta: 0:1:12  time: 24.6456  inter_cls_loss: 0.0910 inner_cls_loss: 2.0806
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:24:56,404 - INFO - Epoch(train)[39/40][60/79]lr: 5.8244e-04  eta: 0:0:53  time: 32.6556  inter_cls_loss: 0.0671 inner_cls_loss: 1.9362
2023-12-04 20:25:03,519 - INFO - Epoch(test) test/all:
2023-12-04 20:25:19,206 - INFO - Epoch(test) : [20/32]
2023-12-04 20:25:24,150 - INFO - Metrics for ship: Accuracy: 0.9331, Precision: 0.8107, Recall: 0.8375, F1_score: 0.8239, Average_Precision: 0.8903
2023-12-04 20:25:24,170 - INFO - Epoch(test) test/offshore:
2023-12-04 20:25:39,866 - INFO - Epoch(test) : [20/29]
2023-12-04 20:25:43,819 - INFO - Metrics for ship: Accuracy: 0.9373, Precision: 0.8343, Recall: 0.8949, F1_score: 0.8635, Average_Precision: 0.9190
2023-12-04 20:25:43,821 - INFO - Epoch(test) test/inshore:
2023-12-04 20:25:49,841 - INFO - Metrics for ship: Accuracy: 0.9096, Precision: 0.6221, Recall: 0.7508, F1_score: 0.6804, Average_Precision: 0.7280
2023-12-04 20:25:50,487 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:26:08,074 - INFO - Epoch(train)[40/40][20/79]lr: 5.4384e-04  eta: 0:0:51  time: 17.5868  inter_cls_loss: 0.0752 inner_cls_loss: 1.9385
2023-12-04 20:26:15,252 - INFO - Epoch(train)[40/40][40/79]lr: 5.4384e-04  eta: 0:0:24  time: 24.7636  inter_cls_loss: 0.0786 inner_cls_loss: 1.8762
data/rsdd/train/images/186_14_18.jpg has no keypoint founded with SuperPoint+Boost-B-attlay3
2023-12-04 20:26:23,065 - INFO - Epoch(train)[40/40][60/79]lr: 5.4384e-04  eta: 0:0:10  time: 32.5760  inter_cls_loss: 0.0768 inner_cls_loss: 1.8913
2023-12-04 20:26:30,381 - INFO - Epoch(test) test/all:
2023-12-04 20:26:45,870 - INFO - Epoch(test) : [20/32]
2023-12-04 20:26:50,794 - INFO - Metrics for ship: Accuracy: 0.9305, Precision: 0.8011, Recall: 0.8350, F1_score: 0.8177, Average_Precision: 0.8835
2023-12-04 20:26:50,813 - INFO - Epoch(test) test/offshore:
2023-12-04 20:27:06,322 - INFO - Epoch(test) : [20/29]
2023-12-04 20:27:10,187 - INFO - Metrics for ship: Accuracy: 0.9364, Precision: 0.8412, Recall: 0.8786, F1_score: 0.8595, Average_Precision: 0.9191
2023-12-04 20:27:10,190 - INFO - Epoch(test) test/inshore:
2023-12-04 20:27:16,007 - INFO - Metrics for ship: Accuracy: 0.8997, Precision: 0.5828, Recall: 0.7659, F1_score: 0.6619, Average_Precision: 0.7032
2023-12-04 20:27:16,954 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_train.png:
2023-12-04 20:27:16,970 - INFO - Last model saved :work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_last_model_weight.pth
2023-12-04 20:27:17,038 - INFO - model weights saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 80802ecea598dfe23f213cec94ba461f!
2023-12-04 20:27:17,070 - INFO - model weights loaded from work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch.pth with MD5 80802ecea598dfe23f213cec94ba461f!
2023-12-04 20:27:17,070 - INFO - Epoch(test) test/all:
2023-12-04 20:27:32,587 - INFO - Epoch(test) : [20/32]
2023-12-04 20:27:36,769 - INFO - Metrics for ship: Accuracy: 0.9353, Precision: 0.8170, Recall: 0.8426, F1_score: 0.8296, Average_Precision: 0.8989
2023-12-04 20:27:36,788 - INFO - Epoch(test) test/offshore:
2023-12-04 20:27:53,249 - INFO - Epoch(test) : [20/29]
2023-12-04 20:27:56,241 - INFO - Metrics for ship: Accuracy: 0.9379, Precision: 0.8393, Recall: 0.8901, F1_score: 0.8640, Average_Precision: 0.9235
2023-12-04 20:27:56,243 - INFO - Epoch(test) test/inshore:
2023-12-04 20:28:02,366 - INFO - Metrics for ship: Accuracy: 0.9099, Precision: 0.6164, Recall: 0.7873, F1_score: 0.6915, Average_Precision: 0.7581
2023-12-04 20:28:03,007 - INFO - PR_curve has been saved to work_dirs/rsdd_SuperPoint+Boost-B-attlay3_100_bs64_best_model_weights_scratch_PR_curve_eval_80802.png!
